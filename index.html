<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IAMPHOENIX - Dashboard</title>
  <script>window.SKIP_META = true;</script>
  <script>
    // Suppress noisy extension/MetaMask RPC messages that don't affect functionality
    window.addEventListener('error', function(e){
      const m = (e && e.message) || '';
      if (m.includes('Could not establish connection') || m.includes('getEnabledChains') || m.includes('isDefaultWallet') || m.includes('Internal JSON-RPC error')) {
        e.preventDefault();
        return false;
      }
    });
    window.addEventListener('unhandledrejection', function(e){
      const r = e && e.reason;
      const msg = (r && (r.message || r)) || '';
      if (typeof msg === 'string' && (msg.includes('Could not establish connection') || msg.includes('getEnabledChains') || msg.includes('isDefaultWallet') || msg.includes('Internal JSON-RPC error'))) {
        e.preventDefault();
        return false;
      }
    });
  </script>
    <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0a0b0f; color:#e6eaf0; }
    .container { 
      max-width: 1100px; 
      margin: 0 auto; 
      padding: 24px; 
      box-sizing: border-box; 
      width: 100%;
      overflow: visible;
    }
    h1 { margin: 0 0 16px; font-size: 20px; color:#9ecbff; text-align: center; }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(2, minmax(0,1fr)); 
      gap: 16px; 
      width: 100%;
      overflow: visible;
    }
    @media (max-width: 1024px) { .grid { grid-template-columns: 1fr; gap: 14px; } }
    .card { background: #121521; border: 1px solid #1f2433; border-radius: 12px; padding: 16px; }
    .card h2 { margin: 0 0 12px; font-size: 16px; color:#aef3c6; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: space-between; }
    #contract-card h2 { margin: 0 0 8px; font-size: 16px; color: #00ff88; text-align: center; }
    .card h2:hover { color: #c4f7d6; }
    .card h2 .toggle-icon { transition: transform 0.3s ease; font-size: 16px; }
    .card h2.collapsed .toggle-icon { transform: rotate(-90deg); }
    /* Contract Info ‚Äì enhanced theming */
    #contract-card { 
      background: linear-gradient(135deg, #1a1f2e 0%, #232946 100%);
      border: 1px solid #00ff88;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
      overflow: visible;
      width: 100%;
      max-width: 100%;
      min-width: 0;
      padding: 12px 16px;
      margin: 10px 0;
    }
    #contract-card .row { 
      padding: 4px 0; 
      border-bottom: 1px dashed rgba(0,255,136,0.18);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: nowrap;
      min-width: 0;
      width: 100%;
    }
    #contract-card .row:last-child { border-bottom: 0; }
    #contract-card .label {
      font-weight: 600;
      color: #aef3c6;
      min-width: 90px;
      max-width: 90px;
      font-size: 10px;
      flex-shrink: 0;
    }
    #contract-card .value {
      flex: 1;
      font-family: monospace;
      font-size: 11px;
      color: #e6eaf0;
      word-break: break-all;
      background: rgba(0, 255, 136, 0.05);
      padding: 3px 6px;
      border-radius: 4px;
      border: 1px solid rgba(0, 255, 136, 0.1);
      min-width: 0;
      overflow-wrap: break-word;
      white-space: nowrap;
      display: flex;
      align-items: center;
      flex-wrap: nowrap;
    }
    #contract-card .value a {
      color: #60a5fa;
      text-decoration: none;
      font-weight: 600;
      font-family: monospace;
      font-size: 11px;
    }
    #contract-card .value a:hover {
      color: #93c5fd;
      text-decoration: underline;
    }
    
    /* Contract Info scroll and overflow handling */
    #contract-content {
      overflow: visible;
      width: 100%;
      max-width: 100%;
    }
    
    #contract-content.collapsed {
      display: none;
    }
    
    /* Ensure all contract data is visible */
    #contract-card {
      overflow: visible;
    }
    
    #contract-card a.value { 
      color: #9ecbff; 
      text-decoration: none; 
      background: rgba(59,130,246,0.08);
      border: 1px solid rgba(59,130,246,0.25);
    }
    #contract-card a.value:hover { 
      color: #00ff88; 
      border-color: rgba(0,255,136,0.55);
      box-shadow: 0 0 0 3px rgba(0,255,136,0.12) inset;
    }
    /* Inline USD badges next to values */
    [data-role="usd-inline"] { 
      background: rgba(167,134,255,0.08);
      border: 1px solid rgba(167,134,255,0.25);
      padding: 2px 4px; 
      border-radius: 4px;
      font-size: 10px;
      color: #a78eff;
      font-weight: 500;
      margin-left: 6px;
      display: inline-block;
      white-space: nowrap;
    }
    .card-content { 
      transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease, padding 0.3s ease; 
      overflow: hidden; 
      max-height: 1000px;
      opacity: 1;
    }
    .card-content.collapsed { 
      max-height: 0; 
      opacity: 0; 
      margin: 0; 
      padding: 0; 
    }
    .row { display: flex; justify-content: space-between; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px dashed #263048; }
    .row:last-child { border-bottom: 0; }
    .label { color:#9aa8c1; }
    .value { color:#e6eaf0; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; word-break: break-all; overflow-wrap: anywhere; }
    .actions { display:flex; gap:8px; margin-bottom:16px; }
    /* Modern Button Styles */
    button { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; 
      border: none; 
      padding: 12px 20px; 
      border-radius: 12px; 
      cursor: pointer; 
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
    }
    
    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    button.secondary { 
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      box-shadow: 0 4px 15px rgba(30, 41, 59, 0.3);
    }
    
    button.secondary:hover {
      background: linear-gradient(135deg, #334155 0%, #475569 100%);
      box-shadow: 0 8px 25px rgba(30, 41, 59, 0.4);
    }
    
    /* Special Button Variants */
    button.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    button.success:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    
    button.warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }
    
    button.warning:hover {
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
    }
    
    button.danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }
    
    button.danger:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    button.info {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    
    button.info:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }
    
    /* Button Sizes */
    button.small {
      padding: 8px 14px;
      font-size: 12px;
      border-radius: 8px;
    }
    
    button.large {
      padding: 16px 28px;
      font-size: 16px;
      border-radius: 16px;
    }
    
    /* Disabled State */
    button:disabled {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      cursor: not-allowed;
      opacity: 0.6;
      transform: none !important;
      box-shadow: 0 2px 8px rgba(107, 114, 128, 0.2) !important;
    }
    
    button:disabled:hover {
      transform: none;
      box-shadow: 0 2px 8px rgba(107, 114, 128, 0.2) !important;
    }
    .muted { color:#7f8ca8; font-size: 12px; }
    .error { color:#ff6b6b; font-size: 13px; }
    .statusbar { background:#0e1220; border:1px solid #1f2433; padding:12px 16px; border-radius:10px; display:flex; gap:8px; align-items:center; margin: 10px 0; }
    .statusbar.top { flex-wrap: wrap; }
    .statusbar.bottom { flex-wrap: nowrap; }
    .pill { background:#162032; color:#cfe2ff; padding:10px 12px; border-radius:8px; font-size:13px; border:1px solid #223150; white-space: nowrap; text-align:center; box-sizing:border-box; flex: 1; min-width: 0; }
    /* Fixed widths for bottom status bar: IAM 2/3, POL and DAI share 1/3 */
    /* Bottom bar fixed fractions: IAM = 2/4, POL = 1/4, DAI = 1/4 */
    #status-iam { flex: 0 0 50%; max-width: 50%; min-width: 0; }
    #status-matic, #status-dai { flex: 0 0 25%; max-width: 25%; min-width: 0; }
    /* Two separate status bars: top (address, index, likes, dislikes, rank) | bottom (POL, DAI, IAM) */
    @media (max-width: 640px) {
      .statusbar { padding:6px 8px; gap:4px; margin: 6px 0; }
      .statusbar.top { flex-wrap: wrap; }
      .statusbar.bottom { flex-wrap: nowrap; }
      .pill { padding:4px 6px; font-size:9px; border-radius:5px; }
    }
    .footer-links { margin: 24px 0 0; display: flex; flex-wrap: wrap; gap: 8px; }
    .footer-links a { text-decoration: none; }
    .footer-btn { 
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e6eaf0; 
      border: 1px solid #334155; 
      padding: 12px 16px; 
      border-radius: 12px; 
      font-size: 13px; 
      display: inline-block;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .footer-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .footer-btn:hover::before {
      left: 100%;
    }
    
    .footer-btn:hover { 
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border-color: #475569;
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(15, 23, 42, 0.4);
    }

    /* Creative Navigation Menu Styles */
    .nav-menu {
      margin-bottom: 24px;
    }
    
    .nav-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      row-gap: 8px;
      column-gap: 0;
      max-width: 100%;
      width: 100%;
      box-sizing: border-box;
    }
    
    .nav-card {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border: 1px solid transparent;
      border-radius: 12px;
      padding: 16px 12px;
      text-decoration: none;
      color: #e6eaf0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
      width: 31%;
      flex: 0 0 31%;
      min-height: 80px;
      box-sizing: border-box;
      box-shadow: 0 2px 8px rgba(30, 41, 59, 0.2);
      backdrop-filter: blur(5px);
    }
    
    .nav-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
      transition: left 0.6s ease;
    }
    
    .nav-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 14px;
    }
    
    .nav-card:hover::before {
      left: 100%;
    }
    
    .nav-card:hover::after {
      opacity: 1;
    }
    
    .nav-card:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(0, 255, 136, 0.3);
      border-color: #00ff88;
      background: linear-gradient(135deg, #334155 0%, #475569 100%);
    }
    
    .nav-icon {
      font-size: 24px;
      margin-bottom: 8px;
      filter: drop-shadow(0 0 6px rgba(0, 255, 136, 0.3));
      transition: all 0.3s ease;
      position: relative;
      z-index: 2;
    }
    
    .nav-label {
      font-size: 15px;
      font-weight: 600;
      color: #e6eaf0;
      text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 2;
      letter-spacing: 0.3px;
    }
    
    .nav-card:hover .nav-icon {
      transform: scale(1.1) rotate(5deg);
      filter: drop-shadow(0 0 16px rgba(0, 255, 136, 0.6));
    }
    
    .nav-card:hover .nav-label {
      color: #00ff88;
      text-shadow: 0 0 8px rgba(0, 255, 136, 0.4);
    }
    
    .nav-card:active {
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 8px 25px rgba(0, 255, 136, 0.5);
    }
    
    /* Special effects for different nav cards */
    .nav-card:nth-child(1) { /* About */
      border-left: 3px solid #3b82f6;
    }
    
    .nav-card:nth-child(2) { /* Register */
      border-left: 3px solid #10b981;
    }
    
    .nav-card:nth-child(3) { /* Profile */
      border-left: 3px solid #f59e0b;
    }
    
    .nav-card:nth-child(4) { /* Sales */
      border-left: 3px solid #ef4444;
    }
    
    .nav-card:nth-child(5) { /* Swap */
      border-left: 3px solid #8b5cf6;
    }
    
    .nav-card:nth-child(6) { /* Transfer */
      border-left: 3px solid #06b6d4;
    }
    
    .nav-card:nth-child(7) { /* Ownership */
      border-left: 3px solid #84cc16;
    }
    
    .nav-card:nth-child(8) { /* Utility */
      border-left: 3px solid #f97316;
    }
    
    .nav-card:nth-child(9) { /* Partners */
      border-left: 3px solid #ec4899;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .container { padding: 16px; }
      h1 { font-size: 18px; margin-bottom: 14px; }
      .card { padding: 14px; border-radius: 10px; }
      .card h2 { font-size: 14px; }
      
      /* Referral section mobile */
      .referral-section {
        margin-top: 16px !important;
        padding: 16px !important;
        border-radius: 10px !important;
      }
      .referral-section h3 {
        font-size: 16px !important;
        margin-bottom: 12px !important;
      }
      
      /* Additional content mobile */
      .additional-content {
        margin-top: 16px !important;
        padding: 16px !important;
        border-radius: 12px !important;
      }
      .additional-content h2 {
        font-size: 20px !important;
        margin-bottom: 16px !important;
      }
      .additional-content h3 {
        font-size: 16px !important;
        margin-bottom: 10px !important;
      }
      .additional-content p {
        font-size: 14px !important;
        margin-bottom: 12px !important;
      }
      .additional-content ul {
        padding-left: 16px !important;
      }
      .additional-content li {
        font-size: 14px !important;
        margin-bottom: 6px !important;
      }
      .row { 
        gap: 6px; 
        padding: 6px 0; 
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        width: 100%;
        min-width: 0;
      }
      .label { 
        font-size: 10px; 
        font-weight: 600;
        color: #aef3c6;
        min-width: 80px;
        max-width: 80px;
        flex-shrink: 0;
      }
      .value { 
        font-size: 12px; 
        flex: 1;
        word-break: break-all;
        font-family: monospace;
        background: rgba(0, 255, 136, 0.05);
        padding: 3px 6px;
        border-radius: 3px;
        border: 1px solid rgba(0, 255, 136, 0.1);
        min-width: 0;
        overflow-wrap: break-word;
        white-space: nowrap;
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
      }
      [data-role="usd-inline"] {
        margin-left: 4px;
        font-size: 9px;
        padding: 1px 3px;
      }
      #contract-card .value a {
        font-size: 11px;
      }
      .statusbar { gap: 8px; padding: 10px 12px; }
      .pill { font-size: 12px; padding: 8px 10px; }
      
      /* Contract Info tablet improvements */
      #contract-card {
        padding: 12px;
        overflow: visible;
      }
      #contract-card .row {
        margin-bottom: 6px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(0, 255, 136, 0.15);
        min-width: max-content;
      }
      #contract-card .row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      #contract-card h2 {
        font-size: 16px;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(0, 255, 136, 0.2);
      }
      #contract-content {
        overflow: visible;
        width: 100%;
      }
      
      /* Navigation menu mobile styles */
      .nav-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(5, auto);
        gap: 8px;
        width: 100%;
      }
      .nav-card {
        padding: 12px 8px;
        width: 100%;
        min-height: 70px;
        border-radius: 10px;
      }
      .nav-icon {
        font-size: 20px;
        margin-bottom: 6px;
      }
      .nav-label {
        font-size: 12px;
        font-weight: 600;
      }
    }

    /* Ensure floating token card sits at bottom of the page */
    #floating-token-card, .floating-token-card, .token-floating-card {
      position: fixed !important;
      bottom: 8px !important;
      right: 8px !important;
      z-index: 9999 !important;
    }

    @media (max-width: 480px) {
      .container { padding: 14px; }
      h1 { font-size: 17px; }
      .card h2 { font-size: 13px; }
      
      /* Referral section small mobile */
      .referral-section {
        margin-top: 12px !important;
        padding: 12px !important;
        border-radius: 8px !important;
      }
      .referral-section h3 {
        font-size: 14px !important;
        margin-bottom: 10px !important;
      }
      .referral-section input {
        font-size: 11px !important;
        padding: 6px 8px !important;
      }
      .referral-section button {
        font-size: 11px !important;
        padding: 6px 8px !important;
      }
      
      /* Additional content small mobile */
      .additional-content {
        margin-top: 12px !important;
        padding: 12px !important;
        border-radius: 10px !important;
      }
      .additional-content h2 {
        font-size: 18px !important;
        margin-bottom: 12px !important;
      }
      .additional-content h3 {
        font-size: 14px !important;
        margin-bottom: 8px !important;
      }
      .additional-content p {
        font-size: 13px !important;
        margin-bottom: 10px !important;
      }
      .additional-content ul {
        padding-left: 12px !important;
      }
      .additional-content li {
        font-size: 13px !important;
        margin-bottom: 4px !important;
      }
      .row { 
        flex-direction: row; 
        align-items: center; 
        gap: 4px;
        padding: 4px 0;
        width: 100%;
        min-width: 0;
      }
      .label { 
        font-size: 9px; 
        opacity: 0.95; 
        font-weight: 600;
        color: #aef3c6;
        min-width: 60px;
        max-width: 60px;
        flex-shrink: 0;
      }
      .value { 
        flex: 1; 
        text-align: left; 
        direction: ltr; 
        font-size: 11px; 
        word-break: break-all;
        font-family: monospace;
        background: rgba(0, 255, 136, 0.1);
        padding: 2px 4px;
        border-radius: 3px;
        border: 1px solid rgba(0, 255, 136, 0.2);
        min-width: 0;
        overflow-wrap: break-word;
        white-space: nowrap;
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
      }
      [data-role="usd-inline"] {
        margin-left: 3px;
        font-size: 8px;
        padding: 1px 2px;
      }
      #contract-card .value a {
        font-size: 10px;
      }
      .pill { font-size: 11px; padding: 6px 8px; }
      
      /* Contract Info mobile improvements */
      #contract-card {
        padding: 8px;
        overflow: visible;
      }
      #contract-card .row {
        margin-bottom: 4px;
        padding-bottom: 4px;
        border-bottom: 1px solid rgba(0, 255, 136, 0.1);
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      #contract-card .row:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      #contract-card h2 {
        font-size: 14px;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(0, 255, 136, 0.2);
      }
      #contract-card .label {
        font-size: 10px;
        min-width: auto;
        max-width: 100%;
        width: 100%;
        text-align: right;
      }
      #contract-card .value {
        font-size: 10px;
        padding: 3px 6px;
        word-break: break-all;
        white-space: normal;
        overflow-wrap: break-word;
        width: 100%;
        text-align: right;
      }
      #contract-content {
        overflow: visible;
        width: 100%;
      }
      
      /* Navigation menu small mobile styles */
      .nav-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(5, auto);
        gap: 6px;
        width: 100%;
      }
      .nav-card {
        padding: 10px 6px;
        width: 100%;
        min-height: 60px;
        border-radius: 8px;
      }
      .nav-icon {
        font-size: 18px;
        margin-bottom: 5px;
      }
      .nav-label {
        font-size: 11px;
        font-weight: 600;
      }
    }

    @media (max-width: 360px) {
      .container { padding: 12px; }
      h1 { font-size: 16px; }
      .card { padding: 12px; }
      .row { padding: 6px 0; }
      .pill { font-size: 10px; padding: 6px 8px; }
      
      /* Referral section extra small mobile */
      .referral-section {
        margin-top: 10px !important;
        padding: 10px !important;
        border-radius: 6px !important;
      }
      .referral-section h3 {
        font-size: 13px !important;
        margin-bottom: 8px !important;
      }
      .referral-section input {
        font-size: 10px !important;
        padding: 4px 6px !important;
      }
      .referral-section button {
        font-size: 10px !important;
        padding: 4px 6px !important;
      }
      
      /* Additional content extra small mobile */
      .additional-content {
        margin-top: 10px !important;
        padding: 10px !important;
        border-radius: 8px !important;
      }
      .additional-content h2 {
        font-size: 16px !important;
        margin-bottom: 10px !important;
      }
      .additional-content h3 {
        font-size: 13px !important;
        margin-bottom: 6px !important;
      }
      .additional-content p {
        font-size: 12px !important;
        margin-bottom: 8px !important;
      }
      .additional-content ul {
        padding-left: 10px !important;
      }
      .additional-content li {
        font-size: 12px !important;
        margin-bottom: 3px !important;
      }
      
      /* Navigation menu extra small mobile styles */
      .nav-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(5, auto);
        gap: 4px;
        width: 100%;
      }
      .nav-card {
        padding: 8px 4px;
        width: 100%;
        min-height: 50px;
        border-radius: 6px;
      }
      .nav-icon {
        font-size: 16px;
        margin-bottom: 4px;
      }
      .nav-label {
        font-size: 10px;
        font-weight: 600;
      }
    }
    
    /* Simple Message Box Styles */
    .simple-message-box {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .simple-message-box.show {
      display: flex;
      animation: fadeInScale 0.5s ease-out;
    }
    
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .simple-message-box .message-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }
    
    .simple-message-box .message-container {
      background: linear-gradient(135deg, #1a1f2e, #2d3748);
      border: 1px solid rgba(0, 255, 136, 0.3);
      border-radius: 12px;
      padding: 20px;
      max-width: 500px;
      width: 90%;
      position: relative;
      z-index: 10001;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .simple-message-box .message-title {
      color: #00ff88;
      font-size: 24px;
      margin: 0 0 16px 0;
      font-weight: 700;
      text-align: center;
    }
    
    .simple-message-box .language-selector {
      margin-bottom: 20px;
      text-align: center;
    }
    
    .simple-message-box #language-select {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      color: #00ff88;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      outline: none;
      min-width: 120px;
    }
    
    .simple-message-box #language-select:hover {
      background: rgba(0, 255, 136, 0.2);
      border-color: rgba(0, 255, 136, 0.5);
    }
    
    .simple-message-box #language-select:focus {
      border-color: #00ff88;
      box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2);
    }
    
    .simple-message-box .message-content {
      color: #e6eaf0;
      font-size: 16px;
      line-height: 1.6;
      text-align: center;
    }
    
    .simple-message-box .message-text {
      min-height: 60px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      border: 1px solid rgba(0, 255, 136, 0.1);
      font-family: 'Tahoma', 'Arial', sans-serif;
      font-size: 16px;
      line-height: 1.6;
      direction: rtl;
      text-align: right;
      unicode-bidi: bidi-override;
    }
    
    .simple-message-box .cursor {
      display: inline-block;
      width: 2px;
      height: 20px;
      background: #00ff88;
      margin-left: 2px;
      animation: blink 1s infinite;
    }
    
    /* Language-specific text styling */
    .simple-message-box[data-lang="fa"] .message-text,
    .simple-message-box[data-lang="ar"] .message-text {
      direction: rtl;
      text-align: right;
      font-family: 'Tahoma', 'Arial', sans-serif;
    }
    
    .simple-message-box[data-lang="en"] .message-text {
      direction: ltr;
      text-align: left;
      font-family: 'Arial', sans-serif;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* Mobile responsiveness for simple message box */
    @media (max-width: 768px) {
      .simple-message-box .message-container {
        margin: 20px;
        padding: 16px;
        max-width: calc(100% - 40px);
      }
      
      .simple-message-box .message-title {
        font-size: 20px;
      }
      
      .simple-message-box .message-content {
        font-size: 14px;
      }
      
      .simple-message-box #language-select {
        font-size: 12px;
        padding: 6px 10px;
      }
    }
    
    @media (max-width: 480px) {
      .simple-message-box .message-container {
        margin: 16px;
        padding: 12px;
      }
      
      .simple-message-box .message-title {
        font-size: 18px;
      }
      
      .simple-message-box .message-content {
        font-size: 12px;
      }
      
      .simple-message-box #language-select {
        font-size: 11px;
        padding: 4px 8px;
      }
    }
    

    /* Google Translate Widget Styling - Modern Dark Theme */
    .goog-te-banner-frame {
      display: none !important;
    }
    
    .goog-te-gadget {
      font-family: 'Inter', sans-serif !important;
      font-size: 13px !important;
    }
    
    .goog-te-gadget-simple {
      background: transparent !important;
      border: none !important;
      padding: 4px 8px !important;
      border-radius: 6px !important;
      color: #e2e8f0 !important;
      font-weight: 500 !important;
      transition: all 0.2s ease !important;
      font-size: 11px !important;
    }
    
    .goog-te-gadget-simple:hover {
      background: rgba(96, 165, 250, 0.15) !important;
      color: #60a5fa !important;
    }
    
    .goog-te-gadget-simple .goog-te-menu-value {
      color: #e2e8f0 !important;
      font-size: 13px !important;
      font-weight: 500 !important;
    }
    
    .goog-te-gadget-simple .goog-te-menu-value span:first-child {
      color: #60a5fa !important;
      font-weight: 600 !important;
    }
    
    .goog-te-gadget-simple .goog-te-menu-value span:last-child {
      color: #94a3b8 !important;
    }
    
    .goog-te-menu2 {
      background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%) !important;
      border: 2px solid #4a5568 !important;
      border-radius: 12px !important;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5) !important;
      backdrop-filter: blur(15px) !important;
      max-height: 400px !important;
      overflow-y: auto !important;
      max-width: 200px !important;
      display: flex !important;
      flex-direction: column !important;
      width: 200px !important;
    }
    
    .goog-te-menu2 .goog-te-menu2-item {
      width: 100% !important;
      display: block !important;
      float: none !important;
      clear: both !important;
    }
    
    .goog-te-menu2::-webkit-scrollbar {
      width: 6px !important;
    }
    
    .goog-te-menu2::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1) !important;
      border-radius: 3px !important;
    }
    
    .goog-te-menu2::-webkit-scrollbar-thumb {
      background: rgba(96, 165, 250, 0.6) !important;
      border-radius: 3px !important;
    }
    
    .goog-te-menu2::-webkit-scrollbar-thumb:hover {
      background: rgba(96, 165, 250, 0.8) !important;
    }
    
    .goog-te-menu2-item {
      color: #e2e8f0 !important;
      padding: 4px 8px !important;
      font-weight: 400 !important;
      transition: all 0.2s ease !important;
      font-size: 10px !important;
      white-space: nowrap !important;
      width: 100% !important;
      display: block !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
      line-height: 1.2 !important;
    }
    
    .goog-te-menu2-item:last-child {
      border-bottom: none !important;
    }
    
    .goog-te-menu2-item:hover {
      background: rgba(96, 165, 250, 0.15) !important;
      color: #60a5fa !important;
    }
    
    .goog-te-menu2-item-selected {
      background: rgba(96, 165, 250, 0.25) !important;
      color: #60a5fa !important;
      font-weight: 600 !important;
    }
    
    /* Mobile responsiveness for translate widget */
    @media (max-width: 768px) {
      #google_translate_element {
        bottom: 10px !important;
        left: 10px !important;
        padding: 6px !important;
        border-radius: 8px !important;
        max-width: 120px !important;
      }
      
      .goog-te-gadget-simple {
        font-size: 10px !important;
        padding: 3px 6px !important;
      }
      
      .goog-te-menu2 {
        max-height: 300px !important;
        max-width: 180px !important;
        font-size: 11px !important;
      }
      
      .goog-te-menu2-item {
        padding: 3px 6px !important;
        font-size: 9px !important;
      }
    }
    
    @media (max-width: 480px) {
      #google_translate_element {
        bottom: 8px !important;
        left: 8px !important;
        padding: 4px !important;
        max-width: 100px !important;
      }
      
      .goog-te-gadget-simple {
        font-size: 9px !important;
        padding: 2px 4px !important;
      }
      
      .goog-te-menu2 {
        max-height: 250px !important;
        max-width: 160px !important;
      }
      
      .goog-te-menu2-item {
        padding: 2px 4px !important;
        font-size: 8px !important;
      }
    }
    </style>
</head>
<body>
    <!-- Google Translate Widget -->
    <div id="google_translate_element" style="
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 9999;
      background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
      border: 2px solid #4a5568;
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      max-width: 150px;
    "></div>
    
  <!-- Simple Message Box -->
  <div class="simple-message-box" id="simple-message-box">
    <div class="message-overlay" id="message-overlay"></div>
    <div class="message-container">
      <div class="message-header">
        <h3 id="message-title">üí¨ Ÿæ€åÿßŸÖ ŸÖŸáŸÖ</h3>
        <div class="language-selector">
          <select id="language-select" onchange="changeLanguage(this.value)">
            <option value="fa" selected>ŸÅÿßÿ±ÿ≥€å</option>
            <option value="en">English</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
          </select>
        </div>
      </div>
      <div class="message-content">
        <div class="message-text" id="message-text"></div>
        <div class="cursor" id="message-cursor"></div>
      </div>
    </div>
  </div>

  <div class="container">
    <h1>IAMPHOENIX Dashboard</h1>

    <div class="statusbar top" id="status-bar-top">
      <span class="pill" id="status-address">-</span>
      <span class="pill" id="status-index">-</span>
      <span class="pill" id="status-likes">üëç -</span>
      <span class="pill" id="status-dislikes">üëé -</span>
      <span class="pill" id="status-rank">‚≠ê -</span>
    </div>

    <div class="statusbar bottom" id="status-bar-bottom">
      <span class="pill" id="status-matic">POL: -</span>
      <span class="pill" id="status-dai">DAI: -</span>
      <span class="pill" id="status-iam">IAM: -</span>
    </div>
        

    <!-- Navigation Menu - Creative Design -->
    <div class="nav-menu" style="margin-bottom: 24px;">
      <div class="nav-grid">
        <a class="nav-card" href="swap.html">
          <div class="nav-icon">üîÑ</div>
          <div class="nav-label">Swap</div>
        </a>
        <a class="nav-card" href="register.html">
          <div class="nav-icon">üìù</div>
          <div class="nav-label">Register</div>
        </a>
        <a class="nav-card" href="profile.html">
          <div class="nav-icon">üë§</div>
          <div class="nav-label">Profile</div>
        </a>
        <a class="nav-card" href="about.html">
          <div class="nav-icon">‚ÑπÔ∏è</div>
          <div class="nav-label">About</div>
        </a>
        <a class="nav-card" href="sales.html">
          <div class="nav-icon">üí∞</div>
          <div class="nav-label">Sales</div>
        </a>
        <a class="nav-card" href="transfer.html">
          <div class="nav-icon">üì§</div>
          <div class="nav-label">Transfer</div>
        </a>
        <a class="nav-card" href="transfer-ownership.html">
          <div class="nav-icon">üèóÔ∏è</div>
          <div class="nav-label">Ownership</div>
        </a>
        <a class="nav-card" href="utility.html">
          <div class="nav-icon">üõ†Ô∏è</div>
          <div class="nav-label">Utility</div>
        </a>
        <a class="nav-card" href="professional-tree.html">
          <div class="nav-icon">üå≥</div>
          <div class="nav-label">Partners</div>
        </a>
        <a class="nav-card" href="price-charts.html" target="_blank">
          <div class="nav-icon">üìä</div>
          <div class="nav-label">Price Charts</div>
        </a>
        </div>
    </div>

    <section class="card" id="contract-card" style="text-align:left; direction:ltr;">
      <h2 id="contract-header">Contract Info <span class="toggle-icon">‚ñº</span></h2>
      <div class="card-content" id="contract-content">
        <div class="row"><div class="label">üîó Contract Address</div><a class="value" id="c-address" href="#" target="_blank" rel="noopener noreferrer">-</a></div>
        <div class="row"><div class="label">üè∑Ô∏è Name</div><div class="value" id="c-name">-</div></div>
        <div class="row"><div class="label">üß© Symbol</div><div class="value" id="c-symbol">-</div></div>
        <div class="row"><div class="label">#Ô∏è‚É£ Decimals</div><div class="value" id="c-decimals">-</div></div>
        <div class="row"><div class="label">üì¶ Total Supply</div><div class="value" id="c-total-supply">-</div></div>
        <div class="row"><div class="label">üí∞ Backing Pool</div><div class="value" id="c-dai-in-contract">-</div></div>
        <div class="row"><div class="label">üßÆ Binary Pool</div><div class="value" id="c-iam-in-contract">-</div></div>
        <div class="row"><div class="label">üí≥ Registration Price</div><div class="value" id="c-registration-price">-</div></div>
        <div class="row"><div class="label">üíµ Token Price</div><div class="value" id="c-token-price">-</div></div>
        <div class="row"><div class="label">üéØ Point Price</div><div class="value" id="c-point-price">-</div></div>
        <div class="row"><div class="label">ü§ù Help Fund</div><div class="value" id="c-cashback">-</div></div>
        
        
        <div class="row"><div class="label">üëõ Wallets Count</div><div class="value" id="c-wallets-count">-</div></div>
        <div class="row"><div class="label">üéÅ Claimable Points (Total)</div><div class="value" id="c-claimable-points">-</div></div>
        
        <div class="muted">Some values may remain empty if their functions do not exist on the contract.</div>
        <div class="error" id="contract-error" style="display:none"></div>
      </div>
    </section>
            
    <!-- Referral Link - Permanent -->
    <div class="referral-section" style="
      margin-top: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #1a1f2e 0%, #232946 100%);
      border: 1px solid #00ff88;
      border-radius: 12px;
      color: #e6eaf0;
      box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
    ">
      <h3 style="margin: 0 0 16px; color: #00ff88; font-size: 18px; text-align: center;">
        üîó Referral Link
      </h3>
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <div id="referral-link-container" style="display: none;">
          <label style="font-size: 12px; color: #9aa8c1; margin-bottom: 4px; display: block;">Your Referral Link:</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="text" id="referral-link" readonly 
                   style="flex: 1; padding: 8px 12px; border: 1px solid #00ff88; border-radius: 6px; background: rgba(0, 255, 136, 0.1); color: #e6eaf0; font-size: 12px; font-family: monospace;">
            <button id="copy-referral-btn" class="success small">
              üìã Copy
            </button>
          </div>
        </div>
        <div id="referral-note" class="muted" style="text-align:center;">Connect your wallet to see your permanent referral link</div>
      </div>
    </div>
                
    <!-- Tree Navigation and Ranking Section -->
    <div class="additional-content" style="
      margin-top: 24px;
      padding: 24px;
      background: linear-gradient(135deg, #1a1f2e 0%, #232946 100%);
      border: 1px solid #00ff88;
      border-radius: 16px;
      color: #e6eaf0;
      line-height: 1.7;
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.1);
    ">
      <h2 style="margin: 0 0 20px; color: #00ff88; font-size: 24px; font-weight: 700; text-align: center;">
        üå≥ Tree Navigation & Leaderboard
      </h2>
      
      <div style="margin-bottom: 20px;">
        <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">üå≤ Binary Tree Explorer</h3>
        <p style="margin: 0 0 16px; color: #b8c1ec; font-size: 15px;">
          Navigate through the binary tree structure and discover the top performers who have claimed the most points in the network.
        </p>
        
        <div id="tree-navigation" style="margin-bottom: 20px;">
          <div style="margin-bottom: 15px;">
            <div id="exploration-status" style="
              color: #aef3c6;
              font-size: 14px;
              margin-bottom: 8px;
              text-align: center;
            ">‚è≥ Starting Tree Exploration...</div>
            <div style="
              background: rgba(0, 255, 136, 0.1);
              border: 1px solid rgba(0, 255, 136, 0.3);
              border-radius: 10px;
              height: 20px;
              overflow: hidden;
              position: relative;
            ">
              <div id="progress-bar" style="
                background: linear-gradient(135deg, #00ff88, #00cc6a);
                height: 100%;
                width: 0%;
                transition: width 0.3s ease;
                position: relative;
              "></div>
              <div id="progress-text" style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: #181c2a;
                font-weight: bold;
                font-size: 12px;
                z-index: 1;
              ">0%</div>
            </div>
          </div>
          
          <div id="tree-stats" style="
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
          ">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
              <div style="text-align: center;">
                <div style="color: #00ff88; font-weight: bold; font-size: 18px;" id="total-users">-</div>
                <div style="color: #aef3c6; font-size: 12px;">Total Users</div>
              </div>
              <div style="text-align: center;">
                <div style="color: #a786ff; font-weight: bold; font-size: 18px;" id="total-points">-</div>
                <div style="color: #aef3c6; font-size: 12px;">Total Points</div>
              </div>
              <div style="text-align: center;">
                <div style="color: #ff6b35; font-weight: bold; font-size: 18px;" id="claimed-points">-</div>
                <div style="color: #aef3c6; font-size: 12px;">Claimed Points</div>
              </div>
            </div>
          </div>
        </div>
        
        <div id="leaderboard-container" style="display: none;">
          <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">üèÜ Top 10 Performers</h3>
          <div id="leaderboard-list" style="
            background: rgba(167, 134, 255, 0.1);
            border: 1px solid rgba(167, 134, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
          ">
            <div style="text-align: center; color: #aef3c6; padding: 20px;">
              Click "Explore Tree" to load the leaderboard
            </div>
          </div>
        </div>
        
        <div id="popularity-container" style="display: block; margin-top: 20px;">
          <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">‚ù§Ô∏è Member Popularity</h3>
          <div id="popularity-list" style="
            background: rgba(255, 107, 51, 0.1);
            border: 1px solid rgba(255, 107, 51, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
          ">
            <div style="text-align: center; color: #aef3c6; padding: 20px;">
              Loading popularity data...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Professional Presentation Section -->
    <div class="additional-content" style="
      margin-top: 24px;
      padding: 24px;
      background: linear-gradient(135deg, #1a1f2e 0%, #232946 100%);
      border: 1px solid #00ff88;
      border-radius: 16px;
      color: #e6eaf0;
      line-height: 1.7;
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.1);
    ">
      <h2 style="margin: 0 0 20px; color: #00ff88; font-size: 24px; font-weight: 700; text-align: center;">
        üöÄ About IAM PHOENIX
      </h2>
      
      <div style="margin-bottom: 20px;">
        <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">üåü Revolutionary Network Marketing Platform</h3>
        <p style="margin: 0 0 16px; color: #b8c1ec; font-size: 15px;">
          <strong>IAM PHOENIX</strong> is a cutting-edge Network Marketing platform that leverages blockchain technology and Web3 infrastructure to create a transparent, secure, and decentralized ecosystem. Our platform eliminates traditional intermediaries and creates direct, trustless relationships between participants through smart contracts.
        </p>
        <p style="margin: 0 0 16px; color: #b8c1ec; font-size: 15px;">
          Built on the <strong>Polygon blockchain</strong>, IAM PHOENIX combines the power of network marketing with the security and transparency of blockchain technology. All network marketing activities, rewards, and commissions are automatically calculated and distributed through audited smart contracts, ensuring complete transparency and eliminating the possibility of fraud or manipulation.
        </p>
                </div>
                
      <div style="margin-bottom: 20px;">
        <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">üî• Phoenix Team Mission</h3>
        <p style="margin: 0 0 16px; color: #b8c1ec; font-size: 15px;">
          Our team, <strong>Phoenix</strong>, is currently supporting and developing the IAM token, which is built on the Polygon blockchain and backed by the decentralized stablecoin DAI. This stablecoin is fully decentralized, and no organization or authority has access to it. The IAM token itself is an independent project, in fact a startup. It does not support or rely on another startup, but rather aims to introduce and promote itself.
        </p>
                </div>
                
      <div style="margin-bottom: 20px;">
        <h3 style="color: #aef3c6; font-size: 18px; margin: 0 0 12px;">üìä Subscription & Point System</h3>
        <p style="margin: 0 0 12px; color: #b8c1ec; font-size: 15px;">
          The IAM token has a subscription mechanism with the following distribution:
        </p>
        <ul style="margin: 0 0 16px; padding-left: 20px; color: #b8c1ec; font-size: 15px;">
          <li style="margin-bottom: 8px;"><strong>10%</strong> for referral rewards (inviter)</li>
          <li style="margin-bottom: 8px;"><strong>10%</strong> for token burning, which increases the token's value</li>
          <li style="margin-bottom: 8px;"><strong>80%</strong> is distributed among users based on the points they earn</li>
        </ul>
        <p style="margin: 0 0 16px; color: #b8c1ec; font-size: 15px;">
          Each person can earn up to <strong>5 points every 12 hours</strong>, with a maximum of <strong>10 points per day</strong>. Any extra points overflow onto other points, increasing the value of each point.
        </p>
                </div>
                
      <div style="text-align: center; padding-top: 16px; border-top: 1px solid rgba(0, 255, 136, 0.2);">
        <p style="margin: 0; color: #00ff88; font-size: 16px; font-weight: 600;">
          üåü Together, we succeed! üåü
        </p>
        <p style="margin: 8px 0 0; color: #9aa8c1; font-size: 14px;">
          A decentralized network that will soon be recognized internationally
        </p>
            </div>
                </div>
                
        
        
    

    
        </div>
        
        
  <!-- Ethers (v6) CDN if not already present on other pages -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.1/dist/ethers.umd.min.js"></script>
        
  <!-- Project scripts providing config and wallet connection/contract utils -->
    <script src="js/config.js"></script>
  <script src="js/network.js"></script>
  <script src="js/web3-interactions.js"></script>
  <script src="js/profile.js"></script>
  <script src="js/auto-wallet-connect.js"></script>
  <script src="js/swap.js"></script>
  <!-- Floating Token Growth Card -->
    <script src="js/floating-token-card.js"></script>
    
  <script>
    function safeFormatUnits(value, decimals) {
      try {
        return (window.ethers && ethers.formatUnits) ? ethers.formatUnits(value, decimals) : String(value);
      } catch { return String(value); }
    }

    function toNumberFromUnits(value, decimals) {
      try {
        const s = safeFormatUnits(value, decimals);
        const n = Number(s);
        return isNaN(n) ? 0 : n;
      } catch { return 0; }
    }

    function formatUsdFromWeiProduct(productWeiBigInt) {
      try {
        const s = safeFormatUnits(productWeiBigInt, 18);
        const n = Number(s);
        if (!isFinite(n)) return '$0.00';
        return '$' + n.toLocaleString('en-US', { 
          minimumFractionDigits: 2, 
          maximumFractionDigits: 18 
        });
      } catch { return '$0.00'; }
    }

    function formatUsdFromWeiProduct2Decimals(productWeiBigInt) {
      try {
        const s = safeFormatUnits(productWeiBigInt, 18);
        const n = Number(s);
        if (!isFinite(n)) return '$0.00';
        return '$' + n.toLocaleString('en-US', { 
          minimumFractionDigits: 2, 
          maximumFractionDigits: 2 
        });
      } catch { return '$0.00'; }
    }

    function shortenAddress(address) {
      if (!address || address === '-') return '-';
      if (address.length < 10) return address;
      return address.slice(0, 6) + '...' + address.slice(-4);
    }

    function ensureUsdInline(valueEl) {
      if (!valueEl) return null;
      let usdEl = valueEl.querySelector('[data-role="usd-inline"]');
      if (!usdEl) {
        usdEl = document.createElement('span');
        usdEl.setAttribute('data-role', 'usd-inline');
        valueEl.appendChild(usdEl);
      }
      return usdEl;
    }

    function formatMax2(num) {
      try { 
        const n = Number(num);
        if (!isFinite(n)) return String(num);
        return n.toLocaleString('en-US', { 
          minimumFractionDigits: 2, 
          maximumFractionDigits: 18 
        });
      } catch { return String(num); }
    }

    function format0(num) {
      try { 
        const n = Number(num);
        if (!isFinite(n)) return String(num);
        return n.toLocaleString('en-US', { 
          minimumFractionDigits: 0, 
          maximumFractionDigits: 18 
        });
      } catch { return String(num); }
    }

    function format2Decimals(num) {
      try { 
        const n = Number(num);
        if (!isFinite(n)) return String(num);
        return n.toLocaleString('en-US', { 
          minimumFractionDigits: 2, 
          maximumFractionDigits: 2 
        });
      } catch { return String(num); }
    }

    function shortenAddress(addr) {
      try { if (!addr || addr.length < 10) return addr || '-'; return addr.slice(0, 6) + '...' + addr.slice(-4); } catch { return addr || '-'; }
    }

    // Dynamically size pills based on their values
    function setDynamicPillWidths(barType, values) {
      try {
        const isTopBar = barType === 'top';
        const pillIds = isTopBar ? 
          ['status-address', 'status-index', 'status-likes', 'status-dislikes', 'status-rank'] :
          ['status-matic', 'status-dai', 'status-iam'];
        
        // Disable dynamic sizing on small screens
        if (window.matchMedia && window.matchMedia('(max-width: 640px)').matches) {
          pillIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) { el.style.flex = '1'; el.style.minWidth = '0'; }
          });
          return;
        }

        const items = pillIds.map(id => {
          const el = document.getElementById(id);
          if (!el) return { id, value: 0, element: null };
          
          let value = 0;
          if (values && values[id]) {
            value = Number(values[id]) || 0;
          } else {
            // Try to parse from text content
            const text = el.textContent || '';
            const num = Number(text.replace(/[^0-9.\-]+/g, ''));
            value = isFinite(num) ? num : 0;
          }
          
          return { id, value: Math.max(0, value), element: el };
        });

        const total = items.reduce((sum, item) => sum + item.value, 0);
        
        // If all values are zero, use equal distribution
        if (total === 0) {
          items.forEach(item => {
            if (item.element) {
              item.element.style.flex = '1';
              item.element.style.minWidth = '0';
            }
          });
          return;
        }

        // Calculate widths
        items.forEach(item => {
          if (!item.element) return;
          const el = item.element;
          const proportion = item.value / total;

          if (isTopBar) {
            // Top bar: grow proportionally but stay in one row
            const minGrow = 0.1; // Minimum 10%
            const maxGrow = 0.6; // Maximum 60%
            const grow = Math.max(minGrow, Math.min(maxGrow, proportion));
            el.style.flex = `${grow} 1 0`;
            el.style.minWidth = '0';
          } else {
            // Bottom bar: fixed proportions - IAM gets 2/3, POL and DAI share 1/3
            let basisPercent;
            if (item.id === 'status-iam') {
              basisPercent = 66.67; // 2/3 of the width
            } else {
              basisPercent = 16.67; // 1/6 each for POL and DAI (1/3 √∑ 2)
            }
            el.style.flex = `0 1 ${basisPercent}%`;
            el.style.minWidth = '0';
            el.style.maxWidth = `${basisPercent}%`;
          }
        });
      } catch {}
    }

    function updateStatusPills(data) {
      const set = (id, label, value) => {
        const el = document.getElementById(id);
        if (!el) return;
        // Icon labels
        const iconLabel = (orig) => {
          switch (id) {
            case 'status-likes': return `‚ù§Ô∏è ${orig}`;
            case 'status-dislikes': return `üíî ${orig}`;
            case 'status-rank': return `‚≠ê ${orig}`;
            default: return orig;
          }
        };
        // For likes/dislikes show icon + number
        if (id === 'status-likes') { el.textContent = `‚ù§Ô∏è ${value ?? 0}`; return; }
        if (id === 'status-dislikes') { el.textContent = `üíî ${value ?? 0}`; return; }
        if (id === 'status-rank') { el.textContent = (value && String(value).trim()) ? String(value) : '‚≠ê'; return; }
        // Normal rendering for others
        if (id === 'status-address' || id === 'status-index') {
          el.textContent = iconLabel(`${value ?? '-'}`);
                        } else {
          el.textContent = iconLabel(`${label}: ${value ?? '-'}`);
        }
      };
      if (!data) return;
      if (data.address !== undefined) set('status-address', 'Address', data.address);
      if (data.index !== undefined) set('status-index', 'Index', data.index);
      if (data.rank !== undefined) set('status-rank', 'Rank', data.rank);
      if (data.matic !== undefined) set('status-matic', 'POL', data.matic);
      if (data.dai !== undefined) set('status-dai', 'DAI', data.dai);
      if (data.iam !== undefined) set('status-iam', 'IAM', data.iam);
      
      if (data.likes !== undefined) set('status-likes', 'Likes', data.likes);
      if (data.dislikes !== undefined) set('status-dislikes', 'Dislikes', data.dislikes);

      // Apply dynamic sizing after updating all values
      setTimeout(() => {
        // Top bar dynamic sizing
        setDynamicPillWidths('top', {
          'status-address': data.address ? 1 : 0, // Address always gets minimum width
          'status-index': data.index,
          'status-likes': data.likes,
          'status-dislikes': data.dislikes,
          'status-rank': data.rank ? 1 : 0 // Rank always gets minimum width
        });

        // Bottom bar dynamic sizing
        setDynamicPillWidths('bottom', {
          'status-matic': data.matic,
          'status-dai': data.dai,
          'status-iam': data.iam
        });
      }, 100);
    }

    // User Info removed

    async function fetchContractInfo() {
      const addrEl = document.getElementById('c-address');
      const nameEl = document.getElementById('c-name');
      const symbolEl = document.getElementById('c-symbol');
      const decimalsEl = document.getElementById('c-decimals');
      const supplyEl = document.getElementById('c-total-supply');
      const daiInEl = document.getElementById('c-dai-in-contract');
      const iamInEl = document.getElementById('c-iam-in-contract');
      const regPriceEl = document.getElementById('c-registration-price');
      const tokenPriceEl = document.getElementById('c-token-price');
      const cashbackEl = document.getElementById('c-cashback');
      const pointPriceEl = document.getElementById('c-point-price');
      const deployerEl = null;
      const usersCountEl = null;
      const walletsCountEl = document.getElementById('c-wallets-count');
      const claimablePointsEl = document.getElementById('c-claimable-points');
      const errEl = document.getElementById('contract-error');
      errEl.style.display = 'none';
      errEl.textContent = '';
      try {
        if (!window.connectWallet) throw new Error('Wallet connection is not available');
        const connection = await window.connectWallet();
        if (!connection || !connection.contract) throw new Error('Contract connection is not available');
        const { contract, provider, signer, address: connectedAddress } = connection;

        const contractAddress = (contract && contract.target) ? String(contract.target) : (window.IAM_ADDRESS || '-');
        addrEl.textContent = shortenAddress(contractAddress);
        // Link to Polygonscan/Amoy based on network
        try {
          if (addrEl && addrEl.tagName === 'A' && contractAddress && contractAddress.startsWith('0x') && contractAddress.length === 42) {
            let base = 'https://polygonscan.com';
            try {
              const net = provider && provider.getNetwork ? await provider.getNetwork() : null;
              const chainId = net && net.chainId ? Number(net.chainId) : undefined;
              if (chainId === 137) base = 'https://polygonscan.com';
              else if (chainId === 80002 || chainId === 80001) base = 'https://amoy.polygonscan.com';
            } catch {}
            addrEl.setAttribute('href', base + '/address/' + contractAddress);
          }
        } catch {}
        // Update status bar basic address immediately
        try { const ua = connectedAddress || (signer ? await signer.getAddress() : null); if (ua) updateStatusPills({ address: shortenAddress(ua) }); } catch {}

        // Always read directly from contract (no cached meta)
        nameEl.textContent = '';
        symbolEl.textContent = '';
        decimalsEl.textContent = '';
        supplyEl.textContent = '';
        
        if (walletsCountEl) walletsCountEl.textContent = '';
        

        // Direct reads
        try { if (typeof contract.name === 'function') nameEl.textContent = await contract.name(); } catch {}
        try { if (typeof contract.symbol === 'function') symbolEl.textContent = await contract.symbol(); } catch {}
        try { if (typeof contract.decimals === 'function') decimalsEl.textContent = (await contract.decimals()).toString(); } catch {}
        let tokenPriceWei = null;
        let totalSupplyWei = null;
        try {
          if (typeof contract.totalSupply === 'function') {
            totalSupplyWei = await contract.totalSupply();
            supplyEl.textContent = formatMax2(toNumberFromUnits(totalSupplyWei, 18));
          }
        } catch {}
        
        // Users count intentionally removed per request

        // Wallets count: prefer explicit contract variable/getter for wallets
        try {
          let walletsCount = null;
          if (typeof contract.wallets === 'function') walletsCount = await contract.wallets();
          if (typeof contract.walletsCount === 'function') walletsCount = await contract.walletsCount();
          else if (typeof contract.getWalletsCount === 'function') walletsCount = await contract.getWalletsCount();
          else if (typeof contract.totalWallets === 'function') walletsCount = await contract.totalWallets();
          else if (typeof contract.walletsLength === 'function') walletsCount = await contract.walletsLength();
          else if (typeof contract.getWalletsLength === 'function') walletsCount = await contract.getWalletsLength();
          if (walletsCountEl && walletsCount !== null && walletsCount !== undefined) walletsCountEl.textContent = (typeof walletsCount === 'bigint' ? walletsCount.toString() : String(walletsCount));
        } catch {}

        // IAM in contract (balanceOf self)
        let iamBalanceSelf = null;
        try {
          if (typeof contract.balanceOf === 'function') {
            iamBalanceSelf = await contract.balanceOf(contract.target);
            if (iamInEl) iamInEl.textContent = formatMax2(toNumberFromUnits(iamBalanceSelf, 18));
          }
        } catch {}

        // ===== Status bar: wallet balances =====
        try {
          const userAddr = connectedAddress || (signer ? await signer.getAddress() : null);
          if (userAddr) {
            // POL/MATIC
            try {
              const mBal = await provider.getBalance(userAddr);
              updateStatusPills({ matic: format2Decimals(toNumberFromUnits(mBal, 18)) });
            } catch {}
            // DAI
            try {
              const daiAddr = window.DAI_ADDRESS || (window.contractConfig && window.contractConfig.DAI_ADDRESS);
              if (daiAddr) {
                const minimalDaiAbi = [{"inputs":[{"name":"account","type":"address"}],"name":"balanceOf","outputs":[{"type":"uint256"}],"stateMutability":"view","type":"function"}];
                const Dai = new ethers.Contract(daiAddr, minimalDaiAbi, provider);
                const dBal = await Dai.balanceOf(userAddr);
                updateStatusPills({ dAI: undefined, dai: format2Decimals(toNumberFromUnits(dBal, 18)) });
              }
            } catch {}
            // IAM balance
            try {
              if (typeof contract.balanceOf === 'function') {
                const ib = await contract.balanceOf(userAddr);
                updateStatusPills({ iam: format2Decimals(toNumberFromUnits(ib, 18)) });
              }
            } catch {}
            // Users struct: index, likes, dislikes (preferred source)
            let u = null;
            try { if (typeof contract.users === 'function') u = await contract.users(userAddr); } catch {}
            if (u) {
              try {
                if (u.index !== undefined) {
                  updateStatusPills({ index: (typeof u.index === 'bigint') ? u.index.toString() : String(u.index) });
                }
                // Rank derived from binaryPointsClaimed (claimed count tiers)
                try {
                  const claimedRaw = u && u.binaryPointsClaimed !== undefined ? u.binaryPointsClaimed : undefined;
                  const claimed = claimedRaw !== undefined ? ((typeof claimedRaw === 'bigint') ? Number(claimedRaw) : Number(claimedRaw||0)) : NaN;
                  if (!isNaN(claimed)) {
                    let stars = 0;
                    if (claimed >= 10000) stars = 5;
                    else if (claimed >= 1000) stars = 4;
                    else if (claimed >= 100) stars = 3;
                    else if (claimed >= 10) stars = 2;
                    else if (claimed >= 1) stars = 1;
                    updateStatusPills({ rank: (stars > 0 ? '‚≠ê'.repeat(stars) : '-') });
                  }
                } catch {}
                // Likes/Dislikes totals from contract method
                try {
                  if (typeof contract.getVoteStatus === 'function') {
                    const vs = await contract.getVoteStatus(userAddr);
                    const likes = (vs && (vs[0] !== undefined || vs.totalLikes !== undefined)) ? Number(vs[0] ?? vs.totalLikes) : 0;
                    const dislikes = (vs && (vs[1] !== undefined || vs.totalDislikes !== undefined)) ? Number(vs[1] ?? vs.totalDislikes) : 0;
                    updateStatusPills({ likes, dislikes });
                  }
                } catch {}
              } catch {}
            } else {
              // Fallbacks
              try {
                let idx = null;
                if (typeof contract.addressToIndex === 'function') idx = await contract.addressToIndex(userAddr);
                if (idx !== null && idx !== undefined) updateStatusPills({ index: (typeof idx === 'bigint' ? idx.toString() : String(idx)) });
              } catch {}
              try {
                if (typeof contract.getVoteStatus === 'function') {
                  const vs = await contract.getVoteStatus(userAddr);
                  const likes = (vs && (vs[0] !== undefined || vs.totalLikes !== undefined)) ? Number(vs[0] ?? vs.totalLikes) : 0;
                  const dislikes = (vs && (vs[1] !== undefined || vs.totalDislikes !== undefined)) ? Number(vs[1] ?? vs.totalDislikes) : 0;
                  updateStatusPills({ likes, dislikes });
                }
              } catch {}
            }
            // Index + Rank (ensure index present if not from struct)
            try {
              let ensuredIndex = document.getElementById('status-index')?.textContent;
              if (!ensuredIndex || ensuredIndex === '-' || ensuredIndex.trim() === '# -') {
                let idx = null;
                if (typeof contract.addressToIndex === 'function') idx = await contract.addressToIndex(userAddr);
                if (idx !== null && idx !== undefined) updateStatusPills({ index: (typeof idx === 'bigint' ? idx.toString() : String(idx)) });
                else updateStatusPills({ index: '-' });
              }
            } catch {}
          }
        } catch {}

        // DAI in contract (best-effort via window.DAI_ADDRESS)
        try {
          const daiAddr = window.DAI_ADDRESS || (window.contractConfig && window.contractConfig.DAI_ADDRESS);
          if (provider && daiAddr) {
            const minimalDaiAbi = [{"inputs":[{"name":"account","type":"address"}],"name":"balanceOf","outputs":[{"type":"uint256"}],"stateMutability":"view","type":"function"}];
            const Dai = new ethers.Contract(daiAddr, minimalDaiAbi, provider);
            const d = await Dai.balanceOf(contract.target);
            if (daiInEl) daiInEl.textContent = toNumberFromUnits(d, 18).toLocaleString('en-US', { 
              minimumFractionDigits: 2, 
              maximumFractionDigits: 2 
            });
          }
        } catch {}

        // Registration price (only getRegPrice per request)
        let regPriceWei = null;
        try {
          if (typeof contract.getRegPrice === 'function') {
            const r = await contract.getRegPrice();
            regPriceWei = (typeof r === 'bigint') ? r : BigInt(r);
            if (regPriceEl) regPriceEl.textContent = formatMax2(toNumberFromUnits(regPriceWei, 18));
          }
        } catch {}

        // Token price (try common names)
        try {
          let p;
          if (typeof contract.getTokenPrice === 'function') p = await contract.getTokenPrice();
          else if (typeof contract.tokenPrice === 'function') p = await contract.tokenPrice();
          if (p !== undefined) {
            tokenPriceWei = (typeof p === 'bigint') ? p : BigInt(p);
            if (tokenPriceEl) tokenPriceEl.textContent = safeFormatUnits(tokenPriceWei, 18);
          }
        } catch {}

        // Point price will be derived below from IAM-in-contract / total unclaimed points

        // Claimable points total ‚Äì read from its public variable/getter on contract
        let totalUnclaimedPoints = null;
        try {
          const preferIntegerString = (v) => {
            try { return (typeof v === 'bigint' ? v : BigInt(v)).toString(); } catch { return String(v); }
          };
          let cp;
          if (typeof contract.totalClaimablePoints === 'function') cp = await contract.totalClaimablePoints();
          else if (typeof contract.claimablePointsTotal === 'function') cp = await contract.claimablePointsTotal();
          else if (typeof contract.getClaimablePoints === 'function') cp = await contract.getClaimablePoints();
          else if (typeof contract.claimablePoints === 'function') cp = await contract.claimablePoints();
          else if (typeof contract.totalUnclaimedPoints === 'function') cp = await contract.totalUnclaimedPoints();
          else if (typeof contract.unclaimedPointsTotal === 'function') cp = await contract.unclaimedPointsTotal();
          if (cp !== undefined) {
            totalUnclaimedPoints = (typeof cp === 'bigint') ? cp : (()=>{ try{return BigInt(cp);}catch{return null;} })();
            if (claimablePointsEl && totalUnclaimedPoints !== null) claimablePointsEl.textContent = totalUnclaimedPoints.toString();
          }
        } catch {}

        // Derived Point Value = IAM in contract / total unclaimed points (IAM has 18 decimals; points are integer)
        try {
          if (pointPriceEl && iamBalanceSelf !== null && totalUnclaimedPoints !== null && totalUnclaimedPoints > 0n) {
            const ONE = 1000000000000000000n; // 1e18
            const priceWeiPerPoint = iamBalanceSelf / totalUnclaimedPoints;
            pointPriceEl.textContent = formatMax2(toNumberFromUnits(priceWeiPerPoint, 18));
            if (tokenPriceWei) {
              const usdPerPointWei = (priceWeiPerPoint * tokenPriceWei) / ONE;
              const usdEl = ensureUsdInline(pointPriceEl);
              if (usdEl) usdEl.textContent = formatUsdFromWeiProduct2Decimals(usdPerPointWei);
            }
          }
        } catch {}

        // Cashback (raw 18-decimals)
        try {
          if (cashbackEl && typeof contract.cashBack === 'function') {
            const cb = await contract.cashBack();
            const cbWei = (typeof cb === 'bigint') ? cb : BigInt(cb);
            cashbackEl.textContent = formatMax2(toNumberFromUnits(cbWei, 18));
            // USD subline below cashback
            if (tokenPriceWei) {
              const ONE = 1000000000000000000n;
              const cbUsdWei = (cbWei * tokenPriceWei) / ONE;
              const usdEl = ensureUsdInline(cashbackEl);
              if (usdEl) usdEl.textContent = formatUsdFromWeiProduct2Decimals(cbUsdWei);
            }
          }
        } catch {}

        // USD subline below Registration Price
        try {
          if (regPriceEl && regPriceWei && tokenPriceWei) {
            // Convert to numbers for precise calculation
            const regPriceNum = Number(ethers.formatUnits(regPriceWei, 18));
            const tokenPriceNum = Number(ethers.formatUnits(tokenPriceWei, 18));
            const usdValue = regPriceNum * tokenPriceNum;
            const usdEl = ensureUsdInline(regPriceEl);
            if (usdEl) usdEl.textContent = '$' + usdValue.toLocaleString('en-US', { 
              minimumFractionDigits: 2, 
              maximumFractionDigits: 2 
            });
          }
        } catch {}

        // USD under Total Supply
        try {
          if (totalSupplyWei && tokenPriceWei) {
            const ONE = 1000000000000000000n;
            const supplyUsdWei = (totalSupplyWei * tokenPriceWei) / ONE;
            const usdEl = ensureUsdInline(supplyEl);
            if (usdEl) usdEl.textContent = formatUsdFromWeiProduct2Decimals(supplyUsdWei);
          }
        } catch {}

        // USD under IAM In Contract
        try {
          if (iamBalanceSelf !== null && tokenPriceWei) {
            const ONE = 1000000000000000000n;
            const iamUsdWei = (iamBalanceSelf * tokenPriceWei) / ONE;
            const usdEl = ensureUsdInline(iamInEl);
            if (usdEl) usdEl.textContent = formatUsdFromWeiProduct2Decimals(iamUsdWei);
          }
        } catch {}
            } catch (e) {
        errEl.textContent = e.message || 'Failed to load contract info';
        errEl.style.display = 'block';
      }
    }

    // Ensure connection before fetching; retry a few times
    async function waitForContract(maxWaitMs = 10000, intervalMs = 500) {
      const start = Date.now();
      while (Date.now() - start < maxWaitMs) {
        try {
          if (window.contractConfig && window.contractConfig.contract) return true;
          if (typeof window.connectWallet === 'function') {
            const conn = await window.connectWallet();
            if (conn && conn.contract) return true;
          }
        } catch {}
        await new Promise(r => setTimeout(r, intervalMs));
      }
      return false;
    }

    async function refreshContractInfoSafe() {
      const ok = await waitForContract(12000, 600);
      if (!ok) return;
      await fetchContractInfo();
    }

    // ==== Dynamic ABI UI builders ====
    function parseInputValue(raw, solidityType) {
      if (solidityType.startsWith('uint') || solidityType.startsWith('int')) {
        // Accept decimal string -> BigInt
        return (typeof raw === 'string' && raw.trim() !== '') ? BigInt(raw) : 0n;
      }
      if (solidityType === 'bool') {
        return String(raw).toLowerCase() === 'true';
      }
      // bytes, address, string, arrays (as JSON)
      if (solidityType.endsWith(']')) {
        try { return JSON.parse(raw); } catch { return []; }
      }
      return raw;
    }

     function buildFunctionRow(fn, container, isWrite = false) {
      const row = document.createElement('div');
      row.style.border = '1px solid #263048';
      row.style.borderRadius = '10px';
      row.style.padding = '10px';
      row.style.margin = '10px 0';

      const title = document.createElement('div');
      title.className = 'label';
      title.textContent = `${fn.name}(${(fn.inputs||[]).map(i=>i.type).join(', ')})`;
      row.appendChild(title);

      const inputsWrap = document.createElement('div');
      inputsWrap.style.display = 'grid';
      inputsWrap.style.gridTemplateColumns = 'repeat(auto-fit, minmax(180px, 1fr))';
      inputsWrap.style.gap = '8px';
      const inputs = [];
      (fn.inputs||[]).forEach((inp, idx) => {
        const field = document.createElement('input');
        field.placeholder = `${inp.name||'arg'+idx}: ${inp.type}`;
        field.style.background = '#0f1220';
        field.style.border = '1px solid #263048';
        field.style.borderRadius = '8px';
        field.style.color = '#e6eaf0';
        field.style.padding = '8px';
        inputsWrap.appendChild(field);
        inputs.push({ field, type: inp.type });
      });
      row.appendChild(inputsWrap);

      const actions = document.createElement('div');
      actions.style.marginTop = '8px';
      const btn = document.createElement('button');
      btn.textContent = isWrite ? 'ÿßÿ±ÿ≥ÿßŸÑ ÿ™ÿ±ÿß⁄©ŸÜÿ¥' : 'ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å';
      btn.className = isWrite ? 'info' : 'secondary';
      actions.appendChild(btn);
      row.appendChild(actions);

      const result = document.createElement('div');
      result.className = 'value';
      result.style.marginTop = '8px';
      result.style.wordBreak = 'break-word';
      row.appendChild(result);

      btn.addEventListener('click', async () => {
        try {
          const args = inputs.map(i => parseInputValue(i.field.value, i.type));
          const callName = fn.name;
          const signature = `${fn.name}(${(fn.inputs||[]).map(i=>i.type).join(',')})`;
          if (isWrite) {
            result.textContent = '‚è≥ ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ ÿ™ÿ±ÿß⁄©ŸÜÿ¥...';
            const sender = (typeof window.sendWriteSignature === 'function') ? window.sendWriteSignature : window.sendWrite;
            const receipt = await sender(signature, ...args);
            result.textContent = `‚úÖ ÿ™ÿß€å€åÿØ ÿ¥ÿØ: ${receipt.transactionHash}`;
                            } else {
            result.textContent = '‚è≥ ÿØÿ± ÿ≠ÿßŸÑ ÿÆŸàÿßŸÜÿØŸÜ...';
            const reader = (typeof window.callReadSignature === 'function') ? window.callReadSignature : window.callRead;
            const out = await reader(signature, ...args);
            try { result.textContent = JSON.stringify(out, null, 2); }
            catch { result.textContent = String(out); }
          }
            } catch (e) {
          result.textContent = `‚ùå ${e.message||e}`;
        }
      });

      container.appendChild(row);
    }

     function buildAbiUI() { /* write functions removed per request */ }

    

    document.addEventListener('DOMContentLoaded', async () => {
      // Connect button removed; keep auto-connect below
      
      // Auto try to load if connection is already present
      try {
        await refreshContractInfoSafe();
        // buildAbiUI removed
      } catch {}

      // Auto-connect on load for immediate data
      try {
        if (typeof window.connectWallet === 'function') {
          const conn = await window.connectWallet();
          if (conn && conn.address) {
            await refreshContractInfoSafe();
          }
        }
      } catch {}

      // Refresh periodically
      setInterval(() => { refreshContractInfoSafe(); }, 30000);

      // MetaMask events: keep info fresh
      if (window.ethereum) {
        try {
          window.ethereum.on('accountsChanged', () => { refreshContractInfoSafe(); });
          window.ethereum.on('chainChanged', () => { refreshContractInfoSafe(); });
          window.ethereum.on('connect', () => { refreshContractInfoSafe(); });
          window.ethereum.on('disconnect', () => { /* no-op */ });
        } catch {}
      }
      
    // Setup permanent referral link
    setupPermanentReferralLink();
    
    // Setup tree navigation and leaderboard
    setupTreeNavigationAndLeaderboard();
    
    // Setup simple message box
    setupSimpleMessage();
  });
    
    function setupPermanentReferralLink() {
      const copyBtn = document.getElementById('copy-referral-btn');
      const referralLinkInput = document.getElementById('referral-link');
      const linkContainer = document.getElementById('referral-link-container');
      const note = document.getElementById('referral-note');

      if (!copyBtn || !referralLinkInput || !linkContainer) {
        console.warn('Referral link elements not found');
        return;
      }

      async function setPermanentLink() {
        try {
          let addr = null;
          if (window.ethereum && window.ethereum.selectedAddress) addr = window.ethereum.selectedAddress;
          if (!addr && window.contractConfig && window.contractConfig.address) addr = window.contractConfig.address;
          if (!addr) return;

          // Resolve user's index from status pill or contract if possible
          let idx = document.getElementById('status-index')?.textContent?.replace('‚≠ê', '').trim();
          if (!idx || idx === '-' || idx === '# -') {
            try {
              if (window.contractConfig && window.contractConfig.contract) {
                const c = window.contractConfig.contract;
                if (typeof c.users === 'function') {
                  const u = await c.users(addr);
                  if (u && u.index !== undefined) idx = (typeof u.index === 'bigint') ? u.index.toString() : String(u.index);
                }
                if ((!idx || idx === '-' || idx === '0') && typeof c.addressToIndex === 'function') {
                  const vi = await c.addressToIndex(addr);
                  idx = (typeof vi === 'bigint') ? vi.toString() : String(vi);
                }
              }
            } catch {}
          }
          if (!idx || idx === '-' || idx === '0') return;

          const baseUrl = window.location.origin + '/register.html';
          const referralUrl = `${baseUrl}?ref=${encodeURIComponent(idx)}`;
          referralLinkInput.value = referralUrl;
          // Removed open button per request
          linkContainer.style.display = 'block';
          if (note) note.style.display = 'none';
        } catch {}
      }

      // Set immediately and on wallet events
      setPermanentLink();
      if (window.ethereum) {
        try {
          window.ethereum.on('accountsChanged', setPermanentLink);
          window.ethereum.on('connect', setPermanentLink);
          window.ethereum.on('chainChanged', setPermanentLink);
        } catch {}
      }

      copyBtn.addEventListener('click', async function() {
        try {
          await navigator.clipboard.writeText(referralLinkInput.value);
          copyBtn.textContent = '‚úÖ Copied!';
          copyBtn.style.background = 'linear-gradient(135deg, #00ff88, #00cc6a)';
          setTimeout(() => {
            copyBtn.textContent = 'üìã Copy';
            copyBtn.style.background = 'linear-gradient(135deg, #a786ff, #9670ff)';
          }, 2000);
        } catch (err) {
          console.error('Failed to copy: ', err);
          // Fallback for older browsers
          referralLinkInput.select();
                            document.execCommand('copy');
          copyBtn.textContent = '‚úÖ Copied!';
          setTimeout(() => {
            copyBtn.textContent = 'üìã Copy';
          }, 2000);
        }
      });
    }

    // Tree Navigation and Leaderboard System
    function setupTreeNavigationAndLeaderboard() {
      // Start exploration automatically
      startAutomaticExploration();
    }

    // Automatic tree exploration
    async function startAutomaticExploration() {
      const statusEl = document.getElementById('exploration-status');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');
      
      if (!statusEl || !progressBar || !progressText) return;

      try {
        updateProgress(0, '‚è≥ Starting Tree Exploration...');
        
        await exploreBinaryTree();
        
        updateProgress(100, '‚úÖ Tree Exploration Complete');
      } catch (error) {
        console.error('Error in automatic tree exploration:', error);
        updateProgress(0, '‚ùå Exploration Failed - Check Console');
        progressBar.style.background = 'linear-gradient(135deg, #ff4444, #cc0000)';
      }
    }

    // Update progress bar
    function updateProgress(percentage, statusText) {
      const statusEl = document.getElementById('exploration-status');
      const progressBar = document.getElementById('progress-bar');
      const progressText = document.getElementById('progress-text');
      
      if (statusEl) statusEl.textContent = statusText;
      if (progressBar) progressBar.style.width = percentage + '%';
      if (progressText) progressText.textContent = Math.round(percentage) + '%';
    }

    // Main function to explore binary tree and create leaderboard
    async function exploreBinaryTree() {
      try {
        if (!window.connectWallet) {
          throw new Error('Wallet connection is not available');
        }

        updateProgress(10, '‚è≥ Connecting to Contract...');

        const { contract } = await window.connectWallet();
        if (!contract) {
          throw new Error('Contract connection failed');
        }

        updateProgress(20, '‚è≥ Exploring Binary Tree...');

        console.log('üå≥ Starting binary tree exploration...');
        
        // Get all users from the tree
        const allUsers = await getAllUsersFromTree(contract);
        
        updateProgress(70, '‚è≥ Processing Data...');
        
        // Sort by claimed points (descending)
        const sortedUsers = allUsers.sort((a, b) => {
          const aClaimed = Number(a.binaryPointsClaimed || 0);
          const bClaimed = Number(b.binaryPointsClaimed || 0);
          return bClaimed - aClaimed;
        });

        updateProgress(85, '‚è≥ Updating Statistics...');

        // Update statistics
        updateTreeStatistics(allUsers);
        
        updateProgress(95, '‚è≥ Displaying Leaderboard...');
        
        // Display top 10 leaderboard
        displayLeaderboard(sortedUsers.slice(0, 10));
        
        // Display popularity data (already collected in allUsers)
        displayPopularityList(allUsers);
        
        console.log(`‚úÖ Tree exploration completed. Found ${allUsers.length} users.`);
        
      } catch (error) {
        console.error('Error in tree exploration:', error);
        throw error;
      }
    }

    // Get all users from the binary tree using optimized traversal with likes/dislikes
    async function getAllUsersFromTree(contract) {
      const users = [];
      const processedIndices = new Set();
      const maxDepth = 10000000; // Increased per request to allow deep traversal
      let processedCount = 0;
      
      // Start from root (index 1)
      const rootIndex = 1n;
      const stack = [{ index: rootIndex, depth: 0 }];
      
      while (stack.length > 0) {
        const { index, depth } = stack.pop();
        const indexStr = index.toString();
        
        // Skip if already processed or too deep
        if (processedIndices.has(indexStr) || depth > maxDepth) continue;
        processedIndices.add(indexStr);
        
        try {
          // Get address for this index
          const address = await contract.indexToAddress(index);
          
          if (address && address !== '0x0000000000000000000000000000000000000000') {
            // Get user data and vote status in parallel
            const [userData, voteStatus] = await Promise.all([
              contract.users(address),
              contract.getVoteStatus(address).catch(() => ({ 0: 0, 1: 0 })) // Fallback for vote errors
            ]);
            
            if (userData && userData.index) {
              const likes = Number(voteStatus[0] || voteStatus.totalLikes || 0);
              const dislikes = Number(voteStatus[1] || voteStatus.totalDislikes || 0);
              
              users.push({
                address: address,
                index: userData.index,
                binaryPoints: userData.binaryPoints || 0,
                binaryPointsClaimed: userData.binaryPointsClaimed || 0,
                leftPoints: userData.leftPoints || 0,
                rightPoints: userData.rightPoints || 0,
                totalPurchasedKind: userData.totalPurchasedKind || 0,
                depositedAmount: userData.depositedAmount || 0,
                likes: likes,
                dislikes: dislikes,
                popularityScore: likes - dislikes
              });
              
              // Add children to stack
              const leftChild = index * 2n;
              const rightChild = index * 2n + 1n;
              
              stack.push({ index: rightChild, depth: depth + 1 });
              stack.push({ index: leftChild, depth: depth + 1 });
            }
          }
          
          // Update progress every 10 processed nodes
          processedCount++;
          if (processedCount % 10 === 0) {
            const progress = Math.min(20 + (processedCount * 0.5), 65);
            updateProgress(progress, `‚è≥ Exploring... Found ${users.length} users`);
          }
        } catch (e) {
          // Skip errors and continue
          continue;
        }
      }
      
      return users;
    }

    // Update tree statistics display
    function updateTreeStatistics(users) {
      const totalUsersEl = document.getElementById('total-users');
      const totalPointsEl = document.getElementById('total-points');
      const claimedPointsEl = document.getElementById('claimed-points');
      const treeStats = document.getElementById('tree-stats');
      
      if (!totalUsersEl || !totalPointsEl || !claimedPointsEl || !treeStats) return;
      
      const totalUsers = users.length;
      const totalPoints = users.reduce((sum, user) => sum + Number(user.binaryPoints || 0), 0);
      const claimedPoints = users.reduce((sum, user) => sum + Number(user.binaryPointsClaimed || 0), 0);
      
      totalUsersEl.textContent = totalUsers.toLocaleString();
      totalPointsEl.textContent = totalPoints.toLocaleString();
      claimedPointsEl.textContent = claimedPoints.toLocaleString();
      
      treeStats.style.display = 'block';
    }

    // Display leaderboard
    function displayLeaderboard(topUsers) {
      const leaderboardContainer = document.getElementById('leaderboard-container');
      const leaderboardList = document.getElementById('leaderboard-list');
      
      if (!leaderboardContainer || !leaderboardList) return;
      
      if (topUsers.length === 0) {
        leaderboardList.innerHTML = '<div style="text-align: center; color: #aef3c6; padding: 20px;">No users found</div>';
        leaderboardContainer.style.display = 'block';
        return;
      }
      
      const leaderboardHTML = topUsers.map((user, index) => {
        const rank = index + 1;
        const claimedPoints = Number(user.binaryPointsClaimed || 0);
        const totalPoints = Number(user.binaryPoints || 0);
        const address = user.address;
        const shortAddress = address ? `${address.slice(0, 6)}...${address.slice(-4)}` : 'Unknown';
        
        // Rank styling
        let rankStyle = '';
        let rankIcon = '';
        if (rank === 1) {
          rankStyle = 'background: linear-gradient(135deg, #ffd700, #ffed4e); color: #181c2a;';
          rankIcon = 'üëë';
        } else if (rank === 2) {
          rankStyle = 'background: linear-gradient(135deg, #c0c0c0, #e5e5e5); color: #181c2a;';
          rankIcon = 'ü•à';
        } else if (rank === 3) {
          rankStyle = 'background: linear-gradient(135deg, #cd7f32, #daa520); color: #181c2a;';
          rankIcon = 'ü•â';
        } else {
          rankStyle = 'background: rgba(167, 134, 255, 0.2); color: #aef3c6;';
          rankIcon = `#${rank}`;
        }
        
        return `
          <div style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            margin: 8px 0;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
          " onmouseover="this.style.background='rgba(0, 255, 136, 0.1)'" onmouseout="this.style.background='rgba(0, 255, 136, 0.05)'">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="
                ${rankStyle}
                padding: 6px 12px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 14px;
                min-width: 40px;
                text-align: center;
              ">${rankIcon}</div>
              <div>
                <div style="color: #e6eaf0; font-weight: 600; font-family: monospace;">${shortAddress}</div>
                <div style="color: #aef3c6; font-size: 12px;">Index: ${user.index}</div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="color: #00ff88; font-weight: bold; font-size: 16px;">${claimedPoints.toLocaleString()}</div>
              <div style="color: #aef3c6; font-size: 12px;">claimed points</div>
              <div style="color: #a786ff; font-size: 11px;">${totalPoints.toLocaleString()} total</div>
            </div>
          </div>
        `;
      }).join('');
      
      leaderboardList.innerHTML = leaderboardHTML;
      leaderboardContainer.style.display = 'block';
    }

    // Display popularity list
    function displayPopularityList(users) {
      const popularityContainer = document.getElementById('popularity-container');
      const popularityList = document.getElementById('popularity-list');
      
      if (!popularityContainer || !popularityList) return;
      
      // Show container
      popularityContainer.style.display = 'block';
      
      if (users.length === 0) {
        popularityList.innerHTML = '<div style="text-align: center; color: #aef3c6; padding: 20px;">No popularity data found</div>';
        return;
      }
      
      // Sort by popularity score (likes - dislikes) descending
      const sortedByPopularity = users.sort((a, b) => (b.popularityScore || 0) - (a.popularityScore || 0));
      
      // Display top 10 most popular users
      const popularUsers = sortedByPopularity.slice(0, 10);
      
      const popularityHTML = popularUsers.map((user, index) => {
        const rank = index + 1;
        const likes = user.likes || 0;
        const dislikes = user.dislikes || 0;
        const popularityScore = user.popularityScore || 0;
        const address = user.address;
        const shortAddress = address ? `${address.slice(0, 6)}...${address.slice(-4)}` : 'Unknown';
        
        // Rank styling
        let rankStyle = '';
        let rankIcon = '';
        if (rank === 1) {
          rankStyle = 'background: linear-gradient(135deg, #ffd700, #ffed4e); color: #181c2a;';
          rankIcon = 'üëë';
        } else if (rank === 2) {
          rankStyle = 'background: linear-gradient(135deg, #c0c0c0, #e5e5e5); color: #181c2a;';
          rankIcon = 'ü•à';
        } else if (rank === 3) {
          rankStyle = 'background: linear-gradient(135deg, #cd7f32, #daa520); color: #181c2a;';
          rankIcon = 'ü•â';
        } else {
          rankStyle = 'background: rgba(255, 107, 51, 0.2); color: #aef3c6;';
          rankIcon = `#${rank}`;
        }
        
        // Popularity color based on score
        let popularityColor = '#aef3c6'; // neutral
        if (popularityScore > 0) popularityColor = '#00ff88'; // positive
        else if (popularityScore < 0) popularityColor = '#ff4444'; // negative
        
        return `
          <div style="
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            margin: 8px 0;
            background: rgba(255, 107, 51, 0.05);
            border: 1px solid rgba(255, 107, 51, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
          " onmouseover="this.style.background='rgba(255, 107, 51, 0.1)'" onmouseout="this.style.background='rgba(255, 107, 51, 0.05)'">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="
                ${rankStyle}
                padding: 6px 12px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 14px;
                min-width: 40px;
                text-align: center;
              ">${rankIcon}</div>
              <div>
                <div style="color: #e6eaf0; font-weight: 600; font-family: monospace;">${shortAddress}</div>
                <div style="color: #aef3c6; font-size: 12px;">Index: ${user.index}</div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="display: flex; gap: 15px; align-items: center;">
                <div style="text-align: center;">
                  <div style="color: #00ff88; font-weight: bold; font-size: 16px;">${likes}</div>
                  <div style="color: #aef3c6; font-size: 12px;">‚ù§Ô∏è Likes</div>
                </div>
                <div style="text-align: center;">
                  <div style="color: #ff4444; font-weight: bold; font-size: 16px;">${dislikes}</div>
                  <div style="color: #aef3c6; font-size: 12px;">üíî Dislikes</div>
                </div>
                <div style="text-align: center;">
                  <div style="color: ${popularityColor}; font-weight: bold; font-size: 16px;">${popularityScore >= 0 ? '+' : ''}${popularityScore}</div>
                  <div style="color: #aef3c6; font-size: 12px;">üìä Score</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      popularityList.innerHTML = popularityHTML;
    }

    // Simple Message Box System
    function setupSimpleMessage() {
      const messageBox = document.getElementById('simple-message-box');
      const overlay = document.getElementById('message-overlay');
      const messageText = document.getElementById('message-text');
      const messageTitle = document.getElementById('message-title');
      const languageSelect = document.getElementById('language-select');
      const cursor = document.getElementById('message-cursor');

      if (!messageBox || !overlay || !messageText || !messageTitle || !languageSelect) {
        console.warn('Simple message elements not found');
        return;
      }

      // Multilingual messages
      const messages = {
        fa: {
          title: 'Ÿæ€åÿßŸÖ ŸÖŸáŸÖ',
          content: `ÿ®ÿß ÿ≥ŸÑÿßŸÖ Ÿà ÿßÿ≠ÿ™ÿ±ÿßŸÖ ŸÅÿ±ÿßŸàÿßŸÜ

ŸÑÿ∑ŸÅÿßŸã ÿ™Ÿàÿ¨Ÿá ÿØÿßÿ¥ÿ™Ÿá ÿ®ÿßÿ¥€åÿØ ⁄©Ÿá ÿ´ÿ®ÿ™ ÿ™ŸÜŸáÿß €å⁄© ÿ≠ÿ≥ÿßÿ® ⁄©ÿßÿ±ÿ®ÿ±€å ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ÿ™Ÿàÿµ€åŸá ŸÖ€å‚Äåÿ¥ŸàÿØ

ÿß€åŸÜ Ÿæ€åÿ¥ŸÜŸáÿßÿØ ÿ®Ÿá ÿØŸÑ€åŸÑ Ÿàÿ¨ŸàÿØ ÿßŸÖ⁄©ÿßŸÜÿßÿ™ ÿßÿ±ÿ™ŸÇÿß Ÿà Ÿæ€åÿ¥ÿ±ŸÅÿ™ ÿØÿ± ÿ≥€åÿ≥ÿ™ŸÖ ÿßÿ≥ÿ™ ⁄©Ÿá ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ™ÿ¨ÿ±ÿ®Ÿá ÿ®Ÿáÿ™ÿ±€å ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ŸÅÿ±ÿßŸáŸÖ ⁄©ŸÜÿØ

Ÿæ€åÿ¥ŸÜŸáÿßÿØ ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ ÿßÿ®ÿ™ÿØÿß ÿ®Ÿá ÿ∑Ÿàÿ± ⁄©ÿßŸÖŸÑ ÿ®ÿß ÿ™ŸÖÿßŸÖ ÿ¨ŸÜÿ®Ÿá‚ÄåŸáÿß€å ÿ≥€åÿ≥ÿ™ŸÖ ÿ¢ÿ¥ŸÜÿß ÿ¥Ÿà€åÿØ

Ÿæÿ≥ ÿßÿ≤ ÿßŸÜÿ¨ÿßŸÖ ÿ™ÿ≥ÿ™‚ÄåŸáÿß€å ŸÑÿßÿ≤ŸÖ Ÿà ⁄©ÿ≥ÿ® ÿßÿ∑ŸÑÿßÿπÿßÿ™ ⁄©ÿßŸÅ€åÿå ÿØÿ± ÿµŸàÿ±ÿ™ ŸÜ€åÿßÿ≤ ŸàÿßŸÇÿπ€å ÿ®Ÿá ÿ≠ÿ≥ÿßÿ® ÿØŸàŸÖÿå ÿ®ÿß ÿ¢⁄ØÿßŸá€å ⁄©ÿßŸÖŸÑ ÿßŸÇÿØÿßŸÖ ⁄©ŸÜ€åÿØ

ÿß€åŸÜ Ÿæ€åÿßŸÖ ÿ®ÿß ŸÜŸáÿß€åÿ™ ÿßÿ≠ÿ™ÿ±ÿßŸÖ Ÿà ÿ®Ÿá ŸÖŸÜÿ∏Ÿàÿ± ÿ±ÿßŸáŸÜŸÖÿß€å€å ÿ¥ŸÖÿß ÿßÿ±ÿßÿ¶Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ`
        },
        en: {
          title: 'Important Message',
          content: `Dear Valued User

We respectfully recommend that you register only one account

This suggestion is made because the system offers upgrade features that can provide you with a better experience and opportunities for growth within the network

We kindly suggest that you first take time to fully understand how the system works

After completing your tests and gathering all necessary information, if you genuinely need a second account, please proceed with complete awareness

This message is presented with utmost respect and is intended to guide you in making the best decision`
        },
        ar: {
          title: 'ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸáŸÖÿ©',
          content: `ÿπÿ≤Ÿäÿ≤Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÖ

ŸÜÿ≠ŸÜ ŸÜŸàÿµŸä ÿ®ÿßÿ≠ÿ™ÿ±ÿßŸÖ ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ≠ÿ≥ÿßÿ® Ÿàÿßÿ≠ÿØ ŸÅŸÇÿ∑

Ÿáÿ∞Ÿá ÿßŸÑÿ™ŸàÿµŸäÿ© ŸÖŸÇÿØŸÖÿ© ŸÑÿ£ŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ŸäŸàŸÅÿ± ŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ™ÿ±ŸÇŸäÿ© ÿßŸÑÿ™Ÿä ŸäŸÖŸÉŸÜ ÿ£ŸÜ ÿ™ŸàŸÅÿ± ŸÑŸÉ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ£ŸÅÿ∂ŸÑ ŸàŸÅÿ±ÿµ ŸÑŸÑŸÜŸÖŸà ÿØÿßÿÆŸÑ ÿßŸÑÿ¥ÿ®ŸÉÿ©

ŸÜŸÇÿ™ÿ±ÿ≠ ÿπŸÑŸäŸÉ ÿ®ÿ£ÿØÿ® ÿ£ŸÜ ÿ™ÿ£ÿÆÿ∞ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÉÿßŸÅŸä ŸÑŸÅŸáŸÖ ŸÉŸäŸÅŸäÿ© ÿπŸÖŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ®ÿ¥ŸÉŸÑ ŸÉÿßŸÖŸÑ ÿ£ŸàŸÑÿßŸã

ÿ®ÿπÿØ ÿ•ÿ¨ÿ±ÿßÿ° ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿßŸÑŸÑÿßÿ≤ŸÖÿ© Ÿàÿ¨ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©ÿå ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ÿ®ÿ≠ÿßÿ¨ÿ© ÿ≠ŸÇŸäŸÇŸäÿ© ŸÑÿ≠ÿ≥ÿßÿ® ÿ´ÿßŸÜŸçÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿ®ŸàÿπŸä ŸÉÿßŸÖŸÑ

Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÇÿØŸÖÿ© ÿ®ŸÉŸÑ ÿßÿ≠ÿ™ÿ±ÿßŸÖ Ÿàÿ™ŸáÿØŸÅ ÿ•ŸÑŸâ ÿ™Ÿàÿ¨ŸäŸáŸÉ ŸÑÿßÿ™ÿÆÿßÿ∞ ÿ£ŸÅÿ∂ŸÑ ŸÇÿ±ÿßÿ±`
        }
      };

      // Set Persian as default language
      let currentLanguage = 'fa';

      // Update UI elements with current language
      function updateLanguage(lang) {
        currentLanguage = lang;
        const message = messages[lang];
        
        // Update title
        messageTitle.textContent = message.title;
        
        // Update language selector
        languageSelect.value = lang;
        
        // Update message content
        messageText.textContent = message.content;
        
        // Add language data attribute for CSS targeting
        messageBox.setAttribute('data-lang', lang);
        
        // Update text direction
        if (lang === 'ar') {
          messageBox.style.direction = 'rtl';
          messageText.style.textAlign = 'right';
        } else if (lang === 'en') {
          messageBox.style.direction = 'ltr';
          messageText.style.textAlign = 'left';
        } else {
          messageBox.style.direction = 'rtl';
          messageText.style.textAlign = 'right';
        }
      }

      // Typewriter effect
      function typeWriter(text, element, speed = 50) {
        return new Promise((resolve) => {
          let i = 0;
          element.textContent = '';
          
          function type() {
            if (i < text.length) {
              element.textContent += text.charAt(i);
              i++;
              setTimeout(type, speed);
            } else {
              resolve();
            }
          }
          
          type();
        });
      }

      // Language change handler
      async function changeLanguage(lang) {
        console.log('Language changed to:', lang);
        
        // Update current language
        currentLanguage = lang;
        
        // Update language first
        const message = messages[lang];
        messageTitle.textContent = message.title;
        languageSelect.value = lang;
        
        // Add language data attribute for CSS targeting
        messageBox.setAttribute('data-lang', lang);
        
        // Update text direction
        if (lang === 'ar') {
          messageBox.style.direction = 'rtl';
          messageText.style.textAlign = 'right';
        } else if (lang === 'en') {
          messageBox.style.direction = 'ltr';
          messageText.style.textAlign = 'left';
        } else {
          messageBox.style.direction = 'rtl';
          messageText.style.textAlign = 'right';
        }
        
        // Clear current text and show cursor
        messageText.textContent = '';
        cursor.style.display = 'inline-block';
        
        // Start typewriter effect from the beginning
        await typeWriter(message.content, messageText, 30);
        
        // Hide cursor after typing is complete
        setTimeout(() => {
          cursor.style.display = 'none';
        }, 1000);
      }
      
      // Make changeLanguage global
      window.changeLanguage = changeLanguage;

      // Show message box
      async function showMessage() {
        // Update to current language first
        updateLanguage(currentLanguage);
        
        messageBox.classList.add('show');
        
        // Get current message content
        const currentMessage = messages[currentLanguage].content;
        
        // Clear text and show cursor
        messageText.textContent = '';
        cursor.style.display = 'inline-block';
        
        // Start typewriter effect
        await typeWriter(currentMessage, messageText, 30);
        
        // Hide cursor after typing is complete
        setTimeout(() => {
          cursor.style.display = 'none';
        }, 1000);
        
        // Auto-close after 10 seconds
        setTimeout(() => {
          hideMessage();
        }, 10000);
      }

      // Hide message box
      function hideMessage() {
        messageBox.classList.remove('show');
        messageText.textContent = '';
        cursor.style.display = 'inline-block';
      }

      // Event listeners
      // Overlay click handler
      overlay.addEventListener('click', (e) => {
        console.log('Overlay clicked, target:', e.target, 'overlay:', overlay);
        
        // Only hide if clicking directly on the overlay, not on child elements
        if (e.target === overlay) {
          console.log('Hiding message box due to overlay click');
          hideMessage();
        } else {
          console.log('Overlay click ignored - clicked on child element:', e.target);
        }
      });
      
      // Prevent message box clicks from bubbling to overlay
      const messageContainer = document.querySelector('.message-container');
      if (messageContainer) {
        messageContainer.addEventListener('click', (e) => {
          console.log('Message container clicked, preventing bubble');
          e.stopPropagation();
        });
      }

      // Show message after ensuring status bar is loaded
      async function waitAndShowMessage() {
        // Wait for status bar to be populated
        let attempts = 0;
        const maxAttempts = 10;
        
        while (attempts < maxAttempts) {
          const statusIndex = document.getElementById('status-index');
          if (statusIndex && statusIndex.textContent && statusIndex.textContent !== '-') {
            // Status bar is populated, wait a bit more then show message
            setTimeout(() => {
              showMessage();
            }, 1000);
            return;
          }
          await new Promise(resolve => setTimeout(resolve, 500));
          attempts++;
        }
        
        // If status bar never populated, show message anyway
        showMessage();
      }
      
      // Start the process
      waitAndShowMessage();
    }
  </script>
  
  <!-- Google Translate -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        includedLanguages: 'en,fa,ar,zh,hi,es,fr,de,ja,ko,ru,tr,ur,pt,it,nl',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        autoDisplay: false,
        multilanguagePage: true
      }, 'google_translate_element');
      
      // Force single column layout after initialization
      setTimeout(() => {
        const menu = document.querySelector('.goog-te-menu2');
        if (menu) {
          menu.style.display = 'flex !important';
          menu.style.flexDirection = 'column !important';
          menu.style.maxHeight = '400px !important';
          menu.style.overflowY = 'auto !important';
          menu.style.maxWidth = '200px !important';
          menu.style.width = '200px !important';
        }
        
        // Force smaller items
        const items = document.querySelectorAll('.goog-te-menu2-item');
        items.forEach(item => {
          item.style.padding = '4px 8px !important';
          item.style.fontSize = '10px !important';
          item.style.lineHeight = '1.2 !important';
          item.style.width = '100% !important';
          item.style.display = 'block !important';
        });
      }, 1000);
    }
  </script>
  
  <!-- Collapsible Contract Info -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const contractHeader = document.getElementById('contract-header');
      const contractContent = document.getElementById('contract-content');
      
      if (contractHeader && contractContent) {
        contractHeader.addEventListener('click', function() {
          contractContent.classList.toggle('collapsed');
          contractHeader.classList.toggle('collapsed');
        });
        
        // Start collapsed by default
        contractContent.classList.add('collapsed');
        contractHeader.classList.add('collapsed');
      }
    });
  </script>
  
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>

