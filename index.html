<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>CONTINUOUS PROFIT ACADEMY</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/index-custom.css">

    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ethers.js Ù†Ø³Ø®Ù‡ 6 Ø§Ø² CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ WalletConnect Provider Ø§Ø² CDN Ø±Ø³Ù…ÛŒ -->
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ WalletConnect Handler -->
    <script src="js/walletconnect-handler.js?v=5.7"></script>

  <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ WalletConnect UMD Ø¨Ù‡ ØµÙˆØ±Øª Ù„ÙˆÚ©Ø§Ù„ -->
  <script src="js/walletconnect-v1.8.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
</head>
<body>
  <div id="online-session-bubble" style="display:none;">
    <span class="bubble-text">Ø¬Ù„Ø³Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø§Ø³Øª! ğŸš€</span>
    <span class="bubble-timer" id="bubble-timer"></span>
    <a href="learning.html" class="bubble-link" target="_blank">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</a>
    <span class="bubble-close" id="bubble-close">Ã—</span>
  </div>
  <div id="bubble-mini" style="display:none;">
    <span class="bubble-mini-icon">ğŸš€</span>
  </div>
  <script>
    function formatCountdown(ms) {
      if (ms <= 0) return '00:00:00';
      let s = Math.floor(ms / 1000);
      let h = Math.floor(s / 3600);
      s = s % 3600;
      let m = Math.floor(s / 60);
      s = s % 60;
      return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
    function showSessionBubble() {
      const info = window.sessionInfo;
      if (!info || !info.active) return;
      const bubble = document.getElementById('online-session-bubble');
      const mini = document.getElementById('bubble-mini');
      const timer = document.getElementById('bubble-timer');
      const link = bubble.querySelector('.bubble-link');
      link.href = info.link || 'learning.html';
      bubble.style.display = 'flex';
      mini.style.display = 'none';
      // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
      function updateTimer() {
        const now = Date.now();
        if (now < info.startTime) {
          timer.textContent = 'Ø´Ø±ÙˆØ¹ ØªØ§ Ø¬Ù„Ø³Ù‡: ' + formatCountdown(info.startTime - now);
        } else if (now < info.endTime) {
          timer.textContent = 'Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + formatCountdown(info.endTime - now);
        } else {
          timer.textContent = 'Ø¬Ù„Ø³Ù‡ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯';
        }
      }
      updateTimer();
      window._bubbleTimerInterval = setInterval(updateTimer, 1000);
    }
    function hideSessionBubble() {
      document.getElementById('online-session-bubble').style.display = 'none';
      document.getElementById('bubble-mini').style.display = 'flex';
      if (window._bubbleTimerInterval) clearInterval(window._bubbleTimerInterval);
    }
    function showMiniBubble() {
      document.getElementById('bubble-mini').style.display = 'flex';
      document.getElementById('online-session-bubble').style.display = 'none';
    }
    function expandMiniBubble() {
      showSessionBubble();
    }
    // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø³ØªÙ†
    document.addEventListener('DOMContentLoaded', function() {
      if (window.sessionInfo && window.sessionInfo.active) {
        showSessionBubble();
      }
      document.getElementById('bubble-close').onclick = hideSessionBubble;
      document.getElementById('bubble-mini').onclick = expandMiniBubble;
    });
  </script>

  <!-- Floating Logo as Hamburger Menu -->
  <img id="floating-logo" src="cpa.jpg" alt="CPA Logo" style="height:48px;width:48px;display:inline-block;border-radius:50%;box-shadow:0 2px 12px #00ff8840;position:fixed;bottom:24px;right:24px;z-index:999999;background:#181c2a;cursor:pointer;transition:all 0.3s ease;object-fit:cover;" loading="lazy" onmouseover="this.style.transform='scale(1.1) rotate(360deg)'" onmouseout="this.style.transform='scale(1) rotate(0deg)'" onclick="toggleHamburgerMenu()">
  
  <!-- Hamburger Menu -->
  <div id="hamburgerMenu" class="hamburger-menu">
    <div style="text-align:center;margin-bottom:1rem;padding-bottom:0.8rem;border-bottom:1px solid rgba(167,134,255,0.2);">
      <h3 style="margin:0;color:#00ff88;font-size:1rem;font-weight:bold;">CONTINUOUS PROFIT ACADEMY</h3>
    </div>
    
    <!-- Dashboard Section -->
    <div class="menu-group">
      <div class="menu-group-title">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</div>
      <button onclick="showTab('dashboard')" class="menu-btn">
        <span class="menu-icon">ğŸ </span>
        <span class="menu-label">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§ØµÙ„ÛŒ</span>
      </button>
    </div>
    
    <div class="menu-divider"></div>
    
    <!-- Education Section -->
    <div class="menu-group">
      <div class="menu-group-title">ğŸ“š Ø¢Ù…ÙˆØ²Ø´</div>
      <button onclick="navigateToPage('learning.html')" class="menu-btn">
        <span class="menu-icon">ğŸ“</span>
        <span class="menu-label">Ø¢Ù…ÙˆØ²Ø´ Ùˆ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</span>
      </button>
      <button onclick="navigateToPage('news.html')" class="menu-btn">
        <span class="menu-icon">ğŸ“°</span>
        <span class="menu-label">Ø§Ø®Ø¨Ø§Ø± Ùˆ ØªØ­Ù„ÛŒÙ„</span>
      </button>
    </div>
    
    <div class="menu-divider"></div>
    
    <!-- Tools Section -->
    <div class="menu-group">
      <div class="menu-group-title">ğŸ› ï¸ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</div>
      <button onclick="showTab('swap')" class="menu-btn">
        <span class="menu-icon">ğŸ”„</span>
        <span class="menu-label">ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</span>
      </button>
      <button onclick="showTab('transfer')" class="menu-btn">
        <span class="menu-icon">ğŸ’¸</span>
        <span class="menu-label">Ø§Ù†ØªÙ‚Ø§Ù„</span>
      </button>
      <button onclick="showTab('network')" class="menu-btn">
        <span class="menu-icon">ğŸŒ</span>
        <span class="menu-label">Ø´Ø¨Ú©Ù‡</span>
      </button>
    </div>
    
    <div class="menu-divider"></div>
    
    <!-- Others Section -->
    <div class="menu-group">
      <div class="menu-group-title">ğŸ“‹ Ø³Ø§ÛŒØ±</div>
      <button onclick="showTab('profile')" class="menu-btn">
        <span class="menu-icon">ğŸ‘¤</span>
        <span class="menu-label">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
      </button>
      <button onclick="showTab('reports')" class="menu-btn">
        <span class="menu-icon">ğŸ“Š</span>
        <span class="menu-label">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span>
      </button>
      <button onclick="navigateToPage('shop.html')" class="menu-btn">
        <span class="menu-icon">ğŸ›’</span>
        <span class="menu-label">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span>
      </button>
      <button onclick="showTab('about')" class="menu-btn">
        <span class="menu-icon">â„¹ï¸</span>
        <span class="menu-label">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</span>
      </button>
    </div>
    
    <div class="menu-divider"></div>
    
    <!-- Admin Section -->
    <div class="menu-group admin-group">
      <div class="menu-group-title">ğŸ” Ù…Ø¯ÛŒØ±ÛŒØª</div>
      <button onclick="navigateToPage('admin-owner-panel.html')" class="menu-btn admin-btn">
        <span class="menu-icon">ğŸ‘‘</span>
        <span class="menu-label">Ù¾Ù†Ù„ Owner</span>
      </button>
      <button onclick="navigateToPage('admin-prop.html')" class="menu-btn admin-btn">
        <span class="menu-icon">âš™ï¸</span>
        <span class="menu-label">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù¾â€ŒÙ‡Ø§</span>
      </button>
      <button onclick="showSubAdminModal()" class="menu-btn admin-btn">
        <span class="menu-icon">ğŸ‘¥</span>
        <span class="menu-label">Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ†</span>
      </button>
    </div>
  </div>
  
  <div id="main-dashboard" class="page-section" style="position:relative;overflow:visible;">
    <div class="dashboard-cards" style="display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;max-width:1400px;margin:0 auto;">
      <div class="dashboard-card" id="dashboard-terminal-card" style="background:#111;color:#00ff88;font-family:monospace;border-radius:16px;box-shadow:0 2px 12px #00ff8840;min-width:320px;max-width:1400px;margin:1rem auto;width:100%;text-align:left;direction:ltr;position:relative;">
        <button id="dashboard-expand-btn" style="position:absolute;left:0.7rem;top:0.7rem;background:none;border:none;color:#ff4b4b;font-size:1.2rem;cursor:pointer;z-index:2;line-height:1;padding:0.1rem 0.4rem;border-radius:6px;">-</button>
        <pre id="dashboard-terminal-info" style="background:#111;border:1.5px solid #333;padding:0.5rem 0.8rem;border-radius:8px;color:#00ff88;font-size:0.85rem;line-height:1.5;font-family:monospace;overflow-x:hidden;word-wrap:break-word;white-space:pre-wrap;min-width:280px;width:100%;margin:0;text-align:left;direction:ltr;"></pre>
      </div>

      <!-- Price Chart Section -->
      <div class="dashboard-card" id="price-chart-section" style="background:linear-gradient(135deg,#1a1f2e,#232946);border-radius:16px;box-shadow:0 4px 20px rgba(0,255,136,0.15);min-width:100%;max-width:100%;margin:1rem 0;width:100%;padding:1.5rem;position:relative;overflow:hidden;">
        <div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#00ff88,#a786ff,#00ff88);animation:shimmer 2s linear infinite;"></div>
        
        <!-- Current Prices Display -->
        <!-- Ø­Ø°Ù Ø´Ø¯: Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª ØªÙˆÚ©Ù† Ùˆ Ù¾ÙˆÛŒÙ†Øª -->

        <!-- Token Chart Controls -->
        <div style="display:flex;justify-content:center;align-items:center;gap:0.5rem;margin-bottom:0.5rem;flex-wrap:wrap;">
          <select id="token-period-select" style="background:rgba(0,255,136,0.1);color:#00ff88;border:1px solid #00ff88;border-radius:6px;padding:0.4rem 1rem;font-size:0.9rem;font-family:monospace;cursor:pointer;">
            <option value="day">Day (24h)</option>
            <option value="week">Week (7d)</option>
            <option value="month">Month (30d)</option>
            <option value="year">Year (12m)</option>
          </select>
          <div style="text-align:center;padding:0.3rem 0.8rem;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid rgba(0,255,136,0.2);min-width:120px;">
            <div style="color:#00ff88;font-size:0.8rem;font-family:monospace;">Token Min: <span id="token-min-price" style="color:#fff;">-</span></div>
          </div>
          <div style="text-align:center;padding:0.3rem 0.8rem;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid rgba(0,255,136,0.2);min-width:120px;">
            <div style="color:#00ff88;font-size:0.8rem;font-family:monospace;">Token Max: <span id="token-max-price" style="color:#fff;">-</span></div>
          </div>
        </div>
        
        <!-- Token Chart Container -->
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);width:100%;max-width:100%;margin-bottom:1rem;">
          <div style="color:#00ff88;font-size:0.9rem;font-weight:bold;text-align:center;margin-bottom:0.3rem;font-family:monospace;">Token Price Chart</div>
          <canvas id="price-chart-canvas" style="width:100% !important;height:180px !important;border-radius:4px;max-width:100%;"></canvas>
        </div>
        
        <!-- Point Chart Controls -->
        <div style="display:flex;justify-content:center;align-items:center;gap:0.5rem;margin-bottom:0.5rem;flex-wrap:wrap;">
          <select id="point-period-select" style="background:rgba(167,134,255,0.1);color:#a786ff;border:1px solid #a786ff;border-radius:6px;padding:0.4rem 1rem;font-size:0.9rem;font-family:monospace;cursor:pointer;">
            <option value="day">Day (24h)</option>
            <option value="week">Week (7d)</option>
            <option value="month">Month (30d)</option>
            <option value="year">Year (12m)</option>
          </select>
          <div style="text-align:center;padding:0.3rem 0.8rem;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid rgba(167,134,255,0.2);min-width:120px;">
            <div style="color:#a786ff;font-size:0.8rem;font-family:monospace;">Point Min: <span id="point-min-price" style="color:#fff;">-</span></div>
          </div>
          <div style="text-align:center;padding:0.3rem 0.8rem;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid rgba(167,134,255,0.2);min-width:120px;">
            <div style="color:#a786ff;font-size:0.8rem;font-family:monospace;">Point Max: <span id="point-max-price" style="color:#fff;">-</span></div>
          </div>
        </div>
        
        <!-- Point Chart Container -->
        <div style="background:rgba(0,0,0,0.3);border-radius:8px;padding:0.8rem;border:1px solid rgba(167,134,255,0.2);width:100%;max-width:100%;">
          <div style="color:#a786ff;font-size:0.9rem;font-weight:bold;text-align:center;margin-bottom:0.3rem;font-family:monospace;">Point Value Chart</div>
          <canvas id="point-chart-canvas" style="width:100% !important;height:180px !important;border-radius:4px;max-width:100%;"></canvas>
        </div>
        

        

      </div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const expandBtn = document.getElementById('dashboard-expand-btn');
    const terminalInfo = document.getElementById('dashboard-terminal-info');
    let expanded = false;
    // Start collapsed
    terminalInfo.classList.add('collapsed');
    expandBtn.textContent = '+';
    expandBtn.onclick = function() {
      expanded = !expanded;
      if (expanded) {
        terminalInfo.classList.remove('collapsed');
        expandBtn.textContent = '-';
      } else {
        terminalInfo.classList.add('collapsed');
        expandBtn.textContent = '+';
      }
    };
  });
</script>

  <!-- Swap Section -->
  <div id="main-swap" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header" style="padding:0 1.5rem;">
      <h2 style="margin:0 0 0.5rem 0;">ğŸ”„ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø±Ø²</h2>
      <p style="margin:0 0 0.5rem 0;">ØªØ¨Ø¯ÛŒÙ„ Ø¨ÛŒÙ† ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ POL Ùˆ CPA</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="swap-container" style="max-width:600px;margin:0 auto;padding:1.5rem;">
        <form id="swapForm" class="swap-form">
          <div class="swap-row">
            <label for="swapDirection">Ù†ÙˆØ¹ ØªØ¨Ø¯ÛŒÙ„:</label>
            <select id="swapDirection" required>
              <option value="usdc-to-pol">USDC â†’ POL</option>
              <option value="pol-to-usdc">POL â†’ USDC</option>
              <option value="usdc-to-cpa">USDC â†’ CPA</option>
              <option value="cpa-to-usdc">CPA â†’ USDC</option>
            </select>
          </div>
          
          <div class="swap-row">
            <label for="swapAmount">Ù…Ù‚Ø¯Ø§Ø±:</label>
            <div class="amount-input-group">
              <input type="number" id="swapAmount" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" min="0" step="any" required>
              <button type="button" id="maxBtn" class="max-btn">Ø­Ø¯Ø§Ú©Ø«Ø±</button>
            </div>
          </div>
          
          <div id="swapRate" class="swap-rate">Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„: 1 POL = 2 CPA</div>
          <div id="swapPreview" class="swap-preview"></div>
          
          <button type="submit" class="swap-btn">ØªØ¨Ø¯ÛŒÙ„</button>
          <div id="swapStatus" class="swap-status"></div>
        </form>
        
        <div class="swap-balances">
          <div class="balance-item">
            <span class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ POL:</span>
            <span class="balance-value" id="polBalance">-</span>
          </div>
          <div class="balance-item">
            <span class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ CPA:</span>
            <span class="balance-value" id="cpaBalance">-</span>
          </div>
          <div class="balance-item">
            <span class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDC:</span>
            <span class="balance-value" id="usdcBalance">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Transfer Section -->
  <div id="main-transfer" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 style="margin:0 0 0.5rem 0;">ğŸ’¸ ØªØ±Ø§Ù†Ø³ÙØ±</h2>
      <p style="margin:0 0 0.5rem 0;">Ø§Ù†ØªÙ‚Ø§Ù„ ØªÙˆÚ©Ù† Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒÚ¯Ø±</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="transfer-container" style="max-width:600px;margin:0 auto;padding:1.5rem;">
        <form id="transferForm" class="transfer-form">
          <div class="transfer-row">
            <label for="transferTo">Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯:</label>
            <input type="text" id="transferTo" placeholder="0x..." required style="direction:ltr;">
          </div>
          <div class="transfer-row" style="margin-bottom:0.5rem;">
            <label for="searchIndex">Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³:</label>
            <div style="display:flex;gap:0.5rem;align-items:center;">
              <input type="number" id="searchIndex" placeholder="Ø§ÛŒÙ†Ø¯Ú©Ø³ Ú©Ø§Ø±Ø¨Ø±" min="0" style="width:120px;direction:ltr;">
              <button type="button" id="searchIndexBtn" class="transfer-btn" style="padding:0.5rem 1.2rem;font-size:1rem;min-width:80px;">Ø¬Ø³ØªØ¬Ùˆ</button>
            </div>
            <div id="searchIndexStatus" class="transfer-status" style="margin-top:0.3rem;"></div>
          </div>
          <div class="transfer-row">
            <label for="transferAmount">Ù…Ù‚Ø¯Ø§Ø±:</label>
            <input type="number" id="transferAmount" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" min="0" step="any" required>
          </div>
          <div class="transfer-row">
            <label for="transferToken">Ù†ÙˆØ¹ ØªÙˆÚ©Ù†:</label>
            <select id="transferToken" required>
              <option value="usdc" selected>USDC</option>
              <option value="pol">POL</option>
              <option value="cpa">CPA</option>
            </select>
          </div>
          <button type="submit" class="transfer-btn">Ø§Ù†ØªÙ‚Ø§Ù„</button>
          <div id="transferStatus" class="transfer-status"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Hamburger Menu -->


  <div id="main-network" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="network-title"></h2>
    </div>
    <div class="expand-content">
      <div class="network-container">

        
        <!-- Ù†Ù…Ø§ÛŒØ´ Ø¯Ø±Ø®Øª Ø´Ø¨Ú©Ù‡ -->
        <div id="network-tree"></div>
      </div>
      <!-- Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø³Ø§Ø¨ ÙØ¹Ø§Ù„ Ø¯Ø± Ø´Ø¨Ú©Ù‡ -->
      <button id="new-register-btn" class="register-btn" style="width: 100%; display: none; margin: 2rem 0;">Ø«Ø¨Øª Ø¬Ø¯ÛŒØ¯</button>
    </div>
  </div>

  <div id="main-profile" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <!-- Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸ‘¤</div>
            <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h3>
          </div>
          <div class="section-content">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„</div>
                <div class="info-value" id="profile-address">-</div>
              </div>
              <div class="info-item">
                <div class="info-label">Ù…Ø¹Ø±Ù</div>
                <div class="info-value" id="profile-referrer">-</div>
              </div>
              <div class="info-item">
                <div class="info-label">Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª</div>
                <div class="info-value-with-action">
                  <a id="profile-referral-link" href="#" target="_blank" style="direction:ltr;user-select:all;word-break:break-all;text-decoration:underline;color:#00ff88;">-</a>
                  <button id="copyProfileReferral" class="action-btn">ğŸ“‹ Ú©Ù¾ÛŒ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸ’°</div>
            <h3>Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§</h3>
          </div>
          <div class="section-content">
            <div class="balance-grid">
              <div class="balance-card">
                <div class="balance-icon">ğŸŸ£</div>
                <div class="balance-info">
                  <div class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ POL</div>
                  <div class="balance-value" id="profile-matic">-</div>
                  <div class="balance-usd" id="profile-matic-usd">-</div>
                </div>
              </div>
              <div class="balance-card">
                <div class="balance-icon">ğŸŸ¢</div>
                <div class="balance-info">
                  <div class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ CPA</div>
                  <div class="balance-value" id="profile-lvl">-</div>
                  <div class="balance-usd" id="profile-lvl-usd">-</div>
                </div>
              </div>
              <div class="balance-card">
                <div class="balance-icon">ğŸ’µ</div>
                <div class="balance-info">
                  <div class="balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ USDC</div>
                  <div class="balance-value" id="profile-usdc">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ø´Ø¨Ú©Ù‡ Ø¨Ø§ÛŒÙ†Ø±ÛŒ -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸŒ³</div>
            <h3>Ø´Ø¨Ú©Ù‡ Ø¨Ø§ÛŒÙ†Ø±ÛŒ</h3>
          </div>
          <div class="section-content">
            <div class="binary-grid">
              <div class="binary-stat">
                <div class="stat-icon">â¬…ï¸</div>
                <div class="stat-info">
                  <div class="stat-label">Ø§Ù…ØªÛŒØ§Ø² Ú†Ù¾</div>
                  <div class="stat-value" id="profile-leftPoints">-</div>
                </div>
              </div>
              <div class="binary-stat">
                <div class="stat-icon">â¡ï¸</div>
                <div class="stat-info">
                  <div class="stat-label">Ø§Ù…ØªÛŒØ§Ø² Ø±Ø§Ø³Øª</div>
                  <div class="stat-value" id="profile-rightPoints">-</div>
                </div>
              </div>
              <div class="binary-stat">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-info">
                  <div class="stat-label">Ø³Ù‚Ù Ø¯Ø±Ø¢Ù…Ø¯</div>
                  <div class="stat-value" id="profile-income-cap">-</div>
                </div>
              </div>
              <div class="binary-stat">
                <div class="stat-icon">ğŸ’¸</div>
                <div class="stat-info">
                  <div class="stat-label">Ø¯Ø±ÛŒØ§ÙØªâ€ŒØ´Ø¯Ù‡</div>
                  <div class="stat-value" id="profile-received">-</div>
                </div>
              </div>
              <div class="binary-stat">
                <div class="stat-icon">ğŸŸ£</div>
                <div class="stat-info">
                  <div class="stat-label">Ù¾ÙˆÛŒÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªâ€ŒÙ†Ø´Ø¯Ù‡</div>
                  <div class="stat-value" id="profile-unclaimed-points">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸ“ˆ</div>
            <h3>Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ùˆ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h3>
          </div>
          <div class="section-content">
            <div class="transaction-grid">
              <div class="transaction-item">
                <div class="transaction-label">Ú©Ù„ ÙˆØ§Ø±ÛŒØ²ÛŒ</div>
                <div class="transaction-value" id="profile-depositedAmount">-</div>
              </div>
              <div class="transaction-item">
                <div class="transaction-label">Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø®Ø±ÛŒØ¯Ù‡Ø§</div>
                <div class="transaction-value" id="profile-purchased-kind">-</div>
              </div>
              <div class="transaction-item">
                <div class="transaction-label">Ø¯Ø±Ø¢Ù…Ø¯ Ø±ÙØ±Ø§Ù„</div>
                <div class="transaction-value" id="profile-refclimed">-</div>
              </div>
              <div class="transaction-item">
                <div class="transaction-label">Ú©Ù„ Ø³ÙˆØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                <div class="transaction-value" id="profile-totalMonthlyRewarded">-</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ú©Ø§Ø±Øª ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸ“…</div>
            <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø±Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§</h3>
          </div>
          <div class="section-content">
            <div class="history-grid">
              <div class="history-item">
                <div class="history-label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´</div>
                <div class="history-value" id="profile-lastClaimTime">-</div>
              </div>
              <div class="history-item">
                <div class="history-label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                <div class="history-value" id="profile-lastMonthlyClaim">-</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Ú©Ø§Ø±Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª -->
        <div class="profile-section">
          <div class="section-header">
            <div class="section-icon">ğŸ’¸</div>
            <h3>Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§</h3>
          </div>
          <div class="section-content">
            <div class="claim-buttons-grid">
              <button id="profile-claim-btn" class="claim-btn primary">
                <div class="claim-btn-icon">ğŸ¥‡</div>
                <div class="claim-btn-content">
                  <div class="claim-btn-title">Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÛŒÙ†Ø±ÛŒ (â³ 12 Ø³Ø§Ø¹Øª) <span id="binary-claim-timer" ...></span></div>
                </div>
              </button>
              <button id="profile-claim-monthly-btn" class="claim-btn primary">
                <div class="claim-btn-icon">ğŸ—“ï¸</div>
                <div class="claim-btn-content">
                  <div class="claim-btn-title">Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾Ø§Ø¯Ø§Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                </div>
              </button>
            </div>
            <div id="profile-claim-status" class="claim-status"></div>
            <div id="profile-claim-monthly-status" class="claim-status"></div>
          </div>
        </div>
        
        <div id="profileStatus" class="profile-status"></div>
      </div>
    </div>
  </div>

  <div id="main-reports" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <div class="report-filters">
          <select id="report-type-filter">
            <option value="all">Ù‡Ù…Ù‡ Ú¯Ø²Ø§Ø±Ø´Ø§Øª</option>
            <option value="purchase">Ø®Ø±ÛŒØ¯Ù‡Ø§</option>
            <option value="activation">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§</option>
            <option value="binary">Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÛŒÙ†Ø±ÛŒ</option>
            <option value="trading">Ù…Ø¹Ø§Ù…Ù„Ø§Øª</option>
          </select>
        </div>
        <div id="reports-container">
          <div class="loading-message">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ø²Ø§Ø±Ø´Ø§Øª...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- NEWS section moved to news.html -->

  <!-- SHOP section moved to shop.html -->

  <div id="main-about" class="page-section expandable-container" style="display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="about-container">
        <div class="about-content">
          <p>CONTINUOUS PROFIT ACADEMY ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ØŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ ØªÙˆÚ©Ù† CPA Ùˆ Ø´Ø¨Ú©Ù‡ Ø¨Ø§ÛŒÙ†Ø±ÛŒ Ø§Ø³Øª. Ù‡Ø¯Ù Ù…Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø³ØªØ±ÛŒ Ø´ÙØ§ÙØŒ Ø³Ø±ÛŒØ¹ Ùˆ Ú©Ø§Ø±Ø¨Ø±Ù¾Ø³Ù†Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯Ø§Ù† Ø¨Ù‡ Ø¯Ù†ÛŒØ§ÛŒ Ø¨Ù„Ø§Ú©Ú†ÛŒÙ† Ø§Ø³Øª.</p>
          
          <div class="about-features">
            <h3>ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ Ù¾Ù„ØªÙØ±Ù…</h3>
            <ul>
              <li>Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ ØªÙˆÚ©Ù† CPA</li>
              <li>Ø³ÛŒØ³ØªÙ… Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ø§ÛŒÙ†Ø±ÛŒ</li>
              <li>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¢Ù…ÙˆØ²Ø´ÛŒ</li>
              <li>Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²</li>
              <li>Ø§Ù…Ù†ÛŒØª Ø¨Ø§Ù„Ø§ Ùˆ Ø´ÙØ§ÙÛŒØª Ú©Ø§Ù…Ù„</li>
              <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ 24/7</li>
            </ul>
          </div>
          
          <div class="about-stats">
            <div class="about-stat">
              <div class="icon">ğŸ‘›</div>
              <div class="number" id="about-wallets-count">-</div>
              <div class="label">ØªØ¹Ø¯Ø§Ø¯ ÙˆÙ„Øªâ€ŒÙ‡Ø§ÛŒ Ù…ØªØµÙ„</div>
            </div>
            <div class="about-stat">
              <div class="icon">ğŸš€</div>
              <div class="number">1000+</div>
              <div class="label">Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„</div>
            </div>
            <div class="about-stat">
              <div class="icon">ğŸ’°</div>
              <div class="number">$500K+</div>
              <div class="label">Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
            </div>
            <div class="about-stat">
              <div class="icon">â­</div>
              <div class="number">4.9</div>
              <div class="label">Ø§Ù…ØªÛŒØ§Ø² Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
            </div>
            <div class="about-stat">
              <div class="icon">ğŸ”’</div>
              <div class="number">100%</div>
              <div class="label">Ø§Ù…Ù†ÛŒØª ØªØ¶Ù…ÛŒÙ†ÛŒ</div>
            </div>
          </div>
          
          <div class="about-contact">
            <h3>Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§</h3>
            <p>Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¨Ø§ Ù…Ø§ Ø¯Ø± ØªÙ…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯</p>
            <div class="contact-info">
              <div class="contact-item">
                <span class="icon">ğŸ“§</span>
                <span class="text">support@levelup.com</span>
              </div>
              <div class="contact-item">
                <span class="icon">ğŸ“±</span>
                <span class="text">@LevelUp_Support</span>
              </div>
              <div class="contact-item">
                <span class="icon">ğŸŒ</span>
                <span class="text">www.levelup.com</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer style="direction:ltr;text-align:left;padding:0.2rem 1rem;font-size:0.7rem;color:rgba(170,170,170,0.7);position:fixed;left:0;bottom:0;width:100vw;background:rgba(35,41,70,0.75);backdrop-filter:blur(8px);z-index:100;text-align:center;border-top:1px solid rgba(167,134,255,0.3);box-shadow:0 -2px 10px rgba(0,0,0,0.15);">
    <div style="display:flex;justify-content:center;align-items:center;gap:0.5rem;max-width:300px;margin:0 auto;">
      <span style="font-size:0.65rem;">Â© LevelUp</span>
      <span style="color:rgba(167,134,255,0.6);font-size:0.6rem;">â€¢</span>
      <span style="font-size:0.6rem;">Blockchain</span>
    </div>
  </footer>

  <!-- Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„ -->
  <div id="connection-status" style="
    display: none;
    margin: 0 1rem 1rem 1rem;
    padding: 1rem;
    border-radius: 12px;
    font-family: 'Nazanin', 'B Nazanin', 'BNazanin', Tahoma, Arial, sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
  "></div>

  <!-- Ø³Ø§ÛŒØ± Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
  <script src="js/config.js"></script>
  <script src="js/web3-interactions.js"></script>
  <script src="js/main.js"></script>
  <script src="js/network.js?v=5.7"></script>
  <script src="js/profile.js?v=5.7"></script>
  <script src="js/reports.js?v=5.7"></script>
  <script src="js/news.js?v=5.7"></script>
  <script src="js/shop.js?v=5.7"></script>
  <script src="js/homepage.js?v=5.8"></script>
  <script src="js/price-history-manager.js?v=5.8"></script>
  <script src="js/price-chart.js?v=5.8"></script>
  <script src="js/point-chart.js?v=5.8"></script>
  
  <style>
    /* Fix for chart width issues */
    #price-chart-section {
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: hidden !important;
    }
    
    #price-chart-canvas,
    #point-chart-canvas {
      width: 100% !important;
      max-width: 100% !important;
      height: 150px !important;
      box-sizing: border-box !important;
    }
    
    @media (max-width: 768px) {
      #price-chart-canvas,
      #point-chart-canvas {
        height: 120px !important;
      }
    }
  </style>
  <script src="js/register.js?v=5.7"></script>
  <script src="js/swap.js?v=5.7"></script>
  

  <script>
    // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
    function toggleHamburgerMenu() {
      const menu = document.getElementById('hamburgerMenu');
      if (menu) {
        menu.classList.toggle('open');
        console.log('Menu toggled, open class:', menu.classList.contains('open'));
        
        // Ø§Ú¯Ø± Ù…Ù†Ùˆ Ø¨Ø§Ø² Ø§Ø³ØªØŒ Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ Ú©Ù‡ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª
        if (menu.classList.contains('open')) {
          menu.style.visibility = 'visible';
          menu.style.opacity = '1';
          menu.style.transform = 'scale(1)';
          menu.style.display = 'block';
        } else {
          menu.style.visibility = 'hidden';
          menu.style.opacity = '0';
          menu.style.transform = 'scale(0.9)';
        }
      } else {
        console.log('Menu element not found!');
      }
    }
    
    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ†
    function showSubAdminModal() {
      const modal = document.getElementById('sub-admin-modal');
      if (modal) {
        modal.style.display = 'flex';
        // Ø¨Ø³ØªÙ† Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
        const menu = document.getElementById('hamburgerMenu');
        if (menu) {
          menu.classList.remove('open');
        }
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        // ÙÙ‚Ø· Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡ØŒ Ø¨Ù‚ÛŒÙ‡ Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ù†Ø¯
        const expandableContainers = document.querySelectorAll('.expandable-container');
        expandableContainers.forEach(container => {
            container.classList.remove('collapsed');
            
            // Ensure content is always visible
            const content = container.querySelector('.expand-content');
            if (content) {
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '0.5rem';
                content.style.overflow = 'visible';
                content.style.display = 'block';
            }
            
            // Remove pointer cursor from headers
            const header = container.querySelector('.expand-header');
            if (header) {
                header.style.cursor = 'default';
            }
        });

        // Initialize price chart
        if (typeof window.priceChart !== 'undefined' && typeof window.priceChart.initialize === 'function') {
            window.priceChart.initialize();
        }
        
        // Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¢Ù†
        document.addEventListener('click', function(e) {
          const menu = document.getElementById('hamburgerMenu');
          const logo = document.getElementById('floating-logo');
          if (menu && !menu.contains(e.target) && !logo.contains(e.target)) {
            menu.classList.remove('open');
          }
        });
        
        // Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Escape
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            const menu = document.getElementById('hamburgerMenu');
            if (menu) menu.classList.remove('open');
          }
        });
    });
  </script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const user = await contract.users(address);
      console.log('totalPurchasedKind:', user.totalPurchasedKind?.toString?.() ?? user.totalPurchasedKind);
    })();
  </script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const events = await contract.queryFilter(contract.filters.PurchaseKind());
      console.log(events);
    })();
  </script>
  <script>
    async function updateAboutWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('about-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('about-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('about-wallets-count').innerText = '-';
      }
    }
    // Hook into tab switching
    const aboutBtn = document.getElementById('tab-about-btn');
    if (aboutBtn) {
      aboutBtn.addEventListener('click', updateAboutWalletsCount);
    }
  </script>

  <script>
    function toggleDashboardChart(chartId, btn) {
      const chartDiv = document.getElementById(chartId);
      if (!chartDiv) return;
      const isOpen = chartDiv.style.display === 'block';
      chartDiv.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? 'â–¼' : 'â–²';
      // Placeholder: Here you can load/render the chart if needed
    }
  </script>
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù†/ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ† -->
  <div class="sub-admin-modal" id="sub-admin-modal">
    <div class="sub-admin-modal-content">
      <h3 id="modal-title">Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ† Ø¬Ø¯ÛŒØ¯</h3>
      <form class="sub-admin-form" id="sub-admin-form">
        <div class="form-group">
          <label for="sub-admin-name">Ù†Ø§Ù… Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ†:</label>
          <input type="text" id="sub-admin-name" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ†" required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-address">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„:</label>
          <input type="text" id="sub-admin-address" placeholder="0x..." required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-role">Ù†Ù‚Ø´:</label>
          <select id="sub-admin-role" required>
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´</option>
            <option value="moderator">Ù…Ø¯ÛŒØ± Ù…Ø­ØªÙˆØ§</option>
            <option value="support">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</option>
            <option value="analyst">ØªØ­Ù„ÛŒÙ„Ú¯Ø±</option>
            <option value="teacher">Ù…Ø¯Ø±Ø³</option>
            <option value="custom">Ø³ÙØ§Ø±Ø´ÛŒ</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-description">ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
          <textarea id="sub-admin-description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ..." rows="3"></textarea>
        </div>
        
        <div class="permissions-group">
          <h5>ğŸ” Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ†</h5>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-stream-control" name="permissions">
            <label for="perm-stream-control">Ú©Ù†ØªØ±Ù„ Ù„Ø§ÛŒÙˆ Ø§Ø³ØªØ±ÛŒÙ…</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-chat-moderate" name="permissions">
            <label for="perm-chat-moderate">Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øª</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-ban-users" name="permissions">
            <label for="perm-ban-users">Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-reports" name="permissions">
            <label for="perm-view-reports">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-manage-content" name="permissions">
            <label for="perm-manage-content">Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØªÙˆØ§</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-analytics" name="permissions">
            <label for="perm-view-analytics">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù…Ø§Ø±</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-edit-products" name="permissions">
            <label for="perm-edit-products">ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-orders" name="permissions">
            <label for="perm-view-orders">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø³ÙØ§Ø±Ø´Ø§Øª</label>
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="submit" class="modal-btn primary" id="save-sub-admin-btn">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
          <button type="button" class="modal-btn secondary" id="cancel-sub-admin-btn">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù -->
  <div class="sub-admin-modal" id="delete-confirm-modal">
    <div class="sub-admin-modal-content">
      <h3>âš ï¸ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h3>
      <p style="color: #ccc; text-align: center; margin-bottom: 1.5rem;">
        Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø³Ø§Ø¨ Ø§Ø¯Ù…ÛŒÙ† Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ
      </p>
      <div style="background: #181c2a; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <p style="color: #fff; margin: 0;"><strong>Ù†Ø§Ù…:</strong> <span id="delete-admin-name"></span></p>
        <p style="color: #888; margin: 0.5rem 0 0 0;"><strong>Ø¢Ø¯Ø±Ø³:</strong> <span id="delete-admin-address"></span></p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn danger" id="confirm-delete-btn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        <button class="modal-btn secondary" id="cancel-delete-btn">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
      </div>
    </div>
  </div>

  <div id="custom-footer-div" style="text-align:center; padding:2rem; color:#00ff88; font-size:1.2rem;">
  <br>  <br>  <br>  <br>  <br>  <br>  <br>
  </div>
  <script>
    // ØªØ§Ø¨Ø¹ Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¨Ù‡ ØµÙØ­Ø§Øª Ø®Ø§Ø±Ø¬ÛŒ
  window.navigateToPage = function(pageUrl) {
    // Ø¨Ø³ØªÙ† Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
    const menu = document.getElementById('hamburgerMenu');
    if (menu) {
      menu.classList.remove('open');
    }
    
    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ù†ØªÙ‚Ø§Ù„
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ú©Ù…ÛŒ ØªØ§Ø®ÛŒØ±
    setTimeout(() => {
      window.location.href = pageUrl;
    }, 300);
  };

  window.showTab = async function(tab) {
      // Ø¨Ø³ØªÙ† Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
      const menu = document.getElementById('hamburgerMenu');
      if (menu) {
        menu.classList.remove('open');
      }
      
      const tabs = ['network','profile','reports','swap','transfer','about'];
      tabs.forEach(function(name) {
        var mainEl = document.getElementById('main-' + name);
        if (mainEl) {
          if (name === tab) {
            mainEl.style.display = '';
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù†ÛŒÙ…ÛŒØ´Ù† fade-in
            mainEl.style.opacity = '0';
            mainEl.style.transform = 'translateY(20px)';
            setTimeout(() => {
              mainEl.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
              mainEl.style.opacity = '1';
              mainEl.style.transform = 'translateY(0)';
            }, 50);
          } else {
            mainEl.style.display = 'none';
            mainEl.style.opacity = '1';
            mainEl.style.transform = 'translateY(0)';
          }
        }
        var btnEl = document.getElementById('tab-' + name + '-btn');
        if (btnEl) btnEl.classList.toggle('active', name === tab);
      });
      
      // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
      const targetElement = document.getElementById('main-' + tab);
      if (targetElement) {
        
        // Ø§Ø³Ú©Ø±ÙˆÙ„ Ù†Ø±Ù… Ø¨Ù‡ Ø¨Ø®Ø´
        setTimeout(() => {
          // Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†
          window.scrollTo({ top: 0, behavior: 'smooth' });
          
          // Ø³Ù¾Ø³ Ø¨Ù‡ Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ú©Ù†
          setTimeout(() => {
            targetElement.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start',
              inline: 'nearest'
            });
          }, 200);
        }, 100);
      }
      
      // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
      tabs.forEach(function(name) {
        var btnEl = document.getElementById('tab-' + name + '-btn');
        if (btnEl) btnEl.classList.toggle('active', name === tab);
      });
      
      try {
        switch(tab) {
          case 'network':
            if (typeof window.initializeNetworkTab === 'function') {
              await window.initializeNetworkTab();
            } else {
              if (typeof updateNetworkStats === 'function') await updateNetworkStats();
              if (typeof renderNetworkTree === 'function') await renderNetworkTree();
            }
            break;
          case 'profile':
            if (typeof loadUserProfile === 'function') await loadUserProfile();
            break;
          case 'reports':
            if (typeof loadReports === 'function') await loadReports();
            break;
          case 'swap':
            if (window.swapManager) {
              await window.swapManager.refreshSwapData();
            }
            break;
          case 'transfer':
            // No extra logic needed for now
            break;
          case 'about': break;
        }
      } catch (error) {
        console.error(`Error loading data for tab ${tab}:`, error);
      }
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var archiveBtn = Array.from(document.querySelectorAll('button, a')).find(el => el.textContent.includes('Ø¢Ø±Ø´ÛŒÙˆ Ø¨Ø§Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ'));
      if (archiveBtn) archiveBtn.remove();
    });
  </script>

  <script>
  (async function() {
    if (window.getUserProfile) {
      const profile = await window.getUserProfile();
      if (!profile.activated) {
        // Ù‚ÙÙ„ Ú©Ø±Ø¯Ù† ÙÙ‚Ø· Ø¨Ø®Ø´ Ø±ÛŒÙ¾ÙˆØ±Øª
        const reportsSection = document.getElementById('main-reports');
        if (reportsSection) {
          reportsSection.innerHTML = '<div style="color:#ff6b6b;text-align:center;padding:3rem;font-size:1.5rem;">Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„ Ù…Ø¬Ø§Ø² Ø§Ø³Øª.<br>ğŸ”’</div>';
          reportsSection.style.background = '#181c2a';
        }
      }
    }
  })();
  </script>

  <!-- Ú©Ù†ØªØ±Ù„ Ù†Ù…Ø§ÛŒØ´ ÙˆØ±ÙˆØ¯ÛŒ Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const transferForm = document.getElementById('transferForm');
      if (!transferForm) return;
      transferForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const transferBtn = transferForm.querySelector('button[type="submit"]');
        if (transferBtn) {
          transferBtn.disabled = true;
          var oldText = transferBtn.textContent;
          transferBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';
        }
        const to = document.getElementById('transferTo').value.trim();
        const amount = parseFloat(document.getElementById('transferAmount').value);
        const token = document.getElementById('transferToken').value;
        const status = document.getElementById('transferStatus');
        status.textContent = '';
        status.className = 'transfer-status';
        if (!to || !amount || amount <= 0) {
          status.textContent = 'Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯ Ùˆ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        if (!window.contractConfig || !window.contractConfig.contract || !window.contractConfig.signer) {
          status.textContent = 'Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        try {
          status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';
          status.className = 'transfer-status loading';
          if (token === 'pol') {
            // Ø§Ù†ØªÙ‚Ø§Ù„ MATIC/POL
            const tx = await window.contractConfig.signer.sendTransaction({
              to,
              value: ethers.parseEther(amount.toString())
            });
            await tx.wait();
            status.textContent = 'Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\nÚ©Ø¯ ØªØ±Ø§Ú©Ù†Ø´: ' + tx.hash;
            status.className = 'transfer-status success';
          } else if (token === 'usdc') {
            // Ø§Ù†ØªÙ‚Ø§Ù„ USDC
            const usdcContract = new ethers.Contract(USDC_ADDRESS, USDC_ABI, window.contractConfig.signer);
            const decimals = 6; // USDC has 6 decimals
            const parsedAmount = ethers.parseUnits(amount.toString(), decimals);
            const tx = await usdcContract.transfer(to, parsedAmount);
            await tx.wait();
            status.textContent = 'Ø§Ù†ØªÙ‚Ø§Ù„ USDC Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\nÚ©Ø¯ ØªØ±Ø§Ú©Ù†Ø´: ' + tx.hash;
            status.className = 'transfer-status success';
          } else {
            // Ø§Ù†ØªÙ‚Ø§Ù„ CPA
            const contract = window.contractConfig.contract;
            const tx = await contract.transfer(to, ethers.parseEther(amount.toString()));
            await tx.wait();
            status.textContent = 'Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\nÚ©Ø¯ ØªØ±Ø§Ú©Ù†Ø´: ' + tx.hash;
            status.className = 'transfer-status success';
          }
          transferForm.reset();
        } catch (error) {
          let msg = error && error.message ? error.message : error;
          if (msg.includes('user rejected')) msg = 'ØªØ±Ø§Ú©Ù†Ø´ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø± Ù„ØºÙˆ Ø´Ø¯';
          else if (msg.includes('insufficient funds')) msg = 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª';
          else if (msg.includes('invalid address')) msg = 'Ø¢Ø¯Ø±Ø³ Ù…Ù‚ØµØ¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
          else if (msg.includes('nonce')) msg = 'Ø®Ø·Ø§ Ø¯Ø± Ø´Ù…Ø§Ø±Ù‡ ØªØ±Ø§Ú©Ù†Ø´. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯';
          else if (msg.includes('execution reverted')) msg = 'ØªØ±Ø§Ú©Ù†Ø´ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø´Ø±Ø§ÛŒØ· Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯';
          else msg = 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªÙ‚Ø§Ù„: ' + msg;
          status.textContent = msg;
          status.className = 'transfer-status error';
        }
        if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchBtn = document.getElementById('searchIndexBtn');
      const searchInput = document.getElementById('searchIndex');
      const searchStatus = document.getElementById('searchIndexStatus');
      if (searchBtn && searchInput) {
        searchBtn.onclick = async function() {
          searchStatus.textContent = '';
          const idx = searchInput.value.trim();
          if (!idx || isNaN(idx) || Number(idx) < 0) {
            searchStatus.textContent = 'Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
            searchStatus.className = 'transfer-status error';
            return;
          }
          if (!window.contractConfig || !window.contractConfig.contract) {
            searchStatus.textContent = 'Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†ÛŒØ³Øª';
            searchStatus.className = 'transfer-status error';
            return;
          }
          try {
            searchStatus.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...';
            searchStatus.className = 'transfer-status loading';
            const contract = window.contractConfig.contract;
            const address = await contract.indexToAddress(BigInt(idx));
            if (!address || address === '0x0000000000000000000000000000000000000000') {
              searchStatus.textContent = 'Ø¢Ø¯Ø±Ø³ ÙˆÙ„Øª Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø§ÛŒÙ†Ø¯Ú©Ø³ ÛŒØ§ÙØª Ù†Ø´Ø¯';
              searchStatus.className = 'transfer-status error';
              document.getElementById('transferTo').value = '';
            } else {
              searchStatus.textContent = 'Ø¢Ø¯Ø±Ø³ ÙˆÙ„Øª Ù¾ÛŒØ¯Ø§ Ø´Ø¯';
              searchStatus.className = 'transfer-status success';
              document.getElementById('transferTo').value = address;
            }
          } catch (err) {
            searchStatus.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ: ' + (err && err.message ? err.message : err);
            searchStatus.className = 'transfer-status error';
            document.getElementById('transferTo').value = '';
          }
        };
      }
    });
  </script>

  <script>
    // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ú¯Ø³ØªØ±Ø´
    function toggleExpandable(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        container.classList.toggle('collapsed');
        
        // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± localStorage
        const isCollapsed = container.classList.contains('collapsed');
        localStorage.setItem(`expandable_${containerId}`, isCollapsed ? 'collapsed' : 'expanded');
      }
    }

    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ú¯Ø³ØªØ±Ø´ Ø§Ø² localStorage
    function restoreExpandableStates() {
      const expandableContainers = document.querySelectorAll('.expandable-container');
      expandableContainers.forEach(container => {
        const containerId = container.id;
        const savedState = localStorage.getItem(`expandable_${containerId}`);
        if (savedState === 'collapsed') {
          container.classList.add('collapsed');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ú¯Ø³ØªØ±Ø´
      restoreExpandableStates();
      
      
    });
  </script>

  <script>
    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ø¨Ø§ Ù†Ù…Ø§Ø¯ Ø¹Ù„Ù…ÛŒ
    window.formatTokenPrice = function(priceWei) {
      if (!priceWei || priceWei === '0') return '0';
      let priceString = priceWei.toString();
      while (priceString.length < 18) priceString = '0' + priceString;
      if (priceString.length > 18) priceString = priceString.slice(-18);
      const result = '0.' + priceString;
      const numResult = parseFloat(result);
      if (numResult < 0.000001) {
        return numResult.toExponential(6);
      }
      return result;
    }

    // ØªØ§Ø¨Ø¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª
    async function updateTokenPriceDisplay() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
          if (!window.contractConfig || !window.contractConfig.contract) {
            const el = document.getElementById('chart-lvl-usd');
            if (el) el.textContent = 'Ø§ØªØµØ§Ù„ Ù†Ø§Ù…ÙˆÙÙ‚';
            return;
          }
        }
        const contract = window.contractConfig.contract;
        const tokenPrice = await contract.getTokenPrice();
        const priceFormatted = window.formatTokenPrice(tokenPrice);
        const el = document.getElementById('chart-lvl-usd');
        if (el) el.textContent = priceFormatted;
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ point-value Ø§Ø² Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        try {
          const pointValue = await contract.getPointValue();
          const pointValueNum = parseFloat(ethers.formatUnits(pointValue, 18));
          const pointValueFormatted = pointValueNum < 0.000001 ? pointValueNum.toExponential(6) : pointValueNum.toFixed(2);
          const el2 = document.getElementById('point-value');
          if (el2) el2.textContent = pointValueFormatted + ' CPA';
        } catch (error) {
          // ...
        }
      } catch (error) {
        const el = document.getElementById('chart-lvl-usd');
        if (el) el.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ';
      }
    }
    // ... existing code ...
  </script>

  <script>
    if (window.loadUserProfile) {
      const origLoadUserProfile = window.loadUserProfile;
      window.loadUserProfile = async function() {
        await origLoadUserProfile.apply(this, arguments);
        await updateProfileReferrer(); // Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ await Ùˆ Ø¨Ø¯ÙˆÙ† ØªØ§Ø®ÛŒØ±
      };
    }
  </script>



  <script src="js/dashboard-typewriter.js"></script>
  <script src="js/token-price.js"></script>
  <script src="js/remove-archive-btn.js"></script>
  <script src="js/hamburger-float.js"></script>
  
  <!-- Dashboard Terminal Script - Moved after config.js -->
  <script>
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ù¾ÙˆÛŒÙ†Øª
    async function updatePointPriceDisplay() {
      try {
        if (window.priceHistoryManager) {
          const pointPrice = await window.priceHistoryManager.updatePointPrice();
          if (pointPrice !== null) {
            const pointDisplay = document.getElementById('current-point-display');
            if (pointDisplay) {
              pointDisplay.textContent = window.priceHistoryManager.formatPrice(pointPrice);
            }
          }
        }
      } catch (error) {
        console.error('Error updating point price display:', error);
        const pointDisplay = document.getElementById('current-point-display');
        if (pointDisplay) pointDisplay.textContent = 'Error loading';
      }
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
    function updatePriceStats() {
      try {
        if (window.priceHistoryManager) {
          const tokenPeriod = window.priceChart?.currentTimePeriod || 'day';
          const pointPeriod = window.pointChart?.currentTimePeriod || 'day';
          
          // Ø¢Ù…Ø§Ø± ØªÙˆÚ©Ù†
          const tokenStats = window.priceHistoryManager.getHistoryStats('token', tokenPeriod);
          const tokenMinEl = document.getElementById('token-min-price');
          const tokenMaxEl = document.getElementById('token-max-price');
          if (tokenMinEl) tokenMinEl.textContent = window.priceHistoryManager.formatPrice(tokenStats.min);
          if (tokenMaxEl) tokenMaxEl.textContent = window.priceHistoryManager.formatPrice(tokenStats.max);
          
          // Ø¢Ù…Ø§Ø± Ù¾ÙˆÛŒÙ†Øª
          const pointStats = window.priceHistoryManager.getHistoryStats('point', pointPeriod);
          const pointMinEl = document.getElementById('point-min-price');
          const pointMaxEl = document.getElementById('point-max-price');
          if (pointMinEl) pointMinEl.textContent = window.priceHistoryManager.formatPrice(pointStats.min);
          if (pointMaxEl) pointMaxEl.textContent = window.priceHistoryManager.formatPrice(pointStats.max);
        }
      } catch (error) {
        console.error('Error updating price stats:', error);
      }
    }

    // Ø§ÙÚ©Øª ØªØ§ÛŒÙ¾ ØªØ¯Ø±ÛŒØ¬ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    function typewriterDashboardInfo(lines, isWaiting = false) {
      const el = document.getElementById('dashboard-terminal-info');
      if (!el) return;
      // Ø­Ø°Ù Ú©Ø±Ø³Ø± Ú†Ø´Ù…Ú©â€ŒØ²Ù†
      if (isWaiting) {
        el.textContent = '';
        return;
      }
      if (el._cursorInterval) {
        clearInterval(el._cursorInterval);
        el._cursorInterval = null;
      }
      el.textContent = '';
      let line = 0, char = 0;
      function type() {
        if (line < lines.length) {
          let prefix = (lines[line].trim() !== '') ? 'cpa> ' : '';
          if (char === 0) el.textContent += prefix;
          if (char < lines[line].length) {
            el.textContent += lines[line][char];
            char++;
            setTimeout(type, 25);
          } else {
            el.textContent += '\n';
            line++;
            char = 0;
            setTimeout(type, 60);
          }
        }
      }
      type();
    }

    // Helper function to format prices in scientific notation
    function formatPriceScientific(price) {
      if (price === 0 || price === '0') return '0';
      const numPrice = parseFloat(price);
      if (isNaN(numPrice)) return price;
      if (numPrice < 0.000001) {
        return numPrice.toExponential(6);
      }
      return numPrice.toFixed(6);
    }

    // Helper function to pad labels
    function padLabel(label) {
      return label.padEnd(20);
    }

    async function updateDashboardTerminalInfo() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          try {
            await window.connectWallet();
          } catch (e) {
            typewriterDashboardInfo([
              //'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—',
              //'â•‘                    WALLET NOT CONNECTED                     â•‘',
              //'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
              'WALLET NOT CONNECTED',
              '',
              'ğŸ”Œ Please connect your wallet to view dashboard data',
              'ğŸ”„ Retrying connection...',
              '',
              'Click the wallet connect button to proceed.'
            ]);
            return;
          }
        }
        const contract = window.contractConfig.contract;
        
        // All Wallets
        let wallets = '-';
        try { wallets = (await contract.wallets()).toString(); } catch(e){}
        
        // Total Supply
        let totalSupply = '-';
        try { 
          const supply = await contract.totalSupply();
          const supplyFormatted = formatPriceScientific(ethers.formatUnits(supply, 18));
          totalSupply = supplyFormatted + ' CPA'; 
        } catch(e){}
        
        // Total Points
        let totalPoints = '-';
        try {
          const totalPointsRaw = await contract.totalClaimableBinaryPoints();
          totalPoints = (BigInt(totalPointsRaw) / 10n ** 18n).toString();
        } catch(e){}
        
        // Point Value
        let pointValue = '-';
        try { 
          const pointValueRaw = await contract.getPointValue();
          const pointValueNum = parseFloat(ethers.formatUnits(pointValueRaw, 18));
          pointValue = formatPriceScientific(pointValueNum) + ' CPA'; 
        } catch(e){}
        
        // Current Token Price
        let tokenPrice = '-';
        try {
          const priceRaw = await contract.getTokenPrice();
          const priceFormatted = formatPriceScientific(ethers.formatUnits(priceRaw, 18));
          tokenPrice = priceFormatted;
        } catch(e){}
        
        // Contract Token Balance
        let contractTokenBalance = '-';
        try { 
          const balance = await contract.balanceOf(contract.target);
          const balanceFormatted = formatPriceScientific(ethers.formatUnits(balance, 18));
          contractTokenBalance = balanceFormatted + ' CPA'; 
        } catch(e){}
        
        // Help Fund
        let cashback = '-';
        try { 
          const cashbackRaw = await (contract.cashBack ? contract.cashBack() : contract.cashback());
          const cashbackFormatted = formatPriceScientific(ethers.formatUnits(cashbackRaw, 18));
          cashback = cashbackFormatted + ' CPA'; 
        } catch(e){}
        
        // USDC Contract Balance
        let usdcBalance = '-';
        try {
          const usdcBalanceRaw = await contract.getContractUSDCBalance();
          const usdcBalanceFormatted = formatPriceScientific(ethers.formatUnits(usdcBalanceRaw, 6));
          usdcBalance = usdcBalanceFormatted + ' USDC';
        } catch(e){
          console.error('Error fetching USDC balance via contract function:', e);
          try {
            if (typeof USDC_ADDRESS !== 'undefined' && typeof USDC_ABI !== 'undefined') {
              const usdcContract = new ethers.Contract(USDC_ADDRESS, USDC_ABI, contract.provider);
              const usdcBalanceRaw = await usdcContract.balanceOf(contract.target);
              const usdcBalanceFormatted = formatPriceScientific(ethers.formatUnits(usdcBalanceRaw, 6));
              usdcBalance = usdcBalanceFormatted + ' USDC';
            } else {
              usdcBalance = 'Config Error';
            }
          } catch(fallbackError) {
            console.error('Fallback USDC balance fetch failed:', fallbackError);
            usdcBalance = 'Error: ' + e.message;
          }
        }
        
        const lines = [
          //'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—',
          'CONTINUOUS PROFIT ACADEMY',
          //'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
          '',
          'ğŸš€ Welcome to CPA!',
          'ğŸ“Š Loading blockchain data...',
          '',
          //'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—',
          //'â•‘                        SYSTEM STATUS                         â•‘',
          //'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
          'SYSTEM STATUS',
          '',
          `ğŸŒ All Wallets: ${wallets}`,
          `ğŸ’° Total Supply: ${totalSupply}`,
          `ğŸ¯ Total Points: ${totalPoints}`,
          `ğŸ’ Point Value: ${pointValue}`,
          `ğŸ“ˆ Current Token Price: ${tokenPrice}`,
          `ğŸ¦ Contract Token Bal.: ${contractTokenBalance}`,
          `ğŸ’š Help Fund: ${cashback}`,
          `ğŸ’µ USDC Contract Bal.: ${usdcBalance}`,
          '',
          //'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—',
          //'â•‘                        READY                                 â•‘',
          //'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
          'READY'
        ];
        
        typewriterDashboardInfo(lines);
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª Ù¾ÙˆÛŒÙ†Øª
        updatePointPriceDisplay();
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
        updatePriceStats();
      } catch (e) {
        typewriterDashboardInfo([
          //'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—',
          //'â•‘                        ERROR DETECTED                        â•‘',
          //'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•',
          'ERROR DETECTED',
          '',
          'âŒ Error loading dashboard info',
          'ğŸ”„ Retrying connection...',
          '',
          'Please check your wallet connection and try again.'
        ]);
      }
    }
    document.addEventListener('DOMContentLoaded', function() {
      // Ù†Ù…Ø§ÛŒØ´ Ú©Ø±Ø³Ø± Ú†Ø´Ù…Ú©â€ŒØ²Ù† ØªØ§ Ø²Ù…Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª
      typewriterDashboardInfo([], true);
      
      // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
      setTimeout(updateDashboardTerminalInfo, 1000);
      
      // Ø´Ø±ÙˆØ¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
      setInterval(() => {
        updatePointPriceDisplay();
        updatePriceStats();
      }, 30000); // Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
      

    });
  </script>
</body>
</html>
