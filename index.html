<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAM Token - Clean Dashboard</title>
    
    <!-- Web3.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    
    <!-- Navbar CSS -->
    <link rel="stylesheet" href="css/navbar.css">
    
    <!-- Navbar JavaScript -->
    <script src="js/navbar.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
        font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f0f17 0%, #181c2a 50%, #232946 100%);
            color: #fff;
            min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
            padding: 20px;
            margin: 0;
        }
        
        
        .container {
        text-align: center;
            max-width: 800px;
            width: 100%;
            padding-top: 80px;
      }

        .logo {
            font-size: 4rem;
            font-weight: bold;
        color: #00ff88;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        
        .title {
            font-size: 2.5rem;
            color: #a786ff;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #b8c1ec;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .wallet-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .connect-wallet-btn {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
        font-weight: 600;
            cursor: pointer;
        transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
            margin-bottom: 15px;
        }
        
        .connect-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }
        
        .connect-wallet-btn:disabled {
        background: #666;
        cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .wallet-status {
            color: #ff6b6b;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .wallet-status.connected {
            color: #00ff88;
        }
        
        .balances-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .balance-item {
            background: rgba(35, 41, 70, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .balance-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 255, 136, 0.4);
        }
        
        .balance-label {
            color: #a786ff;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .balance-value {
            color: #00ff88;
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .balance-item:nth-child(1) .balance-value {
            color: #ff6b6b;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.3);
        }
        
        .balance-item:nth-child(2) .balance-value {
            color: #ffa726;
            text-shadow: 0 0 10px rgba(255, 167, 38, 0.3);
        }
        
        .balance-item:nth-child(3) .balance-value {
            color: #42a5f5;
            text-shadow: 0 0 10px rgba(66, 165, 245, 0.3);
        }
        
        .stars-container {
            background: rgba(35, 41, 70, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .stars-title {
            color: #00ff88;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .stars-display {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .star {
            font-size: 2rem;
            opacity: 0.3;
            transition: all 0.3s ease;
            filter: grayscale(100%);
        }
        
        .star.active {
            opacity: 1;
            filter: grayscale(0%);
            transform: scale(1.1);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .star.level-1.active {
            color: #ff6b6b;
        }
        
        .star.level-2.active {
            color: #ffa726;
        }
        
        .star.level-3.active {
            color: #ffeb3b;
        }
        
        .star.level-4.active {
            color: #66bb6a;
        }
        
        .star.level-5.active {
            color: #42a5f5;
        }
        
        .stars-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .points-display {
            color: #a786ff;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(167, 134, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(167, 134, 255, 0.2);
        }
        
        .level-display {
            color: #00ff88;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .section {
            background: rgba(35, 41, 70, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            color: #00ff88;
            font-size: 1.5rem;
            margin-bottom: 25px;
            font-weight: 600;
        }
        
        .contract-address {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.1);
        }
        
        .contract-label {
            color: #a786ff;
      font-size: 0.9rem;
            margin-bottom: 8px;
      font-weight: 500;
    }
    
        .contract-link {
      color: #00ff88;
            text-decoration: none;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            word-break: break-all;
            text-align: center;
            padding: 8px 12px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(0, 255, 136, 0.2);
      transition: all 0.3s ease;
    }
    
        .contract-link:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.4);
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }
        
        .contract-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: #00ff88;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }
        
        .copy-btn {
      background: rgba(167, 134, 255, 0.1);
            border-color: rgba(167, 134, 255, 0.3);
      color: #a786ff;
        }
        
        .copy-btn:hover {
            background: rgba(167, 134, 255, 0.2);
            border-color: rgba(167, 134, 255, 0.5);
            box-shadow: 0 4px 12px rgba(167, 134, 255, 0.2);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.1);
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
        .info-item:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.3);
      transform: translateY(-2px);
        }
        
        .info-label {
            color: #a786ff;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .info-value {
            color: #00ff88;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: right;
            word-break: break-all;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
        .action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .action-btn:hover::before {
      left: 100%;
    }
    
        .action-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: rgba(0, 255, 136, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
        }
        
        .btn-icon {
            font-size: 2.5rem;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 50%;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .btn-text {
            flex: 1;
        }
        
        .btn-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #00ff88;
            margin-bottom: 5px;
        }
        
        .btn-subtitle {
            font-size: 0.9rem;
            color: #a786ff;
            opacity: 0.8;
        }
        
        .swap-btn:hover .btn-icon {
            background: rgba(0, 255, 136, 0.2);
            transform: rotate(180deg);
        }
        
        .transfer-btn:hover .btn-icon {
            background: rgba(167, 134, 255, 0.2);
            transform: scale(1.1);
        }
        
        .footer {
            margin-top: 40px;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <button class="menu-btn" id="menu-btn">
                <span class="menu-icon">‚ò∞</span>
            </button>
            <div class="nav-menu" id="nav-menu">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="profile.html" class="nav-link">Profile</a>
                <a href="swap.html" class="nav-link">Swap</a>
                <a href="transfer.html" class="nav-link">Transfer</a>
                <a href="utility.html" class="nav-link">Utility</a>
                <a href="register.html" class="nav-link">Register</a>
                <a href="sales.html" class="nav-link">Sales</a>
                <a href="transfer-ownership.html" class="nav-link">Transfer Ownership</a>
                <a href="professional-tree.html" class="nav-link">Professional Tree</a>
                <a href="about.html" class="nav-link">About</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="logo">IAM</div>
        <h1 class="title">Token Dashboard</h1>
        
        <!-- Wallet Connection - Hidden -->
        <div class="wallet-section" style="display: none;">
            <button class="connect-wallet-btn" id="connect-wallet-btn">
                Connect Wallet
            </button>
            <div class="wallet-status" id="wallet-status">
                Not Connected
            </div>
        </div>

        <!-- User Balances -->
        <div class="balances-container" id="balances-container">
            <div class="balance-item">
                <div class="balance-label">IAM Token</div>
                <div class="balance-value" id="iam-balance">--</div>
            </div>
            <div class="balance-item">
                <div class="balance-label">MATIC</div>
                <div class="balance-value" id="matic-balance">--</div>
            </div>
            <div class="balance-item">
                <div class="balance-label">DAI</div>
                <div class="balance-value" id="dai-balance">--</div>
            </div>
        </div>

        <!-- User Stars System -->
        <div class="stars-container">
            <div class="stars-title">Your Level</div>
            <div class="stars-display" id="user-stars">
                <div class="star">‚≠ê</div>
                <div class="star">‚≠ê</div>
                <div class="star">‚≠ê</div>
                <div class="star">‚≠ê</div>
                <div class="star">‚≠ê</div>
            </div>
            <div class="stars-info">
                <span class="points-display" id="user-points">-- Points</span>
                <span class="level-display" id="user-level">Level --</span>
            </div>
        </div>
        
        <p class="subtitle">
            Welcome to IAM Token platform.<br>
            Clean and simple interface without external dependencies.
        </p>
        
        <!-- Contract Address -->
        <div class="section">
            <h3 class="section-title">Contract Address</h3>
            <div class="contract-address">
                <span class="contract-label">IAM Token Contract:</span>
                <a href="https://polygonscan.com/address/0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D" 
                   target="_blank" 
                   class="contract-link">
                    0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D
                </a>
            </div>
            <div class="contract-actions">
                <a href="https://polygonscan.com/address/0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D" 
                   target="_blank" 
                   class="btn">
                    üîç View on PolygonScan
                </a>
                <button onclick="copyContractAddress()" class="btn copy-btn">
                    üìã Copy Address
                </button>
            </div>
        </div>
        
        <!-- Dashboard Information -->
        <div class="section">
            <h3 class="section-title">Dashboard Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Total Supply:</span>
                    <span class="info-value">2,950,496,467,971,858,000 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Total Points:</span>
                    <span class="info-value">7 Points</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Token Price (USD):</span>
                    <span class="info-value">$0.00000118</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Token Price (MATIC):</span>
                    <span class="info-value">0.0000000014 MATIC</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Contract Balance:</span>
                    <span class="info-value">76,026,625,270,933,010 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">DAI Equivalent:</span>
                    <span class="info-value">3,496.34 DAI</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Trading Volume:</span>
                    <span class="info-value">0 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Active Wallets:</span>
                    <span class="info-value">146 Wallets</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Cashback:</span>
                    <span class="info-value">21,541,221,595,864,520 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Point Value:</span>
                    <span class="info-value">10,860,946,467,276,144 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">Registration Price:</span>
                    <span class="info-value">28,691,983,122,362,868 IAM</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">DAI Contract Balance:</span>
                    <span class="info-value">3,497.94 DAI</span>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="section">
            <h3 class="section-title">Quick Actions</h3>
            <div class="buttons-grid">
                <a href="swap.html" class="action-btn swap-btn">
                    <div class="btn-icon">üîÑ</div>
                    <div class="btn-text">
                        <div class="btn-title">Swap</div>
                        <div class="btn-subtitle">Exchange Tokens</div>
                    </div>
                </a>
                
                <a href="transfer.html" class="action-btn transfer-btn">
                    <div class="btn-icon">üí∏</div>
                    <div class="btn-text">
                        <div class="btn-title">Transfer</div>
                        <div class="btn-subtitle">Send Tokens</div>
                    </div>
                </a>
            </div>
        </div>
        
        <div class="footer">
            No external scripts loaded ‚Ä¢ Clean console ‚Ä¢ No errors
        </div>
    </div>
    
    <!-- Contract ABI and Connection -->
  <script>
        // Contract ABI Configuration - Based on actual contract
        const CONTRACT_ABI = [
            {
                "inputs": [],
                "name": "totalSupply",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalClaimableBinaryPoints",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
        "type": "function"
      },
      {
                "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "user", "type": "address"}],
                "name": "users",
        "outputs": [
                    {"internalType": "uint256", "name": "index", "type": "uint256"},
                    {"internalType": "uint256", "name": "binaryPoints", "type": "uint256"},
                    {"internalType": "uint256", "name": "binaryPointCap", "type": "uint256"},
                    {"internalType": "uint256", "name": "binaryPointsClaimed", "type": "uint256"},
                    {"internalType": "uint256", "name": "totalPurchasedKind", "type": "uint256"},
                    {"internalType": "uint256", "name": "upgradeTime", "type": "uint256"},
                    {"internalType": "uint256", "name": "lastClaimTime", "type": "uint256"},
                    {"internalType": "uint256", "name": "leftPoints", "type": "uint256"},
                    {"internalType": "uint256", "name": "rightPoints", "type": "uint256"},
                    {"internalType": "uint256", "name": "lastMonthlyClaim", "type": "uint256"},
                    {"internalType": "uint256", "name": "totalMonthlyRewarded", "type": "uint256"},
                    {"internalType": "uint256", "name": "refclimed", "type": "uint256"},
                    {"internalType": "uint256", "name": "depositedAmount", "type": "uint256"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "user", "type": "address"}],
                "name": "getUserTree",
                "outputs": [
                    {"internalType": "address", "name": "left", "type": "address"},
                    {"internalType": "address", "name": "right", "type": "address"},
                    {"internalType": "uint256", "name": "binaryPoints", "type": "uint256"},
                    {"internalType": "uint256", "name": "binaryPointCap", "type": "uint256"},
                    {"internalType": "uint256", "name": "depositedAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "lastMonthlyClaim", "type": "uint256"},
                    {"internalType": "uint256", "name": "totalMonthlyRewarded", "type": "uint256"},
                    {"internalType": "uint256", "name": "refclimed", "type": "uint256"}
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
                "inputs": [],
                "name": "getTokenPrice",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getPointValue",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // ERC-20 ABI for token balances
        const ERC20_ABI = [
            {
                "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
        "name": "balanceOf",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "decimals",
                "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}],
        "stateMutability": "view",
        "type": "function"
      }
    ];

        // Contract Configuration
        const CONTRACT_ADDRESS = '0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D';
        const POLYGON_RPC_URL = 'https://polygon-rpc.com';
        
        // Token Addresses on Polygon
        const TOKEN_ADDRESSES = {
            IAM: '0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D', // IAM Token
            MATIC: '0x0000000000000000000000000000000000001010', // Native MATIC
            DAI: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063'  // DAI on Polygon
        };
        
        // Alternative RPC endpoints
        const RPC_ENDPOINTS = [
            'https://polygon-rpc.com',
            'https://rpc-mainnet.maticvigil.com',
            'https://polygon-mainnet.chainstacklabs.com',
            'https://polygon-mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161'
        ];
        
        // Web3 and Contract instances
        let web3;
        let contract;
        let userAccount;

        // Initialize Web3 and Contract
        async function initializeWeb3() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    // Use MetaMask provider for wallet connection
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        
                        // Try to create contract with fallback RPC
                        try {
                            contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                            // Test contract connection
                            await contract.methods.totalSupply().call();
                        } catch (contractError) {
                            // Use direct RPC for contract calls
                            web3 = new Web3(RPC_ENDPOINTS[0]);
                            contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                        }
                        
                        updateWalletStatus(true);
                        return true;
                    }
                }
                updateWalletStatus(false);
                return false;
            } catch (error) {
                updateWalletStatus(false);
                return false;
            }
        }

        // Connect wallet function
        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    updateWalletStatus(true);
                    await fetchContractData();
                } else {
                    alert('MetaMask not detected. Please install MetaMask.');
          }
        } catch (error) {
                alert('Failed to connect wallet. Please try again.');
            }
        }

        // Update wallet status UI
        function updateWalletStatus(connected) {
            const statusElement = document.getElementById('wallet-status');
            const connectBtn = document.getElementById('connect-wallet-btn');
            
            if (connected) {
                statusElement.textContent = `Connected: ${userAccount ? userAccount.slice(0, 6) + '...' + userAccount.slice(-4) : 'Unknown'}`;
                statusElement.className = 'wallet-status connected';
                connectBtn.textContent = 'Connected';
                connectBtn.disabled = true;
            } else {
                statusElement.textContent = 'Not Connected';
                statusElement.className = 'wallet-status';
                connectBtn.textContent = 'Connect Wallet';
                connectBtn.disabled = false;
            }
        }

        // Show/hide balances - removed as balances are always visible now

        // Fetch token balance
        async function getTokenBalance(tokenAddress, userAddress, decimals = 18) {
            try {
                if (tokenAddress === TOKEN_ADDRESSES.MATIC) {
                    // For native MATIC
                    const balance = await web3.eth.getBalance(userAddress);
                    return web3.utils.fromWei(balance, 'ether');
                } else {
                    // For ERC-20 tokens
                    const tokenContract = new web3.eth.Contract(ERC20_ABI, tokenAddress);
                    const balance = await tokenContract.methods.balanceOf(userAddress).call();
                    const tokenDecimals = await tokenContract.methods.decimals().call();
                    return web3.utils.fromWei(balance, 'ether');
                }
            } catch (error) {
                return '0';
            }
        }

        // Fetch real data from contract
        async function fetchContractData() {
            if (!web3 || !userAccount) {
                updateUserBalances();
                return;
            }

            try {
                // Fetch token balances, total points received, and token price
                const [iamBalance, maticBalance, daiBalance, totalPointsReceived, tokenPrice] = await Promise.all([
                    getTokenBalance(TOKEN_ADDRESSES.IAM, userAccount),
                    getTokenBalance(TOKEN_ADDRESSES.MATIC, userAccount),
                    getTokenBalance(TOKEN_ADDRESSES.DAI, userAccount),
                    getTotalPointsReceived(),
                    getTokenPrice()
                ]);

                // Update UI with real data from wallet
                updateTokenBalances(
                    parseFloat(iamBalance),
                    parseFloat(maticBalance),
                    parseFloat(daiBalance)
                );

                // Update stars based on binary points claimed from contract
                updateStarsWithPoints(parseInt(totalPointsReceived));

                // Update price history manager with token price
                if (tokenPrice && window.priceHistoryManager) {
                    window.priceHistoryManager.addTokenPrice(parseFloat(tokenPrice));
                }

            } catch (error) {
                updateUserBalances();
            }
        }

        // Stars System - Based on Binary Points Claimed from User Struct
        // Level 1: 1-9 binaryPointsClaimed (1 star)
        // Level 2: 10-99 binaryPointsClaimed (2 stars) 
        // Level 3: 100-999 binaryPointsClaimed (3 stars)
        // Level 4: 1000-9999 binaryPointsClaimed (4 stars)
        // Level 5: 10000+ binaryPointsClaimed (5 stars)
        function calculateUserLevel(points) {
            if (points >= 10000) return 5;
            if (points >= 1000) return 4;
            if (points >= 100) return 3;
            if (points >= 10) return 2;
            if (points >= 1) return 1;
            return 0;
        }
        
        function updateStarsDisplay(points) {
            const level = calculateUserLevel(points);
            const stars = document.querySelectorAll('.star');
            const pointsDisplay = document.getElementById('user-points');
            const levelDisplay = document.getElementById('user-level');
            
            // Reset all stars
            stars.forEach((star, index) => {
                star.classList.remove('active', 'level-1', 'level-2', 'level-3', 'level-4', 'level-5');
                if (index < level) {
                    star.classList.add('active', `level-${level}`);
                }
            });
            
            // Update displays - only show if points > 0
            if (points > 0) {
                pointsDisplay.textContent = `${points} Points`;
                levelDisplay.textContent = `Level ${level}`;
            } else {
                pointsDisplay.textContent = '-- Points';
                levelDisplay.textContent = 'Level --';
            }
        }
        
        // Initialize with binary points claimed data from contract
        async function initializeStars() {
            if (contract && userAccount) {
                try {
                    const userData = await getUserData();
                    if (userData) {
                        const userPoints = parseInt(userData.binaryPointsClaimed);
                        updateStarsDisplay(userPoints);
                    } else {
                        // Show empty state
                        const pointsDisplay = document.getElementById('user-points');
                        const levelDisplay = document.getElementById('user-level');
                        if (pointsDisplay) pointsDisplay.textContent = '-- Points';
                        if (levelDisplay) levelDisplay.textContent = 'Level --';
                    }
                } catch (error) {
                    // Show empty state instead of 0
                    const pointsDisplay = document.getElementById('user-points');
                    const levelDisplay = document.getElementById('user-level');
                    if (pointsDisplay) pointsDisplay.textContent = '-- Points';
                    if (levelDisplay) levelDisplay.textContent = 'Level --';
                }
            } else {
                // Show empty state instead of 0
                const pointsDisplay = document.getElementById('user-points');
                const levelDisplay = document.getElementById('user-level');
                if (pointsDisplay) pointsDisplay.textContent = '-- Points';
                if (levelDisplay) levelDisplay.textContent = 'Level --';
            }
        }
        
        // Function to update stars from binary points claimed
        async function updateStarsFromClaimedPoints() {
            if (contract && userAccount) {
                try {
                    const userData = await getUserData();
                    if (userData) {
                        const userPoints = parseInt(userData.binaryPointsClaimed);
                        updateStarsDisplay(userPoints);
                    }
                } catch (error) {
                    // Silent fail
                }
            }
        }
        
        // Manual function to update stars with specific points
        function updateStarsWithPoints(points) {
            console.log('‚≠ê updateStarsWithPoints called with:', points);
            updateStarsDisplay(points);
        }
        
        // Balance update functions
        function updateUserBalances() {
            // No default values - only show real data from wallet
            const iamBalanceElement = document.getElementById('iam-balance');
            const maticBalanceElement = document.getElementById('matic-balance');
            const daiBalanceElement = document.getElementById('dai-balance');
            
            if (iamBalanceElement) {
                iamBalanceElement.textContent = '--';
            }
            if (maticBalanceElement) {
                maticBalanceElement.textContent = '--';
            }
            if (daiBalanceElement) {
                daiBalanceElement.textContent = '--';
            }
        }
        
        function updateBalanceWithData(iamBalance, binaryBalance, claimedBalance) {
            const iamBalanceElement = document.getElementById('iam-balance');
            const binaryBalanceElement = document.getElementById('binary-balance');
            const claimedBalanceElement = document.getElementById('claimed-balance');
            
            if (iamBalanceElement) {
                iamBalanceElement.textContent = iamBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
            
            if (binaryBalanceElement) {
                binaryBalanceElement.textContent = binaryBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
            
            if (claimedBalanceElement) {
                claimedBalanceElement.textContent = claimedBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            }
        }

        function updateTokenBalances(iamBalance, maticBalance, daiBalance) {
            console.log('üí∞ updateTokenBalances called with:', { iamBalance, maticBalance, daiBalance });
            
            const iamBalanceElement = document.getElementById('iam-balance');
            const maticBalanceElement = document.getElementById('matic-balance');
            const daiBalanceElement = document.getElementById('dai-balance');
            
            console.log('üí∞ Balance elements found:', {
                iam: !!iamBalanceElement,
                matic: !!maticBalanceElement,
                dai: !!daiBalanceElement
            });
            
            if (iamBalanceElement) {
                iamBalanceElement.textContent = iamBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                console.log('‚úÖ IAM balance updated to:', iamBalanceElement.textContent);
            }
            
            if (maticBalanceElement) {
                maticBalanceElement.textContent = maticBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 4,
                    maximumFractionDigits: 4
                });
                console.log('‚úÖ MATIC balance updated to:', maticBalanceElement.textContent);
            }
            
            if (daiBalanceElement) {
                daiBalanceElement.textContent = daiBalance.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                console.log('‚úÖ DAI balance updated to:', daiBalanceElement.textContent);
            }
        }
        
        // Function to get binary points claimed
        async function getBinaryPointsClaimed() {
            const userData = await getUserData();
            if (userData) {
                return userData.binaryPointsClaimed;
            }
            return 0;
        }

        // Function to get user data from contract
        async function getUserData() {
            if (!contract || !userAccount) {
                return null;
            }

            try {
                const userData = await contract.methods.users(userAccount).call();
    return {
                    index: userData[0],
                    binaryPoints: userData[1],
                    binaryPointCap: userData[2],
                    binaryPointsClaimed: userData[3],
                    totalPurchasedKind: userData[4],
                    upgradeTime: userData[5],
                    lastClaimTime: userData[6],
                    leftPoints: userData[7],
                    rightPoints: userData[8],
                    lastMonthlyClaim: userData[9],
                    totalMonthlyRewarded: userData[10],
                    refclimed: userData[11],
                    depositedAmount: userData[12]
                };
  } catch (error) {
                return null;
            }
        }

        // Function to get token price from contract
        async function getTokenPrice() {
            if (!contract) {
                return null;
            }

            try {
                const tokenPrice = await contract.methods.getTokenPrice().call();
                // Convert from Wei to Ether (18 decimals)
                const priceInEther = parseFloat(tokenPrice) / Math.pow(10, 18);
                return priceInEther;
            } catch (error) {
                return null;
            }
        }

        // Function to get binary points claimed by user
        async function getTotalPointsReceived() {
            const userData = await getUserData();
            if (userData) {
                return userData.binaryPointsClaimed;
            }
            return 0;
        }

        // Function to refresh all wallet data
        async function refreshWalletData() {
            if (contract && userAccount) {
                await fetchContractData();
                await updateStarsFromClaimedPoints();
            }
        }

        // Function to manually update floating token card
        async function updateFloatingTokenCard() {
            if (window.floatingTokenGrowthCard) {
                await window.floatingTokenGrowthCard.updateGrowthData();
            }
        }

        // Make essential functions globally available
        window.updateFloatingTokenCard = updateFloatingTokenCard;
        
        
        // Manual trigger for integration
        window.triggerAssetUpdate = function() {
            console.log('üîÑ Manually triggering asset update...');
            updateAssetsFromConfig();
        };
        
        // Debug function to check contract connection
        window.debugContract = function() {
            console.log('üîç Contract Debug Info:');
            console.log('- window.ethereum:', !!window.ethereum);
            console.log('- selectedAddress:', window.ethereum?.selectedAddress);
            console.log('- web3 available:', typeof web3 !== 'undefined');
            console.log('- contractConfig:', !!window.contractConfig);
            console.log('- contract available:', !!window.contractConfig?.contract);
            console.log('- TOKEN_ADDRESSES:', TOKEN_ADDRESSES);
            
            if (window.contractConfig && window.contractConfig.contract) {
                console.log('‚úÖ Contract is available');
                // Test a simple contract call
                window.contractConfig.contract.methods.totalSupply().call()
                    .then(result => console.log('‚úÖ Contract call successful:', result))
                    .catch(error => console.log('‚ùå Contract call failed:', error));
            } else {
                console.log('‚ùå Contract not available');
            }
        };
        
        
        // Function to get user balance and points from contract
        async function getUserBalanceFromContract() {
            if (!window.ethereum || !window.ethereum.selectedAddress) {
                return { points: 0, balance: 0 };
            }
            
            const userAddress = window.ethereum.selectedAddress;
            
            try {
                // Wait for contract to be available
                let attempts = 0;
                while ((!window.contractConfig || !window.contractConfig.contract) && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    attempts++;
                }
                
                if (window.contractConfig && window.contractConfig.contract) {
                    const contract = window.contractConfig.contract;
                    
                    // Get user data from contract using ethers.js
                    const userData = await contract.users(userAddress);
                    
                    // Extract binary points claimed (index 3) and other relevant data
                    const binaryPointsClaimed = parseInt(userData[3] || 0);
                    const binaryPoints = parseInt(userData[1] || 0);
                    const depositedAmount = parseInt(userData[12] || 0);
                    
                    return {
                        points: binaryPointsClaimed,
                        balance: depositedAmount,
                        binaryPoints: binaryPoints
                    };
                } else {
                    console.log('‚ùå Contract not available after waiting');
                    return { points: 0, balance: 0 };
                }
            } catch (error) {
                console.log('‚ùå Error getting user balance from contract:', error);
                return { points: 0, balance: 0 };
            }
        }
        
        // Function to get token balances from wallet using ethers.js
        async function getWalletTokenBalances() {
            // Check if we have the necessary components
            if (!window.ethereum || !window.ethereum.selectedAddress) {
                return { iam: 0, matic: 0, dai: 0 };
            }
            
            const userAddress = window.ethereum.selectedAddress;
            
            try {
                // Wait for contract config to be available
                let attempts = 0;
                while ((!window.contractConfig || !window.contractConfig.provider) && attempts < 20) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    attempts++;
                }
                
                if (!window.contractConfig || !window.contractConfig.provider) {
                    console.log('‚ùå No provider available after waiting');
                    return { iam: 0, matic: 0, dai: 0 };
                }
                
                const provider = window.contractConfig.provider;
                
                // Get IAM token balance using ethers.js
                let iamBalance = 0;
                try {
                    const iamContract = new ethers.Contract(TOKEN_ADDRESSES.IAM, ERC20_ABI, provider);
                    const balance = await iamContract.balanceOf(userAddress);
                    iamBalance = parseFloat(ethers.formatEther(balance));
                } catch (e) {
                    console.log('‚ùå Error getting IAM balance:', e);
                }
                
                // Get MATIC balance (native token)
                let maticBalance = 0;
                try {
                    const balance = await provider.getBalance(userAddress);
                    maticBalance = parseFloat(ethers.formatEther(balance));
                } catch (e) {
                    console.log('‚ùå Error getting MATIC balance:', e);
                }
                
                // Get DAI balance using ethers.js
                let daiBalance = 0;
                try {
                    const daiContract = new ethers.Contract(TOKEN_ADDRESSES.DAI, ERC20_ABI, provider);
                    const balance = await daiContract.balanceOf(userAddress);
                    daiBalance = parseFloat(ethers.formatEther(balance));
                } catch (e) {
                    console.log('‚ùå Error getting DAI balance:', e);
                }
                
                return { iam: iamBalance, matic: maticBalance, dai: daiBalance };
            } catch (error) {
                console.log('‚ùå Error in getWalletTokenBalances:', error);
                return { iam: 0, matic: 0, dai: 0 };
            }
        }
        
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            setupStarsObserver();
            
            // Setup wallet connection button (hidden)
            const connectBtn = document.getElementById('connect-wallet-btn');
            if (connectBtn) {
                connectBtn.addEventListener('click', connectWallet);
            }
            
            // Always show balances (empty state)
            updateUserBalances();
            await initializeStars();
            
            // Try to connect to contract in background
            const web3Connected = await initializeWeb3();
            if (web3Connected) {
                await fetchContractData();
            } else {
                updateUserBalances();
            }
        });
        
        // Setup observer to watch for changes in claimed points
        function setupStarsObserver() {
            const claimedPointsElement = document.getElementById('claimed-points');
            if (claimedPointsElement) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList' || mutation.type === 'characterData') {
                            updateStarsFromClaimedPoints();
                        }
                    });
                });
                
                observer.observe(claimedPointsElement, {
                    childList: true,
                    characterData: true,
                    subtree: true
                });
            }
        }
        
        
        function copyContractAddress() {
            const contractAddress = '0x2D3923A5ba62B2bec13b9181B1E9AE0ea2C8118D';
            
            // Try to copy to clipboard
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(contractAddress).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopy(contractAddress);
                });
    } else {
                fallbackCopy(contractAddress);
            }
        }
        
        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                showCopyError();
            }
            
            document.body.removeChild(textArea);
        }
        
        function showCopySuccess() {
            const btn = document.querySelector('.copy-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Copied!';
            btn.style.background = 'rgba(0, 255, 136, 0.3)';
            btn.style.borderColor = 'rgba(0, 255, 136, 0.6)';
            
      setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = 'rgba(167, 134, 255, 0.1)';
                btn.style.borderColor = 'rgba(167, 134, 255, 0.3)';
      }, 2000);
        }
        
        function showCopyError() {
            const btn = document.querySelector('.copy-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚ùå Error!';
            btn.style.background = 'rgba(255, 0, 0, 0.3)';
            btn.style.borderColor = 'rgba(255, 0, 0, 0.6)';
  
  setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = 'rgba(167, 134, 255, 0.1)';
                btn.style.borderColor = 'rgba(167, 134, 255, 0.3)';
            }, 2000);
        }
  </script>
  
  <!-- Required libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
  
  <!-- Initialize required globals -->
  <script>
    // Initialize activeIntervals as Map (not Set) for main.js compatibility
    window.activeIntervals = new Map();
  </script>
  
  <!-- Required scripts for floating token card -->
  <script src="js/config.js"></script>
  <script src="js/main.js"></script>
  
  <!-- Price History Manager -->
  <script>
    // Simple Price History Manager for floating token card
    window.priceHistoryManager = {
      tokenHistory: [],
      pointHistory: [],
      
      addTokenPrice: function(price) {
        this.tokenHistory.push({
          price: price,
          timestamp: new Date().toISOString()
        });
        // Keep only last 100 entries
        if (this.tokenHistory.length > 100) {
          this.tokenHistory = this.tokenHistory.slice(-100);
        }
        // Save to localStorage
        localStorage.setItem('tokenPriceHistory', JSON.stringify(this.tokenHistory));
      },
      
      addPointPrice: function(price) {
        this.pointHistory.push({
          price: price,
          timestamp: new Date().toISOString()
        });
        // Keep only last 100 entries
        if (this.pointHistory.length > 100) {
          this.pointHistory = this.pointHistory.slice(-100);
        }
        // Save to localStorage
        localStorage.setItem('pointPriceHistory', JSON.stringify(this.pointHistory));
      },
      
      getHistoryStats: function(type, period) {
        const history = type === 'token' ? this.tokenHistory : this.pointHistory;
        if (history.length === 0) return null;
        
        const now = new Date();
        const periodMs = period === 'day' ? 24 * 60 * 60 * 1000 : 7 * 24 * 60 * 60 * 1000;
        const recentHistory = history.filter(entry => 
          (now - new Date(entry.timestamp)) <= periodMs
        );
        
        if (recentHistory.length === 0) return null;
        
        const prices = recentHistory.map(entry => entry.price);
        const min = Math.min(...prices);
        const max = Math.max(...prices);
        const avg = prices.reduce((a, b) => a + b, 0) / prices.length;
        
        return { min, max, avg, count: recentHistory.length };
      },
      
      clearHistory: function() {
        this.tokenHistory = [];
        this.pointHistory = [];
        localStorage.removeItem('tokenPriceHistory');
        localStorage.removeItem('pointPriceHistory');
      }
    };
    
    // Load existing history from localStorage
    try {
      const savedTokenHistory = localStorage.getItem('tokenPriceHistory');
      if (savedTokenHistory) {
        window.priceHistoryManager.tokenHistory = JSON.parse(savedTokenHistory);
      }
      
      const savedPointHistory = localStorage.getItem('pointPriceHistory');
      if (savedPointHistory) {
        window.priceHistoryManager.pointHistory = JSON.parse(savedPointHistory);
      }
    } catch (e) {
      // Silent fail
    }
  </script>
  
  <!-- Floating Token Growth Card -->
  <script src="js/floating-token-card.js"></script>
  
  <!-- Integration with config.js system -->
  <script>
    // Function to update assets from contract data
    async function updateAssetsFromConfig() {
      // Wait for config.js to be ready
      if (window.contractConfig && window.contractConfig.contract) {
        // Get user data directly from contract
        try {
          const userData = await getUserBalanceFromContract();
          
          // Update stars based on binary points claimed from contract
          if (window.updateStarsWithPoints) {
            window.updateStarsWithPoints(userData.points);
          }
        } catch (e) {
          console.log('‚ùå Error getting user data from contract:', e);
        }
        
        // Get token balances from wallet using contract connection
        if (window.ethereum && window.ethereum.selectedAddress) {
          try {
            const balances = await getWalletTokenBalances();
            if (window.updateTokenBalances) {
              window.updateTokenBalances(balances.iam, balances.matic, balances.dai);
            }
          } catch (e) {
            console.log('‚ùå Error getting wallet balances from contract:', e);
          }
        }
      } else {
        console.log('‚ùå Contract config not available');
      }
    }
    
    // Initialize floating card when page loads
    window.addEventListener('load', function() {
      setTimeout(() => {
        if (window.updateFloatingTokenCard) {
          window.updateFloatingTokenCard();
        }
        
        // Try to get token price and add to history
        if (window.getTokenPrice && window.priceHistoryManager) {
          window.getTokenPrice().then(price => {
            if (price) {
              window.priceHistoryManager.addTokenPrice(price);
              if (window.updateFloatingTokenCard) {
                window.updateFloatingTokenCard();
              }
            }
          }).catch(error => {
            // Silent fail
          });
        }
        
        // Update assets from config.js data
        updateAssetsFromConfig();
      }, 3000); // Wait longer for config.js to complete
    });
    
    // Also try to update when config.js finishes loading
    const checkConfigReady = setInterval(() => {
      if (window.contractConfig && window.contractConfig.contract) {
        updateAssetsFromConfig();
        clearInterval(checkConfigReady);
      }
    }, 1000);
  </script>
</body>
</html>