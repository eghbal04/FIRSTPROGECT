<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>IAMPHOENIX</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=1.1">
    <link rel="stylesheet" href="css/index-custom.css">
    <link rel="stylesheet" href="css/floating-ai-assistant.css">
    <link rel="stylesheet" href="css/smooth-transitions.css">
    <link rel="stylesheet" href="css/mobile-user-popup.css">
    <link rel="stylesheet" href="css/modern-theme.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">

    <!-- Loading ethers.js version 6 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
    <!-- Loading WalletConnect Provider from official CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- Loading WalletConnect Handler -->
    <script src="js/walletconnect-handler.js?v=5.7"></script>
    <script src="js/mobile-navigation.js"></script>
    <script src="js/mobile-optimizer.js"></script>


      <!-- Loading WalletConnect UMD locally -->
  <script src="js/walletconnect-v1.8.0.js"></script>
  
  <!-- Binary Tree Traversal System -->
  <script src="js/binary-tree-traversal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="js/auth-redirect.js"></script>
  <script src="js/modern-theme-variables.js"></script>
  
      <!-- Loading contract base knowledge -->
  <!-- <script src="js/contract-knowledge-base.js"></script> -->
  
      <!-- Loading Floating AI Assistants -->
  <!-- <script src="js/floating-ai-assistant.js"></script> -->
  
  <!-- Immediate AI Assistant Initialization -->
  <!--
  <script>
    // Force immediate initialization
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ DOM Content Loaded - Initializing AI Assistant...');

      setTimeout(() => {
        // Only initialize the advanced assistant
        if (typeof FloatingAIAssistant !== 'undefined') {
          console.log('‚úÖ FloatingAIAssistant class found');

          if (!window.floatingAI) {
            console.log('üîÑ Creating new FloatingAIAssistant instance...');
            window.floatingAI = new FloatingAIAssistant();
          }
          
          if (window.floatingAI) {
            console.log('‚úÖ FloatingAI instance ready');
            window.floatingAI.switchToIdleState();
          }
        } else {
          console.error('‚ùå FloatingAIAssistant class not found');
        }
      }, 1000);
    });
  </script>
  -->
  
  <!-- Test script for floating AI -->

</head>
<body>





  
  
  <div id="main-dashboard" class="page-section" style="position:relative;overflow:visible;">

    <div class="dashboard-cards" style="display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;max-width:1400px;margin:0 auto;">
      <!-- AI Assistant will be inserted here by JavaScript -->

      <!-- Blockchain Information Cards -->
      <div class="modern-card dashboard-card" style="min-width:100%;max-width:100%;margin:1rem 0;width:100%;padding:1.5rem;position:relative;overflow:hidden;">
        <div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#00ff88,#a786ff,#00ff88);animation:shimmer 2s linear infinite;"></div>
        
        <div style="text-align:center;margin-bottom:1.5rem;">
          <h3 style="color:#00ff88;font-size:1.2rem;font-weight:bold;margin:0;font-family:monospace;">IAMPHOENIX</h3>
        </div>
        

        
        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;">
          <!-- 1. Total Supply - First Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">üí∞</div>
                          <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Total Supply</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="circulating-supply" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM Tokens</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="circulating-supply-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">‚âà DAI</div>
          </div>
          
          <!-- 2. IAM Binary Pool - Second Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(255,193,7,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#ffc107;font-size:1.2rem;margin-bottom:0.3rem;">üè¶</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Binary Pool</div>
            <div style="color:#ffc107;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="contract-token-balance" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM in Binary Pool</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="contract-token-balance-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">‚âà DAI</div>
          </div>
          
          <!-- 3. DAI Baking Pool - Third Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,123,255,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#007bff;font-size:1.2rem;margin-bottom:0.3rem;">üíµ</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Baking Pool</div>
            <div style="color:#007bff;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-dai-balance" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">DAI in Baking Pool</div>
          </div>
          
          <!-- 4. Token Price - Fourth Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">üí≤</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">IAM Token Price</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-token-price" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">DAI per IAM</div>
          </div>
          
          <!-- 5. Registration Price - Fifth Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(138,43,226,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#8a2be2;font-size:1.2rem;margin-bottom:0.3rem;">üé´</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Registration Price</div>
            <div style="color:#8a2be2;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-registration-price" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM per Registration</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-registration-price-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">‚âà DAI</div>
          </div>
          
          <!-- Other Cards -->
          
          <!-- Total Points Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(167,134,255,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#a786ff;font-size:1.2rem;margin-bottom:0.3rem;">üéØ</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Total Points</div>
            <div style="color:#a786ff;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="total-points" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Binary Points</div>
          </div>
          
          <!-- Point Value Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">üíé</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Point Value</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-point-value" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM per Point</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-point-value-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">‚âà DAI</div>
          </div>
          
          <!-- Help Fund Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(220,53,69,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#dc3545;font-size:1.2rem;margin-bottom:0.3rem;">üíù</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Help Fund</div>
            <div style="color:#dc3545;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-cashback-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Cashback Pool</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-cashback-value-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">‚âà DAI</div>
          </div>
          
          <!-- Wallet Count Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(255,165,0,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#ffa500;font-size:1.2rem;margin-bottom:0.3rem;">üëõ</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Wallet Count</div>
            <div style="color:#ffa500;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-wallets-count" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Connected Wallets</div>
          </div>
          
          <!-- Network Status Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(40,167,69,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#28a745;font-size:1.2rem;margin-bottom:0.3rem;">üåê</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Network Status</div>
            <div style="color:#28a745;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="network-status">Polygon</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Active</div>
          </div>
        </div>
        
        <!-- Last Update Info -->
        <div style="text-align:center;margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.1);">
          <div style="color:#888;font-size:0.8rem;font-family:monospace;margin-bottom:0.5rem;">
            Last Update: <span id="blockchain-last-update">-</span>
          </div>
          <!-- Update button removed -->
        </div>
        

      </div>

      <!-- Popular Indexes Expandable Box -->
      <div id="popular-indexes-section" class="modern-card" style="margin-top: 2rem; padding: 1.5rem; border: 2px solid rgba(0,255,136,0.3); border-radius: 15px; background: linear-gradient(135deg, rgba(26,31,46,0.9), rgba(42,47,62,0.9));">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h3 style="color: #00ff88; font-size: 1.3rem; font-weight: bold; margin: 0; margin-bottom: 0.5rem;">üåü Most Popular Indexes</h3>
          <p style="color: #ccc; font-size: 0.9rem; margin: 0;">List of most popular network users based on positive votes</p>
        </div>
        
        <!-- Expandable Content -->
        <div id="popular-indexes-content" style="display: none;">
          <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
            <!-- Popular Indexes List -->
            <div style="flex: 1; min-width: 300px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1rem; border: 1px solid rgba(0,255,136,0.2);">
              <div style="text-align: center; margin-bottom: 1rem;">
                <h4 style="color: #00ff88; font-size: 1.1rem; font-weight: bold; margin: 0;">üèÜ Most Popular Rankings</h4>
              </div>
              <div id="popular-indexes-list" style="max-height: 300px; overflow-y: auto;">
                <div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">
                  Loading most popular indexes...
                </div>
              </div>
            </div>
            
            <!-- Voting Section -->
            <div style="flex: 1; min-width: 300px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1rem; border: 1px solid rgba(167,134,255,0.2);">
              <div style="text-align: center; margin-bottom: 1rem;">
                <h4 style="color: #a786ff; font-size: 1.1rem; font-weight: bold; margin: 0;">üó≥Ô∏è Voting</h4>
              </div>
              
              <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                  <label style="color: #ccc; font-size: 0.9rem; font-weight: bold;">Target Index:</label>
                  <input type="number" id="popular-vote-index" placeholder="Enter index number" 
                         style="background: rgba(0,0,0,0.3); border: 1px solid rgba(167,134,255,0.3); border-radius: 8px; padding: 0.8rem; color: #fff; text-align: center; font-size: 0.9rem; font-family: monospace;">
                </div>
                
                <div style="display: flex; gap: 0.5rem; justify-content: center;">
                  <button onclick="voteForPopularIndex(true)" 
                          style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.8rem 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
                    üëç Like
                  </button>
                  <button onclick="voteForPopularIndex(false)" 
                          style="background: linear-gradient(135deg,#ff4444,#cc3333); color: #fff; border: none; border-radius: 8px; padding: 0.8rem 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
                    üëé Dislike
                  </button>
                </div>
                
                <div id="popular-vote-result" style="text-align: center; padding: 0.5rem; border-radius: 8px; font-size: 0.9rem; min-height: 1.5em;"></div>
              </div>
            </div>
          </div>
          
          <!-- Refresh Button -->
          <div style="text-align: center;">
            <button onclick="refreshPopularIndexes()" 
                    style="background: linear-gradient(135deg,#a786ff,#8a6fff); color: #fff; border: none; border-radius: 8px; padding: 0.8rem 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;">
              üîÑ Refresh List
            </button>
          </div>
        </div>
        
        <!-- Toggle Button -->
        <div style="text-align: center;">
          <button onclick="togglePopularIndexes()" id="popular-indexes-toggle" 
                  style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.8rem 2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 1rem;">
            üìä Show Most Popular
          </button>
        </div>
      </div>

      <!-- Voting System Section (Hidden by default) -->
      <div id="voting-system-section" class="modern-card" style="margin-top: 2rem; padding: 1.5rem; display: none;">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h3 style="color: #00ff88; font-size: 1.3rem; font-weight: bold; margin: 0; margin-bottom: 0.5rem;">üó≥Ô∏è Voting System</h3>
          <p style="color: #ccc; font-size: 0.9rem; margin: 0;">Vote for other users in the network (self-voting not allowed)</p>
        </div>
        
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; align-items: center; margin-bottom: 1rem;">
          <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
            <div style="color: #00ff88; font-size: 0.9rem; font-weight: bold;">Vote for Index:</div>
            <input type="number" id="vote-index-input-main" placeholder="Enter index" 
                   style="background: rgba(0,0,0,0.3); border: 1px solid rgba(0,255,136,0.3); border-radius: 8px; padding: 0.5rem; color: #fff; text-align: center; width: 120px; font-size: 0.9rem; font-family: monospace;">
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.3rem;">
            <button onclick="voteForIndexMain(true)" 
                    style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;">
              üëç Like
            </button>
            <button onclick="voteForIndexMain(false)" 
                    style="background: linear-gradient(135deg,#ff4444,#cc3333); color: #fff; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;">
              üëé Dislike
            </button>
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.3rem;">
            <button onclick="voteForSelfMain(true)" 
                    style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;" disabled>
              üëç Vote Self (Disabled)
            </button>
            <button onclick="voteForSelfMain(false)" 
                    style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;" disabled>
              üëé Dislike Self (Disabled)
            </button>
          </div>
        </div>
        
        <div id="vote-result-main" style="text-align: center; margin-top: 1rem; padding: 0.5rem; border-radius: 8px; font-size: 0.9rem; min-height: 1.5em;"></div>
        
        <div style="text-align: center; margin-top: 1rem;">
          <div style="color: #ccc; font-size: 0.8rem; margin-bottom: 0.5rem;">Your Vote Status:</div>
          <div id="user-vote-status-main" style="color: #00ff88; font-size: 0.9rem; font-weight: bold;">Not voted yet</div>
        </div>
      </div>

      <!-- Voting Popup Modal -->
      <div id="voting-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; backdrop-filter: blur(5px);">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #1a1f2e, #2a2f3e); border: 2px solid #00ff88; border-radius: 15px; padding: 1.5rem; min-width: 350px; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,255,136,0.3);">
          <div style="text-align: center; margin-bottom: 1rem;">
            <h3 style="color: #00ff88; font-size: 1.2rem; font-weight: bold; margin: 0; margin-bottom: 0.5rem;">üó≥Ô∏è Quick Vote</h3>
            <p style="color: #ccc; font-size: 0.8rem; margin: 0;">Vote for any user (self-voting not allowed)</p>
          </div>
          
          <!-- Top 10 Most Liked Users Section -->
          <div style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; border: 1px solid rgba(0,255,136,0.2);">
            <div style="text-align: center; margin-bottom: 1rem;">
              <h4 style="color: #00ff88; font-size: 1rem; font-weight: bold; margin: 0; margin-bottom: 0.3rem;">üèÜ Top 10 Users with Likes</h4>
              <p style="color: #ccc; font-size: 0.7rem; margin: 0;">Users with at least 1 like - click on any user</p>
            </div>
            
            <div id="top-users-popup-list" style="max-height: 200px; overflow-y: auto;">
              <div style="text-align: center; color: #ccc; font-size: 0.8rem; padding: 1rem;">
                üîÑ Loading top users...
              </div>
            </div>
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.8rem; margin-bottom: 1rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <span style="color: #00ff88; font-size: 0.9rem; font-weight: bold; min-width: 80px;">Index:</span>
              <input type="number" id="vote-index-popup" placeholder="Enter index" 
                     style="background: rgba(0,0,0,0.3); border: 1px solid rgba(0,255,136,0.3); border-radius: 8px; padding: 0.5rem; color: #fff; text-align: center; flex: 1; font-size: 0.9rem; font-family: monospace;">
            </div>
            
            <div style="display: flex; gap: 0.5rem; justify-content: center;">
              <button onclick="voteForIndexPopup(true)" 
                      style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
                üëç Like
              </button>
              <button onclick="voteForIndexPopup(false)" 
                      style="background: linear-gradient(135deg,#ff4444,#cc3333); color: #fff; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
                üëé Dislike
              </button>
            </div>
            
            <div style="display: flex; gap: 0.5rem; justify-content: center;">
              <button onclick="voteForSelfPopup(true)" 
                      style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;" disabled>
                üëç Vote Self (Disabled)
              </button>
              <button onclick="voteForSelfPopup(false)" 
                      style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;" disabled>
                üëé Dislike Self (Disabled)
              </button>
            </div>
          </div>
          
          <div id="vote-result-popup" style="text-align: center; margin-bottom: 1rem; padding: 0.5rem; border-radius: 8px; font-size: 0.9rem; min-height: 1.5em;"></div>
          
          <div style="text-align: center; display: flex; gap: 0.5rem; justify-content: center;">
            <button onclick="testTopUsersLoading()" 
                    style="background: linear-gradient(135deg,#007bff,#0056b3); color: #fff; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.8rem;">
              üß™ Test
            </button>
            <button onclick="closeVotingPopup()" 
                    style="background: linear-gradient(135deg,#666,#444); color: #fff; border: none; border-radius: 8px; padding: 0.5rem 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;">
              ‚úï Close
            </button>
          </div>
        </div>
      </div>





      <script>
      document.addEventListener('DOMContentLoaded', function() {
        
        // Swap rules popup removed
        
        // (swap pre-modal removed)
        // Show welcome popup
        function showWelcomeModal() {
          console.log('üîÑ showWelcomeModal called');
          const modal = document.getElementById('welcome-modal');
          const closeBtn = document.getElementById('welcome-modal-close');
          const understandBtn = document.getElementById('welcome-understand-btn');
          console.log('Modal element found:', !!modal);
          
          // Always show the welcome modal on each visit
          
          // Show modal after 1.5 seconds
          console.log('‚è±Ô∏è Setting timeout for modal display');
          setTimeout(() => {
            console.log('‚ö° Timeout reached, showing modal');
            if (modal) {
              modal.style.display = 'flex';
              document.body.style.overflow = 'hidden';
              console.log('‚úÖ Modal display set to flex');
              startWelcomeTypewriter();
            } else {
              console.error('‚ùå Modal element not found!');
            }
          }, 1500);
          
          function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = '';
            // Do not persist seen flag; always show on next visit
          }
          
          // Function to close popup
          window.closeWelcomeModal = function() {
                          // Stop timer
            if (readingTimerInterval) {
              clearInterval(readingTimerInterval);
            }
            const modal = document.getElementById('welcome-modal');
            if (modal) {
              modal.style.display = 'none';
              document.body.style.overflow = '';
            }
          };
          
          if (closeBtn) closeBtn.onclick = function() {
            // Check if checkboxes exist and if all are checked
            const acceptButton = document.getElementById('acceptButton');
            if (acceptButton && acceptButton.disabled) {
              // If accept button is disabled, don't allow closing
              return;
            }
            closeModal();
          };
          if (understandBtn) understandBtn.onclick = closeModal;
          
          // Close by clicking on background (only if conditions are not accepted)
          modal.onclick = function(e) {
            if (e.target === modal) {
              // Check if checkboxes exist and if all are checked
              const acceptButton = document.getElementById('acceptButton');
              if (acceptButton && acceptButton.disabled) {
                // If accept button is disabled, don't allow closing
                return;
              }
              closeModal();
            }
          };
        }

        // Check the number of popup displays in cache
        function shouldShowWelcomeModal() {
          const showCount = localStorage.getItem('welcomeModalShowCount') || 0;
          return showCount < 3;
        }

        // Increment popup display counter
        function incrementShowCount() {
          const currentCount = parseInt(localStorage.getItem('welcomeModalShowCount') || 0);
          localStorage.setItem('welcomeModalShowCount', currentCount + 1);
        }

        // Reading timer
        let readingTimerInterval;
        let readingSeconds = 0;
        
        function startReadingTimer() {
          readingSeconds = 0;
          readingTimerInterval = setInterval(() => {
            readingSeconds++;
            const minutes = Math.floor(readingSeconds / 60);
            const seconds = readingSeconds % 60;
            const timerDisplay = document.getElementById('readingTimer');
            if (timerDisplay) {
              timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // After 30 seconds of reading, enable checkboxes
            if (readingSeconds >= 30) {
              enableCheckboxes();
              clearInterval(readingTimerInterval);
            }
          }, 1000);
        }
        
        // Enable checkboxes after reading
        function enableCheckboxes() {
          const condition1 = document.getElementById('condition1');
          const condition2 = document.getElementById('condition2');
          const condition3 = document.getElementById('condition3');
          const acceptButton = document.getElementById('acceptButton');
          
          if (condition1 && condition2 && condition3 && acceptButton) {
            // Enable checkboxes
            condition1.disabled = false;
            condition2.disabled = false;
            condition3.disabled = false;
            
            // Change checkbox text
            const spans = document.querySelectorAll('#welcome-typewriter-content label span');
            if (spans.length >= 3) {
              spans[0].textContent = '‚úÖ I have read and accept the acceptance conditions';
              spans[0].style.opacity = '1';
              spans[1].textContent = 'üéì I want to learn this market';
              spans[1].style.opacity = '1';
              spans[2].textContent = 'üìö I am familiar with cryptocurrency rules and regulations';
              spans[2].style.opacity = '1';
            }
            
            // Change button text
            acceptButton.textContent = 'üîì Enter Platform';
            acceptButton.style.background = 'linear-gradient(135deg,#00ff88,#00cc6a)';
            acceptButton.style.color = '#000';
            acceptButton.style.cursor = 'pointer';
            
            // Change timer text
            const timerText = document.querySelector('#welcome-typewriter-content p strong');
            if (timerText) {
              timerText.textContent = '‚úÖ Reading completed!';
            }
          }
        }
        
        // Typewriter popup for terms and conditions
        function startWelcomeTypewriter() {
          const container = document.getElementById('welcome-typewriter-content');
          if (!container) {
            console.error('Container not found');
            return;
          }
          
          console.log('Starting typewriter...');
          
          // Start reading timer from the beginning of typewriter
          if (typeof startReadingTimer === 'function') {
            startReadingTimer();
          }
          
          const welcomeText = `<div style="background:rgba(255,193,7,0.08);padding:1.2em 1.4em;border-radius:12px;border-right:4px solid #ffc107;margin-bottom:1.2em;">
  <p style="margin:0;color:#e0e6f7;font-weight:500;">
    ‚ö†Ô∏è <strong>Important Notice:</strong> Before entering the platform, please read and accept the following terms and conditions.
  </p>
</div>

<h3 style="color:#a786ff;font-size:1.25em;margin:0 0 0.8em 0;">Acceptance Conditions</h3>
<div style="background:rgba(0,255,136,0.05);padding:1em;border-radius:8px;border-right:3px solid #00ff88;margin-bottom:1em;">
  <p style="margin:0;color:#e0e6f7;line-height:1.6;">
    <strong>‚úÖ I accept the following conditions:</strong><br>
    ‚Ä¢ Investing in cryptocurrencies involves risk<br>
    ‚Ä¢ All transactions are irreversible and transparent<br>
    ‚Ä¢ I am responsible for my financial decisions<br>
    ‚Ä¢ I will comply with local laws and regulations
  </p>
</div>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Desire to Learn</h3>
<div style="background:rgba(138,43,226,0.05);padding:1em;border-radius:8px;border-right:3px solid #8a2be2;margin-bottom:1em;">
  <p style="margin:0;color:#e0e6f7;line-height:1.6;">
    <strong>üéì I want to learn this market:</strong><br>
    ‚Ä¢ Continuous study in the field of cryptocurrencies<br>
    ‚Ä¢ Familiarity with blockchain concepts and smart contracts<br>
    ‚Ä¢ Learning risk management and capital management<br>
    
  </p>
</div>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Familiarity with Cryptocurrency Rules</h3>
<div style="background:rgba(255,69,0,0.05);padding:1em;border-radius:8px;border-right:3px solid #ff4500;margin-bottom:1em;">
  <p style="margin:0;color:#e0e6f7;line-height:1.6;">
    <strong>üìö I am familiar with cryptocurrency rules and regulations:</strong><br>
    ‚Ä¢ How digital wallets work<br>
    ‚Ä¢ Security principles and protection of private keys<br>
    ‚Ä¢ Familiarity with different networks (Ethereum, Polygon)<br>
    ‚Ä¢ Understanding Gas concepts and transaction confirmation
  </p>
</div>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Smart Contract Specifications</h3>
<p style="margin-top:0;">
  <strong>Contract Address:</strong> 0xA3d5445e3e57dDA57C69184e88A93C9f6f7f9aA6<br>
  <strong>Network:</strong> Polygon (MATIC)<br>
  <strong>Standard:</strong> ERC-20<br>
  <strong>Token Name:</strong> IAM Token<br>
  <strong>Symbol:</strong> IAM<br>
  <strong>Decimals:</strong> 18
</p>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Main Contract Functions</h3>
<ul style="list-style:none;padding:0;margin:0;">
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>register()</strong> - Register new user
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>transfer()</strong> - Transfer tokens between wallets
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>getTokenPrice()</strong> - Get current token price
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>getPointValue()</strong> - Get value of each point
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>buyTokens()</strong> - Buy tokens with DAI
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">üîπ</span>
    <strong>sellTokens()</strong> - Sell tokens and receive DAI
  </li>
</ul>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Data Structure</h3>
<p style="margin-top:0;">
  <strong>User Struct:</strong><br>
  - address: User wallet address<br>
  - uint256 index: User index number<br>
  - bool activated: Activation status<br>
  - uint256 registrationTime: Registration time<br>
  - address referrer: User referrer<br>
  - uint256 totalPoints: Total points earned
</p>

<h3 style="color:#a786ff;font-size:1.25em;margin:1.1em 0 0.6em 0;">Important Variables</h3>
<ul style="list-style:none;padding:0;margin:0;">
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">‚úÖ</span>
    <strong>totalSupply:</strong> Total IAM token supply
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">‚úÖ</span>
    <strong>registrationPrice:</strong> Registration price (in IAM)
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">‚úÖ</span>
    <strong>tokenPrice:</strong> Current token price (in DAI)
  </li>
  <li style="margin-bottom:0.65em;padding-right:1.5em;position:relative;">
    <span style="position:absolute;right:0;color:#00ff88;">‚úÖ</span>
                    <strong>pointValue:</strong> Value of each point (in IAM)
  </li>
</ul>

<div style="margin-top:1.2em;background:rgba(167,134,255,0.08);padding:1em;border-radius:10px;border-right:4px solid #a786ff;">
  <p style="margin:0;">All transactions are traceable on <strong>PolygonScan</strong> and the contract code is <strong>open and verifiable</strong>.</p>
</div>`;
          
          let i = 0;
          const speed = 15; // Typewriter speed (milliseconds)
          
          function typeWriter() {
            if (i < welcomeText.length) {
              let char = welcomeText.charAt(i);
              
              // If character is <, add the entire HTML tag at once
              if (char === '<') {
                let tagEnd = welcomeText.indexOf('>', i);
                if (tagEnd !== -1) {
                  container.innerHTML += welcomeText.substring(i, tagEnd + 1);
                  i = tagEnd + 1;
                  // auto-scroll as content grows
                  container.scrollTop = container.scrollHeight;
                  setTimeout(typeWriter, 5); // Tags should be added quickly
                  return;
                }
              }
              
              container.innerHTML += char;
              i++;
              // auto-scroll as content grows
              container.scrollTop = container.scrollHeight;
              const delay = (char === '.' || char === '!' || char === '?' || char === ',') ? speed * 3 : speed;
              setTimeout(typeWriter, delay);
            } else {
              // Typewriter finished, now show checkboxes
              if (typeof showCheckboxes === 'function') {
                showCheckboxes();
              }
            }
          }
          
          typeWriter();
        }
        
        // Test function for typewriter
        function testTypewriter() {
          console.log('Testing typewriter...');
          const container = document.getElementById('welcome-typewriter-content');
          if (container) {
            container.innerHTML = 'Testing typewriter...';
            setTimeout(() => {
              startWelcomeTypewriter();
            }, 1000);
          }
        }

        // Display condition checkboxes
        function showCheckboxes() {
          const container = document.getElementById('welcome-typewriter-content');
          if (!container) return;

          const checkboxesHTML = `
            <div style="margin-top:2em;background:rgba(255,193,7,0.1);padding:1.5em;border-radius:12px;border:2px solid #ffc107;">
              <h3 style="color:#ffc107;margin-bottom:1em;text-align:center;">‚úÖ Confirm Terms and Conditions</h3>
              
              <div style="margin-bottom:1em;">
                <label style="display:flex;align-items:center;cursor:pointer;color:#e0e6f7;">
                  <input type="checkbox" id="condition1" style="margin-left:0.5em;transform:scale(1.2);" onchange="checkAllConditions()" disabled>
                  <span style="opacity:0.6;">‚è≥ I have read and accept the acceptance conditions</span>
                </label>
              </div>
              
              <div style="margin-bottom:1em;">
                <label style="display:flex;align-items:center;cursor:pointer;color:#e0e6f7;">
                  <input type="checkbox" id="condition2" style="margin-left:0.5em;transform:scale(1.2);" onchange="checkAllConditions()" disabled>
                  <span style="opacity:0.6;">‚è≥ I want to learn this market</span>
                </label>
              </div>
              
              <div style="margin-bottom:1em;">
                <label style="display:flex;align-items:center;cursor:pointer;color:#e0e6f7;">
                  <input type="checkbox" id="condition3" style="margin-left:0.5em;transform:scale(1.2);" onchange="checkAllConditions()" disabled>
                  <span style="opacity:0.6;">‚è≥ I am familiar with cryptocurrency rules and regulations</span>
                </label>
              </div>
              
              <div style="text-align:center;margin-top:1.5em;">
                <button id="acceptButton" onclick="acceptConditions()" style="background:linear-gradient(135deg,#666,#444);color:#999;border:none;padding:0.8em 2em;border-radius:8px;font-weight:bold;cursor:not-allowed;opacity:0.5;pointer-events:none;" disabled>
                  ‚è≥ Please read the terms first
                </button>
              </div>
            </div>
          `;
          
          container.innerHTML += checkboxesHTML;
          container.scrollTop = container.scrollHeight;
        }

        // Reading timer
        // Removed duplicate
        
        function startReadingTimer() {
          readingSeconds = 0;
          readingTimerInterval = setInterval(() => {
            readingSeconds++;
            const minutes = Math.floor(readingSeconds / 60);
            const seconds = readingSeconds % 60;
            const timerDisplay = document.getElementById('readingTimer');
            if (timerDisplay) {
              timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // After 30 seconds of reading, enable checkboxes
            if (readingSeconds >= 30) {
              enableCheckboxes();
              clearInterval(readingTimerInterval);
            }
          }, 1000);
        }
        
        // Enable checkboxes after reading
        function enableCheckboxes() {
          const condition1 = document.getElementById('condition1');
          const condition2 = document.getElementById('condition2');
          const condition3 = document.getElementById('condition3');
          const acceptButton = document.getElementById('acceptButton');
          
          if (condition1 && condition2 && condition3 && acceptButton) {
            // Enable checkboxes
            condition1.disabled = false;
            condition2.disabled = false;
            condition3.disabled = false;
            
            // Change checkbox text
            const spans = document.querySelectorAll('#welcome-typewriter-content label span');
            if (spans.length >= 3) {
              spans[0].textContent = '‚úÖ I have read and accept the acceptance conditions';
              spans[0].style.opacity = '1';
              spans[1].textContent = 'üéì I want to learn this market';
              spans[1].style.opacity = '1';
              spans[2].textContent = 'üìö I am familiar with cryptocurrency rules and regulations';
              spans[2].style.opacity = '1';
            }
            
            // Change button text
            acceptButton.textContent = 'üîì Enter Platform';
            acceptButton.style.background = 'linear-gradient(135deg,#00ff88,#00cc6a)';
            acceptButton.style.color = '#000';
            acceptButton.style.cursor = 'pointer';
            
            // Change timer text
            const timerText = document.querySelector('#welcome-typewriter-content p strong');
            if (timerText) {
              timerText.textContent = '‚úÖ Reading completed!';
            }
          }
        }
        
        // Check status of all checkboxes
        function checkAllConditions() {
          const condition1 = document.getElementById('condition1');
          const condition2 = document.getElementById('condition2');
          const condition3 = document.getElementById('condition3');
          const acceptButton = document.getElementById('acceptButton');
          
          if (condition1 && condition2 && condition3 && acceptButton) {
            if (condition1.checked && condition2.checked && condition3.checked) {
              acceptButton.style.opacity = '1';
              acceptButton.style.pointerEvents = 'auto';
              acceptButton.disabled = false;
            } else {
              acceptButton.style.opacity = '0.5';
              acceptButton.style.pointerEvents = 'none';
              acceptButton.disabled = true;
            }
          }
        }

        // Accept terms and enter platform
        function acceptConditions() {
          // Stop timer
          if (readingTimerInterval) {
            clearInterval(readingTimerInterval);
          }
          incrementShowCount();
          closeWelcomeModal();
        }
        
        
        const text = `The IAM Continuous Profit Academy is an innovative, people-centric ecosystem established to provide fully decentralized and transparent financial, educational, and trading services. In this collection, your capital always remains under your control, whether in your personal exchange account, with a broker, or in a smart wallet connected to a decentralized contract.

Our Services:
‚Ä¢ Providing specialized signals and auto-trading robots for financial markets
‚Ä¢ Opportunity to act as an agent for individuals and IBs in brokerages
‚Ä¢ Network marketing opportunities for friends who want to promote this collection
‚Ä¢ You can benefit from Referral Shares.
‚Ä¢ You can also achieve guaranteed profit by investing in the IAM fund and its incremental token.
‚Ä¢ Comprehensive Forex and Cryptocurrency training
‚Ä¢ Support for the decentralized IAM fund and IAM token
‚Ä¢ Copy-trading services: If the IAM robot profits, you profit, and if it incurs a loss, you also incur a loss; no profit is withdrawn from your account during a loss, and IAM receives no share until the loss is recovered.
‚Ä¢ Our motto: Your capital in your own account, your profit with us.`;
        const container = document.getElementById('IAM-typewriter');
        if (container) {
          let i = 0;
          const speed = 40; // ms per character (slower)
          function typeWriter() {
            if (i < text.length) {
              const char = text.charAt(i);
              if (char === '\\n' || char === '\n') {
                container.innerHTML += '<br>';
                i++;
                setTimeout(typeWriter, 350);
              } else {
                container.innerHTML += char;
                i++;
                setTimeout(typeWriter, speed);
              }
            }
          }
          typeWriter();
        }

        // Expand/collapse logic
        const wrapper = document.getElementById('IAM-typewriter-wrapper');
        const fade = document.getElementById('IAM-fade');
        const btn = document.getElementById('IAM-expand-btn');
        if (wrapper && fade && btn) {
          let expanded = false;
          btn.addEventListener('click', function() {
            expanded = !expanded;
            if (expanded) {
              wrapper.style.maxHeight = '2000px';
              fade.style.opacity = '0';
              btn.textContent = 'Show Less';
            } else {
              wrapper.style.maxHeight = '2.1em';
              fade.style.opacity = '1';
              btn.textContent = 'Show More';
            }
          });
        }
      });
      </script>

  <!-- Swap Section -->
  <div id="main-swap" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    
    <div id="swap-main-content" style="display:block;">
    <div class="expand-header" style="padding:0 1.5rem;">
      <h2 style="margin:0 0 0.5rem 0;">üîÑ Currency Exchange</h2>
      <p style="margin:0 0 0.5rem 0;">Exchange between DAI and IAM tokens</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="swap-container" style="max-width:600px;margin:0 auto;padding:1.5rem;">
        
        <!-- Swap Rules and Information -->
        <div class="swap-rules" style="background:linear-gradient(135deg,#232946,#181c2a);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;border:2px solid #00ff88;">
          <h3 style="color:#00ff88;margin-bottom:1rem;font-size:1.2rem;">üìã Exchange Rules and Guide</h3>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#00ff88;margin-bottom:0.5rem;">üîÑ How to Exchange:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>‚úÖ <strong style="color:#00ff88;">DAI ‚Üí IAM:</strong> Buy IAM tokens with DAI (variable rate)</li>
              <li>‚úÖ <strong style="color:#00ff88;">IAM ‚Üí DAI:</strong> Sell IAM tokens and receive DAI</li>
              <li>‚úÖ Exchange fee: Dynamic (2%, 2.5%, or 3% based on contract DAI balance)</li>
              <li>‚úÖ Minimum exchange amount: More than 1 DAI or more than 1 IAM</li>
            </ul>
          </div>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#00ff88;margin-bottom:0.5rem;">üí∞ Exchange Benefits:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li><strong style="color:#00ff88;">IAM:</strong> Main platform token - for investment and earning</li>
              <li><strong style="color:#00ccff;">DAI:</strong> Stable token - for value preservation and daily transactions</li>
              <li>üîÑ Instant exchange without additional approval</li>
              <li>üìä Exchange rate calculated based on supply and demand</li>
            </ul>
          </div>
          
          <div>
            <h4 style="color:#00ff88;margin-bottom:0.5rem;">‚ö†Ô∏è Important Notes:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>üîç Check current rate before exchange</li>
              <li>üí∞ Have sufficient balance for exchange + fees</li>
              <li>‚è±Ô∏è Exchanges are processed instantly</li>
              <li>üìû Contact support if you encounter issues</li>
            </ul>
          </div>
        </div>
        <!-- Blockchain Information Dashboard (added to prevent not found errors) -->

        <form id="swapForm" class="swap-form">
          <!-- Left Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="swap-row">
            <label for="swapDirection">Exchange Type:</label>
            <select id="swapDirection" required>
              <option value="dai-to-IAM">DAI ‚Üí IAM</option>
              <option value="IAM-to-dai">IAM ‚Üí DAI</option>
            </select>
            <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Select your desired exchange type</small>
          </div>
          
          <div class="swap-row">
            <label for="swapAmount">Amount:</label>
            <div class="amount-input-group">
              <input type="number" id="swapAmount" placeholder="Enter amount" min="0" step="any" required>
              <button type="button" id="maxBtn" class="max-btn">Maximum</button>
            </div>
            <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter the amount you want to exchange</small>
            </div>
          </div>
          
          <!-- Right Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="swap-row" id="swap-usd-converter-row" style="display:none;">
            <label for="swapUsdAmount">üí∞ Dollar Equivalent:</label>
            <div class="usd-converter-container" style="display:flex;gap:0.5rem;align-items:center;">
              <span style="color:#00ff88;font-weight:bold;">$</span>
              <input type="number" id="swapUsdAmount" placeholder="5.00" min="0" step="0.01" style="flex:1;">
              <button type="button" id="swapUsdToTokenBtn" style="
                background: linear-gradient(90deg,#00ff88,#a786ff);
                color: #181c2a;
                border: none;
                border-radius: 6px;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
              ">üîÑ Convert</button>
            </div>
            <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter dollar amount to convert to tokens (e.g., 5 for $5)</small>
          </div>
        
        <!-- Balance Check -->
            <div style="background:rgba(0,255,136,0.1);border-radius:8px;padding:0.8rem;">
              <h4 style="color:#00ff88;margin-bottom:0.6rem;font-size:0.9rem;">üí∞ Your Current Balance:</h4>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.8rem;">
            <div style="text-align:center;">
                  <div style="color:#00ff88;font-weight:bold;font-size:0.9rem;">DAI</div>
                  <div id="daiBalance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
            </div>
            <div style="text-align:center;">
                  <div style="color:#00ccff;font-weight:bold;font-size:0.9rem;">IAM</div>
                  <div id="IAMBalance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
                  <div id="IAMUsdValue" style="color:#a786ff;font-size:0.75rem;margin-top:2px;">-</div>
            </div>
          </div>
            </div>
            
            <!-- Exchange Button - Moved here to be closer to Current Balance -->
            <button type="submit" class="swap-btn" style="width:100%;margin-top:1rem;background:linear-gradient(135deg,#00ff88,#00cc6a);color:#1a1f2e;border:none;border-radius:8px;padding:0.8rem;font-weight:bold;cursor:pointer;transition:all 0.3s ease;font-size:1rem;">üí± Exchange</button>
          </div>
          
          <!-- Full Width Elements -->
          <div style="grid-column:1/-1;margin-top:1rem;">
            <div id="swapRate" class="swap-rate">Exchange rate: Loading...</div>
            <div id="swapPreview" class="swap-preview"></div>
            <div id="swapLimitInfo" class="swap-limit-info" style="margin-top:0.5rem;color:#555;font-size:0.98em;"></div>
            
            <div id="swapStatus" class="swap-status"></div>
          </div>
        </form>
        

        </div>
      </div>
    </div>
  </div>

  <!-- Transfer Section -->
  <div id="main-transfer" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 style="margin:0 0 0.5rem 0;">üí∏ Transfer</h2>
      <p style="margin:0 0 0.5rem 0;">Transfer tokens to another wallet</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="transfer-container" style="max-width:600px;margin:0;padding:1.5rem;">
        
        <!-- Transfer Rules and Information -->
        <div class="transfer-rules" style="background:linear-gradient(135deg,#232946,#181c2a);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;border:2px solid #a786ff;">
          <h3 style="color:#00ff88;margin-bottom:1rem;font-size:1.2rem;">üìã Transfer Rules and Guide</h3>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">üîí Transfer Security:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>‚úÖ Transfers are irreversible - double-check before sending</li>
              <li>‚úÖ Enter destination address carefully - one wrong character can cause loss of assets</li>
              <li>‚úÖ Send a small amount first to verify the address is correct</li>
              <li>‚úÖ Use valid and secure wallets</li>
            </ul>
          </div>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">üí∞ Transferable Token Types:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li><strong style="color:#00ff88;">DAI:</strong> Stable token with value of $1 - for daily transactions</li>
              <li><strong style="color:#a786ff;">POL (MATIC):</strong> Polygon network token - for transaction fee payments</li>
              <li><strong style="color:#00ccff;">IAM:</strong> Main platform token - for investment and earning</li>
            </ul>
          </div>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">‚ö° Transaction Fees:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>üí∏ Polygon network fee: ~0.001-0.01 MATIC (depending on network traffic)</li>
              <li>‚è±Ô∏è Confirmation time: 2-5 seconds (usually)</li>
              <li>üîç Transactions can be tracked on PolygonScan</li>
            </ul>
          </div>
          
          <div>
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">üéØ Important Notes:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>üì± You can search by user index to find the address</li>
              <li>üîç Check your balance before transferring</li>
              <li>‚ö†Ô∏è Transfer amount + network fee must be less than your balance</li>
              <li>üìû Contact support if you have any issues</li>
            </ul>
          </div>
        </div>
        
        <form id="transferForm" class="transfer-form" style="display:grid !important;grid-template-columns:1fr 1fr !important;gap:1.5rem !important;align-items:start !important;">
          <!-- Left Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="transfer-row">
            <label for="transferTo">Destination Address:</label>
            <input type="text" id="transferTo" placeholder="0x..." required style="direction:ltr;">
            <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter destination wallet address (42 characters)</small>
          </div>

          <!-- Index to Address Search -->
            <div class="transfer-row" id="search-index-container" style="background:rgba(0,255,136,0.1);border-radius:8px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);">
              <h4 style="color:#00ff88;margin-bottom:0.6rem;font-size:0.9rem;">üîç Search by Index</h4>
              <div style="margin-bottom:0.4rem;">
              <input type="number" id="searchIndex" placeholder="Enter user index" 
                       style="background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,136,0.3);border-radius:6px;padding:0.4rem;color:#fff;text-align:center;width:100%;font-size:0.85rem;font-family:monospace;margin-bottom:0.4rem;">
              <button type="button" id="searchIndexBtn" 
                        style="background:linear-gradient(135deg,#00ff88,#00cc6a);color:#1a1f2e;border:none;border-radius:6px;padding:0.4rem 0.8rem;font-weight:bold;cursor:pointer;transition:all 0.3s ease;font-size:0.85rem;width:100%;">
                üîç Search
              </button>
            </div>
              <div id="searchIndexStatus" style="text-align:center;padding:0.4rem;border-radius:6px;font-size:0.85rem;min-height:1.2em;"></div>
              <small style="color:#b8c1ec;font-size:0.75rem;margin-top:0.2rem;display:block;">Enter a user index to find their wallet address</small>
          </div>

          <div class="transfer-row">
              <label for="transferAmount">Amount:</label>
              <input type="number" id="transferAmount" placeholder="Enter amount" min="0" step="any" required>
            <button type="button" id="maxAmountBtn" style="
              background: linear-gradient(90deg,#ff6b6b,#ee5a52);
              color: #fff;
              border: none;
              border-radius: 6px;
              padding: 0.4rem 0.8rem;
              font-size: 0.8rem;
              cursor: pointer;
                margin-top: 0.4rem;
              transition: all 0.3s ease;
              width: auto;
              display: inline-block;
              ">üî• Maximum Balance</button>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter transfer amount or click "Maximum"</small>
          </div>

          </div>

          <!-- Right Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
            <div class="transfer-row">
              <label for="transferToken">Token Type:</label>
              <select id="transferToken" required>
                <option value="dai" selected>DAI</option>
                <option value="pol">POL</option>
                <option value="IAM">IAM</option>
              </select>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Select the token type you want to transfer</small>
            </div>

          <div class="transfer-row" id="usd-converter-row" style="display:none;">
              <label for="transferUsdAmount">üí∞ Dollar Equivalent (Only for IAM):</label>
            <div class="usd-converter-container" style="display:flex;gap:0.5rem;align-items:center;">
              <span style="color:#00ff88;font-weight:bold;">$</span>
              <input type="number" id="transferUsdAmount" placeholder="5.00" min="0" step="0.01" style="flex:1;">
              <button type="button" id="usdToIAMBtn" style="
                background: linear-gradient(90deg,#00ff88,#a786ff);
                color: #181c2a;
                border: none;
                border-radius: 6px;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                ">üîÑ Convert</button>
            </div>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter dollar amount to convert to IAM (e.g., 5 for $5)</small>
          </div>
          
          <!-- Balance Check -->
            <div style="background:rgba(167,134,255,0.1);border-radius:8px;padding:0.8rem;" class="balance-check">
              <h4 style="color:#a786ff;margin-bottom:0.6rem;font-size:0.9rem;">üí∞ Your Current Balance:</h4>
              <div class="balance-check-grid" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.8rem;">
              <div style="text-align:center;">
                  <div style="color:#00ff88;font-weight:bold;font-size:0.9rem;">DAI</div>
                  <div id="transfer-dai-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
              </div>
              <div style="text-align:center;">
                  <div style="color:#a786ff;font-weight:bold;font-size:0.9rem;">POL</div>
                  <div id="transfer-poly-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
              </div>
              <div style="text-align:center;">
                  <div style="color:#00ccff;font-weight:bold;font-size:0.9rem;">IAM</div>
                  <div id="transfer-IAM-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
                  <div id="transfer-IAM-usd" style="color:#a786ff;font-size:0.75rem;margin-top:2px;">-</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Full Width Submit Button -->
          <div style="grid-column:1/-1;margin-top:1rem;">
            <button type="submit" class="transfer-btn" style="width:100%;">Transfer</button>
          <div id="transferStatus" class="transfer-status"></div>
          </div>
        </form>
      </div>
    </div>
  </div>

  




    
    <script src="js/smooth-value-updater.js"></script>
    <script src="js/smart-dashboard-updater.js"></script>
    <script src="js/central-dashboard-updater.js"></script>
    <script src="js/test-address-config.js"></script>
    <script src="js/config.js"></script>
    <script>
      // ÿ®ÿ±ÿ±ÿ≥€å ŸÑŸàÿØ ÿ¥ÿØŸÜ config.js
              console.log('üîç Checking config.js loading...');
        setTimeout(() => {
          console.log('displayTopUsersRanking available:', typeof window.displayTopUsersRanking);
          console.log('voteForIndex available:', typeof window.voteForIndex);
          if (typeof window.displayTopUsersRanking !== 'function') {
            console.error('‚ùå config.js not loaded properly!');
          } else {
            console.log('‚úÖ config.js loaded successfully');
          }
        }, 1000);
    </script>
  <script src="js/reports.js"></script>
  <script src="js/web3-interactions.js"></script>
  <script src="js/main.js"></script>
  <script src="js/search-index.js"></script>
  <script src="js/network.js?v=5.7"></script>
  <script src="js/network-database.js?v=5.8"></script>
  <script src="js/mobile-user-popup.js"></script>
  <script src="js/profile.js?v=5.7"></script>
  
  <script src="js/homepage.js?v=5.8"></script>

  <style>
    /* Fix for chart width issues */
    #price-chart-section {
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: hidden !important;
    }
    
    #price-chart-canvas,
    #point-chart-canvas {
      width: 100% !important;
      max-width: 100% !important;
      height: 150px !important;
      box-sizing: border-box !important;
    }
    
    @media (max-width: 768px) {
      #price-chart-canvas,
      #point-chart-canvas {
        height: 120px !important;
      }
    }
    
    /* Transfer Status Styles */
    .transfer-status {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      font-size: 0.9rem;
      text-align: center;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .transfer-status.success {
      background: rgba(0, 255, 136, 0.1);
      color: #00ff88;
      border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    .transfer-status.error {
      background: rgba(255, 68, 68, 0.1);
      color: #ff4444;
      border: 1px solid rgba(255, 68, 68, 0.3);
    }
    
    .transfer-status.loading {
      background: rgba(167, 134, 255, 0.1);
      color: #a786ff;
      border: 1px solid rgba(167, 134, 255, 0.3);
    }

    /* Index Search Styles */
    #search-index-container {
      transition: all 0.3s ease;
    }
    
    #search-index-container:hover {
      background: rgba(0, 255, 136, 0.15) !important;
      border-color: rgba(0, 255, 136, 0.4) !important;
    }
    
    #searchIndexStatus {
      transition: all 0.3s ease;
    }
    
    #searchIndexStatus.success {
      background: rgba(0, 255, 136, 0.1);
      color: #00ff88;
      border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    #searchIndexStatus.error {
      background: rgba(255, 68, 68, 0.1);
      color: #ff4444;
      border: 1px solid rgba(255, 68, 68, 0.3);
    }
    
    #searchIndexStatus.loading {
      background: rgba(167, 134, 255, 0.1);
      color: #a786ff;
      border: 1px solid rgba(167, 134, 255, 0.3);
    }
    
    /* Transfer Form Improvements */
    .transfer-form {
      background: linear-gradient(135deg, #232946, #181c2a);
      border-radius: 12px;
      padding: 1.5rem;
      border: 2px solid #a786ff;
    }
    
    .transfer-row {
      margin-bottom: 1.5rem;
    }
    
    .transfer-row label {
      display: block;
      color: #a786ff;
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    
    .transfer-row input,
    .transfer-row select {
      width: 100%;
      padding: 0.8rem;
      border-radius: 8px;
      border: 2px solid #a786ff;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-size: 0.95rem;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    
    .transfer-row input:focus,
    .transfer-row select:focus {
      outline: none;
      border-color: #00ff88;
    }
    
    .transfer-btn {
      background: linear-gradient(90deg, #00ff88, #a786ff);
      color: #181c2a;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      padding: 1rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 1rem;
    }
    
    .transfer-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
    }
    
    .transfer-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Responsive Design for Transfer Section */
    @media (max-width: 768px) {
      #main-transfer {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        padding: 0.5rem !important;
      }
      

      
      .transfer-container {
        max-width: 100% !important;
        padding: 0.8rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .transfer-form {
        padding: 0.8rem !important;
        border-radius: 8px !important;
      }
      
      .transfer-row {
        margin-bottom: 0.8rem !important;
      }
      
      .transfer-row label {
        font-size: 0.9rem !important;
        margin-bottom: 0.3rem !important;
      }
      
      .transfer-row input,
      .transfer-row select {
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      .transfer-btn {
        padding: 0.7rem 1.2rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      /* Balance grid responsive */
      .balance-check {
        padding: 0.8rem !important;
        border-radius: 6px !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr !important;
        gap: 0.6rem !important;
      }
      
      .balance-check h4 {
        font-size: 1rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      /* Search index row responsive */
      .search-index-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .search-index-container input {
        width: 100% !important;
        min-width: auto !important;
      }
      
      .search-index-container button {
        width: 100% !important;
        min-width: auto !important;
        padding: 0.5rem !important;
      }

      /* Index search responsive */
      #search-index-container {
        padding: 0.8rem !important;
        margin-bottom: 0.8rem !important;
      }
      
      #search-index-container h4 {
        font-size: 0.95rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      #search-index-container .transfer-row {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      #search-index-container input {
        width: 100% !important;
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
      }
      
      #search-index-container button {
        width: 100% !important;
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
      }
      
      #searchIndexStatus {
        font-size: 0.8rem !important;
        padding: 0.4rem !important;
      }
      
      /* USD converter row responsive */
      .usd-converter-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .usd-converter-container input {
        width: 100% !important;
      }
      
      .usd-converter-container button {
        width: 100% !important;
        padding: 0.5rem !important;
      }
      
      /* Rules section responsive */
      .transfer-rules {
        padding: 0.8rem !important;
        border-radius: 8px !important;
        margin-bottom: 1rem !important;
      }
      
      .transfer-rules h3 {
        font-size: 1.1rem !important;
        margin-bottom: 0.8rem !important;
      }
      
      .transfer-rules h4 {
        font-size: 0.95rem !important;
        margin-bottom: 0.4rem !important;
      }
      
      .transfer-rules ul {
        font-size: 0.8rem !important;
        line-height: 1.4 !important;
        padding-right: 0.8rem !important;
      }
      
      .transfer-rules li {
        margin-bottom: 0.3rem !important;
      }
      
      /* Small text responsive */
      .transfer-row small {
        font-size: 0.75rem !important;
        margin-top: 0.2rem !important;
      }
      
      /* Max amount button responsive */
      #maxAmountBtn {
        padding: 0.4rem 0.8rem !important;
        font-size: 0.8rem !important;
        margin-top: 0.4rem !important;
        width: 100% !important;
      }
    }
    
    @media (max-width: 480px) {
      #main-transfer {
        padding: 0.3rem !important;
      }
      

      
      .transfer-container {
        padding: 0.6rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .transfer-form {
        padding: 0.6rem !important;
      }
      
      .transfer-row {
        margin-bottom: 0.6rem !important;
      }
      
      .transfer-row label {
        font-size: 0.85rem !important;
      }
      
      .transfer-row input,
      .transfer-row select {
        padding: 0.5rem !important;
        font-size: 0.85rem !important;
      }
      
      .transfer-btn {
        padding: 0.6rem 1rem !important;
        font-size: 0.85rem !important;
      }
      
      .balance-check {
        padding: 0.6rem !important;
      }
      
      .transfer-rules {
        padding: 0.6rem !important;
      }
      
      .transfer-rules h3 {
        font-size: 1rem !important;
      }
      
      .transfer-rules h4 {
        font-size: 0.9rem !important;
      }
      
      .transfer-rules ul {
        font-size: 0.75rem !important;
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {

      
      .transfer-container {
        max-width: 90% !important;
        padding: 1.2rem !important;
        margin: 0 auto !important;
      }
      
      .transfer-form {
        padding: 1.2rem !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    @media (min-width: 1025px) {

      
      .transfer-container {
        max-width: 700px !important;
        padding: 1.5rem !important;
        margin: 0 auto !important;
      }
      
      .transfer-form {
        padding: 1.5rem !important;
      }
      
      .transfer-row {
        margin-bottom: 1.5rem !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    /* Responsive Design for Swap Section */
    @media (max-width: 768px) {
      #main-swap {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        padding: 0.5rem !important;
      }
      
      .swap-container {
        max-width: 100% !important;
        padding: 0.8rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .swap-form {
        padding: 0.8rem !important;
        border-radius: 8px !important;
      }
      
      .swap-row {
        margin-bottom: 0.8rem !important;
      }
      
      .swap-row label {
        font-size: 0.9rem !important;
        margin-bottom: 0.3rem !important;
      }
      
      .swap-row input,
      .swap-row select {
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      .swap-btn {
        padding: 0.7rem 1.2rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      /* Swap rules responsive */
      .swap-rules {
        padding: 0.8rem !important;
        border-radius: 8px !important;
        margin-bottom: 1rem !important;
      }
      
      .swap-rules h3 {
        font-size: 1.1rem !important;
        margin-bottom: 0.8rem !important;
      }
      
      .swap-rules h4 {
        font-size: 0.95rem !important;
        margin-bottom: 0.4rem !important;
      }
      
      .swap-rules ul {
        font-size: 0.8rem !important;
        line-height: 1.4 !important;
        padding-right: 0.8rem !important;
      }
      
      .swap-rules li {
        margin-bottom: 0.3rem !important;
      }
      
      /* Amount input group responsive */
      .amount-input-group {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .amount-input-group input {
        width: 100% !important;
      }
      
      .amount-input-group .max-btn {
        width: 100% !important;
        padding: 0.5rem !important;
      }
      
      /* USD converter responsive */
      .swap-row .usd-converter-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .swap-row .usd-converter-container input {
        width: 100% !important;
      }
      
      .swap-row .usd-converter-container button {
        width: 100% !important;
        padding: 0.5rem !important;
      }
      
      /* Balance check responsive */
      .swap-balance-check {
        padding: 0.8rem !important;
        border-radius: 6px !important;
      }
      
      .swap-balance-check .swap-balance-grid {
        grid-template-columns: 1fr !important;
        gap: 0.6rem !important;
      }
      
      .swap-balance-check h4 {
        font-size: 1rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      /* Small text responsive */
      .swap-row small {
        font-size: 0.75rem !important;
        margin-top: 0.2rem !important;
      }
    }
    
    @media (max-width: 480px) {
      #main-swap {
        padding: 0.3rem !important;
      }
      
      .swap-container {
        padding: 0.6rem !important;
      }
      
      .swap-form {
        padding: 0.6rem !important;
      }
      
      .swap-row {
        margin-bottom: 0.6rem !important;
      }
      
      .swap-row label {
        font-size: 0.85rem !important;
      }
      
      .swap-row input,
      .swap-row select {
        padding: 0.5rem !important;
        font-size: 0.85rem !important;
      }
      
      .swap-btn {
        padding: 0.6rem 1rem !important;
        font-size: 0.85rem !important;
      }
      
      .swap-balance-check {
        padding: 0.6rem !important;
      }
      
      .swap-rules {
        padding: 0.6rem !important;
      }
      
      .swap-rules h3 {
        font-size: 1rem !important;
      }
      
      .swap-rules h4 {
        font-size: 0.9rem !important;
      }
      
      .swap-rules ul {
        font-size: 0.75rem !important;
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {
      .swap-container {
        max-width: 90% !important;
        padding: 1.2rem !important;
        margin: 0 auto !important;
      }
      
      .swap-form {
        padding: 1.2rem !important;
      }
      
      .swap-balance-check .swap-balance-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    @media (min-width: 1025px) {
      .swap-container {
        max-width: 700px !important;
        padding: 1.5rem !important;
        margin: 0 auto !important;
      }
      
      .swap-form {
        padding: 1.5rem !important;
      }
      
      .swap-row {
        margin-bottom: 1.5rem !important;
      }
      
      .swap-balance-check .swap-balance-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
  </style>
  
      <!-- Define required variables for swap -->
  <script>
    // DAI contract address in Polygon network
    window.DAI_ADDRESS = '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063';
    
    // Simple ABI for DAI
    window.DAI_ABI = [
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          }
        ],
        "name": "allowance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];
  </script>
  
  <script src="js/swap.js?v=5.7"></script>
  

 
  <!-- Charts removed -->
  
  <script>
    // Safe, no-op placeholder to avoid unhandled users(address) calls
    (async () => {
      try {
        await window.connectWallet();
        // Intentionally skip direct contract.users(address) call to avoid provider decode issues
      } catch (e) {
        // ignore
      }
    })();
  </script>

  <script>
    async function updateAboutWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('about-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('about-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('about-wallets-count').innerText = '-';
      }
    }
    // Hook into tab switching
    const aboutBtn = document.getElementById('tab-about-btn');
    if (aboutBtn) {
      aboutBtn.addEventListener('click', updateAboutWalletsCount);
    }
  </script>

  <script>
    function toggleDashboardChart(chartId, btn) {
      const chartDiv = document.getElementById(chartId);
      if (!chartDiv) return;
      const isOpen = chartDiv.style.display === 'block';
      chartDiv.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? '‚ñº' : '‚ñ≤';
      // Placeholder: Here you can load/render the chart if needed
    }
  </script>
  <!-- Add/Edit Sub-Admin Modal -->
  <div class="sub-admin-modal" id="sub-admin-modal">
    <div class="sub-admin-modal-content">
      <h3 id="modal-title">Add New Sub-Admin</h3>
      <form class="sub-admin-form" id="sub-admin-form">
        <div class="form-group">
          <label for="sub-admin-name">Sub-Admin Name:</label>
          <input type="text" id="sub-admin-name" placeholder="Full name of sub-admin" required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-address">Wallet Address:</label>
          <input type="text" id="sub-admin-address" placeholder="0x..." required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-role">Role:</label>
          <select id="sub-admin-role" required>
            <option value="">Select Role</option>
            <option value="moderator">Content Manager</option>
            <option value="support">Support</option>
            <option value="analyst">Analyst</option>
            <option value="teacher">Teacher</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-description">Description:</label>
          <textarea id="sub-admin-description" placeholder="Additional descriptions..." rows="3"></textarea>
        </div>
        
        <div class="permissions-group">
          <h5>üîê Sub-Admin Permissions</h5>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-stream-control" name="permissions">
            <label for="perm-stream-control">Live Stream Control</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-chat-moderate" name="permissions">
            <label for="perm-chat-moderate">Chat Management</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-ban-users" name="permissions">
            <label for="perm-ban-users">Ban Users</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-reports" name="permissions">
            <label for="perm-view-reports">View Reports</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-manage-content" name="permissions">
            <label for="perm-manage-content">Content Management</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-analytics" name="permissions">
            <label for="perm-view-analytics">View Analytics</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-edit-products" name="permissions">
            <label for="perm-edit-products">Edit Products</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-orders" name="permissions">
            <label for="perm-view-orders">View Orders</label>
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="submit" class="modal-btn primary" id="save-sub-admin-btn">üíæ Save</button>
          <button type="button" class="modal-btn secondary" id="cancel-sub-admin-btn">‚ùå Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="sub-admin-modal" id="delete-confirm-modal">
    <div class="sub-admin-modal-content">
      <h3>‚ö†Ô∏è Confirm Deletion</h3>
      <p style="color: #ccc; text-align: center; margin-bottom: 1.5rem;">
        Are you sure you want to delete this sub-admin?
      </p>
      <div style="background: #181c2a; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <p style="color: #fff; margin: 0;"><strong>Name:</strong> <span id="delete-admin-name"></span></p>
        <p style="color: #888; margin: 0.5rem 0 0 0;"><strong>Address:</strong> <span id="delete-admin-address"></span></p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn danger" id="confirm-delete-btn">üóëÔ∏è Delete</button>
        <button class="modal-btn secondary" id="cancel-delete-btn">‚ùå Cancel</button>
      </div>
    </div>
  </div>



  <div id="custom-footer-div" style="text-align:center; padding:2rem; color:#00ff88; font-size:1.2rem;">
  <br>  <br>  <br>  <br>  <br>  <br>  <br>
  </div>


  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var archiveBtn = Array.from(document.querySelectorAll('button, a')).find(el => el.textContent.includes('Financial Markets Archive'));
      if (archiveBtn) archiveBtn.remove();
      
      // Restore active tab from localStorage
      const savedTab = localStorage.getItem('currentActiveTab');
      if (savedTab && savedTab !== 'network' && typeof window.showTab === 'function') {
        // Wait a bit for the page to fully load
        setTimeout(() => {
          window.showTab(savedTab);
        }, 1000);
      }
    });
  </script>

  <script>
  (async function() {
    if (window.getUserProfile) {
      const profile = await window.getUserProfile();
      if (!(profile.index && BigInt(profile.index) > 0n)) {
        // Lock only the reports section
        const reportsSection = document.getElementById('main-reports');
        if (reportsSection) {
          reportsSection.innerHTML = '<div style="color:#ff6b6b;text-align:center;padding:3rem;font-size:1.5rem;">Access to this section is only allowed for active users.<br>üîí</div>';
          reportsSection.style.background = '#181c2a';
        }
      }
    }
  })();
  </script>

  <!-- Control display of destination address input -->
  <script>
          // Auto-refresh transfer balances function
      async function autoRefreshTransferBalances() {
        try {
          if (window.updateTransferBalancesOnConnect) {
            await window.updateTransferBalancesOnConnect();
            console.log('‚úÖ Transfer balances auto-refreshed');
          }
        } catch (error) {
          console.warn('Error in auto-refreshing transfer balances:', error);
        }
      }

    document.addEventListener('DOMContentLoaded', function() {
      const transferForm = document.getElementById('transferForm');
      if (!transferForm) return;

              // Auto-update balances when page loads
      const initTransferBalances = () => {
        if (window.contractConfig && window.contractConfig.contract) {
          autoRefreshTransferBalances();
        } else {
          // Wait for wallet connection
          const checkConnection = setInterval(() => {
            if (window.contractConfig && window.contractConfig.contract) {
              autoRefreshTransferBalances();
              clearInterval(checkConnection);
            }
          }, 1000);
          
          // Stop checking after 15 seconds
          setTimeout(() => clearInterval(checkConnection), 15000);
        }
      };

      // Start updating
      initTransferBalances();

      // USD Converter functionality
      const usdConverterRow = document.getElementById('usd-converter-row');
      const transferUsdAmount = document.getElementById('transferUsdAmount');
      const usdToIAMBtn = document.getElementById('usdToIAMBtn');
      
      // Show/hide USD field based on token type
      function toggleUsdConverter() {
        const selectedToken = transferTokenSelect.value;
        if (selectedToken === 'IAM') {
          usdConverterRow.style.display = 'block';
        } else {
          usdConverterRow.style.display = 'none';
          transferUsdAmount.value = '';
        }
      }
      
      // Convert USD to IAM
      async function convertUsdToIAM() {
        const usdAmount = parseFloat(transferUsdAmount.value);
        if (isNaN(usdAmount) || usdAmount <= 0) {
          alert('Please enter a valid dollar amount');
          return;
        }
        
        try {
          // Get token price from smart contract
          const connection = await window.connectWallet();
          if (!connection || !connection.contract) {
            alert('Please connect your wallet first');
            return;
          }
          
          usdToIAMBtn.textContent = '‚è≥ Calculating...';
          usdToIAMBtn.disabled = true;
          
          const tokenPriceRaw = await connection.contract.getTokenPrice();
          const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
          
          // Calculate required IAM amount
          const IAMAmount = (usdAmount / tokenPrice).toFixed(6);
          
          // Set value in main field
          transferAmountInput.value = IAMAmount;
          
          // Show success message
          const statusDiv = document.getElementById('transferStatus');
          if (statusDiv) {
            statusDiv.innerHTML = `‚úÖ $${usdAmount} equals ${parseFloat(IAMAmount).toLocaleString('en-US', {maximumFractionDigits: 6})} IAM`;
            statusDiv.style.color = '#00ff88';
            setTimeout(() => {
              statusDiv.innerHTML = '';
            }, 3000);
          }
          
        } catch (error) {
          console.error('Error converting USD to IAM:', error);
          alert('Conversion error. Please try again.');
        } finally {
          usdToIAMBtn.textContent = 'üîÑ Convert';
          usdToIAMBtn.disabled = false;
        }
      }
      
      // Maximum button
      const maxAmountBtn = document.getElementById('maxAmountBtn');
      const transferAmountInput = document.getElementById('transferAmount');
      const transferTokenSelect = document.getElementById('transferToken');

      if (maxAmountBtn && transferAmountInput && transferTokenSelect) {
        maxAmountBtn.addEventListener('click', function() {
          const selectedToken = transferTokenSelect.value;
          let maxAmount = '0';
          
          // Get balance based on selected token
          if (selectedToken === 'dai') {
            const daiBalanceEl = document.getElementById('transfer-dai-balance');
            if (daiBalanceEl) {
              const raw = parseFloat(daiBalanceEl.dataset.value || daiBalanceEl.textContent);
              if (!isNaN(raw) && raw > 0) maxAmount = raw.toString();
            }
          } else if (selectedToken === 'pol') {
            const polBalanceEl = document.getElementById('transfer-poly-balance');
            if (polBalanceEl) {
              const raw = parseFloat(polBalanceEl.dataset.value || polBalanceEl.textContent);
              if (!isNaN(raw)) {
                maxAmount = Math.max(0, raw - 0.01).toString();
              }
            }
          } else if (selectedToken === 'IAM') {
            const IAMBalanceEl = document.getElementById('transfer-IAM-balance');
            if (IAMBalanceEl) {
              const raw = parseFloat(IAMBalanceEl.dataset.value || IAMBalanceEl.textContent);
              if (!isNaN(raw) && raw > 0) maxAmount = raw.toString();
            }
          }
          
          // Set value in input field
          if (parseFloat(maxAmount) > 0) {
            const decimals = (transferTokenSelect.value === 'IAM') ? 6 : 18;
            // For DAI and POL, it's better to use 2 or 4 digits; for IAM up to 6 digits
            const floorToDecimals = (val, d) => { const m = Math.pow(10, d); return Math.floor(Number(val) * m) / m; };
            const d = (transferTokenSelect.value === 'IAM') ? 6 : 4;
            const floored = floorToDecimals(maxAmount, d);
            transferAmountInput.value = floored.toFixed(d);
            // Temporarily change button text
            const originalText = maxAmountBtn.textContent;
                          maxAmountBtn.textContent = '‚úì Set';
            maxAmountBtn.style.background = 'linear-gradient(90deg,#00ff88,#00cc66)';
            setTimeout(() => {
              maxAmountBtn.textContent = originalText;
              maxAmountBtn.style.background = 'linear-gradient(90deg,#ff6b6b,#ee5a52)';
            }, 1500);
          } else {
            // Show error message
            maxAmountBtn.textContent = '‚ùå Insufficient balance';
            maxAmountBtn.style.background = 'linear-gradient(90deg,#666,#555)';
            setTimeout(() => {
              maxAmountBtn.textContent = 'Maximum';
              maxAmountBtn.style.background = 'linear-gradient(90deg,#ff6b6b,#ee5a52)';
            }, 2000);
          }
        });
      }
      
      // Event listeners for USD converter
      if (transferTokenSelect) {
        // Change token type
        transferTokenSelect.addEventListener('change', toggleUsdConverter);
        
        // Initial execution to set initial state
        toggleUsdConverter();
      }
      
      if (usdToIAMBtn) {
        // Convert button click
        usdToIAMBtn.addEventListener('click', convertUsdToIAM);
      }
      
      if (transferUsdAmount) {
        // Enter key in USD field
        transferUsdAmount.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            convertUsdToIAM();
          }
        });
        
        // Real-time calculation when user types
        let usdTimeout;
        transferUsdAmount.addEventListener('input', function() {
          clearTimeout(usdTimeout);
          usdTimeout = setTimeout(async () => {
            const usdAmount = parseFloat(transferUsdAmount.value);
            if (!isNaN(usdAmount) && usdAmount > 0) {
              try {
                const connection = await window.connectWallet();
                if (connection && connection.contract) {
                  const tokenPriceRaw = await connection.contract.getTokenPrice();
                  const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
                  const IAMAmount = (usdAmount / tokenPrice).toFixed(6);
                  
                  // Show preview in placeholder
                  transferAmountInput.placeholder = `‚âà ${parseFloat(IAMAmount).toLocaleString('en-US', {maximumFractionDigits: 6})} IAM`;
                }
              } catch (e) {
                // Error in real-time - ignore
              }
            } else {
              transferAmountInput.placeholder = 'Enter amount';
            }
          }, 500); // 500ms delay to prevent too many calls
        });
      }
      
      // Real-time calculation of dollar equivalent when IAM amount changes
      if (transferAmountInput) {
        let IAMTimeout;
        transferAmountInput.addEventListener('input', function() {
          if (transferTokenSelect.value === 'IAM') {
            clearTimeout(IAMTimeout);
            IAMTimeout = setTimeout(async () => {
              const IAMAmount = parseFloat(transferAmountInput.value);
              if (!isNaN(IAMAmount) && IAMAmount > 0) {
                try {
                  const connection = await window.connectWallet();
                  if (connection && connection.contract) {
                    const tokenPriceRaw = await connection.contract.getTokenPrice();
                    const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
                    const usdValue = (IAMAmount * tokenPrice).toFixed(2);
                    
                    // Show dollar equivalent in USD field
                    if (transferUsdAmount) {
                      transferUsdAmount.placeholder = `‚âà $${parseFloat(usdValue).toLocaleString('en-US', {maximumFractionDigits: 2})}`;
                    }
                  }
                } catch (e) {
                  // Error in real-time - ignore
                }
              } else {
                if (transferUsdAmount) {
                  transferUsdAmount.placeholder = '5.00';
                }
              }
            }, 500);
          }
        });
      }

      transferForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const transferBtn = transferForm.querySelector('button[type="submit"]');
        if (transferBtn) {
          transferBtn.disabled = true;
          var oldText = transferBtn.textContent;
                      transferBtn.textContent = 'Processing...';
        }
        const transferToInput = document.getElementById('transferTo');
                      // ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ÿ¢ÿØÿ±ÿ≥ ⁄©ÿßŸÖŸÑ ÿß⁄Øÿ± ÿØÿ± data attribute ÿ∞ÿÆ€åÿ±Ÿá ÿ¥ÿØŸá ÿ®ÿßÿ¥ÿØ
              const to = transferToInput.getAttribute('data-full-address') || transferToInput.value.trim();
        const amount = parseFloat(document.getElementById('transferAmount').value);
        const token = document.getElementById('transferToken').value;
        const status = document.getElementById('transferStatus');
        status.textContent = '';
        status.className = 'transfer-status';
        if (!to || !amount || amount <= 0) {
                      status.textContent = 'Please enter valid destination address and amount';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        if (!window.contractConfig || !window.contractConfig.contract || !window.contractConfig.signer) {
                      status.textContent = 'Wallet connection not established';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        try {
                      status.textContent = 'Sending...';
          status.className = 'transfer-status loading';
          if (token === 'pol') {
            // Transfer MATIC/POL
            const tx = await window.contractConfig.signer.sendTransaction({
              to,
              value: ethers.parseEther(amount.toString())
            });
            await tx.wait();
            status.textContent = 'Transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          } else if (token === 'dai') {
            // Transfer DAI - fix decimal to 18
            const daiContract = new ethers.Contract(DAI_ADDRESS, DAI_ABI, window.contractConfig.signer);
            const decimals = 18; // DAI has 18 decimals, not 6
            const parsedAmount = ethers.parseUnits(amount.toString(), decimals);
            const tx = await daiContract.transfer(to, parsedAmount);
            await tx.wait();
            status.textContent = 'DAI transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          } else {
            // Transfer IAM
            const contract = window.contractConfig.contract;
            const tx = await contract.transfer(to, ethers.parseEther(amount.toString()));
            await tx.wait();
            status.textContent = 'Transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          }
          transferForm.reset();
          
          // Update balances after successful transfer
          setTimeout(autoRefreshTransferBalances, 2000);
        } catch (error) {
          let msg = error && error.message ? error.message : error;
          if (msg.includes('user rejected')) msg = 'Transaction cancelled by user';
          else if (msg.includes('insufficient funds')) msg = 'Insufficient balance';
          else if (msg.includes('invalid address')) msg = 'Invalid destination address';
          else if (msg.includes('nonce')) msg = 'Transaction number error. Please try again';
          else if (msg.includes('execution reverted')) msg = 'Transaction failed. Please check conditions';
          else msg = 'Transfer error: ' + msg;
          status.textContent = msg;
          status.className = 'transfer-status error';
        }
        if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
      });
    });
  </script>

  <script>
    // ÿ™ÿßÿ®ÿπ ⁄©Ÿàÿ™ÿßŸá ⁄©ÿ±ÿØŸÜ ÿ¢ÿØÿ±ÿ≥
    function shortenAddress(address) {
      if (address && address.length === 42 && address.startsWith('0x')) {
        return `${address.substring(0, 6)}...${address.substring(38)}`;
      }
      return address;
    }

    // Event listener ÿ®ÿ±ÿß€å ⁄©Ÿàÿ™ÿßŸá ⁄©ÿ±ÿØŸÜ ÿ¢ÿØÿ±ÿ≥‚ÄåŸáÿß€å Ÿàÿßÿ±ÿØ ÿ¥ÿØŸá ÿØÿ≥ÿ™€å
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Manual address shortening script loaded');
      const transferToInput = document.getElementById('transferTo');
      console.log('TransferTo input found:', !!transferToInput);
      if (transferToInput) {
        transferToInput.addEventListener('blur', function() {
          console.log('TransferTo input blur event triggered');
          const value = this.value.trim();
          console.log('Input value:', value, 'Length:', value.length, 'Starts with 0x:', value.startsWith('0x'));
          if (value && value.length === 42 && value.startsWith('0x')) {
            // ÿ∞ÿÆ€åÿ±Ÿá ÿ¢ÿØÿ±ÿ≥ ⁄©ÿßŸÖŸÑ
            this.setAttribute('data-full-address', value);
            // ŸÜŸÖÿß€åÿ¥ ÿ¢ÿØÿ±ÿ≥ ⁄©Ÿàÿ™ÿßŸá ÿ¥ÿØŸá
            this.value = shortenAddress(value);
          }
        });
      }
    });
  </script>



  <script>
    // Function to expand/collapse expandable sections
    function toggleExpandable(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        container.classList.toggle('collapsed');
        
        // Save state in localStorage
        const isCollapsed = container.classList.contains('collapsed');
        localStorage.setItem(`expandable_${containerId}`, isCollapsed ? 'collapsed' : 'expanded');
      }
    }

    // Restore expandable sections state from localStorage
    function restoreExpandableStates() {
      const expandableContainers = document.querySelectorAll('.expandable-container');
      expandableContainers.forEach(container => {
        const containerId = container.id;
        const savedState = localStorage.getItem(`expandable_${containerId}`);
        if (savedState === 'collapsed') {
          container.classList.add('collapsed');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      restoreExpandableStates();
      
      
    });
  </script>

  <script>
    window.formatTokenPrice = function(priceWei) {
      if (!priceWei || priceWei === '0') return '0';
      let priceString = priceWei.toString();
      while (priceString.length < 18) priceString = '0' + priceString;
      if (priceString.length > 18) priceString = priceString.slice(-18);
      const result = '0.' + priceString;
      const numResult = parseFloat(result);
      if (numResult < 0.000001) {
        return numResult.toExponential(6);
      }
      return result;
    }

    // Function to update price display
    async function updateTokenPriceDisplay() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
          if (!window.contractConfig || !window.contractConfig.contract) {
            const el = document.getElementById('chart-lvl-usd');
            if (el) el.textContent = 'Connection failed';
            return;
          }
        }
        const contract = window.contractConfig.contract;
        const tokenPrice = await contract.getTokenPrice();
        const priceFormatted = window.formatTokenPrice(tokenPrice);
        const el = document.getElementById('chart-lvl-usd');
        if (el) el.textContent = priceFormatted;
        // Update point-value from contract
        try {
          const pointValue = await contract.getPointValue();
          const pointValueNum = parseFloat(ethers.formatUnits(pointValue, 18));
          const pointValueFormatted = pointValueNum < 0.000001 ? pointValueNum.toExponential(6) : pointValueNum.toFixed(2);
          const el2 = document.getElementById('point-value');
          if (el2) el2.textContent = pointValueFormatted; // Remove IAM suffix
        } catch (error) {
          // ...
        }
      } catch (error) {
        const el = document.getElementById('chart-lvl-usd');
                    if (el) el.textContent = 'Loading error';
      }
    }
    // ... existing code ...
  </script>

  <script>
    if (window.loadUserProfile) {
      const origLoadUserProfile = window.loadUserProfile;
      window.loadUserProfile = async function() {
        await origLoadUserProfile.apply(this, arguments);
        await updateProfileReferrer(); // Here with await and without delay
      };
    }
  </script>
  <script src="js/token-price.js"></script>
  <script src="js/remove-archive-btn.js"></script>



  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('connectProfileWalletBtn');
    if (btn) {
      btn.addEventListener('click', async function() {
        try {
          if (window.connectWallet) {
            await window.connectWallet();
            // After connecting, reload profile
            if (typeof loadUserProfile === 'function') loadUserProfile();
          }
        } catch (e) {
          alert('Wallet connection error: ' + (e.message || e));
        }
      });
    }
  });
  </script>

  <script src="js/navbar.js"></script>
  
      <!-- SwapManager initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ Starting SwapManager initialization...');
      
              // Ensure swap.js is loaded
      if (typeof SwapManager !== 'undefined') {
        try {
          console.log('‚úÖ SwapManager class found');
          
          // Wait a bit for DOM to fully load
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Check for required elements
          const requiredElements = ['swapForm', 'swapDirection', 'swapAmount', 'maxBtn', 'swapRate', 'swapPreview', 'swapLimitInfo', 'swapStatus'];
          const missingElements = requiredElements.filter(id => !document.getElementById(id));
          
          if (missingElements.length > 0) {
            console.warn('‚ö†Ô∏è The following elements were not found:', missingElements);
            return;
          }
          
          console.log('‚úÖ All required elements are present');
          
          // Check for required variables
          if (!window.DAI_ADDRESS || !window.DAI_ABI) {
            console.error('‚ùå DAI_ADDRESS or DAI_ABI variables are not defined');
            return;
          }
          
          console.log('‚úÖ DAI variables are present');
          
          // Create SwapManager instance
          window.swapManager = new SwapManager();
          console.log('‚úÖ SwapManager instance created');
          
          // Initial setup
          await window.swapManager.initializeSwap();
          console.log('‚úÖ SwapManager initialized successfully');
          
        } catch (error) {
          console.error('‚ùå Error initializing SwapManager:', error);
        }
      } else {
        console.warn('‚ö†Ô∏è SwapManager is not defined - swap.js file not loaded');
      }
      

    });
    
    // Re-initialization after wallet connection
    if (window.connectWallet) {
      const originalConnectWallet = window.connectWallet;
      window.connectWallet = async function() {
        const result = await originalConnectWallet();
        
        // Re-initialize SwapManager after connection
        setTimeout(async () => {
          if (window.swapManager && typeof window.swapManager.refreshSwapData === 'function') {
            try {
              console.log('üîÑ Refreshing SwapManager after wallet connection...');
              await window.swapManager.refreshSwapData();
              console.log('‚úÖ SwapManager refreshed');
            } catch (error) {
              console.warn('‚ö†Ô∏è Error refreshing SwapManager:', error);
            }
          }
          // Update index dashboard status bar
          try { if (typeof window.indexStatusTryUpdate === 'function') window.indexStatusTryUpdate(); } catch(_) {}
        }, 1000);
        
        return result;
      };
    }
  </script>
  </div>

<style>
/* File cleaned - new CSS is at the end */

/* === All cards fixed width on mobile === */
@media (max-width: 768px) {
  /* Main cards container */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-direction: column !important;
    gap: 0.8rem !important;
    width: 100% !important;
    padding: 0 0.5rem !important;
  }
  
  /* All cards fixed full width */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    flex: none !important;
    padding: 1.2rem !important;
    margin: 0 !important;
    margin-bottom: 0.8rem !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3) !important;
    backdrop-filter: blur(6px) !important;
    border: 1.5px solid rgba(255,255,255,0.15) !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
  }
  
  /* Card icons */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:1.2rem;margin-bottom:0.3rem;"] {
    font-size: 1.8rem !important;
    margin-bottom: 0.6rem !important;
    text-align: center !important;
  }
  
  /* Card titles */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;"] {
    font-size: 1rem !important;
    margin-bottom: 0.4rem !important;
    letter-spacing: 0.3px !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  /* Card values - fix overflow */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    font-size: 1.1rem !important;
    margin: 0.6rem 0 !important;
    letter-spacing: 0.2px !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.4) !important;
    text-align: center !important;
    word-break: break-all !important;
    overflow-wrap: break-word !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Card descriptions */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.7rem;margin-top:0.2rem;"] {
    font-size: 0.8rem !important;
    margin-top: 0.4rem !important;
    opacity: 0.7 !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  /* Special cards - special sizes */
  
  /* Total supply card */
  div[style*="border:1px solid rgba(0,255,136,0.2)"] {
    border: 3px solid rgba(0,255,136,0.4) !important;
    background: rgba(0,255,136,0.1) !important;
  }
  
  /* IAM contract balance card */
  div[style*="border:1px solid rgba(255,193,7,0.2)"] {
    border: 3px solid rgba(255,193,7,0.4) !important;
    background: rgba(255,193,7,0.1) !important;
  }
  
  /* DAI balance card */
  div[style*="border:1px solid rgba(0,123,255,0.2)"] {
    border: 3px solid rgba(0,123,255,0.4) !important;
    background: rgba(0,123,255,0.1) !important;
  }
  
  /* Registration price card */
  div[style*="border:1px solid rgba(138,43,226,0.2)"] {
    border: 3px solid rgba(138,43,226,0.4) !important;
    background: rgba(138,43,226,0.1) !important;
  }
  
  /* Card Entry Animation */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    animation: slideUpMobile 0.6s ease-out !important;
    animation-delay: calc(var(--card-index, 0) * 0.1s) !important;
  }
}

/* Card Entry Animation on Mobile */
@keyframes slideUpMobile {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* For very small screens */
@media (max-width: 480px) {
  /* Cards container */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    padding: 0 0.3rem !important;
    gap: 0.6rem !important;
  }
  
  /* Cards */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    padding: 1rem !important;
    margin-bottom: 0.6rem !important;
    border-radius: 10px !important;
  }
  
  /* Icons */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:1.2rem;margin-bottom:0.3rem;"] {
    font-size: 1.5rem !important;
    margin-bottom: 0.5rem !important;
  }
  
  /* Titles */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;"] {
    font-size: 0.9rem !important;
    margin-bottom: 0.3rem !important;
  }
  
  /* Values */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    font-size: 1rem !important;
    margin: 0.5rem 0 !important;
    line-height: 1.2 !important;
  }
  
  /* Descriptions */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.7rem;margin-top:0.2rem;"] {
    font-size: 0.75rem !important;
    margin-top: 0.3rem !important;
  }
}

/* Prevent long numbers from overflowing out of cards (in all sizes) */
div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
  word-break: break-all !important;
  overflow-wrap: anywhere !important;
  white-space: normal !important;
  max-width: 100% !important;
}

/* Responsive Layout for Dashboard Metric Cards on Tablet and Desktop */
@media (min-width: 769px) and (max-width: 1023px) {
  /* Cards container ‚Üí 2 columns per row */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 0.8rem !important;
    justify-content: center !important;
  }
  /* ÿÆŸàÿØ ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß ÿØÿßÿÆŸÑ ÿ∏ÿ±ŸÅ ÿ®ÿßŸÑÿß */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    flex: none !important;
    box-sizing: border-box !important;
  }
}

@media (min-width: 1024px) {
  /* Cards container ‚Üí 3 columns per row */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 1rem !important;
    justify-content: center !important;
  }
  /* ÿÆŸàÿØ ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß ÿØÿßÿÆŸÑ ÿ∏ÿ±ŸÅ ÿ®ÿßŸÑÿß */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    flex: none !important;
    box-sizing: border-box !important;
  }
}

/* Dynamic Width Mode for Dashboard Metric Cards on Tablet/Desktop
   This block overrides the grid rules above to make cards expand to content width */
@media (min-width: 769px) {
  /* Cards container: flex and wrappable */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 0.8rem !important;
    justify-content: center !important;
    align-items: stretch !important;
  }
  /* Cards themselves: width based on content */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    flex: 0 0 auto !important;
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
    box-sizing: border-box !important;
  }
  /* Values: stay single-line so card expands */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    white-space: nowrap !important;
    word-break: normal !important;
    overflow-wrap: normal !important;
  }
}

/* Dynamic Width Mode for Dashboard Metric Cards on Mobile */
@media (max-width: 768px) {
  /* Cards container: flex, active wrapping, row layout, horizontal scroll if needed */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: flex-start !important;
    align-items: stretch !important;
    gap: 0.6rem !important;
    width: 100% !important;
    padding: 0 0.5rem !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  /* Cards: width based on content, prevent stretching to 100% */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    flex: 0 0 auto !important;
    width: auto !important;
    min-width: max-content !important;
    max-width: none !important;
    box-sizing: border-box !important;
    margin: 0 !important;
  }
  /* Values: single-line to increase card width */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    white-space: nowrap !important;
    word-break: normal !important;
    overflow-wrap: normal !important;
  }
}
</style>

<script>
// Manage cards and values on mobile
function optimizeCardsForMobile() {
  if (window.innerWidth <= 768) {
    // Find all cards
    const cards = document.querySelectorAll('div[style*="background:rgba(0,0,0,0.3)"]');
    
    cards.forEach((card, index) => {
      // Fix width
      card.style.width = '100%';
      card.style.maxWidth = '100%';
      card.style.minWidth = '100%';
      card.style.boxSizing = 'border-box';
      card.style.overflow = 'hidden';
      
      // Entry Animation
      card.style.setProperty('--card-index', index.toString());
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      
      // Delay for animation
      setTimeout(() => {
        card.style.transition = 'all 0.4s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 80);
      
      // Optimize values inside card
      const valueElements = card.querySelectorAll('div[style*="font-family:monospace"]');
      valueElements.forEach(valueEl => {
        valueEl.style.wordBreak = 'break-all';
        valueEl.style.overflowWrap = 'break-word';
        valueEl.style.maxWidth = '100%';
        valueEl.style.textAlign = 'center';
        
        // If value is too long, make font smaller
        const text = valueEl.textContent || '';
        if (text.length > 15) {
          valueEl.style.fontSize = '0.9rem';
          valueEl.style.lineHeight = '1.2';
        }
        if (text.length > 25) {
          valueEl.style.fontSize = '0.8rem';
          valueEl.style.lineHeight = '1.1';
        }
      });
    });
    
    // Optimize main container
    const container = document.querySelector('div[style*="display:flex;flex-wrap:wrap"]');
    if (container) {
      container.style.width = '100%';
      container.style.padding = '0 0.5rem';
      container.style.boxSizing = 'border-box';
    }
  }
}

// Manage mobile refresh button
document.addEventListener('DOMContentLoaded', function() {
  // Optimize cards for mobile
  setTimeout(() => {
    optimizeCardsForMobile();
  }, 800);
  
  // Re-optimize when page size changes
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      optimizeCardsForMobile();
    }, 300);
  });
  
  // Re-optimize when values update
  const observer = new MutationObserver(() => {
    if (window.innerWidth <= 768) {
      setTimeout(optimizeCardsForMobile, 200);
    }
  });
  
  // Monitor changes in cards
  const targetNode = document.querySelector('div[style*="display:flex;flex-wrap:wrap"]');
  if (targetNode) {
    observer.observe(targetNode, {
      childList: true,
      subtree: true,
      characterData: true
    });
  }
  
  // Main page codes
});



// End of main scripts



// Voting Functions for Main Section
async function voteForIndexMain(isLike) {
  try {
    const indexInput = document.getElementById('vote-index-input-main');
    const voteResult = document.getElementById('vote-result-main');

    if (!indexInput) {
      throw new Error('Index input field not found');
    }

    const index = parseInt(indexInput.value.trim());

    if (!index || index <= 0) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è Please enter a valid index</span>';
      return;
    }

    if (!window.contractConfig || !window.contractConfig.contract) {
      await window.connectWallet();
    }
    const contract = window.contractConfig.contract;

    if (!contract) {
      throw new Error('Contract not connected');
    }

    // Check wallet connection
    if (!window.contractConfig.signer) {
      throw new Error('Wallet not connected');
    }

    // Get user address from index
    const userAddress = await contract.indexToAddress(index);

    if (userAddress === '0x0000000000000000000000000000000000000000') {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è No user found with this index</span>';
      return;
    }

    // Check if user is trying to vote for themselves
    const currentUserAddress = window.contractConfig.signer.address;
    if (userAddress.toLowerCase() === currentUserAddress.toLowerCase()) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå Cannot vote for yourself</span>';
      return;
    }

    // Show processing message
    voteResult.innerHTML = '<span style="color: #a786ff;">‚è≥ Sending vote...</span>';

    // Send voting transaction
    const tx = await contract.voteUser(userAddress, isLike);

    // Wait for transaction confirmation
    const receipt = await tx.wait();

    // Show success message
    const successMessage = isLike ? '‚úÖ Like successfully registered' : '‚úÖ Dislike successfully registered';
    voteResult.innerHTML = `<span style="color: #00ff88;">${successMessage}</span>`;
    
    // Show alert too
    alert(successMessage);

    // Update user vote status
    updateUserVoteStatus();

    // Update ranking after 2 seconds
    setTimeout(() => {
      if (typeof window.displayTopUsersRanking === 'function') {
        const rankingContainer = document.getElementById('top-users-ranking');
        if (rankingContainer) {
          window.displayTopUsersRanking('top-users-ranking');
        }
      }
    }, 2000);

    return {
      success: true,
      transactionHash: receipt.transactionHash,
      userAddress: userAddress,
      voteType: isLike ? 'like' : 'dislike'
    };

  } catch (error) {
    console.error('‚ùå Error voting for index:', error);
    const voteResult = document.getElementById('vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function voteForSelfMain(isLike) {
  try {
    const voteResult = document.getElementById('vote-result-main');
    
    // Show error message immediately since self-voting is not allowed
    voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå Self-voting is not allowed by the smart contract</span>';
    
    // Show alert
    alert('‚ùå Self-voting is not allowed by the smart contract');
    
    return {
      success: false,
      error: 'Self-voting is not allowed by the smart contract'
    };

  } catch (error) {
    console.error('‚ùå Error voting for self:', error);
    const voteResult = document.getElementById('vote-result-main');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function voteForSelf(isLike) {
  try {
    const voteResult = document.getElementById('vote-result');

    // Show error message immediately since self-voting is not allowed
    voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå Self-voting is not allowed by the smart contract</span>';
    
    // Show alert
    alert('‚ùå Self-voting is not allowed by the smart contract');

    return {
      success: false,
      error: 'Self-voting is not allowed by the smart contract'
    };

  } catch (error) {
    console.error('‚ùå Error voting for self:', error);
    const voteResult = document.getElementById('vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function updateUserVoteStatusMain() {
  try {
    if (!window.contractConfig || !window.contractConfig.contract) {
      return;
    }

    const contract = window.contractConfig.contract;
    const currentUserAddress = window.contractConfig.signer?.address;

    if (!currentUserAddress) {
      return;
    }

    const voteStatus = await contract.getVoteStatus(currentUserAddress);
    const statusElement = document.getElementById('user-vote-status-main');
    
    if (statusElement) {
      const myVote = Number(voteStatus[2]); // 0: no vote, 1: like, 2: dislike
      if (myVote == 1) {
        statusElement.innerHTML = '<span style="color: #00ff88;">‚úì Self-liked</span>';
      } else if (myVote == 2) {
        statusElement.innerHTML = '<span style="color: #ff4444;">‚úó Self-disliked</span>';
      } else {
        statusElement.innerHTML = '<span style="color: #ccc;">Not voted yet</span>';
      }
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è Error updating user vote status:', error);
  }
}

async function updateUserVoteStatus() {
  try {
    if (!window.contractConfig || !window.contractConfig.contract) {
      return;
    }

    const contract = window.contractConfig.contract;
    const currentUserAddress = window.contractConfig.signer?.address;

    if (!currentUserAddress) {
      return;
    }

    const voteStatus = await contract.getVoteStatus(currentUserAddress);
    const statusElement = document.getElementById('user-vote-status');
    
    if (statusElement) {
      const myVote = Number(voteStatus[2]); // 0: no vote, 1: like, 2: dislike
      if (myVote == 1) {
        statusElement.innerHTML = '<span style="color: #00ff88;">‚úì Self-liked</span>';
      } else if (myVote == 2) {
        statusElement.innerHTML = '<span style="color: #ff4444;">‚úó Self-disliked</span>';
      } else {
        statusElement.innerHTML = '<span style="color: #ccc;">Not voted yet</span>';
      }
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è Error updating user vote status:', error);
  }
}

// Make voting functions globally available
window.voteForIndex = voteForIndex;
window.voteForSelf = voteForSelf;
window.updateUserVoteStatus = updateUserVoteStatus;

// Update vote status when wallet connects
document.addEventListener('DOMContentLoaded', function() {
  // Check vote status after wallet connection
  if (window.contractConfig && window.contractConfig.signer) {
    setTimeout(updateUserVoteStatus, 2000);
  }
  
  // Update vote status when user info is displayed
  const userInfoSection = document.getElementById('dashboard-user-info');
  if (userInfoSection) {
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          if (userInfoSection.style.display !== 'none') {
            setTimeout(updateUserVoteStatus, 1000);
          }
        }
      });
    });
    
    observer.observe(userInfoSection, {
      attributes: true,
      attributeFilter: ['style']
    });
  }
});

// Quick traversal functions
async function startQuickTraversal(method = 'bfs') {
  try {
    console.log(`üöÄ Starting quick ${method.toUpperCase()} traversal...`);
    
    const progressElement = document.getElementById('traversal-progress');
    const statusElement = document.getElementById('traversal-status');
    
    if (progressElement) {
      progressElement.style.display = 'block';
    }
    
    if (statusElement) {
      statusElement.textContent = `Starting ${method.toUpperCase()} traversal...`;
    }
    
    // Add event listener for progress updates
    const progressHandler = (event) => {
      const { totalFound, currentIndex, isComplete } = event.detail;
      
      if (statusElement) {
        if (method === 'index') {
          statusElement.textContent = `Processed ${currentIndex} indices, found ${totalFound} users`;
        } else {
          statusElement.textContent = `Found ${totalFound} users so far...`;
        }
      }
      
      if (isComplete) {
        if (statusElement) {
          statusElement.textContent = `‚úÖ Traversal completed! Found ${totalFound} users`;
        }
        
        // Hide progress after 3 seconds
        setTimeout(() => {
          if (progressElement) {
            progressElement.style.display = 'none';
          }
        }, 3000);
        
        // Remove event listener
        document.removeEventListener('traversalProgress', progressHandler);
      }
    };
    
    document.addEventListener('traversalProgress', progressHandler);
    
    let users;
    
                   switch (method.toLowerCase()) {
        case 'bfs':
          users = await window.traverseAllUsers('bfs', 1, 50);
          break;
        case 'dfs':
          users = await window.traverseAllUsers('dfs', 1, 50);
          break;
        case 'index':
          users = await window.traverseAllUsers('index', 1, 50);
          break;
        case 'unlimited':
          users = await window.traverseAllUsers('unlimited', 1, 50);
          break;
        default:
          users = await window.traverseAllUsers('bfs', 1, 50);
      }
    
    console.log(`‚úÖ Quick ${method.toUpperCase()} traversal completed! Found ${users.length} users`);
    
    // Show success message
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #00ff88;">‚úÖ Found ${users.length} users! Results cached.</span>`;
    }
    
    // Update ranking with new data
    setTimeout(() => {
      if (typeof window.displayTopUsersRanking === 'function') {
        const rankingContainer = document.getElementById('top-users-ranking');
        if (rankingContainer) {
          window.displayTopUsersRanking('top-users-ranking');
        }
      }
    }, 2000);
    
    return users;
    
  } catch (error) {
    console.error('‚ùå Error in quick traversal:', error);
    
    const statusElement = document.getElementById('traversal-status');
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    
    // Hide progress after 5 seconds
    setTimeout(() => {
      const progressElement = document.getElementById('traversal-progress');
      if (progressElement) {
        progressElement.style.display = 'none';
      }
    }, 5000);
    
    throw error;
  }
}

function stopQuickTraversal() {
  try {
    window.stopTraversal();
    
    const statusElement = document.getElementById('traversal-status');
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #ffaa00;">‚èπÔ∏è Traversal stopped by user</span>`;
    }
    
    // Hide progress after 3 seconds
    setTimeout(() => {
      const progressElement = document.getElementById('traversal-progress');
      if (progressElement) {
        progressElement.style.display = 'none';
      }
    }, 3000);
    
    console.log('‚èπÔ∏è Quick traversal stopped by user');
    
  } catch (error) {
    console.error('‚ùå Error stopping traversal:', error);
  }
}

// Make functions globally available
window.startQuickTraversal = startQuickTraversal;
window.stopQuickTraversal = stopQuickTraversal;

// Toggle voting section visibility
function toggleVotingSection() {
  const userInfoSection = document.getElementById('dashboard-user-info');
  if (userInfoSection) {
    const currentDisplay = userInfoSection.style.display;
    if (currentDisplay === 'none' || currentDisplay === '') {
      userInfoSection.style.display = 'block';
      console.log('‚úÖ Voting section is now visible');
    } else {
      userInfoSection.style.display = 'none';
      console.log('‚ùå Voting section is now hidden');
    }
  } else {
    console.error('‚ùå Voting section not found');
  }
}

// Make toggle function globally available
window.toggleVotingSection = toggleVotingSection;

// Popup Voting Functions
async function voteForIndexPopup(isLike) {
  try {
    const indexInput = document.getElementById('vote-index-popup');
    const voteResult = document.getElementById('vote-result-popup');

    if (!indexInput) {
      throw new Error('Index input field not found');
    }

    const index = parseInt(indexInput.value.trim());

    if (!index || index <= 0) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è Please enter a valid index</span>';
      return;
    }

    if (!window.contractConfig || !window.contractConfig.contract) {
      await window.connectWallet();
    }
    const contract = window.contractConfig.contract;

    if (!contract) {
      throw new Error('Contract not connected');
    }

    // Check wallet connection
    if (!window.contractConfig.signer) {
      throw new Error('Wallet not connected');
    }

    // Get user address from index
    const userAddress = await contract.indexToAddress(index);

    if (userAddress === '0x0000000000000000000000000000000000000000') {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è No user found with this index</span>';
      return;
    }

    // Check if user is trying to vote for themselves
    const currentUserAddress = window.contractConfig.signer.address;
    if (userAddress.toLowerCase() === currentUserAddress.toLowerCase()) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå Cannot vote for yourself</span>';
      return;
    }

    // Show processing message
    voteResult.innerHTML = '<span style="color: #a786ff;">‚è≥ Sending vote...</span>';

    // Send voting transaction
    const tx = await contract.voteUser(userAddress, isLike);

    // Wait for transaction confirmation
    const receipt = await tx.wait();

    // Show success message
    const successMessage = isLike ? '‚úÖ Like successfully registered' : '‚úÖ Dislike successfully registered';
    voteResult.innerHTML = `<span style="color: #00ff88;">${successMessage}</span>`;
    
    // Show alert too
    alert(successMessage);

    // Close popup after 2 seconds
    setTimeout(() => {
      closeVotingPopup();
    }, 2000);

    // Update ranking after 2 seconds
    setTimeout(() => {
      if (typeof window.displayTopUsersRanking === 'function') {
        const rankingContainer = document.getElementById('top-users-ranking');
        if (rankingContainer) {
          window.displayTopUsersRanking('top-users-ranking');
        }
      }
    }, 2000);

    return {
      success: true,
      transactionHash: receipt.transactionHash,
      userAddress: userAddress,
      voteType: isLike ? 'like' : 'dislike'
    };

  } catch (error) {
    console.error('‚ùå Error voting for index:', error);
    const voteResult = document.getElementById('vote-result-popup');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function voteForSelfPopup(isLike) {
  try {
    const voteResult = document.getElementById('vote-result-popup');
    
    // Show error message immediately since self-voting is not allowed
    voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå Self-voting is not allowed by the smart contract</span>';
    
    // Show alert
    alert('‚ùå Self-voting is not allowed by the smart contract');
    
    return {
      success: false,
      error: 'Self-voting is not allowed by the smart contract'
    };

  } catch (error) {
    console.error('‚ùå Error voting for self:', error);
    const voteResult = document.getElementById('vote-result-popup');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

// Make popup functions globally available
window.voteForIndexPopup = voteForIndexPopup;
window.voteForSelfPopup = voteForSelfPopup;
window.showVotingPopup = showVotingPopup;
window.closeVotingPopup = closeVotingPopup;
window.loadTopUsersInPopup = loadTopUsersInPopup;
window.displayTopUsersInPopup = displayTopUsersInPopup;
window.selectUserForVoting = selectUserForVoting;
window.testTopUsersLoading = testTopUsersLoading;

// Test function for debugging
async function testTopUsersLoading() {
  console.log('üß™ Testing top users loading...');
  
  // Test 1: Check wallet connection
  console.log('üîç Test 1: Wallet connection');
  console.log('contractConfig:', !!window.contractConfig);
  console.log('contract:', !!window.contractConfig?.contract);
  
  if (!window.contractConfig?.contract) {
    console.log('‚ö†Ô∏è No contract available, trying to connect...');
    try {
      await window.connectWallet();
      console.log('‚úÖ Wallet connected successfully');
    } catch (error) {
      console.error('‚ùå Failed to connect wallet:', error);
      return;
    }
  }
  
  // Test 2: Simple manual test with first 10 users
  console.log('üîç Test 2: Manual test with first 10 users');
  try {
    const contract = window.contractConfig.contract;
    const testUsers = [];
    
    for (let i = 1; i <= 10; i++) {
      try {
        console.log(`üîç Testing user ${i}...`);
        const address = await contract.indexToAddress(i);
        console.log(`User ${i} address:`, address);
        
        if (address && address !== '0x0000000000000000000000000000000000000000') {
          const likeCount = await contract.likeCount(address);
          console.log(`User ${i} likes:`, likeCount);
          
          if (Number(likeCount) > 0) {
            testUsers.push({
              index: i,
              address: address,
              likeCount: Number(likeCount)
            });
            console.log(`‚úÖ Added user ${i} with ${likeCount} likes`);
          }
        }
        
        // Small delay to avoid RPC issues
        await new Promise(resolve => setTimeout(resolve, 200));
        
      } catch (error) {
        console.log(`‚ùå Error checking user ${i}:`, error.message);
      }
    }
    
    console.log('‚úÖ Manual test result:', testUsers);
    
    // Update popup with manual results
    const listContainer = document.getElementById('top-users-popup-list');
    if (listContainer && testUsers.length > 0) {
      displayTopUsersInPopup(testUsers);
      console.log('‚úÖ Updated popup with test results');
    } else if (listContainer) {
      listContainer.innerHTML = `
        <div style="text-align: center; color: #ccc; font-size: 0.8rem; padding: 1rem;">
          <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">üìä</div>
          <div style="font-weight: bold; margin-bottom: 0.3rem;">Manual test completed</div>
          <div style="font-size: 0.7rem;">No users with likes found in first 10 users</div>
          <div style="font-size: 0.6rem; margin-top: 0.5rem; color: #888;">üí° Users with likes might be in higher indexes</div>
        </div>
      `;
      console.log('‚úÖ Updated popup with no results message');
    }
  } catch (error) {
    console.error('‚ùå Manual test error:', error);
  }
}

// Load top users in popup
async function loadTopUsersInPopup() {
  try {
    const listContainer = document.getElementById('top-users-popup-list');
    if (!listContainer) {
      console.error('‚ùå top-users-popup-list container not found');
      return;
    }
    
    console.log('üîÑ Starting to load top users in popup...');
    listContainer.innerHTML = '<div style="text-align: center; color: #ccc; font-size: 0.8rem; padding: 1rem;">üîÑ Searching for users with likes...</div>';
    
    // Check wallet connection
    if (!window.contractConfig || !window.contractConfig.contract) {
      console.log('‚ö†Ô∏è Wallet not connected, attempting to connect...');
      try {
        await window.connectWallet();
      } catch (error) {
        console.error('‚ùå Failed to connect wallet:', error);
        listContainer.innerHTML = '<div style="text-align: center; color: #ff4444; font-size: 0.8rem; padding: 1rem;">Please connect your wallet first</div>';
        return;
      }
    }
    
    console.log('‚úÖ Wallet connected, contract available:', !!window.contractConfig?.contract);
    
    // Try a simpler approach first - check first 20 users manually
    console.log('üîç Trying simple manual approach for first 20 users...');
    const contract = window.contractConfig.contract;
    const topUsers = [];
    
    for (let i = 1; i <= 20; i++) {
      try {
        console.log(`üîç Checking user ${i}...`);
        const address = await contract.indexToAddress(i);
        console.log(`User ${i} address:`, address);
        
        if (address && address !== '0x0000000000000000000000000000000000000000') {
          const likeCount = await contract.likeCount(address);
          console.log(`User ${i} likes:`, likeCount);
          
          if (Number(likeCount) > 0) {
            topUsers.push({
              index: i,
              address: address,
              likeCount: Number(likeCount)
            });
            console.log(`‚úÖ Added user ${i} with ${likeCount} likes`);
          }
        }
      } catch (error) {
        console.log(`‚ùå Error checking user ${i}:`, error.message);
        // Continue with next user
      }
      
      // Small delay to avoid overwhelming the RPC
      await new Promise(resolve => setTimeout(resolve, 100));
    }
    
    console.log('üìã Found users with likes:', topUsers);
    
    if (topUsers.length === 0) {
      console.log('üìä No users with likes found in first 20 users');
      listContainer.innerHTML = `
        <div style="text-align: center; color: #ccc; font-size: 0.8rem; padding: 1rem;">
          <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">üìä</div>
          <div style="font-weight: bold; margin-bottom: 0.3rem;">No users with likes found</div>
          <div style="font-size: 0.7rem;">In the first 20 users, no one has received likes</div>
          <div style="font-size: 0.6rem; margin-top: 0.5rem; color: #888;">üí° You can be the first to receive likes!</div>
        </div>
      `;
      return;
    }
    
    // Sort by like count (descending) and take top 10
    const sortedUsers = topUsers
      .sort((a, b) => b.likeCount - a.likeCount)
      .slice(0, 10);
    
    console.log('üèÜ Final sorted users:', sortedUsers);
    displayTopUsersInPopup(sortedUsers);
    
  } catch (error) {
    console.error('‚ùå Error loading top users in popup:', error);
    const listContainer = document.getElementById('top-users-popup-list');
    if (listContainer) {
      listContainer.innerHTML = `<div style="text-align: center; color: #ff4444; font-size: 0.8rem; padding: 1rem;">Error loading users: ${error.message}</div>`;
    }
  }
}

// Display top users in popup
function displayTopUsersInPopup(users) {
  const listContainer = document.getElementById('top-users-popup-list');
  if (!listContainer) return;
  
  if (!users || users.length === 0) {
    listContainer.innerHTML = `
      <div style="text-align: center; color: #ccc; font-size: 0.8rem; padding: 1rem;">
        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">üìä</div>
        <div style="font-weight: bold; margin-bottom: 0.3rem;">No users with likes found</div>
        <div style="font-size: 0.7rem;">No users have received likes yet</div>
        <div style="font-size: 0.6rem; margin-top: 0.5rem; color: #888;">üí° You can be the first to receive likes!</div>
      </div>
    `;
    return;
  }
  
  let usersHtml = '';
  users.forEach((user, index) => {
    const rank = index + 1;
    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
    const rankColor = rank === 1 ? '#ffd700' : rank === 2 ? '#c0c0c0' : rank === 3 ? '#cd7f32' : '#a786ff';
    
    usersHtml += `
      <div onclick="selectUserForVoting(${user.index})" 
           style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; margin-bottom: 0.3rem; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(0,255,136,0.1); cursor: pointer; transition: all 0.2s ease; hover:background: rgba(0,255,136,0.1);">
        <div style="text-align: center; min-width: 30px;">
          <div style="color: ${rankColor}; font-size: 0.9rem; font-weight: bold;">${medal}</div>
        </div>
        <div style="flex: 1; min-width: 0;">
          <div style="color: #00ff88; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.2rem;">
            IAM${user.index.toString().padStart(5, '0')}
          </div>
          <div style="color: #ccc; font-size: 0.6rem; font-family: monospace; word-break: break-all;">
            ${user.address.substring(0, 6)}...${user.address.substring(user.address.length - 4)}
          </div>
        </div>
        <div style="text-align: center; min-width: 40px;">
          <div style="color: #00ff88; font-size: 0.8rem; font-weight: bold;">${user.likeCount}</div>
          <div style="color: #ccc; font-size: 0.5rem;">Likes</div>
        </div>
      </div>
    `;
  });
  
  listContainer.innerHTML = usersHtml;
}

// Select user for voting
function selectUserForVoting(index) {
  const indexInput = document.getElementById('vote-index-popup');
  if (indexInput) {
    indexInput.value = index;
    // Highlight the input briefly
    indexInput.style.borderColor = '#00ff88';
    indexInput.style.boxShadow = '0 0 10px rgba(0,255,136,0.3)';
    setTimeout(() => {
      indexInput.style.borderColor = 'rgba(0,255,136,0.3)';
      indexInput.style.boxShadow = 'none';
    }, 1000);
  }
}

// Modified showVotingPopup function to load top users
function showVotingPopup() {
  const popup = document.getElementById('voting-popup');
  if (popup) {
    popup.style.display = 'block';
    document.body.style.overflow = 'hidden';
    // Load top users when popup opens
    setTimeout(() => {
      loadTopUsersInPopup();
    }, 100);
  }
}

// Close voting popup function
function closeVotingPopup() {
  const popup = document.getElementById('voting-popup');
  if (popup) {
    popup.style.display = 'none';
    document.body.style.overflow = 'auto';
  }
}

// Popular Indexes Functions
function togglePopularIndexes() {
  const content = document.getElementById('popular-indexes-content');
  const toggleBtn = document.getElementById('popular-indexes-toggle');
  
  if (content.style.display === 'none' || !content.style.display) {
    content.style.display = 'block';
    toggleBtn.innerHTML = 'üìä Hide Most Popular';
    toggleBtn.style.background = 'linear-gradient(135deg,#ff4444,#cc3333)';
    loadPopularIndexes();
  } else {
    content.style.display = 'none';
    toggleBtn.innerHTML = 'üìä Show Most Popular';
    toggleBtn.style.background = 'linear-gradient(135deg,#00ff88,#00cc6a)';
  }
}

async function loadPopularIndexes() {
  try {
    const listContainer = document.getElementById('popular-indexes-list');
    listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">Loading most popular indexes...</div>';
    
    if (!window.contractConfig || !window.contractConfig.contract) {
      listContainer.innerHTML = '<div style="text-align: center; color: #ff4444; font-size: 0.9rem; padding: 2rem;">Please connect your wallet first</div>';
      return;
    }
    
    const contract = window.contractConfig.contract;
    
    // Get top users (we'll use the existing ranking function if available)
    if (typeof window.displayTopUsersRanking === 'function') {
      // Use existing ranking function
      const popularUsers = await getTopUsersByLikes(10);
      displayPopularIndexes(popularUsers);
    } else {
      // Fallback: show a simple list
      listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">Ranking system not available</div>';
    }
    
  } catch (error) {
    console.error('‚ùå Error loading popular indexes:', error);
    const listContainer = document.getElementById('popular-indexes-list');
    listContainer.innerHTML = `<div style="text-align: center; color: #ff4444; font-size: 0.9rem; padding: 2rem;">Error loading: ${error.message}</div>`;
  }
}

async function getTopUsersByLikes(limit = 10) {
  try {
    const contract = window.contractConfig.contract;
    const users = [];
    
    // Check first 50 users for likes
    for (let i = 1; i <= 50; i++) {
      try {
        const userAddress = await contract.indexToAddress(i);
        if (userAddress && userAddress !== '0x0000000000000000000000000000000000000000') {
          const likeCount = await contract.likeCount(userAddress);
          
          if (Number(likeCount) > 0) {
            users.push({
              index: i,
              address: userAddress,
              likeCount: Number(likeCount)
            });
          }
        }
      } catch (error) {
        console.log(`Error getting user ${i}:`, error.message);
        continue;
      }
    }
    
    // Sort by like count (descending)
    users.sort((a, b) => b.likeCount - a.likeCount);
    
    return users.slice(0, limit);
    
  } catch (error) {
    console.error('‚ùå Error getting top users:', error);
    return [];
  }
}

function displayPopularIndexes(users) {
  const listContainer = document.getElementById('popular-indexes-list');
  
  if (!users || users.length === 0) {
    listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">No users found</div>';
    return;
  }
  
  let html = '';
  users.forEach((user, index) => {
    const rank = index + 1;
    const rankEmoji = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : `#${rank}`;
    const shortAddress = user.address.substring(0, 6) + '...' + user.address.substring(user.address.length - 4);
    
    html += `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; margin-bottom: 0.5rem; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid rgba(0,255,136,0.2);">
        <div style="display: flex; align-items: center; gap: 0.8rem;">
          <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;">${rankEmoji}</div>
          <div>
            <div style="color: #fff; font-weight: bold; font-size: 0.9rem;">Index ${user.index}</div>
            <div style="color: #ccc; font-size: 0.8rem; font-family: monospace;">${shortAddress}</div>
          </div>
        </div>
        <div style="text-align: right;">
          <div style="color: #00ff88; font-weight: bold; font-size: 0.9rem;">üëç ${user.likeCount}</div>
        </div>
      </div>
    `;
  });
  
  listContainer.innerHTML = html;
}

async function voteForPopularIndex(isLike) {
  try {
    const indexInput = document.getElementById('popular-vote-index');
    const voteResult = document.getElementById('popular-vote-result');
    
    if (!indexInput) {
      throw new Error('Index input field not found');
    }
    
    const index = parseInt(indexInput.value.trim());
    
    if (!index || index <= 0) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è Please enter a valid index</span>';
      return;
    }
    
    if (!window.contractConfig || !window.contractConfig.contract) {
      await window.connectWallet();
    }
    const contract = window.contractConfig.contract;
    
    if (!contract) {
      throw new Error('ŸÇÿ±ÿßÿ±ÿØÿßÿØ ŸÖÿ™ÿµŸÑ ŸÜ€åÿ≥ÿ™');
    }
    
    // Check wallet connection
    if (!window.contractConfig.signer) {
      throw new Error('⁄©€åŸÅ ŸæŸàŸÑ ŸÖÿ™ÿµŸÑ ŸÜ€åÿ≥ÿ™');
    }
    
    // Get user address from index
    const userAddress = await contract.indexToAddress(index);
    
    if (userAddress === '0x0000000000000000000000000000000000000000') {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ö†Ô∏è No user found with this index</span>';
      return;
    }
    
    // Check if user is trying to vote for themselves
    const currentUserAddress = window.contractConfig.signer.address;
    if (userAddress.toLowerCase() === currentUserAddress.toLowerCase()) {
      voteResult.innerHTML = '<span style="color: #ff4444;">‚ùå You cannot vote for yourself</span>';
      return;
    }
    
    // Show processing message
    voteResult.innerHTML = '<span style="color: #a786ff;">‚è≥ Sending vote...</span>';
    
    // Send voting transaction
    const tx = await contract.voteUser(userAddress, isLike);
    
    // Wait for transaction confirmation
    const receipt = await tx.wait();
    
    // Show success message
    const successMessage = isLike ? '‚úÖ Like successfully registered' : '‚úÖ Dislike successfully registered';
    voteResult.innerHTML = `<span style="color: #00ff88;">${successMessage}</span>`;
    
    // Clear input
    indexInput.value = '';
    
    // Show alert too
    alert(successMessage);
    
    // Refresh popular indexes list after 2 seconds
    setTimeout(() => {
      loadPopularIndexes();
    }, 2000);
    
    return {
      success: true,
      transactionHash: receipt.transactionHash,
      userAddress: userAddress,
      voteType: isLike ? 'like' : 'dislike'
    };
    
  } catch (error) {
    console.error('‚ùå Error voting for popular index:', error);
    const voteResult = document.getElementById('popular-vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">‚ùå Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

function refreshPopularIndexes() {
  loadPopularIndexes();
}

// Make popular indexes functions globally available
window.togglePopularIndexes = togglePopularIndexes;
window.loadPopularIndexes = loadPopularIndexes;
window.voteForPopularIndex = voteForPopularIndex;
window.refreshPopularIndexes = refreshPopularIndexes;



</script>

<!-- Floating Token Growth Card - ⁄©ÿßÿ±ÿ™ ÿ¥ŸÜÿßŸàÿ± ÿ±ÿ¥ÿØ ÿ™Ÿà⁄©ŸÜ -->
<script src="js/floating-token-card.js"></script>

<!-- ÿßÿπŸÖÿßŸÑ ÿ™ŸÖ ŸÖÿØÿ±ŸÜ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('üé® ÿßÿπŸÖÿßŸÑ ÿ™ŸÖ ŸÖÿØÿ±ŸÜ ŸÜÿßÿ±ŸÜÿ¨€å Ÿà ÿ®ŸÜŸÅÿ¥...');
  
  // Apply modern-card class to all existing cards
  const cards = document.querySelectorAll('.dashboard-card');
  cards.forEach(card => {
    if (!card.classList.contains('modern-card')) {
      card.classList.add('modern-card');
    }
  });
  
  // Apply modern-btn class to all buttons
  const buttons = document.querySelectorAll('button');
  buttons.forEach(button => {
    if (!button.classList.contains('modern-btn')) {
      button.classList.add('modern-btn', 'modern-btn-primary');
    }
  });
  
  // Apply modern-input class to all input fields
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    if (!input.classList.contains('modern-input')) {
      input.classList.add('modern-input');
    }
  });
  
  console.log('‚úÖ ÿ™ŸÖ ŸÖÿØÿ±ŸÜ ŸÜÿßÿ±ŸÜÿ¨€å Ÿà ÿ®ŸÜŸÅÿ¥ ÿßÿπŸÖÿßŸÑ ÿ¥ÿØ');
});
</script>

</body>
</html>
</html>