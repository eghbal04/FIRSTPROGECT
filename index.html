<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>IAMPHOENIX</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=1.1">
    <link rel="stylesheet" href="css/index-custom.css">
    <link rel="stylesheet" href="css/floating-ai-assistant.css">
    <link rel="stylesheet" href="css/smooth-transitions.css">

    <link rel="stylesheet" href="css/modern-theme.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">


    <style>
      /* User Status Bar Animations */
      @keyframes pulse {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.1); }
        100% { opacity: 1; transform: scale(1); }
      }

      @keyframes cardGlow {
        0%, 100% { box-shadow: 0 2px 8px rgba(0,255,136,0.1); }
        50% { box-shadow: 0 4px 16px rgba(0,255,136,0.3); }
      }
      
      @keyframes cardFloat {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-2px); }
      }
      
      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      
      /* Dynamic Card Styles */
      .status-card {
        position: relative;
        overflow: hidden;
        cursor: pointer;
      }
      
      .status-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.5s;
        z-index: 1;
      }
      
      .status-card:hover::before {
        left: 100%;
      }
      
      .status-card:hover {
        animation: cardFloat 0.6s ease-in-out;
      }
      
      .user-id-card:hover {
        animation: cardGlow 2s infinite;
      }
      
      .wallet-card:hover {
        animation: cardGlow 2s infinite;
      }
      
      .likes-card:hover {
        animation: cardGlow 2s infinite;
      }
      
      .dislikes-card:hover {
        animation: cardGlow 2s infinite;
      }
      
      /* Content-based sizing */
      .status-card[data-content-length="short"] {
        max-width: 120px !important;
      }
      
      .status-card[data-content-length="medium"] {
        max-width: 200px !important;
      }
      
      .status-card[data-content-length="long"] {
        max-width: 300px !important;
      }
      
      .status-card[data-content-length="very-long"] {
        max-width: 400px !important;
      }

      /* Mobile Responsive for User Status Bar */
      @media (max-width: 768px) {
        .user-status-container {
          padding: 0.8rem !important;
        }
        
        .user-status-container > div:first-child {
          gap: 0.5rem !important;
          overflow-x: auto !important;
          padding-bottom: 0.5rem !important;
        }
        
        .user-status-container > div:first-child > div {
          min-width: 100px !important;
          flex-shrink: 0 !important;
        }
        
        .status-card {
          margin-bottom: 0.5rem;
        }
        
        .status-card:hover {
          transform: scale(1.01) !important;
        }
        
        /* Star rating responsive */
        #user-star-rating {
          top: 0.3rem !important;
          left: 0.3rem !important;
          padding: 0.2rem 0.4rem !important;
        }
        
        #user-star-count {
          font-size: 0.7rem !important;
        }
      }

      @media (max-width: 480px) {
        .user-status-container {
          padding: 0.6rem !important;
        }
        
        .user-status-container > div:first-child {
          gap: 0.4rem !important;
        }
        
        .user-status-container > div:first-child > div {
          min-width: 80px !important;
          padding: 0.4rem !important;
        }
        
        .status-card {
          padding: 0.4rem !important;
          min-width: 100px !important;
        }
        
        .status-card > div {
          font-size: 0.7rem !important;
        }
        
        .user-status-container > div:first-child > div > div:first-child {
          font-size: 0.8rem !important;
        }
        
        .user-status-container > div:first-child > div > div > div {
          font-size: 0.6rem !important;
        }
        
        /* Star rating responsive for small screens */
        #user-star-rating {
          top: 0.2rem !important;
          left: 0.2rem !important;
          padding: 0.15rem 0.3rem !important;
          gap: 0.1rem !important;
        }
        
        #user-star-count {
          font-size: 0.6rem !important;
        }
        
        #user-star-rating span:last-child {
          font-size: 0.6rem !important;
        }
      }
    </style>

    <!-- Loading ethers.js version 6 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
    <!-- Loading WalletConnect Provider from official CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- Loading WalletConnect Handler -->
    <script src="js/walletconnect-handler.js?v=5.7"></script>
    <script src="js/mobile-navigation.js"></script>
    <script src="js/mobile-optimizer.js"></script>


      <!-- Loading WalletConnect UMD locally -->
  <script src="js/walletconnect-v1.8.0.js"></script>
  
  <!-- Binary Tree Traversal System -->
  <script src="js/binary-tree-traversal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="js/auth-redirect.js"></script>
  <script src="js/modern-theme-variables.js"></script>
  
</head>
<body>

  <div id="main-dashboard" class="page-section" style="position:relative;overflow:visible;">

    <!-- User Status Bar -->
    <div id="user-status-bar" class="user-status-container" style="display:block;background:linear-gradient(135deg,rgba(35,41,70,0.95),rgba(24,28,42,0.95));border:1px solid rgba(0,255,136,0.2);border-radius:16px;padding:1rem;margin:1rem auto;max-width:1400px;backdrop-filter:blur(10px);box-shadow:0 8px 32px rgba(0,0,0,0.3);position:relative;">
     

      
      <div style="display:flex;flex-wrap:nowrap;gap:0.8rem;align-items:center;justify-content:space-between;overflow-x:auto;">
        <!-- User ID Section -->
                        <div class="status-card user-id-card" style="display:flex;align-items:center;gap:0.5rem;flex:1;min-width:120px;max-width:250px;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);border-radius:10px;padding:0.6rem;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);transform:scale(1);box-shadow:0 2px 8px rgba(0,255,136,0.1);" onmouseenter="this.style.transform='scale(1.02)';this.style.boxShadow='0 4px 16px rgba(0,255,136,0.2)'" onmouseleave="this.style.transform='scale(1)';this.style.boxShadow='0 2px 8px rgba(0,255,136,0.1)'">
          <div style="flex:1;min-width:0;">
            <div style="color:#00ff88;font-size:0.7rem;font-weight:600;margin-bottom:0.1rem;white-space:nowrap;">User ID</div>
            <div style="color:#e0e6f7;font-size:0.8rem;font-weight:bold;font-family:monospace;word-break:break-all;overflow:hidden;text-overflow:ellipsis;" id="user-status-id-value">Not Connected</div>
          </div>
        </div>

        <!-- Wallet Address Section -->
        <div class="status-card wallet-card" style="display:flex;align-items:center;gap:0.5rem;flex:1.5;min-width:150px;max-width:280px;background:rgba(167,134,255,0.1);border:1px solid rgba(167,134,255,0.3);border-radius:10px;padding:0.5rem;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);transform:scale(1);box-shadow:0 2px 8px rgba(167,134,255,0.1);" onmouseenter="this.style.transform='scale(1.02)';this.style.boxShadow='0 4px 16px rgba(167,134,255,0.2)'" onmouseleave="this.style.transform='scale(1)';this.style.boxShadow='0 2px 8px rgba(167,134,255,0.1)'">
          <div style="flex:1;min-width:0;">
            <div style="color:#a786ff;font-size:0.6rem;font-weight:600;margin-bottom:0.1rem;white-space:nowrap;">Wallet Address</div>
            <div style="color:#e0e6f7;font-size:0.65rem;font-family:monospace;word-break:break-all;padding:0.1rem;border-radius:4px;overflow:hidden;text-overflow:ellipsis;cursor:pointer;" id="user-status-wallet" title="Click to copy">Not Connected</div>
          </div>
        </div>

        <!-- Likes Section -->
        <div class="status-card likes-card" style="display:flex;flex-direction:column;align-items:center;gap:0.15rem;flex:1;min-width:60px;max-width:100px;background:rgba(40,167,69,0.1);border:1px solid rgba(40,167,69,0.3);border-radius:8px;padding:0.4rem;text-align:center;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);transform:scale(1);box-shadow:0 2px 8px rgba(40,167,69,0.1);" onmouseenter="this.style.transform='scale(1.02)';this.style.boxShadow='0 4px 16px rgba(40,167,69,0.2)'" onmouseleave="this.style.transform='scale(1)';this.style.boxShadow='0 2px 8px rgba(40,167,69,0.1)'">
          <div style="color:#28a745;font-size:0.65rem;font-weight:bold;font-family:monospace;overflow:hidden;text-overflow:ellipsis;" id="user-status-likes">0</div>
          <div style="color:#28a745;font-size:0.8rem;flex-shrink:0;">ğŸ‘</div>
        </div>

        <!-- Dislikes Section -->
        <div class="status-card dislikes-card" style="display:flex;flex-direction:column;align-items:center;gap:0.15rem;flex:1;min-width:60px;max-width:100px;background:rgba(220,53,69,0.1);border:1px solid rgba(220,53,69,0.3);border-radius:8px;padding:0.4rem;text-align:center;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);transform:scale(1);box-shadow:0 2px 8px rgba(220,53,69,0.1);" onmouseenter="this.style.transform='scale(1.02)';this.style.boxShadow='0 4px 16px rgba(220,53,69,0.2)'" onmouseleave="this.style.transform='scale(1)';this.style.boxShadow='0 2px 8px rgba(220,53,69,0.1)'">
          <div style="color:#dc3545;font-size:0.65rem;font-weight:bold;font-family:monospace;overflow:hidden;text-overflow:ellipsis;" id="user-status-dislikes">0</div>
          <div style="color:#dc3545;font-size:0.8rem;flex-shrink:0;">ğŸ‘</div>
        </div>
      </div>
    </div>

    <div class="dashboard-cards" style="display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;max-width:1400px;margin:0 auto;">
      <!-- AI Assistant will be inserted here by JavaScript -->

      <!-- Blockchain Information Cards -->
      <div class="modern-card dashboard-card" style="min-width:100%;max-width:100%;margin:1rem 0;width:100%;padding:1.5rem;position:relative;overflow:hidden;">
        <div style="position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,#00ff88,#a786ff,#00ff88);animation:shimmer 2s linear infinite;"></div>
        
        <div style="text-align:center;margin-bottom:1.5rem;">
                <!-- Star Rating - Top Left Corner -->
      <div id="user-star-rating" style="position:absolute;top:0.5rem;left:0.5rem;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:8px;padding:0.3rem 0.5rem;display:flex;align-items:center;gap:0.2rem;z-index:10;">
          <span style="color:#ffd700;font-size:0.8rem;font-weight:bold;" id="user-star-count">0</span>
          </div>
          <h3 style="color:#00ff88;font-size:1.2rem;font-weight:bold;margin:0;font-family:monospace;">IAMPHOENIX</h3>
        </div>
        

        
        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;">
          <!-- 1. Total Supply - First Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ’°</div>
                          <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Total Supply</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="circulating-supply" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM Tokens</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="circulating-supply-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">â‰ˆ DAI</div>
          </div>
          
          <!-- 2. IAM Binary Pool - Second Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(255,193,7,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#ffc107;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ¦</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Binary Pool</div>
            <div style="color:#ffc107;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="contract-token-balance" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM in Binary Pool</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="contract-token-balance-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">â‰ˆ DAI</div>
          </div>
          
          <!-- 3. DAI Baking Pool - Third Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,123,255,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#007bff;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ’µ</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Baking Pool</div>
            <div style="color:#007bff;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-dai-balance" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">DAI in Baking Pool</div>
          </div>
          
          <!-- 4. Token Price - Fourth Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ’²</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">IAM Token Price</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-token-price" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">DAI per IAM</div>
          </div>
          
          <!-- 5. Registration Price - Fifth Priority -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(138,43,226,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#8a2be2;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ«</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Registration Price</div>
            <div style="color:#8a2be2;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-registration-price" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM per Registration</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-registration-price-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">â‰ˆ DAI</div>
          </div>
          
          <!-- Other Cards -->
          
          <!-- Total Points Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(167,134,255,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#a786ff;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ¯</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Total Points</div>
            <div style="color:#a786ff;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="total-points" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Binary Points</div>
          </div>
          
          <!-- Point Value Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#00ff88;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ’</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Point Value</div>
            <div style="color:#00ff88;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-point-value" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">IAM per Point</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-point-value-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">â‰ˆ DAI</div>
          </div>
          
          <!-- Help Fund Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(220,53,69,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#dc3545;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ’</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Help Fund</div>
            <div style="color:#dc3545;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-cashback-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Cashback Pool</div>
            <div style="color:#f7931e;font-size:0.7rem;font-family:monospace;font-weight:bold;margin-top:0.2rem;" id="dashboard-cashback-value-dai">-</div>
            <div style="color:#888;font-size:0.6rem;margin-top:0.1rem;">â‰ˆ DAI</div>
          </div>
          
          <!-- Wallet Count Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(255,165,0,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#ffa500;font-size:1.2rem;margin-bottom:0.3rem;">ğŸ‘›</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Wallet Count</div>
            <div style="color:#ffa500;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="dashboard-wallets-count" class="dashboard-value smooth-value-transition numeric-value">-</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Connected Wallets</div>
          </div>
          
          <!-- Network Status Card -->
          <div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid rgba(40,167,69,0.2);text-align:center;min-width:140px;flex:1;max-width:180px;">
            <div style="color:#28a745;font-size:1.2rem;margin-bottom:0.3rem;">ğŸŒ</div>
            <div style="color:#fff;font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;">Network Status</div>
            <div style="color:#28a745;font-size:0.9rem;font-family:monospace;font-weight:bold;" id="network-status">Polygon</div>
            <div style="color:#888;font-size:0.7rem;margin-top:0.2rem;">Active</div>
          </div>
        </div>
        
        <!-- Last Update Info -->
        <div style="text-align:center;margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.1);">
          <div style="color:#888;font-size:0.8rem;font-family:monospace;margin-bottom:0.5rem;">
            Last Update: <span id="blockchain-last-update">-</span>
          </div>
          <!-- Update button removed -->
        </div>
        

      </div>



      <!-- Voting System Section (Hidden by default) -->
      <div id="voting-system-section" class="modern-card" style="margin-top: 2rem; padding: 1.5rem; display: none;">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h3 style="color: #00ff88; font-size: 1.3rem; font-weight: bold; margin: 0; margin-bottom: 0.5rem;">ğŸ—³ï¸ Voting System</h3>
          <p style="color: #ccc; font-size: 0.9rem; margin: 0;">Vote for other users in the network (self-voting not allowed)</p>
        </div>
        
        <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; align-items: center; margin-bottom: 1rem;">
          <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
            <div style="color: #00ff88; font-size: 0.9rem; font-weight: bold;">Vote for Index:</div>
            <input type="number" id="vote-index-input-main" placeholder="Enter index" 
                   style="background: rgba(0,0,0,0.3); border: 1px solid rgba(0,255,136,0.3); border-radius: 8px; padding: 0.5rem; color: #fff; text-align: center; width: 120px; font-size: 0.9rem; font-family: monospace;">
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.3rem;">
            <button onclick="voteForIndexMain(true)" 
                    style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;">
              ğŸ‘ Like
            </button>
            <button onclick="voteForIndexMain(false)" 
                    style="background: linear-gradient(135deg,#ff4444,#cc3333); color: #fff; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;">
              ğŸ‘ Dislike
            </button>
          </div>
          
          <div style="display: flex; flex-direction: column; gap: 0.3rem;">
            <button onclick="voteForSelfMain(true)" 
                    style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;" disabled>
              ğŸ‘ Vote Self (Disabled)
            </button>
            <button onclick="voteForSelfMain(false)" 
                    style="background: linear-gradient(135deg,#666,#444); color: #ccc; border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: not-allowed; transition: all 0.3s ease; font-size: 0.9rem; min-width: 80px;" disabled>
              ğŸ‘ Dislike Self (Disabled)
            </button>
          </div>
        </div>
        
        <div id="vote-result-main" style="text-align: center; margin-top: 1rem; padding: 0.5rem; border-radius: 8px; font-size: 0.9rem; min-height: 1.5em;"></div>
        
        <div style="text-align: center; margin-top: 1rem;">
          <div style="color: #ccc; font-size: 0.8rem; margin-bottom: 0.5rem;">Your Vote Status:</div>
          <div id="user-vote-status-main" style="color: #00ff88; font-size: 0.9rem; font-weight: bold;">Not voted yet</div>
        </div>
      </div>






  <!-- Swap Section - Messenger Style -->
  <div id="main-swap" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    
    <div id="swap-main-content" style="display:block;">
    <div class="expand-header" style="padding:0 1.5rem;">
      <h2 style="margin:0 0 0.5rem 0;">ğŸ’¬ Exchange Messenger</h2>
      <p style="margin:0 0 0.5rem 0;">Exchange between DAI and IAM tokens with messenger interface</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="swap-container" style="max-width:800px;margin:0 auto;padding:1.5rem;">
        
        <!-- Messenger Style Chat Interface -->
        <div class="messenger-swap-interface" style="background:linear-gradient(135deg,#0a0f1c,#1a1f2e);border-radius:20px;border:2px solid #00ff88;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.3);">
          
          <!-- Messenger Header -->
          <div class="messenger-header" style="background:linear-gradient(135deg,#1a1f2e,#2a3441);padding:1.5rem;border-bottom:1px solid #2a3441;display:flex;align-items:center;gap:1rem;">
            <div class="messenger-avatar" style="width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#00ff88,#a786ff);display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:white;">ğŸ’±</div>
            <div class="messenger-info">
              <h3 style="color:#00ff88;margin:0;font-size:1.2rem;">Exchange Assistant</h3>
              <p style="color:#b8c1ec;margin:0.2rem 0 0 0;font-size:0.9rem;">Ready to help you exchange tokens</p>
            </div>
            <div class="messenger-status" style="margin-right:auto;display:flex;align-items:center;gap:0.5rem;">
              <div class="status-dot" style="width:10px;height:10px;border-radius:50%;background:#00ff88;animation:pulse 2s infinite;"></div>
              <span style="color:#00ff88;font-size:0.8rem;">Online</span>
            </div>
          </div>
          
          <!-- Messenger Messages Area -->
          <div class="messenger-messages" style="height:400px;overflow-y:auto;padding:1.5rem;background:#0a0f1c;">
            
            <!-- Welcome Message -->
            <div class="message received" style="max-width:80%;margin-bottom:1rem;animation:messageSlide 0.5s ease-out;">
              <div class="message-bubble" style="background:#1a1f2e;color:#ffffff;padding:1rem 1.2rem;border-radius:20px;border-bottom-left-radius:5px;">
                <div class="message-content">
                  <h4 style="color:#00ff88;margin:0 0 0.5rem 0;">ğŸ”„ Welcome to Exchange Assistant!</h4>
                  <p style="margin:0 0 0.5rem 0;line-height:1.5;">I can help you exchange between DAI and IAM tokens. Here's what you can do:</p>
                  <ul style="margin:0.5rem 0;padding-right:1rem;color:#b8c1ec;">
                    <li>âœ… <strong style="color:#00ff88;">DAI â†’ IAM:</strong> Buy IAM tokens with DAI</li>
                    <li>âœ… <strong style="color:#00ff88;">IAM â†’ DAI:</strong> Sell IAM tokens for DAI</li>
                    <li>âœ… Dynamic exchange rates based on supply/demand</li>
                    <li>âœ… Instant processing with low fees</li>
                  </ul>
                  <p style="margin:0.5rem 0 0 0;color:#a786ff;">What would you like to exchange today?</p>
                </div>
              </div>
            </div>
            
            <!-- Exchange Form Message -->
            <div class="message received" style="max-width:80%;margin-bottom:1rem;animation:messageSlide 0.5s ease-out 0.2s both;">
              <div class="message-bubble" style="background:#1a1f2e;color:#ffffff;padding:1rem 1.2rem;border-radius:20px;border-bottom-left-radius:5px;">
                <div class="message-content">
                  <h4 style="color:#00ff88;margin:0 0 1rem 0;">ğŸ“ Exchange Form</h4>
                  
                  <form id="swapForm" class="messenger-form" style="display:flex;flex-direction:column;gap:1rem;">
                    
                    <!-- Exchange Type -->
                    <div class="form-group" style="margin-bottom:1rem;">
                      <label for="swapDirection" style="display:block;color:#00ff88;margin-bottom:0.5rem;font-weight:600;">Exchange Type:</label>
                      <select id="swapDirection" required style="width:100%;background:#0a0f1c;border:2px solid #2a3441;color:#ffffff;padding:0.8rem;border-radius:12px;outline:none;transition:border-color 0.3s ease;font-size:0.95rem;">
                        <option value="dai-to-IAM">ğŸŸ¢ DAI â†’ IAM (Buy IAM)</option>
                        <option value="IAM-to-dai">ğŸ”´ IAM â†’ DAI (Sell IAM)</option>
                      </select>
                    </div>
                    
                    <!-- Amount Input -->
                    <div class="form-group" style="margin-bottom:1rem;">
                      <label for="swapAmount" style="display:block;color:#00ff88;margin-bottom:0.5rem;font-weight:600;">Amount:</label>
                      <div class="amount-input-group" style="display:flex;gap:0.5rem;align-items:center;">
                        <input type="number" id="swapAmount" placeholder="Enter amount" min="0" step="any" required style="flex:1;background:#0a0f1c;border:2px solid #2a3441;color:#ffffff;padding:0.8rem;border-radius:12px;outline:none;transition:border-color 0.3s ease;font-size:0.95rem;">
                        <button type="button" id="maxBtn" class="max-btn" style="background:linear-gradient(135deg,#a786ff,#00ff88);color:#0a0f1c;border:none;padding:0.8rem 1rem;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.3s ease;white-space:nowrap;">Max</button>
                      </div>
                    </div>
                    
                    <!-- USD Converter -->
                    <div id="swap-usd-converter-row" style="display:none;margin-bottom:1rem;">
                      <label for="swapUsdAmount" style="display:block;color:#00ff88;margin-bottom:0.5rem;font-weight:600;">ğŸ’° Dollar Equivalent:</label>
                      <div class="usd-converter-container" style="display:flex;gap:0.5rem;align-items:center;">
                        <span style="color:#00ff88;font-weight:bold;font-size:1.1rem;">$</span>
                        <input type="number" id="swapUsdAmount" placeholder="5.00" min="0" step="0.01" style="flex:1;background:#0a0f1c;border:2px solid #2a3441;color:#ffffff;padding:0.8rem;border-radius:12px;outline:none;transition:border-color 0.3s ease;font-size:0.95rem;">
                        <button type="button" id="swapUsdToTokenBtn" style="background:linear-gradient(135deg,#00ff88,#a786ff);color:#0a0f1c;border:none;padding:0.8rem 1rem;border-radius:12px;font-weight:600;cursor:pointer;transition:all 0.3s ease;font-size:0.9rem;">ğŸ”„</button>
                      </div>
                    </div>
                    
                    <!-- Balance Display -->
                    <div class="balance-display" style="background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);border-radius:12px;padding:1rem;margin-bottom:1rem;">
                      <h4 style="color:#00ff88;margin:0 0 0.8rem 0;font-size:1rem;">ğŸ’° Your Balances</h4>
                      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                        <div style="text-align:center;background:rgba(0,255,136,0.1);border-radius:8px;padding:0.8rem;">
                          <div style="color:#00ff88;font-weight:bold;font-size:0.9rem;">DAI</div>
                          <div id="daiBalance" style="color:#ffffff;font-family:monospace;font-size:1rem;font-weight:600;">-</div>
                        </div>
                        <div style="text-align:center;background:rgba(167,134,255,0.1);border-radius:8px;padding:0.8rem;">
                          <div style="color:#a786ff;font-weight:bold;font-size:0.9rem;">IAM</div>
                          <div id="IAMBalance" style="color:#ffffff;font-family:monospace;font-size:1rem;font-weight:600;">-</div>
                          <div id="IAMUsdValue" style="color:#a786ff;font-size:0.8rem;margin-top:0.2rem;">-</div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Exchange Button -->
                    <button type="submit" class="exchange-btn" style="width:100%;background:linear-gradient(135deg,#00ff88,#00cc6a);color:#0a0f1c;border:none;border-radius:12px;padding:1rem;font-weight:bold;cursor:pointer;transition:all 0.3s ease;font-size:1.1rem;margin-top:0.5rem;">ğŸ’± Execute Exchange</button>
                    
                  </form>
                  
                </div>
              </div>
            </div>
            
            <!-- Exchange Rate Message -->
            <div class="message received" style="max-width:80%;margin-bottom:1rem;animation:messageSlide 0.5s ease-out 0.4s both;">
              <div class="message-bubble" style="background:#1a1f2e;color:#ffffff;padding:1rem 1.2rem;border-radius:20px;border-bottom-left-radius:5px;">
                <div class="message-content">
                  <h4 style="color:#00ff88;margin:0 0 0.5rem 0;">ğŸ“Š Exchange Information</h4>
                  <div id="swapRate" class="swap-rate" style="color:#b8c1ec;margin-bottom:0.5rem;">Exchange rate: Loading...</div>
                  <div id="swapPreview" class="swap-preview" style="color:#a786ff;margin-bottom:0.5rem;"></div>
                  <div id="swapLimitInfo" class="swap-limit-info" style="color:#ffc107;font-size:0.9rem;"></div>
                </div>
              </div>
            </div>
            
            <!-- Status Message -->
            <div id="swapStatus" class="swap-status" style="max-width:80%;margin-bottom:1rem;"></div>
            
          </div>
          
          <!-- Messenger Input Area -->
          <div class="messenger-input-area" style="background:#1a1f2e;border-top:1px solid #2a3441;padding:1rem 1.5rem;">
            <div class="input-container" style="display:flex;align-items:center;gap:0.5rem;background:#0a0f1c;border:2px solid #2a3441;border-radius:25px;padding:0.5rem;">
              <div style="flex:1;color:#b8c1ec;font-size:0.9rem;padding:0 1rem;">
                ğŸ’¡ Tip: Check your balance and exchange rate before proceeding
              </div>
                                            <button type="button" class="refresh-btn" onclick="if(window.swapManager) window.swapManager.refreshSwapData()" style="background:linear-gradient(135deg,#00ff88,#a786ff);color:#0a0f1c;border:none;padding:0.8rem;border-radius:50%;cursor:pointer;transition:all 0.3s ease;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;">ğŸ”„</button>
            </div>
          </div>
          
        </div>
        
      </div>
    </div>
  </div>

  <!-- Transfer Section -->
  <div id="main-transfer" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 style="margin:0 0 0.5rem 0;">ğŸ’¸ Transfer</h2>
      <p style="margin:0 0 0.5rem 0;">Transfer tokens to another wallet</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="transfer-container" style="max-width:600px;margin:0;padding:1.5rem;">
        
        <!-- Transfer Rules and Information -->
        <div class="transfer-rules" style="background:linear-gradient(135deg,#232946,#181c2a);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;border:2px solid #a786ff;">
          <h3 style="color:#00ff88;margin-bottom:1rem;font-size:1.2rem;">ğŸ“‹ Transfer Rules and Guide</h3>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">ğŸ”’ Transfer Security:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>âœ… Transfers are irreversible - double-check before sending</li>
              <li>âœ… Enter destination address carefully - one wrong character can cause loss of assets</li>
              <li>âœ… Send a small amount first to verify the address is correct</li>
              <li>âœ… Use valid and secure wallets</li>
            </ul>
          </div>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">ğŸ’° Transferable Token Types:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li><strong style="color:#00ff88;">DAI:</strong> Stable token with value of $1 - for daily transactions</li>
              <li><strong style="color:#a786ff;">POL (MATIC):</strong> Polygon network token - for transaction fee payments</li>
              <li><strong style="color:#00ccff;">IAM:</strong> Main platform token - for investment and earning</li>
            </ul>
          </div>
          
          <div style="margin-bottom:1rem;">
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">âš¡ Transaction Fees:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>ğŸ’¸ Polygon network fee: ~0.001-0.01 MATIC (depending on network traffic)</li>
              <li>â±ï¸ Confirmation time: 2-5 seconds (usually)</li>
              <li>ğŸ” Transactions can be tracked on PolygonScan</li>
            </ul>
          </div>
          
          <div>
            <h4 style="color:#a786ff;margin-bottom:0.5rem;">ğŸ¯ Important Notes:</h4>
            <ul style="color:#b8c1ec;line-height:1.6;margin:0;padding-right:1rem;">
              <li>ğŸ“± You can search by user index to find the address</li>
              <li>ğŸ” Check your balance before transferring</li>
              <li>âš ï¸ Transfer amount + network fee must be less than your balance</li>
              <li>ğŸ“ Contact support if you have any issues</li>
            </ul>
          </div>
        </div>
        
        <form id="transferForm" class="transfer-form" style="display:grid !important;grid-template-columns:1fr 1fr !important;gap:1.5rem !important;align-items:start !important;">
          <!-- Left Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
          <div class="transfer-row">
            <label for="transferTo">Destination Address:</label>
            <input type="text" id="transferTo" placeholder="0x..." required style="direction:ltr;">
            <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter destination wallet address (42 characters)</small>
          </div>

          <!-- Index to Address Search -->
            <div class="transfer-row" id="search-index-container" style="background:rgba(0,255,136,0.1);border-radius:8px;padding:0.8rem;border:1px solid rgba(0,255,136,0.2);">
              <h4 style="color:#00ff88;margin-bottom:0.6rem;font-size:0.9rem;">ğŸ” Search by Index</h4>
              <div style="margin-bottom:0.4rem;">
              <input type="number" id="searchIndex" placeholder="Enter user index" 
                       style="background:rgba(0,0,0,0.3);border:1px solid rgba(0,255,136,0.3);border-radius:6px;padding:0.4rem;color:#fff;text-align:center;width:100%;font-size:0.85rem;font-family:monospace;margin-bottom:0.4rem;">
              <button type="button" id="searchIndexBtn" 
                        style="background:linear-gradient(135deg,#00ff88,#00cc6a);color:#1a1f2e;border:none;border-radius:6px;padding:0.4rem 0.8rem;font-weight:bold;cursor:pointer;transition:all 0.3s ease;font-size:0.85rem;width:100%;">
                ğŸ” Search
              </button>
            </div>
              <div id="searchIndexStatus" style="text-align:center;padding:0.4rem;border-radius:6px;font-size:0.85rem;min-height:1.2em;"></div>
              <small style="color:#b8c1ec;font-size:0.75rem;margin-top:0.2rem;display:block;">Enter a user index to find their wallet address</small>
          </div>

          <div class="transfer-row">
              <label for="transferAmount">Amount:</label>
              <input type="number" id="transferAmount" placeholder="Enter amount" min="0" step="any" required>
            <button type="button" id="maxAmountBtn" style="
              background: linear-gradient(90deg,#ff6b6b,#ee5a52);
              color: #fff;
              border: none;
              border-radius: 6px;
              padding: 0.4rem 0.8rem;
              font-size: 0.8rem;
              cursor: pointer;
                margin-top: 0.4rem;
              transition: all 0.3s ease;
              width: auto;
              display: inline-block;
              ">ğŸ”¥ Maximum Balance</button>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter transfer amount or click "Maximum"</small>
          </div>

          </div>

          <!-- Right Column -->
          <div style="display:flex;flex-direction:column;gap:1rem;">
            <div class="transfer-row">
              <label for="transferToken">Token Type:</label>
              <select id="transferToken" required>
                <option value="dai" selected>DAI</option>
                <option value="pol">POL</option>
                <option value="IAM">IAM</option>
              </select>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Select the token type you want to transfer</small>
            </div>

          <div class="transfer-row" id="usd-converter-row" style="display:none;">
              <label for="transferUsdAmount">ğŸ’° Dollar Equivalent (Only for IAM):</label>
            <div class="usd-converter-container" style="display:flex;gap:0.5rem;align-items:center;">
              <span style="color:#00ff88;font-weight:bold;">$</span>
              <input type="number" id="transferUsdAmount" placeholder="5.00" min="0" step="0.01" style="flex:1;">
              <button type="button" id="usdToIAMBtn" style="
                background: linear-gradient(90deg,#00ff88,#a786ff);
                color: #181c2a;
                border: none;
                border-radius: 6px;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: bold;
                ">ğŸ”„ Convert</button>
            </div>
              <small style="color:#b8c1ec;font-size:0.85rem;margin-top:0.3rem;display:block;">Enter dollar amount to convert to IAM (e.g., 5 for $5)</small>
          </div>
          
          <!-- Balance Check -->
            <div style="background:rgba(167,134,255,0.1);border-radius:8px;padding:0.8rem;" class="balance-check">
              <h4 style="color:#a786ff;margin-bottom:0.6rem;font-size:0.9rem;">ğŸ’° Your Current Balance:</h4>
              <div class="balance-check-grid" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.8rem;">
              <div style="text-align:center;">
                  <div style="color:#00ff88;font-weight:bold;font-size:0.9rem;">DAI</div>
                  <div id="transfer-dai-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
              </div>
              <div style="text-align:center;">
                  <div style="color:#a786ff;font-weight:bold;font-size:0.9rem;">POL</div>
                  <div id="transfer-poly-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
              </div>
              <div style="text-align:center;">
                  <div style="color:#00ccff;font-weight:bold;font-size:0.9rem;">IAM</div>
                  <div id="transfer-IAM-balance" style="color:#b8c1ec;font-family:monospace;font-size:0.85rem;">-</div>
                  <div id="transfer-IAM-usd" style="color:#a786ff;font-size:0.75rem;margin-top:2px;">-</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Full Width Submit Button -->
          <div style="grid-column:1/-1;margin-top:1rem;">
            <button type="submit" class="transfer-btn" style="width:100%;">Transfer</button>
          <div id="transferStatus" class="transfer-status"></div>
          </div>
        </form>
      </div>
    </div>
  </div>

  




    
    <script src="js/smooth-value-updater.js"></script>
    <script src="js/smart-dashboard-updater.js"></script>
    <script src="js/central-dashboard-updater.js"></script>
    <script src="js/test-address-config.js"></script>
    <script src="js/config.js"></script>
    <script>
      // Ø¨Ø±Ø±Ø³ÛŒ Ù„ÙˆØ¯ Ø´Ø¯Ù† config.js
              console.log('ğŸ” Checking config.js loading...');
        setTimeout(() => {
          console.log('displayTopUsersRanking available:', typeof window.displayTopUsersRanking);
          console.log('voteForIndex available:', typeof window.voteForIndex);
          if (typeof window.displayTopUsersRanking !== 'function') {
            console.error('âŒ config.js not loaded properly!');
          } else {
            console.log('âœ… config.js loaded successfully');
          }
        }, 1000);
    </script>
  <script src="js/reports.js"></script>
  <script src="js/web3-interactions.js"></script>
      <script src="js/main.js"></script>

    <script src="js/search-index.js"></script>
  <script src="js/network.js?v=5.7"></script>
  <script src="js/network-database.js?v=5.8"></script>
  
  <script src="js/profile.js?v=5.7"></script>
  
  <script src="js/homepage.js?v=5.8"></script>

  <style>
    /* Fix for chart width issues */
    #price-chart-section {
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: hidden !important;
    }
    
    #price-chart-canvas,
    #point-chart-canvas {
      width: 100% !important;
      max-width: 100% !important;
      height: 150px !important;
      box-sizing: border-box !important;
    }
    
    @media (max-width: 768px) {
      #price-chart-canvas,
      #point-chart-canvas {
        height: 120px !important;
      }
    }
    
    /* Transfer Status Styles */
    .transfer-status {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      font-size: 0.9rem;
      text-align: center;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .transfer-status.success {
      background: rgba(0, 255, 136, 0.1);
      color: #00ff88;
      border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    .transfer-status.error {
      background: rgba(255, 68, 68, 0.1);
      color: #ff4444;
      border: 1px solid rgba(255, 68, 68, 0.3);
    }
    
    .transfer-status.loading {
      background: rgba(167, 134, 255, 0.1);
      color: #a786ff;
      border: 1px solid rgba(167, 134, 255, 0.3);
    }

    /* Index Search Styles */
    #search-index-container {
      transition: all 0.3s ease;
    }
    
    #search-index-container:hover {
      background: rgba(0, 255, 136, 0.15) !important;
      border-color: rgba(0, 255, 136, 0.4) !important;
    }
    
    #searchIndexStatus {
      transition: all 0.3s ease;
    }
    
    #searchIndexStatus.success {
      background: rgba(0, 255, 136, 0.1);
      color: #00ff88;
      border: 1px solid rgba(0, 255, 136, 0.3);
    }
    
    #searchIndexStatus.error {
      background: rgba(255, 68, 68, 0.1);
      color: #ff4444;
      border: 1px solid rgba(255, 68, 68, 0.3);
    }
    
    #searchIndexStatus.loading {
      background: rgba(167, 134, 255, 0.1);
      color: #a786ff;
      border: 1px solid rgba(167, 134, 255, 0.3);
    }
    
    /* Transfer Form Improvements */
    .transfer-form {
      background: linear-gradient(135deg, #232946, #181c2a);
      border-radius: 12px;
      padding: 1.5rem;
      border: 2px solid #a786ff;
    }
    
    .transfer-row {
      margin-bottom: 1.5rem;
    }
    
    .transfer-row label {
      display: block;
      color: #a786ff;
      font-weight: bold;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    
    .transfer-row input,
    .transfer-row select {
      width: 100%;
      padding: 0.8rem;
      border-radius: 8px;
      border: 2px solid #a786ff;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-size: 0.95rem;
      transition: border-color 0.3s ease;
      box-sizing: border-box;
    }
    
    .transfer-row input:focus,
    .transfer-row select:focus {
      outline: none;
      border-color: #00ff88;
    }
    
    .transfer-btn {
      background: linear-gradient(90deg, #00ff88, #a786ff);
      color: #181c2a;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      padding: 1rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 1rem;
    }
    
    .transfer-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
    }
    
    .transfer-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Responsive Design for Transfer Section */
    @media (max-width: 768px) {
      #main-transfer {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        padding: 0.5rem !important;
      }
      

      
      .transfer-container {
        max-width: 100% !important;
        padding: 0.8rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .transfer-form {
        padding: 0.8rem !important;
        border-radius: 8px !important;
      }
      
      .transfer-row {
        margin-bottom: 0.8rem !important;
      }
      
      .transfer-row label {
        font-size: 0.9rem !important;
        margin-bottom: 0.3rem !important;
      }
      
      .transfer-row input,
      .transfer-row select {
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      .transfer-btn {
        padding: 0.7rem 1.2rem !important;
        font-size: 0.9rem !important;
        border-radius: 6px !important;
      }
      
      /* Balance grid responsive */
      .balance-check {
        padding: 0.8rem !important;
        border-radius: 6px !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr !important;
        gap: 0.6rem !important;
      }
      
      .balance-check h4 {
        font-size: 1rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      /* Search index row responsive */
      .search-index-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .search-index-container input {
        width: 100% !important;
        min-width: auto !important;
      }
      
      .search-index-container button {
        width: 100% !important;
        min-width: auto !important;
        padding: 0.5rem !important;
      }

      /* Index search responsive */
      #search-index-container {
        padding: 0.8rem !important;
        margin-bottom: 0.8rem !important;
      }
      
      #search-index-container h4 {
        font-size: 0.95rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      #search-index-container .transfer-row {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      #search-index-container input {
        width: 100% !important;
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
      }
      
      #search-index-container button {
        width: 100% !important;
        padding: 0.6rem !important;
        font-size: 0.9rem !important;
      }
      
      #searchIndexStatus {
        font-size: 0.8rem !important;
        padding: 0.4rem !important;
      }
      
      /* USD converter row responsive */
      .usd-converter-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .usd-converter-container input {
        width: 100% !important;
      }
      
      .usd-converter-container button {
        width: 100% !important;
        padding: 0.5rem !important;
      }
      
      /* Rules section responsive */
      .transfer-rules {
        padding: 0.8rem !important;
        border-radius: 8px !important;
        margin-bottom: 1rem !important;
      }
      
      .transfer-rules h3 {
        font-size: 1.1rem !important;
        margin-bottom: 0.8rem !important;
      }
      
      .transfer-rules h4 {
        font-size: 0.95rem !important;
        margin-bottom: 0.4rem !important;
      }
      
      .transfer-rules ul {
        font-size: 0.8rem !important;
        line-height: 1.4 !important;
        padding-right: 0.8rem !important;
      }
      
      .transfer-rules li {
        margin-bottom: 0.3rem !important;
      }
      
      /* Small text responsive */
      .transfer-row small {
        font-size: 0.75rem !important;
        margin-top: 0.2rem !important;
      }
      
      /* Max amount button responsive */
      #maxAmountBtn {
        padding: 0.4rem 0.8rem !important;
        font-size: 0.8rem !important;
        margin-top: 0.4rem !important;
        width: 100% !important;
      }
    }
    
    @media (max-width: 480px) {
      #main-transfer {
        padding: 0.3rem !important;
      }
      

      
      .transfer-container {
        padding: 0.6rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .transfer-form {
        padding: 0.6rem !important;
      }
      
      .transfer-row {
        margin-bottom: 0.6rem !important;
      }
      
      .transfer-row label {
        font-size: 0.85rem !important;
      }
      
      .transfer-row input,
      .transfer-row select {
        padding: 0.5rem !important;
        font-size: 0.85rem !important;
      }
      
      .transfer-btn {
        padding: 0.6rem 1rem !important;
        font-size: 0.85rem !important;
      }
      
      .balance-check {
        padding: 0.6rem !important;
      }
      
      .transfer-rules {
        padding: 0.6rem !important;
      }
      
      .transfer-rules h3 {
        font-size: 1rem !important;
      }
      
      .transfer-rules h4 {
        font-size: 0.9rem !important;
      }
      
      .transfer-rules ul {
        font-size: 0.75rem !important;
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {

      
      .transfer-container {
        max-width: 90% !important;
        padding: 1.2rem !important;
        margin: 0 auto !important;
      }
      
      .transfer-form {
        padding: 1.2rem !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    @media (min-width: 1025px) {

      
      .transfer-container {
        max-width: 700px !important;
        padding: 1.5rem !important;
        margin: 0 auto !important;
      }
      
      .transfer-form {
        padding: 1.5rem !important;
      }
      
      .transfer-row {
        margin-bottom: 1.5rem !important;
      }
      
      .balance-check .balance-check-grid {
        grid-template-columns: 1fr 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    /* Messenger Style Swap Interface */
    .messenger-swap-interface {
      position: relative;
      overflow: hidden;
    }
    
    .messenger-swap-interface::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0,255,136,0.1), transparent);
      transition: left 0.8s;
      z-index: 1;
      pointer-events: none;
    }
    
    .messenger-swap-interface:hover::before {
      left: 100%;
    }
    
    .messenger-header {
      position: relative;
      z-index: 2;
    }
    
    .messenger-messages {
      position: relative;
      z-index: 2;
    }
    
    .messenger-input-area {
      position: relative;
      z-index: 2;
    }
    
    /* Message animations */
    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { 
        opacity: 1; 
        transform: scale(1); 
      }
      50% { 
        opacity: 0.7; 
        transform: scale(1.1); 
      }
    }
    
    /* Form styling */
    .messenger-form .form-group input:focus,
    .messenger-form .form-group select:focus {
      border-color: #00ff88 !important;
      box-shadow: 0 0 0 2px rgba(0,255,136,0.2) !important;
    }
    
    .exchange-btn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 8px 25px rgba(0,255,136,0.3) !important;
    }
    
         .refresh-btn:hover {
       transform: rotate(180deg) scale(1.1) !important;
     }
     
     
    
    /* Responsive Design for Messenger Swap Section */
    @media (max-width: 768px) {
      #main-swap {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        padding: 0.4rem !important;
      }
      
      .swap-container {
        max-width: 100% !important;
        padding: 0.6rem !important;
        margin: 0 !important;
        width: 100% !important;
      }
      
      .messenger-swap-interface {
        border-radius: 15px !important;
      }
      
      .messenger-header {
        padding: 1rem !important;
        flex-direction: column !important;
        gap: 0.8rem !important;
        text-align: center !important;
      }
      
      .messenger-avatar {
        width: 40px !important;
        height: 40px !important;
        font-size: 1.2rem !important;
      }
      
      .messenger-info h3 {
        font-size: 1rem !important;
      }
      
      .messenger-info p {
        font-size: 0.8rem !important;
      }
      
      .messenger-messages {
        height: 350px !important;
        padding: 1rem !important;
      }
      
      .message {
        max-width: 95% !important;
      }
      
      .message-bubble {
        padding: 0.8rem 1rem !important;
        border-radius: 15px !important;
      }
      
      .messenger-form .form-group {
        margin-bottom: 0.8rem !important;
      }
      
      .messenger-form .form-group label {
        font-size: 0.9rem !important;
        margin-bottom: 0.4rem !important;
      }
      
      .messenger-form .form-group input,
      .messenger-form .form-group select {
        padding: 0.7rem !important;
        font-size: 0.9rem !important;
        border-radius: 10px !important;
      }
      
      .amount-input-group {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .amount-input-group input {
        width: 100% !important;
      }
      
      .amount-input-group .max-btn {
        width: 100% !important;
        padding: 0.7rem !important;
        font-size: 0.9rem !important;
      }
      
      .usd-converter-container {
        flex-direction: column !important;
        gap: 0.4rem !important;
      }
      
      .usd-converter-container input {
        width: 100% !important;
      }
      
      .usd-converter-container button {
        width: 100% !important;
        padding: 0.7rem !important;
      }
      
      .balance-display {
        padding: 0.8rem !important;
        border-radius: 10px !important;
      }
      
      .balance-display h4 {
        font-size: 0.9rem !important;
        margin-bottom: 0.6rem !important;
      }
      
      .balance-display > div > div {
        grid-template-columns: 1fr !important;
        gap: 0.6rem !important;
      }
      
      .exchange-btn {
        padding: 0.8rem !important;
        font-size: 1rem !important;
        border-radius: 10px !important;
      }
      
      .messenger-input-area {
        padding: 0.8rem 1rem !important;
      }
      
      .input-container {
        flex-direction: column !important;
        gap: 0.5rem !important;
        padding: 0.8rem !important;
      }
      
      .input-container > div {
        text-align: center !important;
        font-size: 0.8rem !important;
      }
      
      .refresh-btn {
        width: 35px !important;
        height: 35px !important;
        font-size: 1rem !important;
      }
    }
    
    @media (max-width: 480px) {
      #main-swap {
        padding: 0.2rem !important;
      }
      
      .swap-container {
        padding: 0.4rem !important;
      }
      
      .messenger-swap-interface {
        border-radius: 12px !important;
      }
      
      .messenger-header {
        padding: 0.8rem !important;
        gap: 0.6rem !important;
      }
      
      .messenger-avatar {
        width: 35px !important;
        height: 35px !important;
        font-size: 1rem !important;
      }
      
      .messenger-info h3 {
        font-size: 0.9rem !important;
      }
      
      .messenger-info p {
        font-size: 0.75rem !important;
      }
      
      .messenger-messages {
        height: 300px !important;
        padding: 0.8rem !important;
      }
      
      .message {
        max-width: 98% !important;
      }
      
      .message-bubble {
        padding: 0.6rem 0.8rem !important;
        border-radius: 12px !important;
      }
      
      .message-bubble h4 {
        font-size: 0.9rem !important;
        margin-bottom: 0.4rem !important;
      }
      
      .message-bubble p {
        font-size: 0.8rem !important;
        line-height: 1.3 !important;
      }
      
      .message-bubble ul {
        font-size: 0.75rem !important;
        padding-right: 0.6rem !important;
      }
      
      .messenger-form .form-group {
        margin-bottom: 0.6rem !important;
      }
      
      .messenger-form .form-group label {
        font-size: 0.8rem !important;
        margin-bottom: 0.3rem !important;
      }
      
      .messenger-form .form-group input,
      .messenger-form .form-group select {
        padding: 0.6rem !important;
        font-size: 0.8rem !important;
        border-radius: 8px !important;
      }
      
      .amount-input-group .max-btn {
        padding: 0.6rem !important;
        font-size: 0.8rem !important;
      }
      
      .usd-converter-container button {
        padding: 0.6rem !important;
        font-size: 0.8rem !important;
      }
      
      .balance-display {
        padding: 0.6rem !important;
        border-radius: 8px !important;
      }
      
      .balance-display h4 {
        font-size: 0.8rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .balance-display > div > div > div {
        padding: 0.6rem !important;
        border-radius: 6px !important;
      }
      
      .balance-display > div > div > div > div:first-child {
        font-size: 0.8rem !important;
      }
      
      .balance-display > div > div > div > div:nth-child(2) {
        font-size: 0.9rem !important;
      }
      
      .exchange-btn {
        padding: 0.7rem !important;
        font-size: 0.9rem !important;
        border-radius: 8px !important;
      }
      
      .messenger-input-area {
        padding: 0.6rem 0.8rem !important;
      }
      
      .input-container {
        padding: 0.6rem !important;
        gap: 0.4rem !important;
      }
      
      .input-container > div {
        font-size: 0.75rem !important;
        padding: 0 0.8rem !important;
      }
      
      .refresh-btn {
        width: 30px !important;
        height: 30px !important;
        font-size: 0.9rem !important;
      }
    }
    
    /* Extra small devices (phones, 320px and down) */
    @media (max-width: 320px) {
      #main-swap {
        padding: 0.1rem !important;
      }
      
      .swap-container {
        padding: 0.3rem !important;
      }
      
      .swap-form {
        padding: 0.3rem !important;
        gap: 0.5rem !important;
      }
      
      .swap-row {
        margin-bottom: 0.4rem !important;
      }
      
      .swap-row label {
        font-size: 0.7rem !important;
      }
      
      .swap-row input,
      .swap-row select {
        padding: 0.3rem !important;
        font-size: 0.7rem !important;
      }
      
      .swap-btn {
        padding: 0.4rem 0.6rem !important;
        font-size: 0.7rem !important;
      }
      
      .swap-row small {
        font-size: 0.65rem !important;
      }
    }
    
    /* Small tablets (600px and down) */
    @media (max-width: 600px) and (min-width: 481px) {
      #main-swap {
        padding: 0.3rem !important;
      }
      
      .swap-container {
        padding: 0.5rem !important;
      }
      
      .swap-form {
        padding: 0.5rem !important;
        gap: 0.7rem !important;
      }
      
      .swap-row {
        margin-bottom: 0.6rem !important;
      }
      
      .swap-row label {
        font-size: 0.8rem !important;
      }
      
      .swap-row input,
      .swap-row select {
        padding: 0.5rem !important;
        font-size: 0.8rem !important;
      }
      
      .swap-btn {
        padding: 0.6rem 1rem !important;
        font-size: 0.8rem !important;
      }
    }
    
    @media (min-width: 769px) and (max-width: 1024px) {
      .swap-container {
        max-width: 90% !important;
        padding: 1.2rem !important;
        margin: 0 auto !important;
      }
      
      .messenger-swap-interface {
        border-radius: 18px !important;
      }
      
      .messenger-header {
        padding: 1.3rem !important;
      }
      
      .messenger-messages {
        height: 450px !important;
        padding: 1.3rem !important;
      }
      
      .message {
        max-width: 85% !important;
      }
      
      .balance-display > div > div {
        grid-template-columns: 1fr 1fr !important;
        gap: 1rem !important;
      }
    }
    
    @media (min-width: 1025px) {
      .swap-container {
        max-width: 900px !important;
        padding: 1.5rem !important;
        margin: 0 auto !important;
      }
      
      .messenger-swap-interface {
        border-radius: 20px !important;
      }
      
      .messenger-header {
        padding: 1.5rem !important;
      }
      
      .messenger-messages {
        height: 500px !important;
        padding: 1.5rem !important;
      }
      
      .message {
        max-width: 80% !important;
      }
      
      .messenger-form .form-group {
        margin-bottom: 1rem !important;
      }
      
      .balance-display > div > div {
        grid-template-columns: 1fr 1fr !important;
        gap: 1.2rem !important;
      }
      
      .exchange-btn:hover {
        transform: translateY(-3px) !important;
        box-shadow: 0 12px 35px rgba(0,255,136,0.4) !important;
      }
    }
  </style>
  
      <!-- Define required variables for swap -->
  <script>
    // DAI contract address in Polygon network
    window.DAI_ADDRESS = '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063';
    
    // Simple ABI for DAI
    window.DAI_ABI = [
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "value",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "spender",
            "type": "address"
          }
        ],
        "name": "allowance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "account",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];
  </script>
  
  <script src="js/swap.js?v=5.7"></script>
  

 
  <!-- Charts removed -->
  
  <script>
    // Safe, no-op placeholder to avoid unhandled users(address) calls
    (async () => {
      try {
        await window.connectWallet();
        // Intentionally skip direct contract.users(address) call to avoid provider decode issues
      } catch (e) {
        // ignore
      }
    })();
  </script>

  <script>
    async function updateAboutWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('about-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('about-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('about-wallets-count').innerText = '-';
      }
    }
    // Hook into tab switching
    const aboutBtn = document.getElementById('tab-about-btn');
    if (aboutBtn) {
      aboutBtn.addEventListener('click', updateAboutWalletsCount);
    }
  </script>

  <script>
    function toggleDashboardChart(chartId, btn) {
      const chartDiv = document.getElementById(chartId);
      if (!chartDiv) return;
      const isOpen = chartDiv.style.display === 'block';
      chartDiv.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? 'â–¼' : 'â–²';
      // Placeholder: Here you can load/render the chart if needed
    }
  </script>
  <!-- Add/Edit Sub-Admin Modal -->
  <div class="sub-admin-modal" id="sub-admin-modal">
    <div class="sub-admin-modal-content">
      <h3 id="modal-title">Add New Sub-Admin</h3>
      <form class="sub-admin-form" id="sub-admin-form">
        <div class="form-group">
          <label for="sub-admin-name">Sub-Admin Name:</label>
          <input type="text" id="sub-admin-name" placeholder="Full name of sub-admin" required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-address">Wallet Address:</label>
          <input type="text" id="sub-admin-address" placeholder="0x..." required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-role">Role:</label>
          <select id="sub-admin-role" required>
            <option value="">Select Role</option>
            <option value="moderator">Content Manager</option>
            <option value="support">Support</option>
            <option value="analyst">Analyst</option>
            <option value="teacher">Teacher</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-description">Description:</label>
          <textarea id="sub-admin-description" placeholder="Additional descriptions..." rows="3"></textarea>
        </div>
        
        <div class="permissions-group">
          <h5>ğŸ” Sub-Admin Permissions</h5>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-stream-control" name="permissions">
            <label for="perm-stream-control">Live Stream Control</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-chat-moderate" name="permissions">
            <label for="perm-chat-moderate">Chat Management</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-ban-users" name="permissions">
            <label for="perm-ban-users">Ban Users</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-reports" name="permissions">
            <label for="perm-view-reports">View Reports</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-manage-content" name="permissions">
            <label for="perm-manage-content">Content Management</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-analytics" name="permissions">
            <label for="perm-view-analytics">View Analytics</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-edit-products" name="permissions">
            <label for="perm-edit-products">Edit Products</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-orders" name="permissions">
            <label for="perm-view-orders">View Orders</label>
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="submit" class="modal-btn primary" id="save-sub-admin-btn">ğŸ’¾ Save</button>
          <button type="button" class="modal-btn secondary" id="cancel-sub-admin-btn">âŒ Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="sub-admin-modal" id="delete-confirm-modal">
    <div class="sub-admin-modal-content">
      <h3>âš ï¸ Confirm Deletion</h3>
      <p style="color: #ccc; text-align: center; margin-bottom: 1.5rem;">
        Are you sure you want to delete this sub-admin?
      </p>
      <div style="background: #181c2a; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <p style="color: #fff; margin: 0;"><strong>Name:</strong> <span id="delete-admin-name"></span></p>
        <p style="color: #888; margin: 0.5rem 0 0 0;"><strong>Address:</strong> <span id="delete-admin-address"></span></p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn danger" id="confirm-delete-btn">ğŸ—‘ï¸ Delete</button>
        <button class="modal-btn secondary" id="cancel-delete-btn">âŒ Cancel</button>
      </div>
    </div>
  </div>



  <div id="custom-footer-div" style="text-align:center; padding:2rem; color:#00ff88; font-size:1.2rem;">
  <br>  <br>  <br>  <br>  <br>  <br>  <br>
  </div>


  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var archiveBtn = Array.from(document.querySelectorAll('button, a')).find(el => el.textContent.includes('Financial Markets Archive'));
      if (archiveBtn) archiveBtn.remove();
      
      // Restore active tab from localStorage
      const savedTab = localStorage.getItem('currentActiveTab');
      if (savedTab && savedTab !== 'network' && typeof window.showTab === 'function') {
        // Wait a bit for the page to fully load
        setTimeout(() => {
          window.showTab(savedTab);
        }, 1000);
      }
    });
  </script>

  <script>
  (async function() {
    if (window.getUserProfile) {
      const profile = await window.getUserProfile();
      if (!(profile.index && BigInt(profile.index) > 0n)) {
        // Lock only the reports section
        const reportsSection = document.getElementById('main-reports');
        if (reportsSection) {
          reportsSection.innerHTML = '<div style="color:#ff6b6b;text-align:center;padding:3rem;font-size:1.5rem;">Access to this section is only allowed for active users.<br>ğŸ”’</div>';
          reportsSection.style.background = '#181c2a';
        }
      }
    }
  })();
  </script>

  <!-- Control display of destination address input -->
  <script>
          // Auto-refresh transfer balances function
      async function autoRefreshTransferBalances() {
        try {
          if (window.updateTransferBalancesOnConnect) {
            await window.updateTransferBalancesOnConnect();
            console.log('âœ… Transfer balances auto-refreshed');
          }
        } catch (error) {
          console.warn('Error in auto-refreshing transfer balances:', error);
        }
      }

    document.addEventListener('DOMContentLoaded', function() {
      const transferForm = document.getElementById('transferForm');
      if (!transferForm) return;

              // Auto-update balances when page loads
      const initTransferBalances = () => {
        if (window.contractConfig && window.contractConfig.contract) {
          autoRefreshTransferBalances();
        } else {
          // Wait for wallet connection
          const checkConnection = setInterval(() => {
            if (window.contractConfig && window.contractConfig.contract) {
              autoRefreshTransferBalances();
              clearInterval(checkConnection);
            }
          }, 1000);
          
          // Stop checking after 15 seconds
          setTimeout(() => clearInterval(checkConnection), 15000);
        }
      };

      // Start updating
      initTransferBalances();

      // USD Converter functionality
      const usdConverterRow = document.getElementById('usd-converter-row');
      const transferUsdAmount = document.getElementById('transferUsdAmount');
      const usdToIAMBtn = document.getElementById('usdToIAMBtn');
      
      // Show/hide USD field based on token type
      function toggleUsdConverter() {
        const selectedToken = transferTokenSelect.value;
        if (selectedToken === 'IAM') {
          usdConverterRow.style.display = 'block';
        } else {
          usdConverterRow.style.display = 'none';
          transferUsdAmount.value = '';
        }
      }
      
      // Convert USD to IAM
      async function convertUsdToIAM() {
        const usdAmount = parseFloat(transferUsdAmount.value);
        if (isNaN(usdAmount) || usdAmount <= 0) {
          alert('Please enter a valid dollar amount');
          return;
        }
        
        try {
          // Get token price from smart contract
          const connection = await window.connectWallet();
          if (!connection || !connection.contract) {
            alert('Please connect your wallet first');
            return;
          }
          
          usdToIAMBtn.textContent = 'â³ Calculating...';
          usdToIAMBtn.disabled = true;
          
          const tokenPriceRaw = await connection.contract.getTokenPrice();
          const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
          
          // Calculate required IAM amount
          const IAMAmount = (usdAmount / tokenPrice).toFixed(6);
          
          // Set value in main field
          transferAmountInput.value = IAMAmount;
          
          // Show success message
          const statusDiv = document.getElementById('transferStatus');
          if (statusDiv) {
            statusDiv.innerHTML = `âœ… $${usdAmount} equals ${parseFloat(IAMAmount).toLocaleString('en-US', {maximumFractionDigits: 6})} IAM`;
            statusDiv.style.color = '#00ff88';
            setTimeout(() => {
              statusDiv.innerHTML = '';
            }, 3000);
          }
          
        } catch (error) {
          console.error('Error converting USD to IAM:', error);
          alert('Conversion error. Please try again.');
        } finally {
          usdToIAMBtn.textContent = 'ğŸ”„ Convert';
          usdToIAMBtn.disabled = false;
        }
      }
      
      // Maximum button
      const maxAmountBtn = document.getElementById('maxAmountBtn');
      const transferAmountInput = document.getElementById('transferAmount');
      const transferTokenSelect = document.getElementById('transferToken');

      if (maxAmountBtn && transferAmountInput && transferTokenSelect) {
        maxAmountBtn.addEventListener('click', function() {
          const selectedToken = transferTokenSelect.value;
          let maxAmount = '0';
          
          // Get balance based on selected token
          if (selectedToken === 'dai') {
            const daiBalanceEl = document.getElementById('transfer-dai-balance');
            if (daiBalanceEl) {
              const raw = parseFloat(daiBalanceEl.dataset.value || daiBalanceEl.textContent);
              if (!isNaN(raw) && raw > 0) maxAmount = raw.toString();
            }
          } else if (selectedToken === 'pol') {
            const polBalanceEl = document.getElementById('transfer-poly-balance');
            if (polBalanceEl) {
              const raw = parseFloat(polBalanceEl.dataset.value || polBalanceEl.textContent);
              if (!isNaN(raw)) {
                maxAmount = Math.max(0, raw - 0.01).toString();
              }
            }
          } else if (selectedToken === 'IAM') {
            const IAMBalanceEl = document.getElementById('transfer-IAM-balance');
            if (IAMBalanceEl) {
              const raw = parseFloat(IAMBalanceEl.dataset.value || IAMBalanceEl.textContent);
              if (!isNaN(raw) && raw > 0) maxAmount = raw.toString();
            }
          }
          
          // Set value in input field
          if (parseFloat(maxAmount) > 0) {
            const decimals = (transferTokenSelect.value === 'IAM') ? 6 : 18;
            // For DAI and POL, it's better to use 2 or 4 digits; for IAM up to 6 digits
            const floorToDecimals = (val, d) => { const m = Math.pow(10, d); return Math.floor(Number(val) * m) / m; };
            const d = (transferTokenSelect.value === 'IAM') ? 6 : 4;
            const floored = floorToDecimals(maxAmount, d);
            transferAmountInput.value = floored.toFixed(d);
            // Temporarily change button text
            const originalText = maxAmountBtn.textContent;
                          maxAmountBtn.textContent = 'âœ“ Set';
            maxAmountBtn.style.background = 'linear-gradient(90deg,#00ff88,#00cc66)';
            setTimeout(() => {
              maxAmountBtn.textContent = originalText;
              maxAmountBtn.style.background = 'linear-gradient(90deg,#ff6b6b,#ee5a52)';
            }, 1500);
          } else {
            // Show error message
            maxAmountBtn.textContent = 'âŒ Insufficient balance';
            maxAmountBtn.style.background = 'linear-gradient(90deg,#666,#555)';
            setTimeout(() => {
              maxAmountBtn.textContent = 'Maximum';
              maxAmountBtn.style.background = 'linear-gradient(90deg,#ff6b6b,#ee5a52)';
            }, 2000);
          }
        });
      }
      
      // Event listeners for USD converter
      if (transferTokenSelect) {
        // Change token type
        transferTokenSelect.addEventListener('change', toggleUsdConverter);
        
        // Initial execution to set initial state
        toggleUsdConverter();
      }
      
      if (usdToIAMBtn) {
        // Convert button click
        usdToIAMBtn.addEventListener('click', convertUsdToIAM);
      }
      
      if (transferUsdAmount) {
        // Enter key in USD field
        transferUsdAmount.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            convertUsdToIAM();
          }
        });
        
        // Real-time calculation when user types
        let usdTimeout;
        transferUsdAmount.addEventListener('input', function() {
          clearTimeout(usdTimeout);
          usdTimeout = setTimeout(async () => {
            const usdAmount = parseFloat(transferUsdAmount.value);
            if (!isNaN(usdAmount) && usdAmount > 0) {
              try {
                const connection = await window.connectWallet();
                if (connection && connection.contract) {
                  const tokenPriceRaw = await connection.contract.getTokenPrice();
                  const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
                  const IAMAmount = (usdAmount / tokenPrice).toFixed(6);
                  
                  // Show preview in placeholder
                  transferAmountInput.placeholder = `â‰ˆ ${parseFloat(IAMAmount).toLocaleString('en-US', {maximumFractionDigits: 6})} IAM`;
                }
              } catch (e) {
                // Error in real-time - ignore
              }
            } else {
              transferAmountInput.placeholder = 'Enter amount';
            }
          }, 500); // 500ms delay to prevent too many calls
        });
      }
      
      // Real-time calculation of dollar equivalent when IAM amount changes
      if (transferAmountInput) {
        let IAMTimeout;
        transferAmountInput.addEventListener('input', function() {
          if (transferTokenSelect.value === 'IAM') {
            clearTimeout(IAMTimeout);
            IAMTimeout = setTimeout(async () => {
              const IAMAmount = parseFloat(transferAmountInput.value);
              if (!isNaN(IAMAmount) && IAMAmount > 0) {
                try {
                  const connection = await window.connectWallet();
                  if (connection && connection.contract) {
                    const tokenPriceRaw = await connection.contract.getTokenPrice();
                    const tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
                    const usdValue = (IAMAmount * tokenPrice).toFixed(2);
                    
                    // Show dollar equivalent in USD field
                    if (transferUsdAmount) {
                      transferUsdAmount.placeholder = `â‰ˆ $${parseFloat(usdValue).toLocaleString('en-US', {maximumFractionDigits: 2})}`;
                    }
                  }
                } catch (e) {
                  // Error in real-time - ignore
                }
              } else {
                if (transferUsdAmount) {
                  transferUsdAmount.placeholder = '5.00';
                }
              }
            }, 500);
          }
        });
      }

      transferForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const transferBtn = transferForm.querySelector('button[type="submit"]');
        if (transferBtn) {
          transferBtn.disabled = true;
          var oldText = transferBtn.textContent;
                      transferBtn.textContent = 'Processing...';
        }
        const transferToInput = document.getElementById('transferTo');
                      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ø§Ú¯Ø± Ø¯Ø± data attribute Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
              const to = transferToInput.getAttribute('data-full-address') || transferToInput.value.trim();
        const amount = parseFloat(document.getElementById('transferAmount').value);
        const token = document.getElementById('transferToken').value;
        const status = document.getElementById('transferStatus');
        status.textContent = '';
        status.className = 'transfer-status';
        if (!to || !amount || amount <= 0) {
                      status.textContent = 'Please enter valid destination address and amount';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        if (!window.contractConfig || !window.contractConfig.contract || !window.contractConfig.signer) {
                      status.textContent = 'Wallet connection not established';
          status.className = 'transfer-status error';
          if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
          return;
        }
        try {
                      status.textContent = 'Sending...';
          status.className = 'transfer-status loading';
          if (token === 'pol') {
            // Transfer MATIC/POL
            const tx = await window.contractConfig.signer.sendTransaction({
              to,
              value: ethers.parseEther(amount.toString())
            });
            await tx.wait();
            status.textContent = 'Transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          } else if (token === 'dai') {
            // Transfer DAI - fix decimal to 18
            const daiContract = new ethers.Contract(DAI_ADDRESS, DAI_ABI, window.contractConfig.signer);
            const decimals = 18; // DAI has 18 decimals, not 6
            const parsedAmount = ethers.parseUnits(amount.toString(), decimals);
            const tx = await daiContract.transfer(to, parsedAmount);
            await tx.wait();
            status.textContent = 'DAI transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          } else {
            // Transfer IAM
            const contract = window.contractConfig.contract;
            const tx = await contract.transfer(to, ethers.parseEther(amount.toString()));
            await tx.wait();
            status.textContent = 'Transfer completed successfully!\nTransaction hash: ' + tx.hash;
            status.className = 'transfer-status success';
          }
          transferForm.reset();
          
          // Update balances after successful transfer
          setTimeout(autoRefreshTransferBalances, 2000);
        } catch (error) {
          let msg = error && error.message ? error.message : error;
          if (msg.includes('user rejected')) msg = 'Transaction cancelled by user';
          else if (msg.includes('insufficient funds')) msg = 'Insufficient balance';
          else if (msg.includes('invalid address')) msg = 'Invalid destination address';
          else if (msg.includes('nonce')) msg = 'Transaction number error. Please try again';
          else if (msg.includes('execution reverted')) msg = 'Transaction failed. Please check conditions';
          else msg = 'Transfer error: ' + msg;
          status.textContent = msg;
          status.className = 'transfer-status error';
        }
        if (transferBtn) { transferBtn.disabled = false; transferBtn.textContent = oldText; }
      });
    });
  </script>

  <script>
    // ØªØ§Ø¨Ø¹ Ú©ÙˆØªØ§Ù‡ Ú©Ø±Ø¯Ù† Ø¢Ø¯Ø±Ø³
    function shortenAddress(address) {
      if (address && address.length === 42 && address.startsWith('0x')) {
        return `${address.substring(0, 6)}...${address.substring(38)}`;
      }
      return address;
    }

    // Event listener Ø¨Ø±Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ Ú©Ø±Ø¯Ù† Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¯Ø³ØªÛŒ
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Manual address shortening script loaded');
      const transferToInput = document.getElementById('transferTo');
      console.log('TransferTo input found:', !!transferToInput);
      if (transferToInput) {
        transferToInput.addEventListener('blur', function() {
          console.log('TransferTo input blur event triggered');
          const value = this.value.trim();
          console.log('Input value:', value, 'Length:', value.length, 'Starts with 0x:', value.startsWith('0x'));
          if (value && value.length === 42 && value.startsWith('0x')) {
            // Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„
            this.setAttribute('data-full-address', value);
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ú©ÙˆØªØ§Ù‡ Ø´Ø¯Ù‡
            this.value = shortenAddress(value);
          }
        });
      }
    });
  </script>



  <script>
    // Function to expand/collapse expandable sections
    function toggleExpandable(containerId) {
      const container = document.getElementById(containerId);
      if (container) {
        container.classList.toggle('collapsed');
        
        // Save state in localStorage
        const isCollapsed = container.classList.contains('collapsed');
        localStorage.setItem(`expandable_${containerId}`, isCollapsed ? 'collapsed' : 'expanded');
      }
    }

    // Restore expandable sections state from localStorage
    function restoreExpandableStates() {
      const expandableContainers = document.querySelectorAll('.expandable-container');
      expandableContainers.forEach(container => {
        const containerId = container.id;
        const savedState = localStorage.getItem(`expandable_${containerId}`);
        if (savedState === 'collapsed') {
          container.classList.add('collapsed');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      restoreExpandableStates();
      
      
    });
  </script>

  <script>
    window.formatTokenPrice = function(priceWei) {
      if (!priceWei || priceWei === '0') return '0';
      let priceString = priceWei.toString();
      while (priceString.length < 18) priceString = '0' + priceString;
      if (priceString.length > 18) priceString = priceString.slice(-18);
      const result = '0.' + priceString;
      const numResult = parseFloat(result);
      if (numResult < 0.000001) {
        return numResult.toExponential(6);
      }
      return result;
    }

    // Function to update price display
    async function updateTokenPriceDisplay() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
          if (!window.contractConfig || !window.contractConfig.contract) {
            const el = document.getElementById('chart-lvl-usd');
            if (el) el.textContent = 'Connection failed';
            return;
          }
        }
        const contract = window.contractConfig.contract;
        const tokenPrice = await contract.getTokenPrice();
        const priceFormatted = window.formatTokenPrice(tokenPrice);
        const el = document.getElementById('chart-lvl-usd');
        if (el) el.textContent = priceFormatted;
        // Update point-value from contract
        try {
          const pointValue = await contract.getPointValue();
          const pointValueNum = parseFloat(ethers.formatUnits(pointValue, 18));
          const pointValueFormatted = pointValueNum < 0.000001 ? pointValueNum.toExponential(6) : pointValueNum.toFixed(2);
          const el2 = document.getElementById('point-value');
          if (el2) el2.textContent = pointValueFormatted; // Remove IAM suffix
        } catch (error) {
          // ...
        }
      } catch (error) {
        const el = document.getElementById('chart-lvl-usd');
                    if (el) el.textContent = 'Loading error';
      }
    }
    // ... existing code ...
  </script>

  <script>
    if (window.loadUserProfile) {
      const origLoadUserProfile = window.loadUserProfile;
      window.loadUserProfile = async function() {
        await origLoadUserProfile.apply(this, arguments);
        await updateProfileReferrer(); // Here with await and without delay
      };
    }
  </script>
  <script src="js/token-price.js"></script>
  <script src="js/remove-archive-btn.js"></script>



  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('connectProfileWalletBtn');
    if (btn) {
      btn.addEventListener('click', async function() {
        try {
          if (window.connectWallet) {
            await window.connectWallet();
            // After connecting, reload profile
            if (typeof loadUserProfile === 'function') loadUserProfile();
          }
        } catch (e) {
          alert('Wallet connection error: ' + (e.message || e));
        }
      });
    }
  });
  </script>

  <script src="js/navbar.js"></script>
  
      <!-- SwapManager initialization -->
  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('ğŸš€ Starting SwapManager initialization...');
      
              // Ensure swap.js is loaded
      if (typeof SwapManager !== 'undefined') {
        try {
          console.log('âœ… SwapManager class found');
          
          // Wait a bit for DOM to fully load
          await new Promise(resolve => setTimeout(resolve, 1000));
          
          // Check for required elements
          const requiredElements = ['swapForm', 'swapDirection', 'swapAmount', 'maxBtn', 'swapRate', 'swapPreview', 'swapLimitInfo', 'swapStatus'];
          const missingElements = requiredElements.filter(id => !document.getElementById(id));
          
          if (missingElements.length > 0) {
            console.warn('âš ï¸ The following elements were not found:', missingElements);
            return;
          }
          
          console.log('âœ… All required elements are present');
          
          // Check for required variables
          if (!window.DAI_ADDRESS || !window.DAI_ABI) {
            console.error('âŒ DAI_ADDRESS or DAI_ABI variables are not defined');
            return;
          }
          
          console.log('âœ… DAI variables are present');
          
          // Create SwapManager instance
          window.swapManager = new SwapManager();
          console.log('âœ… SwapManager instance created');
          
          // Initial setup
          await window.swapManager.initializeSwap();
          console.log('âœ… SwapManager initialized successfully');
          
        } catch (error) {
          console.error('âŒ Error initializing SwapManager:', error);
        }
      } else {
        console.warn('âš ï¸ SwapManager is not defined - swap.js file not loaded');
      }
      

    });
    
    // Re-initialization after wallet connection
    if (window.connectWallet) {
      const originalConnectWallet = window.connectWallet;
      window.connectWallet = async function() {
        const result = await originalConnectWallet();
        
        // Re-initialize SwapManager after connection
        setTimeout(async () => {
          if (window.swapManager && typeof window.swapManager.refreshSwapData === 'function') {
            try {
              console.log('ğŸ”„ Refreshing SwapManager after wallet connection...');
              await window.swapManager.refreshSwapData();
              console.log('âœ… SwapManager refreshed');
            } catch (error) {
              console.warn('âš ï¸ Error refreshing SwapManager:', error);
            }
          }
                  // Update index dashboard status bar
        try { if (typeof window.indexStatusTryUpdate === 'function') window.indexStatusTryUpdate(); } catch(_) {}
        
        // Update user status bar
        try { if (typeof window.updateUserStatusBar === 'function') window.updateUserStatusBar(); } catch(_) {}
        }, 1000);
        
        return result;
      };
    }
  </script>



  </script>
  </div>

<style>
/* File cleaned - new CSS is at the end */

/* === All cards fixed width on mobile === */
@media (max-width: 768px) {
  /* Main cards container */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-direction: column !important;
    gap: 0.8rem !important;
    width: 100% !important;
    padding: 0 0.5rem !important;
  }
  
  /* All cards fixed full width */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
    flex: none !important;
    padding: 1.2rem !important;
    margin: 0 !important;
    margin-bottom: 0.8rem !important;
    border-radius: 12px !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3) !important;
    backdrop-filter: blur(6px) !important;
    border: 1.5px solid rgba(255,255,255,0.15) !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
  }
  
  /* Card icons */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:1.2rem;margin-bottom:0.3rem;"] {
    font-size: 1.8rem !important;
    margin-bottom: 0.6rem !important;
    text-align: center !important;
  }
  
  /* Card titles */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;"] {
    font-size: 1rem !important;
    margin-bottom: 0.4rem !important;
    letter-spacing: 0.3px !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  /* Card values - fix overflow */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    font-size: 1.1rem !important;
    margin: 0.6rem 0 !important;
    letter-spacing: 0.2px !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.4) !important;
    text-align: center !important;
    word-break: break-all !important;
    overflow-wrap: break-word !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  
  /* Card descriptions */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.7rem;margin-top:0.2rem;"] {
    font-size: 0.8rem !important;
    margin-top: 0.4rem !important;
    opacity: 0.7 !important;
    text-align: center !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  /* Special cards - special sizes */
  
  /* Total supply card */
  div[style*="border:1px solid rgba(0,255,136,0.2)"] {
    border: 3px solid rgba(0,255,136,0.4) !important;
    background: rgba(0,255,136,0.1) !important;
  }
  
  /* IAM contract balance card */
  div[style*="border:1px solid rgba(255,193,7,0.2)"] {
    border: 3px solid rgba(255,193,7,0.4) !important;
    background: rgba(255,193,7,0.1) !important;
  }
  
  /* DAI balance card */
  div[style*="border:1px solid rgba(0,123,255,0.2)"] {
    border: 3px solid rgba(0,123,255,0.4) !important;
    background: rgba(0,123,255,0.1) !important;
  }
  
  /* Registration price card */
  div[style*="border:1px solid rgba(138,43,226,0.2)"] {
    border: 3px solid rgba(138,43,226,0.4) !important;
    background: rgba(138,43,226,0.1) !important;
  }
  
  /* Card Entry Animation */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    animation: slideUpMobile 0.6s ease-out !important;
    animation-delay: calc(var(--card-index, 0) * 0.1s) !important;
  }
}

/* Card Entry Animation on Mobile */
@keyframes slideUpMobile {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* For very small screens */
@media (max-width: 480px) {
  /* Cards container */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    padding: 0 0.3rem !important;
    gap: 0.6rem !important;
  }
  
  /* Cards */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    padding: 1rem !important;
    margin-bottom: 0.6rem !important;
    border-radius: 10px !important;
  }
  
  /* Icons */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:1.2rem;margin-bottom:0.3rem;"] {
    font-size: 1.5rem !important;
    margin-bottom: 0.5rem !important;
  }
  
  /* Titles */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.8rem;font-weight:bold;margin-bottom:0.2rem;"] {
    font-size: 0.9rem !important;
    margin-bottom: 0.3rem !important;
  }
  
  /* Values */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    font-size: 1rem !important;
    margin: 0.5rem 0 !important;
    line-height: 1.2 !important;
  }
  
  /* Descriptions */
  div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.7rem;margin-top:0.2rem;"] {
    font-size: 0.75rem !important;
    margin-top: 0.3rem !important;
  }
}

/* Prevent long numbers from overflowing out of cards (in all sizes) */
div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
  word-break: break-all !important;
  overflow-wrap: anywhere !important;
  white-space: normal !important;
  max-width: 100% !important;
}

/* Responsive Layout for Dashboard Metric Cards on Tablet and Desktop */
@media (min-width: 769px) and (max-width: 1023px) {
  /* Cards container â†’ 2 columns per row */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: grid !important;
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 0.8rem !important;
    justify-content: center !important;
  }
  /* Ø®ÙˆØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ø¸Ø±Ù Ø¨Ø§Ù„Ø§ */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    flex: none !important;
    box-sizing: border-box !important;
  }
}

@media (min-width: 1024px) {
  /* Cards container â†’ 3 columns per row */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: grid !important;
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 1rem !important;
    justify-content: center !important;
  }
  /* Ø®ÙˆØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ø¸Ø±Ù Ø¨Ø§Ù„Ø§ */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    min-width: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    flex: none !important;
    box-sizing: border-box !important;
  }
}

/* Dynamic Width Mode for Dashboard Metric Cards on Tablet/Desktop
   This block overrides the grid rules above to make cards expand to content width */
@media (min-width: 769px) {
  /* Cards container: flex and wrappable */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 0.8rem !important;
    justify-content: center !important;
    align-items: stretch !important;
  }
  /* Cards themselves: width based on content */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    flex: 0 0 auto !important;
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
    box-sizing: border-box !important;
  }
  /* Values: stay single-line so card expands */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    white-space: nowrap !important;
    word-break: normal !important;
    overflow-wrap: normal !important;
  }
}

/* Dynamic Width Mode for Dashboard Metric Cards on Mobile */
@media (max-width: 768px) {
  /* Cards container: flex, active wrapping, row layout, horizontal scroll if needed */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: flex-start !important;
    align-items: stretch !important;
    gap: 0.6rem !important;
    width: 100% !important;
    padding: 0 0.5rem !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  /* Cards: width based on content, prevent stretching to 100% */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] {
    flex: 0 0 auto !important;
    width: auto !important;
    min-width: max-content !important;
    max-width: none !important;
    box-sizing: border-box !important;
    margin: 0 !important;
  }
  /* Values: single-line to increase card width */
  div[style*="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;justify-content:center;"] > div[style*="background:rgba(0,0,0,0.3);border-radius:12px;padding:0.8rem;border:1px solid"] > div[style*="font-size:0.9rem;font-family:monospace;font-weight:bold;"] {
    white-space: nowrap !important;
    word-break: normal !important;
    overflow-wrap: normal !important;
  }
}
</style>

<script>
// Manage cards and values on mobile
function optimizeCardsForMobile() {
  if (window.innerWidth <= 768) {
    // Find all cards
    const cards = document.querySelectorAll('div[style*="background:rgba(0,0,0,0.3)"]');
    
    cards.forEach((card, index) => {
      // Fix width
      card.style.width = '100%';
      card.style.maxWidth = '100%';
      card.style.minWidth = '100%';
      card.style.boxSizing = 'border-box';
      card.style.overflow = 'hidden';
      
      // Entry Animation
      card.style.setProperty('--card-index', index.toString());
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      
      // Delay for animation
      setTimeout(() => {
        card.style.transition = 'all 0.4s ease';
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 80);
      
      // Optimize values inside card
      const valueElements = card.querySelectorAll('div[style*="font-family:monospace"]');
      valueElements.forEach(valueEl => {
        valueEl.style.wordBreak = 'break-all';
        valueEl.style.overflowWrap = 'break-word';
        valueEl.style.maxWidth = '100%';
        valueEl.style.textAlign = 'center';
        
        // If value is too long, make font smaller
        const text = valueEl.textContent || '';
        if (text.length > 15) {
          valueEl.style.fontSize = '0.9rem';
          valueEl.style.lineHeight = '1.2';
        }
        if (text.length > 25) {
          valueEl.style.fontSize = '0.8rem';
          valueEl.style.lineHeight = '1.1';
        }
      });
    });
    
    // Optimize main container
    const container = document.querySelector('div[style*="display:flex;flex-wrap:wrap"]');
    if (container) {
      container.style.width = '100%';
      container.style.padding = '0 0.5rem';
      container.style.boxSizing = 'border-box';
    }
  }
}

// Manage mobile refresh button
document.addEventListener('DOMContentLoaded', function() {
  // Optimize cards for mobile
  setTimeout(() => {
    optimizeCardsForMobile();
  }, 800);
  
  // Re-optimize when page size changes
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      optimizeCardsForMobile();
    }, 300);
  });
  
  // Re-optimize when values update
  const observer = new MutationObserver(() => {
    if (window.innerWidth <= 768) {
      setTimeout(optimizeCardsForMobile, 200);
    }
  });
  
  // Monitor changes in cards
  const targetNode = document.querySelector('div[style*="display:flex;flex-wrap:wrap"]');
  if (targetNode) {
    observer.observe(targetNode, {
      childList: true,
      subtree: true,
      characterData: true
    });
  }
  
  // Main page codes
});



// End of main scripts



// Voting Functions for Main Section
async function voteForIndexMain(isLike) {
  try {
    const indexInput = document.getElementById('vote-index-input-main');
    const voteResult = document.getElementById('vote-result-main');

    if (!indexInput) {
      throw new Error('Index input field not found');
    }

    const index = parseInt(indexInput.value.trim());

    if (!index || index <= 0) {
      voteResult.innerHTML = '<span style="color: #ff4444;">âš ï¸ Please enter a valid index</span>';
      return;
    }

    if (!window.contractConfig || !window.contractConfig.contract) {
      await window.connectWallet();
    }
    const contract = window.contractConfig.contract;

    if (!contract) {
      throw new Error('Contract not connected');
    }

    // Check wallet connection
    if (!window.contractConfig.signer) {
      throw new Error('Wallet not connected');
    }

    // Get user address from index
    const userAddress = await contract.indexToAddress(index);

    if (userAddress === '0x0000000000000000000000000000000000000000') {
      voteResult.innerHTML = '<span style="color: #ff4444;">âš ï¸ No user found with this index</span>';
      return;
    }

    // Check if user is trying to vote for themselves
    const currentUserAddress = window.contractConfig.signer.address;
    if (userAddress.toLowerCase() === currentUserAddress.toLowerCase()) {
      voteResult.innerHTML = '<span style="color: #ff4444;">âŒ Cannot vote for yourself</span>';
      return;
    }

    // Show processing message
    voteResult.innerHTML = '<span style="color: #a786ff;">â³ Sending vote...</span>';

    // Send voting transaction
    const tx = await contract.voteUser(userAddress, isLike);

    // Wait for transaction confirmation
    const receipt = await tx.wait();

    // Show success message
    const successMessage = isLike ? 'âœ… Like successfully registered' : 'âœ… Dislike successfully registered';
    voteResult.innerHTML = `<span style="color: #00ff88;">${successMessage}</span>`;
    
    // Show alert too
    alert(successMessage);

    // Update user vote status
    updateUserVoteStatus();

    // Update ranking after 2 seconds
    setTimeout(() => {
      if (typeof window.displayTopUsersRanking === 'function') {
        const rankingContainer = document.getElementById('top-users-ranking');
        if (rankingContainer) {
          window.displayTopUsersRanking('top-users-ranking');
        }
      }
    }, 2000);

    return {
      success: true,
      transactionHash: receipt.transactionHash,
      userAddress: userAddress,
      voteType: isLike ? 'like' : 'dislike'
    };

  } catch (error) {
    console.error('âŒ Error voting for index:', error);
    const voteResult = document.getElementById('vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">âŒ Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function voteForSelfMain(isLike) {
  try {
    const voteResult = document.getElementById('vote-result-main');
    
    // Show error message immediately since self-voting is not allowed
    voteResult.innerHTML = '<span style="color: #ff4444;">âŒ Self-voting is not allowed by the smart contract</span>';
    
    // Show alert
    alert('âŒ Self-voting is not allowed by the smart contract');
    
    return {
      success: false,
      error: 'Self-voting is not allowed by the smart contract'
    };

  } catch (error) {
    console.error('âŒ Error voting for self:', error);
    const voteResult = document.getElementById('vote-result-main');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">âŒ Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function voteForSelf(isLike) {
  try {
    const voteResult = document.getElementById('vote-result');

    // Show error message immediately since self-voting is not allowed
    voteResult.innerHTML = '<span style="color: #ff4444;">âŒ Self-voting is not allowed by the smart contract</span>';
    
    // Show alert
    alert('âŒ Self-voting is not allowed by the smart contract');

    return {
      success: false,
      error: 'Self-voting is not allowed by the smart contract'
    };

  } catch (error) {
    console.error('âŒ Error voting for self:', error);
    const voteResult = document.getElementById('vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">âŒ Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

async function updateUserVoteStatusMain() {
  try {
    if (!window.contractConfig || !window.contractConfig.contract) {
      return;
    }

    const contract = window.contractConfig.contract;
    const currentUserAddress = window.contractConfig.signer?.address;

    if (!currentUserAddress) {
      return;
    }

    const voteStatus = await contract.getVoteStatus(currentUserAddress);
    const statusElement = document.getElementById('user-vote-status-main');
    
    if (statusElement) {
      const myVote = Number(voteStatus[2]); // 0: no vote, 1: like, 2: dislike
      if (myVote == 1) {
        statusElement.innerHTML = '<span style="color: #00ff88;">âœ“ Self-liked</span>';
      } else if (myVote == 2) {
        statusElement.innerHTML = '<span style="color: #ff4444;">âœ— Self-disliked</span>';
      } else {
        statusElement.innerHTML = '<span style="color: #ccc;">Not voted yet</span>';
      }
    }
  } catch (error) {
    console.warn('âš ï¸ Error updating user vote status:', error);
  }
}

async function updateUserVoteStatus() {
  try {
    if (!window.contractConfig || !window.contractConfig.contract) {
      return;
    }

    const contract = window.contractConfig.contract;
    const currentUserAddress = window.contractConfig.signer?.address;

    if (!currentUserAddress) {
      return;
    }

    const voteStatus = await contract.getVoteStatus(currentUserAddress);
    const statusElement = document.getElementById('user-vote-status');
    
    if (statusElement) {
      const myVote = Number(voteStatus[2]); // 0: no vote, 1: like, 2: dislike
      if (myVote == 1) {
        statusElement.innerHTML = '<span style="color: #00ff88;">âœ“ Self-liked</span>';
      } else if (myVote == 2) {
        statusElement.innerHTML = '<span style="color: #ff4444;">âœ— Self-disliked</span>';
      } else {
        statusElement.innerHTML = '<span style="color: #ccc;">Not voted yet</span>';
      }
    }
  } catch (error) {
    console.warn('âš ï¸ Error updating user vote status:', error);
  }
}

// Make voting functions globally available
window.voteForIndex = voteForIndex;
window.voteForSelf = voteForSelf;
window.updateUserVoteStatus = updateUserVoteStatus;

// Update vote status when wallet connects
document.addEventListener('DOMContentLoaded', function() {
  // Check vote status after wallet connection
  if (window.contractConfig && window.contractConfig.signer) {
    setTimeout(updateUserVoteStatus, 2000);
  }
  

});

// Quick traversal functions
async function startQuickTraversal(method = 'bfs') {
  try {
    console.log(`ğŸš€ Starting quick ${method.toUpperCase()} traversal...`);
    
    const progressElement = document.getElementById('traversal-progress');
    const statusElement = document.getElementById('traversal-status');
    
    if (progressElement) {
      progressElement.style.display = 'block';
    }
    
    if (statusElement) {
      statusElement.textContent = `Starting ${method.toUpperCase()} traversal...`;
    }
    
    // Add event listener for progress updates
    const progressHandler = (event) => {
      const { totalFound, currentIndex, isComplete } = event.detail;
      
      if (statusElement) {
        if (method === 'index') {
          statusElement.textContent = `Processed ${currentIndex} indices, found ${totalFound} users`;
        } else {
          statusElement.textContent = `Found ${totalFound} users so far...`;
        }
      }
      
      if (isComplete) {
        if (statusElement) {
          statusElement.textContent = `âœ… Traversal completed! Found ${totalFound} users`;
        }
        
        // Hide progress after 3 seconds
        setTimeout(() => {
          if (progressElement) {
            progressElement.style.display = 'none';
          }
        }, 3000);
        
        // Remove event listener
        document.removeEventListener('traversalProgress', progressHandler);
      }
    };
    
    document.addEventListener('traversalProgress', progressHandler);
    
    let users;
    
                   switch (method.toLowerCase()) {
        case 'bfs':
          users = await window.traverseAllUsers('bfs', 1, 50);
          break;
        case 'dfs':
          users = await window.traverseAllUsers('dfs', 1, 50);
          break;
        case 'index':
          users = await window.traverseAllUsers('index', 1, 50);
          break;
        case 'unlimited':
          users = await window.traverseAllUsers('unlimited', 1, 50);
          break;
        default:
          users = await window.traverseAllUsers('bfs', 1, 50);
      }
    
    console.log(`âœ… Quick ${method.toUpperCase()} traversal completed! Found ${users.length} users`);
    
    // Show success message
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #00ff88;">âœ… Found ${users.length} users! Results cached.</span>`;
    }
    
    // Update ranking with new data
    setTimeout(() => {
      if (typeof window.displayTopUsersRanking === 'function') {
        const rankingContainer = document.getElementById('top-users-ranking');
        if (rankingContainer) {
          window.displayTopUsersRanking('top-users-ranking');
        }
      }
    }, 2000);
    
    return users;
    
  } catch (error) {
    console.error('âŒ Error in quick traversal:', error);
    
    const statusElement = document.getElementById('traversal-status');
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #ff4444;">âŒ Error: ${error.message}</span>`;
    }
    
    // Hide progress after 5 seconds
    setTimeout(() => {
      const progressElement = document.getElementById('traversal-progress');
      if (progressElement) {
        progressElement.style.display = 'none';
      }
    }, 5000);
    
    throw error;
  }
}

function stopQuickTraversal() {
  try {
    window.stopTraversal();
    
    const statusElement = document.getElementById('traversal-status');
    if (statusElement) {
      statusElement.innerHTML = `<span style="color: #ffaa00;">â¹ï¸ Traversal stopped by user</span>`;
    }
    
    // Hide progress after 3 seconds
    setTimeout(() => {
      const progressElement = document.getElementById('traversal-progress');
      if (progressElement) {
        progressElement.style.display = 'none';
      }
    }, 3000);
    
    console.log('â¹ï¸ Quick traversal stopped by user');
    
  } catch (error) {
    console.error('âŒ Error stopping traversal:', error);
  }
}

// Make functions globally available
window.startQuickTraversal = startQuickTraversal;
window.stopQuickTraversal = stopQuickTraversal;

// Toggle voting section visibility
function toggleVotingSection() {
  console.log('âŒ Voting section not found');
}

// Make toggle function globally available
window.toggleVotingSection = toggleVotingSection;







// Popular Indexes Functions
function togglePopularIndexes() {
  const content = document.getElementById('popular-indexes-content');
  const toggleBtn = document.getElementById('popular-indexes-toggle');
  
  if (content.style.display === 'none' || !content.style.display) {
    content.style.display = 'block';
    toggleBtn.innerHTML = 'ğŸ“Š Hide Most Popular';
    toggleBtn.style.background = 'linear-gradient(135deg,#ff4444,#cc3333)';
    loadPopularIndexes();
  } else {
    content.style.display = 'none';
    toggleBtn.innerHTML = 'ğŸ“Š Show Most Popular';
    toggleBtn.style.background = 'linear-gradient(135deg,#00ff88,#00cc6a)';
  }
}

async function loadPopularIndexes() {
  try {
    const listContainer = document.getElementById('popular-indexes-list');
    listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">Loading most popular indexes...</div>';
    
    if (!window.contractConfig || !window.contractConfig.contract) {
      listContainer.innerHTML = '<div style="text-align: center; color: #ff4444; font-size: 0.9rem; padding: 2rem;">Please connect your wallet first</div>';
      return;
    }
    
    const contract = window.contractConfig.contract;
    
    // Get top users (we'll use the existing ranking function if available)
    if (typeof window.displayTopUsersRanking === 'function') {
      // Use existing ranking function
      const popularUsers = await getTopUsersByLikes(10);
      displayPopularIndexes(popularUsers);
    } else {
      // Fallback: show a simple list
      listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">Ranking system not available</div>';
    }
    
  } catch (error) {
    console.error('âŒ Error loading popular indexes:', error);
    const listContainer = document.getElementById('popular-indexes-list');
    listContainer.innerHTML = `<div style="text-align: center; color: #ff4444; font-size: 0.9rem; padding: 2rem;">Error loading: ${error.message}</div>`;
  }
}

async function getTopUsersByLikes(limit = 10) {
  try {
    const contract = window.contractConfig.contract;
    const users = [];
    
    // Check first 50 users for likes
    for (let i = 1; i <= 50; i++) {
      try {
        const userAddress = await contract.indexToAddress(i);
        if (userAddress && userAddress !== '0x0000000000000000000000000000000000000000') {
          const likeCount = await contract.likeCount(userAddress);
          
          if (Number(likeCount) > 0) {
            users.push({
              index: i,
              address: userAddress,
              likeCount: Number(likeCount)
            });
          }
        }
      } catch (error) {
        console.log(`Error getting user ${i}:`, error.message);
        continue;
      }
    }
    
    // Sort by like count (descending)
    users.sort((a, b) => b.likeCount - a.likeCount);
    
    return users.slice(0, limit);
    
  } catch (error) {
    console.error('âŒ Error getting top users:', error);
    return [];
  }
}

function displayPopularIndexes(users) {
  const listContainer = document.getElementById('popular-indexes-list');
  
  if (!users || users.length === 0) {
    listContainer.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">No users found</div>';
    return;
  }
  
  let html = '';
  users.forEach((user, index) => {
    const rank = index + 1;
    const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `#${rank}`;
    const shortAddress = user.address.substring(0, 6) + '...' + user.address.substring(user.address.length - 4);
    
    html += `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; margin-bottom: 0.5rem; background: rgba(0,255,136,0.1); border-radius: 8px; border: 1px solid rgba(0,255,136,0.2);">
        <div style="display: flex; align-items: center; gap: 0.8rem;">
          <div style="color: #00ff88; font-weight: bold; font-size: 1.1rem;">${rankEmoji}</div>
          <div>
            <div style="color: #fff; font-weight: bold; font-size: 0.9rem;">Index ${user.index}</div>
            <div style="color: #ccc; font-size: 0.8rem; font-family: monospace;">${shortAddress}</div>
          </div>
        </div>
        <div style="text-align: right;">
          <div style="color: #00ff88; font-weight: bold; font-size: 0.9rem;">ğŸ‘ ${user.likeCount}</div>
        </div>
      </div>
    `;
  });
  
  listContainer.innerHTML = html;
}

async function voteForPopularIndex(isLike) {
  try {
    const indexInput = document.getElementById('popular-vote-index');
    const voteResult = document.getElementById('popular-vote-result');
    
    if (!indexInput) {
      throw new Error('Index input field not found');
    }
    
    const index = parseInt(indexInput.value.trim());
    
    if (!index || index <= 0) {
      voteResult.innerHTML = '<span style="color: #ff4444;">âš ï¸ Please enter a valid index</span>';
      return;
    }
    
    if (!window.contractConfig || !window.contractConfig.contract) {
      await window.connectWallet();
    }
    const contract = window.contractConfig.contract;
    
    if (!contract) {
      throw new Error('Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª');
    }
    
    // Check wallet connection
    if (!window.contractConfig.signer) {
      throw new Error('Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù…ØªØµÙ„ Ù†ÛŒØ³Øª');
    }
    
    // Get user address from index
    const userAddress = await contract.indexToAddress(index);
    
    if (userAddress === '0x0000000000000000000000000000000000000000') {
      voteResult.innerHTML = '<span style="color: #ff4444;">âš ï¸ No user found with this index</span>';
      return;
    }
    
    // Check if user is trying to vote for themselves
    const currentUserAddress = window.contractConfig.signer.address;
    if (userAddress.toLowerCase() === currentUserAddress.toLowerCase()) {
      voteResult.innerHTML = '<span style="color: #ff4444;">âŒ You cannot vote for yourself</span>';
      return;
    }
    
    // Show processing message
    voteResult.innerHTML = '<span style="color: #a786ff;">â³ Sending vote...</span>';
    
    // Send voting transaction
    const tx = await contract.voteUser(userAddress, isLike);
    
    // Wait for transaction confirmation
    const receipt = await tx.wait();
    
    // Show success message
    const successMessage = isLike ? 'âœ… Like successfully registered' : 'âœ… Dislike successfully registered';
    voteResult.innerHTML = `<span style="color: #00ff88;">${successMessage}</span>`;
    
    // Clear input
    indexInput.value = '';
    
    // Show alert too
    alert(successMessage);
    
    // Refresh popular indexes list after 2 seconds
    setTimeout(() => {
      loadPopularIndexes();
    }, 2000);
    
    return {
      success: true,
      transactionHash: receipt.transactionHash,
      userAddress: userAddress,
      voteType: isLike ? 'like' : 'dislike'
    };
    
  } catch (error) {
    console.error('âŒ Error voting for popular index:', error);
    const voteResult = document.getElementById('popular-vote-result');
    if (voteResult) {
      voteResult.innerHTML = `<span style="color: #ff4444;">âŒ Error: ${error.message}</span>`;
    }
    return {
      success: false,
      error: error.message
    };
  }
}

function refreshPopularIndexes() {
  loadPopularIndexes();
}

// Make popular indexes functions globally available
window.togglePopularIndexes = togglePopularIndexes;
window.loadPopularIndexes = loadPopularIndexes;
window.voteForPopularIndex = voteForPopularIndex;
window.refreshPopularIndexes = refreshPopularIndexes;



</script>

<!-- Floating Token Growth Card - Ú©Ø§Ø±Øª Ø´Ù†Ø§ÙˆØ± Ø±Ø´Ø¯ ØªÙˆÚ©Ù† -->
<script src="js/floating-token-card.js"></script>

<!-- Ø§Ø¹Ù…Ø§Ù„ ØªÙ… Ù…Ø¯Ø±Ù† -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸ¨ Ø§Ø¹Ù…Ø§Ù„ ØªÙ… Ù…Ø¯Ø±Ù† Ù†Ø§Ø±Ù†Ø¬ÛŒ Ùˆ Ø¨Ù†ÙØ´...');
  
  // Apply modern-card class to all existing cards
  const cards = document.querySelectorAll('.dashboard-card');
  cards.forEach(card => {
    if (!card.classList.contains('modern-card')) {
      card.classList.add('modern-card');
    }
  });
  
  // Apply modern-btn class to all buttons
  const buttons = document.querySelectorAll('button');
  buttons.forEach(button => {
    if (!button.classList.contains('modern-btn')) {
      button.classList.add('modern-btn', 'modern-btn-primary');
    }
  });
  
  // Apply modern-input class to all input fields
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    if (!input.classList.contains('modern-input')) {
      input.classList.add('modern-input');
    }
  });
  
  console.log('âœ… ØªÙ… Ù…Ø¯Ø±Ù† Ù†Ø§Ø±Ù†Ø¬ÛŒ Ùˆ Ø¨Ù†ÙØ´ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯');
});
</script>

<!-- Most Popular Indexes Section - Always Expanded at Bottom -->
<div id="popular-indexes-section" class="modern-card" style="margin-top: 2rem; margin-bottom: 2rem; padding: 1.5rem; border: 2px solid rgba(0,255,136,0.3); border-radius: 15px; background: linear-gradient(135deg, rgba(26,31,46,0.9), rgba(42,47,62,0.9));">
  <div style="text-align: center; margin-bottom: 1.5rem;">
    <h3 style="color: #00ff88; font-size: 1.3rem; font-weight: bold; margin: 0; margin-bottom: 0.5rem;">ğŸŒŸ Most Popular Indexes</h3>
    <p style="color: #ccc; font-size: 0.9rem; margin: 0;">List of most popular network users based on positive votes</p>
  </div>
  
  <!-- Always Visible Content -->
  <div id="popular-indexes-content" style="display: block;">
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; margin-bottom: 1.5rem;">
      <!-- Popular Indexes List -->
      <div style="flex: 1; min-width: 300px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1rem; border: 1px solid rgba(0,255,136,0.2);">
        <div style="text-align: center; margin-bottom: 1rem;">
          <h4 style="color: #00ff88; font-size: 1.1rem; font-weight: bold; margin: 0;">ğŸ† Most Popular Rankings</h4>
        </div>
        <div id="popular-indexes-list" style="max-height: 300px; overflow-y: auto;">
          <div style="text-align: center; color: #888; font-size: 0.9rem; padding: 2rem;">
            Loading most popular indexes...
          </div>
        </div>
      </div>
      
      <!-- Voting Section -->
      <div style="flex: 1; min-width: 300px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1rem; border: 1px solid rgba(167,134,255,0.2);">
        <div style="text-align: center; margin-bottom: 1rem;">
          <h4 style="color: #a786ff; font-size: 1.1rem; font-weight: bold; margin: 0;">ğŸ—³ï¸ Voting</h4>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <label style="color: #ccc; font-size: 0.9rem; font-weight: bold;">Target Index:</label>
            <input type="number" id="popular-vote-index" placeholder="Enter index number" 
                   style="background: rgba(0,0,0,0.3); border: 1px solid rgba(167,134,255,0.3); border-radius: 8px; padding: 0.8rem; color: #fff; text-align: center; font-size: 0.9rem; font-family: monospace;">
          </div>
          
          <div style="display: flex; gap: 0.5rem; justify-content: center;">
            <button onclick="voteForPopularIndex(true)" 
                    style="background: linear-gradient(135deg,#00ff88,#00cc6a); color: #1a1f2e; border: none; border-radius: 8px; padding: 0.8rem 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
              ğŸ‘ Like
            </button>
            <button onclick="voteForPopularIndex(false)" 
                    style="background: linear-gradient(135deg,#ff4444,#cc3333); color: #fff; border: none; border-radius: 8px; padding: 0.8rem 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem; flex: 1;">
              ğŸ‘ Dislike
            </button>
          </div>
          
          <div id="popular-vote-result" style="text-align: center; padding: 0.5rem; border-radius: 8px; font-size: 0.9rem; min-height: 1.5em;"></div>
        </div>
      </div>
    </div>
    
    <!-- Refresh Button -->
    <div style="text-align: center;">
      <button onclick="refreshPopularIndexes()" 
              style="background: linear-gradient(135deg,#a786ff,#8a6fff); color: #fff; border: none; border-radius: 8px; padding: 0.8rem 1.5rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;">
        ğŸ”„ Refresh List
      </button>
    </div>
  </div>
</div>

<!-- Auto-load popular indexes when page loads -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Auto-load popular indexes after a short delay
  setTimeout(() => {
    if (typeof loadPopularIndexes === 'function') {
      loadPopularIndexes();
    }
  }, 2000);
});
</script>

</body>
</html>
</html>