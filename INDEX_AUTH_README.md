# 🔐 سیستم احراز هویت بر اساس ایندکس

## 📋 خلاصه
سیستم جدید احراز هویت که فقط به کاربران دارای **ایندکس معتبر** اجازه دسترسی به بخش‌های سوشال مدیا می‌دهد.

## 🎯 هدف
- **احراز هویت:** فقط کاربران ثبت‌نام شده با ایندکس > 0
- **سوشال مدیا:** محدود کردن دسترسی به صفحات سوشال
- **نام کاربری:** برای نمایش، ایندکس برای احراز هویت

## 🛠️ فایل‌های تغییر یافته

### ✅ فایل‌های جدید:
- **`js/index-auth.js`** - کلاس اصلی احراز هویت

### 🔄 فایل‌های آپدیت شده:
- **`seller.html`** - پشتیبانی از `?index=123` + احراز هویت
- **`explorer.html`** - احراز هویت اجباری
- **`feed.html`** - احراز هویت اجباری
- **`js/sidebar-menu.js`** - لینک با ایندکس

## 🚀 نحوه کارکرد

### 1. بررسی احراز هویت:
```javascript
const isAuth = await window.requireUserIndex('نام صفحه');
if (!isAuth) {
  // پیام خطا نمایش داده شده
  return;
}
```

### 2. دریافت اطلاعات کاربر:
```javascript
const userIndex = window.getCurrentUserIndex();
const userName = window.getCurrentUserName();
```

### 3. لینک پروفایل:
```
seller.html?index=123  // جدید - بر اساس ایندکس
seller.html?seller=0x...  // قدیمی - پشتیبانی شده
```

## 🔒 صفحات محافظت شده

### احراز هویت اجباری:
- **`seller.html`** - پروفایل کاربری
- **`explorer.html`** - اکسپلورر پست‌ها  
- **`feed.html`** - فید اصلی

### پیام خطا:
- 🚫 دسترسی محدود
- پیشنهاد ثبت‌نام
- لینک بازگشت به خانه

## 📊 جزئیات پیاده‌سازی

### کلاس IndexAuth:
```javascript
window.indexAuth = new IndexAuth();

// متدهای اصلی:
- checkAuthentication()     // بررسی احراز هویت
- getDisplayName()         // نام نمایشی
- setDisplayName(name)     // تنظیم نام
- getUserIndex()           // دریافت ایندکس
- canAccessSocial()        // بررسی دسترسی
- requireAuth(pageName)    // احراز هویت اجباری
```

### توابع کمکی سراسری:
```javascript
window.requireUserIndex(pageName)   // بررسی سریع
window.getCurrentUserIndex()        // دریافت ایندکس
window.getCurrentUserName()         // دریافت نام
```

## 🎨 رابط کاربری

### پیام خطای دسترسی:
- **طراحی:** مودال تمام صفحه
- **رنگ:** قرمز (#ff6b6b) برای خطا
- **دکمه‌ها:** ثبت‌نام (سبز) + بازگشت (بنفش)
- **بسته شدن:** خودکار بعد از 10 ثانیه

### نمایش نام کاربری:
1. **اولویت اول:** نام ذخیره شده در localStorage
2. **اولویت دوم:** "کاربر #123" (بر اساس ایندکس)

## 🔄 مسیریابی

### Sidebar → صفحه شخصی:
```javascript
// جدید: استفاده از ایندکس
window.location.href = `seller.html?index=${userIndex}`;

// قدیمی: fallback با آدرس
window.location.href = `seller.html?seller=${address}`;
```

### seller.html:
- **پشتیبانی:** هر دو parameter (`index` و `seller`)
- **تبدیل:** ایندکس → آدرس (از کنترکت)
- **خطا:** مدیریت خطاهای دریافت آدرس

## ⚡ مزایا

1. **امنیت:** فقط کاربران ثبت‌نام شده
2. **یکپارچگی:** همه صفحات سوشال محافظت شده
3. **کاربرپسند:** پیام‌های واضح و راهنما
4. **انعطاف:** پشتیبانی از روش‌های قدیمی
5. **کارآمد:** cache و مدیریت خطا

## 🚨 نکات مهم

- **ایندکس صفر:** کاربران غیرفعال دسترسی ندارند
- **مدیریت خطا:** تمام خطاها catch و نمایش داده می‌شوند
- **localStorage:** نام کاربری محلی ذخیره می‌شود
- **Fallback:** روش‌های قدیمی همچنان کار می‌کنند

## 🎯 نتیجه

سیستم احراز هویت بر اساس ایندکس با موفقیت پیاده‌سازی شد:
- ✅ کاربران فعال: دسترسی کامل
- ❌ کاربران غیرفعال: عدم دسترسی + راهنمایی
- 🔄 یکپارچگی: همه صفحات سوشال محافظت شده

