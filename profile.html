<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background: linear-gradient(135deg, #232946 0%, #181c2a 100%);
            margin: 0;
            padding: 0;
            direction: rtl;
            color: #e0e6f7;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            background: rgba(35,41,70,0.98);
            border-radius: 18px;
            box-shadow: 0 4px 24px #0005;
            padding: 36px 22px 28px 22px;
            border: 2px solid #a786ff33;
        }
        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 28px;
            font-weight: 700;
            letter-spacing: 0.5px;
            font-size: 2.1em;
            text-shadow: 0 2px 8px #00ff8822;
        }
        .profile-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2d3250;
            font-size: 1.08em;
        }
        .profile-row:last-child { border-bottom: none; }
        .profile-label { color: #a786ff; font-weight: bold; }
        .profile-value { color: #e0e6f7; font-family: monospace; }
        .balance-box {
            background: #181c2a;
            border-radius: 10px;
            margin: 18px 0 28px 0;
            box-shadow: 0 2px 8px #a786ff11;
            padding: 18px 14px 10px 14px;
            /* Ú†ÛŒØ¯Ù…Ø§Ù† Ù¾ÙˆÛŒØ§: Ø¹Ø±Ø¶ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØªÙˆØ§ */
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            align-items: stretch;
            justify-content: flex-start;
        }
        .balance-item {
            /* Ú©Ø§Ø±Øª Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡Ù” Ù…Ø­ØªÙˆØ§ Ø¹Ø±ÛŒØ¶ Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
            flex: 0 0 auto;
            min-width: auto;
            margin: 0;
            box-sizing: border-box;
            text-align: center;
        }
        .balance-label { color: #00ff88; font-weight: bold; font-size: 1.08em; }
        .balance-value { color: #fff; font-size: 1.18em; font-family: monospace; margin-top: 4px; display: block; white-space: nowrap; }
        /* Ø¯Ø± ØªØ¨Ù„Øª/Ø¯Ø³Ú©ØªØ§Ù¾ ØµØ±ÙØ§Ù‹ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ú©Ù…ÛŒ Ø¨ÛŒØ´ØªØ± Ú©Ù† */
        @media (min-width: 769px) and (max-width: 1023px) {
            .balance-box { gap: 16px; }
        }
        @media (min-width: 1024px) {
            .balance-box { gap: 18px; }
        }
        /* Ø¯Ú©Ù…Ù‡ Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø­Ø°Ù Ø´Ø¯ */
        .loading, .error-message {
            text-align: center;
            margin: 24px 0;
            color: #a786ff;
        }
        .error-message { color: #ff4444; }
        #copyProfileReferral:hover {
            background: linear-gradient(90deg,#a786ff,#00ff88) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,255,136,0.3);
        }
        #copyProfileReferral:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <script src="js/navbar.js"></script>
    <div class="container">
        <h1>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</h1>
        <div id="profile-progress" style="display:none;height:6px;background:rgba(255,255,255,0.12);border-radius:999px;overflow:hidden;margin:-8px 0 16px 0;">
          <div id="profile-progress-inner" style="height:100%;width:0%;background:linear-gradient(90deg,#00ff88,#a786ff);box-shadow:0 0 12px rgba(0,255,136,0.35) inset;transition:width 300ms ease;">
          </div>
        </div>
        <div id="profile-content">
            <div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>
        </div>
        <div id="eligibility-modal" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(24,28,42,0.85);align-items:center;justify-content:center;">
          <div id="eligibility-modal-content" style="background:#232946;border-radius:16px;max-width:95vw;width:370px;padding:2.2em 1.2em 1.5em 1.2em;box-shadow:0 8px 32px #0008;position:relative;text-align:center;color:#fff;font-size:1.08em;">
            <button id="eligibility-modal-close" style="position:absolute;top:0.7em;left:0.7em;background:none;border:none;color:#a786ff;font-size:1.5em;cursor:pointer;">âœ–</button>
            <div id="eligibility-modal-body"></div>
          </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/profile.js"></script>
    <script>
    function showProfileProgress() {
        const bar = document.getElementById('profile-progress');
        if (bar) bar.style.display = 'block';
    }
    function setProfileProgress(pct) {
        const inner = document.getElementById('profile-progress-inner');
        if (inner) inner.style.width = Math.max(0, Math.min(100, pct)) + '%';
    }
    function hideProfileProgress() {
        const bar = document.getElementById('profile-progress');
        if (!bar) return;
        setTimeout(() => { bar.style.display = 'none'; setProfileProgress(0); }, 400);
    }

    // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    function formatHMS(totalSeconds) {
        const s = Math.max(0, Math.floor(totalSeconds));
        const hh = String(Math.floor(s / 3600)).padStart(2,'0');
        const mm = String(Math.floor((s % 3600) / 60)).padStart(2,'0');
        const ss = String(s % 60).padStart(2,'0');
        return `${hh}:${mm}:${ss}`;
    }
    function startCountdownButton(btn, secondsRemaining, storageKey) {
        if (!btn) return;
        // Ø§ÛŒØ¬Ø§Ø¯/ÛŒØ§ÙØªÙ† span Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
        let span = btn.querySelector('.btn-countdown');
        if (!span) {
            span = document.createElement('span');
            span.className = 'btn-countdown';
            span.style.marginInlineStart = '8px';
            span.style.fontSize = '0.85em';
            span.style.opacity = '0.9';
            btn.appendChild(span);
        }
        // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ØªØ§ÛŒÙ…Ø± Ù‚Ø¨Ù„ÛŒ Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯
        const prevId = btn.getAttribute('data-timer-id');
        if (prevId) {
            clearInterval(Number(prevId));
            btn.removeAttribute('data-timer-id');
        }
        const endAt = Date.now() + Math.max(0, secondsRemaining) * 1000;
        function tick() {
            const remain = Math.ceil((endAt - Date.now()) / 1000);
            if (remain > 0) {
                btn.disabled = true;
                btn.style.opacity = '0.6';
                btn.style.cursor = 'not-allowed';
                span.textContent = `(${formatHMS(remain)})`;
                span.style.color = '#ffffff'; // Ø±Ù†Ú¯ Ø³ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³
                span.style.fontWeight = 'normal';
            } else {
                // Ø²Ù…Ø§Ù† Ø¨Ù‡ ØµÙØ± Ø±Ø³ÛŒØ¯Ù‡ - Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¦Ù…ÛŒ 00:00:00
                btn.disabled = false;
                btn.style.opacity = '';
                btn.style.cursor = '';
                span.textContent = '(00:00:00)';
                span.style.color = '#232946'; // Ø±Ù†Ú¯ ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ø§Ø³Øª Ø¨Ù‡ØªØ± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø³Ø¨Ø²
                span.style.fontWeight = 'bold';
                // ØªØ§ÛŒÙ…Ø± Ø±Ø§ Ù…ØªÙˆÙ‚Ù Ù†Ú©Ù†ØŒ ÙÙ‚Ø· Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª Ù†Ú¯Ù‡ Ø¯Ø§Ø±
            }
        }
        tick();
        const id = setInterval(tick, 1000);
        btn.setAttribute('data-timer-id', String(id));
    }

    function startMonthCounterButton(btn, lastClaimTimestamp) {
        if (!btn) return;
        // Ø§ÛŒØ¬Ø§Ø¯/ÛŒØ§ÙØªÙ† span Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ù…Ø§Ù‡
        let span = btn.querySelector('.btn-countdown');
        if (!span) {
            span = document.createElement('span');
            span.className = 'btn-countdown';
            span.style.marginInlineStart = '8px';
            span.style.fontSize = '0.85em';
            span.style.opacity = '0.9';
            btn.appendChild(span);
        }
        
        function updateCounter() {
            const now = Math.floor(Date.now() / 1000);
            const lastClaim = Number(lastClaimTimestamp || 0);
            const monthsPassed = Math.floor((now - lastClaim) / (30 * 24 * 3600));
            
            if (monthsPassed >= 1) {
                btn.disabled = false;
                btn.style.opacity = '';
                btn.style.cursor = '';
                span.textContent = `(${monthsPassed} Ù…Ø§Ù‡)`;
                span.style.color = '#232946'; // Ø±Ù†Ú¯ ØªÛŒØ±Ù‡ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø³Ø¨Ø²
                span.style.fontWeight = 'bold';
            } else {
                // Ù‡Ù†ÙˆØ² ÛŒÚ© Ù…Ø§Ù‡ Ù†Ú¯Ø°Ø´ØªÙ‡
                const remainSeconds = (30 * 24 * 3600) - (now - lastClaim);
                const remainDays = Math.ceil(remainSeconds / (24 * 3600));
                btn.disabled = true;
                btn.style.opacity = '0.6';
                btn.style.cursor = 'not-allowed';
                span.textContent = `(${remainDays} Ø±ÙˆØ²)`;
                span.style.color = '#ffffff';
                span.style.fontWeight = 'normal';
            }
        }
        
        updateCounter();
        const id = setInterval(updateCounter, 60000); // Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ú†Ú© Ú©Ù†
        btn.setAttribute('data-timer-id', String(id));
    }
    function formatDateTime(ts) {
        if (!ts || ts == 0) return '-';
        // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø±Ø´ØªÙ‡ Ùˆ Ø³Ù¾Ø³ Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§ÛŒ BigInt
        let n = Number(ts.toString());
        if (isNaN(n)) return '-';
        // Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø± Ø­Ø³Ø¨ Ø«Ø§Ù†ÛŒÙ‡ Ø§Ø³Øª (Ú©ÙˆÚ†Ú©)ØŒ Ø¶Ø±Ø¨Ø¯Ø± 1000 Ú©Ù†
        if (n < 10000000000) n = n * 1000;
        const d = new Date(n);
        if (isNaN(d.getTime())) return '-';
        // YYYY-MM-DD HH:mm
        return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0') + ' ' + String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0');
    }
    async function loadProfile() {
        showProfileProgress();
        setProfileProgress(10);
        const content = document.getElementById('profile-content');
        content.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>';
        try {
            if (!window.connectWallet) throw new Error('Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª');
            const { contract, address, provider } = await window.connectWallet();
            setProfileProgress(40);
            if (!contract || !address) throw new Error('Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯');
            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª struct User
            const user = await contract.users(address);
            setProfileProgress(60);
            // Ù…ÙˆØ¬ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
            const maticBalance = await provider.getBalance(address);
            const cpaBalance = await contract.balanceOf(address);
            setProfileProgress(75);
            
            // ØªØ§Ø¨Ø¹ Ú©ÙˆØªØ§Ù‡ Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø²Ø±Ú¯
            function formatLargeNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                } else {
                    return num.toFixed(2);
                }
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¹Ø§Ø¯Ù„ Ø¯Ù„Ø§Ø±ÛŒ CPA
            let cpaUsdValue = 0;
            let tokenPrice = 0;
            try {
                if (typeof contract.getTokenPrice === 'function') {
                    const tokenPriceRaw = await contract.getTokenPrice();
                    tokenPrice = Number(ethers.formatUnits(tokenPriceRaw, 18));
                    const cpaAmount = Number(ethers.formatUnits(cpaBalance, 18));
                    cpaUsdValue = cpaAmount * tokenPrice;
                }
            } catch (e) {
                console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª ØªÙˆÚ©Ù†:', e);
            }
            
            // DAI
            let daiBalance = '0';
            try {
                const daiAddress = window.DAI_ADDRESS || '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063';
                const daiAbi = window.DAI_ABI || [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"}];
                const dai = new ethers.Contract(daiAddress, daiAbi, provider);
                const daiRaw = await dai.balanceOf(address);
                daiBalance = ethers.formatUnits(daiRaw, 18);
            } catch {}
            // Ø§ÛŒÙ†Ø¯Ú©Ø³
            const cpaId = user.index ? `CPA${user.index.toString().padStart(5, '0')}` : '-';
            // Ø´Ø±Ø· ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø¯Ú©Ù…Ù‡ Ú©Ø´Ø¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡
            let canMonthlyCashback = false;
            let monthlyMsg = '';
            const now = Math.floor(Date.now() / 1000);
            const lastMonthly = user.lastMonthlyClaim ? Number(user.lastMonthlyClaim) : 0;
            const oneMonth = 30 * 24 * 60 * 60;
            // Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ø²Ù†Ø¯ Ø®Ø§Ù„ÛŒ (left ÛŒØ§ right)
            let hasEmptyChild = false;
            if (typeof contract.indexToAddress === 'function') {
                const leftAddr = await contract.indexToAddress(BigInt(user.index) * 2n);
                const rightAddr = await contract.indexToAddress(BigInt(user.index) * 2n + 1n);
                if (!leftAddr || leftAddr === '0x0000000000000000000000000000000000000000' || !rightAddr || rightAddr === '0x0000000000000000000000000000000000000000') {
                    hasEmptyChild = true;
                }
            }
            if (hasEmptyChild && (now - lastMonthly >= oneMonth)) {
                canMonthlyCashback = true;
            } else {
                if (!hasEmptyChild) monthlyMsg = 'Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´Ø¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ÙØ±Ø²Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.';
                else if (now - lastMonthly < oneMonth) monthlyMsg = 'Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ø§Ù‡ Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.';
            }
            const cashbackBtnDisplay = hasEmptyChild ? '' : 'display:none;';
            // Ù†Ù…Ø§ÛŒØ´
            content.innerHTML = `
                <div class="balance-box">
                    <div class="balance-item">
                        <div class="balance-label">CPA</div>
                        <span class="balance-value" title="${Number.parseFloat(ethers.formatUnits(cpaBalance.toString(), 18)).toLocaleString('en-US', {maximumFractionDigits: 4})}">${formatLargeNumber(Number.parseFloat(ethers.formatUnits(cpaBalance.toString(), 18)))}</span>
                        <div style="font-size:0.8rem;color:#a786ff;margin-top:2px;">â‰ˆ $${formatLargeNumber(cpaUsdValue)}</div>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">MATIC</div>
                        <span class="balance-value" title="${Number.parseFloat(ethers.formatEther(maticBalance.toString())).toLocaleString('en-US', {maximumFractionDigits: 4})}">${formatLargeNumber(Number.parseFloat(ethers.formatEther(maticBalance.toString())))}</span>
                    </div>
                    <div class="balance-item">
                        <div class="balance-label">DAI</div>
                        <span class="balance-value" title="${Number.parseFloat(daiBalance.toString()).toLocaleString('en-US', {maximumFractionDigits: 4})}">${formatLargeNumber(Number.parseFloat(daiBalance.toString()))}</span>
                    </div>
                </div>
                <div style="display:flex;gap:1.2rem;justify-content:center;margin-bottom:1.5rem;">
                  <button id="claim-btn" title="Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù…ØªÛŒØ§Ø² ÙÙ‚Ø· Ù‡Ø± Û±Û² Ø³Ø§Ø¹Øª ÛŒÚ©Ø¨Ø§Ø± Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ø¯Ø§Ø´ØªÙ† Ø§Ù…ØªÛŒØ§Ø² Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ø³Øª. Ø§Ú¯Ø± Ø§Ù…ØªÛŒØ§Ø² Ù†Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ù‡Ù†ÙˆØ² Û±Û² Ø³Ø§Ø¹Øª Ù†Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª." style="background:linear-gradient(90deg,#00ff88,#a786ff);color:#181c2a;font-weight:bold;border:none;border-radius:10px;padding:0.9em 2.2em;font-size:1.08em;cursor:pointer;box-shadow:0 2px 8px #00ff8840;display:inline-flex;align-items:center;gap:0.6em;transition:box-shadow 0.2s,transform 0.2s;"><span style='font-size:1.2em;'>ğŸ’¸</span> Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾ÙˆØ±Ø³Ø§Ù†Øª</button>
                  ${hasEmptyChild ? '<button id="monthly-cashback-btn" title="Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´â€ŒØ¨Ú© ÙÙ‚Ø· Ù‡Ø± Û³Û° Ø±ÙˆØ² ÛŒÚ©Ø¨Ø§Ø±ØŒ Ø¨Ø§ Ø¯Ø§Ø´ØªÙ† Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ÙØ±Ø²Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ùˆ ØªØ§ Ø³Ù‚Ù Ø³Ù¾Ø±Ø¯Ù‡ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª. Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ù¾Ø± Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ù‡Ù†ÙˆØ² Û³Û° Ø±ÙˆØ² Ù†Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ø³Ù‚Ù Ú©Ø´â€ŒØ¨Ú© Ù¾Ø± Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª." style="background:linear-gradient(90deg,#a786ff,#00ff88);color:#181c2a;font-weight:bold;border:none;border-radius:10px;padding:0.9em 2.2em;font-size:1.08em;cursor:pointer;box-shadow:0 2px 8px #a786ff40;display:inline-flex;align-items:center;gap:0.6em;transition:box-shadow 0.2s,transform 0.2s;"><span style="font-size:1.2em;">ğŸ“†</span> Ú©Ø´â€ŒØ¨Ú©</button>' : ''}
                </div>
                <div id="monthly-cashback-msg" style="display:none;color:#ff4444;text-align:center;margin-bottom:1.2rem;font-size:1.05em;transition:opacity 0.3s;"></div>
                <div class="profile-row"><span class="profile-label">Ø¢Ø¯Ø±Ø³ Ú©ÛŒÙ Ù¾ÙˆÙ„:</span><span class="profile-value">${address}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§ÛŒÙ†Ø¯Ú©Ø³:</span><span class="profile-value">${cpaId}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§ÛŒÙ†Ø¯Ú©Ø³:</span><span class="profile-value">${user.index}</span></div>
                <div class="profile-row"><span class="profile-label">ÙØ¹Ø§Ù„:</span><span class="profile-value">${user.activated ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§ÛŒÙ†Ø±ÛŒ:</span><span class="profile-value">${user.binaryPoints}</span></div>
                <div class="profile-row"><span class="profile-label">Ø³Ù‚Ù Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§ÛŒÙ†Ø±ÛŒ:</span><span class="profile-value">${user.binaryPointCap}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªâ€ŒØ´Ø¯Ù‡:</span><span class="profile-value">${user.binaryPointsClaimed}</span></div>
                <div class="profile-row"><span class="profile-label">Ù…Ø¬Ù…ÙˆØ¹ Ø®Ø±ÛŒØ¯:</span><span class="profile-value">${user.totalPurchasedKind}</span></div>
                <div class="profile-row"><span class="profile-label">Ø²Ù…Ø§Ù† Ø§Ø±ØªÙ‚Ø§:</span><span class="profile-value">${formatDateTime(user.upgradeTime)}</span></div>
                <div class="profile-row"><span class="profile-label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù…ØªÛŒØ§Ø²:</span><span class="profile-value">${formatDateTime(user.lastClaimTime)}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§Ù…ØªÛŒØ§Ø² Ú†Ù¾:</span><span class="profile-value">${user.leftPoints}</span></div>
                <div class="profile-row"><span class="profile-label">Ø§Ù…ØªÛŒØ§Ø² Ø±Ø§Ø³Øª:</span><span class="profile-value">${user.rightPoints}</span></div>
                <div class="profile-row"><span class="profile-label">ØªØ¹Ø¯Ø§Ø¯ ÙˆÙ„Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ú†Ù¾:</span><span class="profile-value" id="profile-left-wallets">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...</span></div>
                <div class="profile-row"><span class="profile-label">ØªØ¹Ø¯Ø§Ø¯ ÙˆÙ„Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ø±Ø§Ø³Øª:</span><span class="profile-value" id="profile-right-wallets">Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...</span></div>
                <div class="profile-row"><span class="profile-label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ø§Ù‡Ø§Ù†Ù‡:</span><span class="profile-value">${formatDateTime(user.lastMonthlyClaim)}</span></div>
                <div class="profile-row"><span class="profile-label">Ú©Ù„ Ù¾Ø§Ø¯Ø§Ø´ Ù…Ø§Ù‡Ø§Ù†Ù‡:</span><span class="profile-value">${user.totalMonthlyRewarded}</span></div>
                <div class="profile-row"><span class="profile-label">Ù¾Ø§Ø¯Ø§Ø´ Ø±ÙØ±Ø§Ù„:</span><span class="profile-value">${Number(user.refclimed.toString())/1e18|0}</span></div>
                <div class="profile-row"><span class="profile-label">Ø³Ù¾Ø±Ø¯Ù‡:</span><span class="profile-value">${Number(user.depositedAmount.toString())/1e18|0}</span></div>
                <div class="profile-row" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                    <span class="profile-label">Ù„ÛŒÙ†Ú© Ø±ÙØ±Ø§Ù„:</span>
                    <div style="display: flex; align-items: center; gap: 10px; width: 100%; background: rgba(167,134,255,0.1); border-radius: 8px; padding: 12px; border: 1px solid #a786ff33;">
                        <span class="profile-value" id="profile-referral-link" style="flex: 1; word-break: break-all; font-size: 0.9em;">${window.location.origin}/?ref=${address}</span>
                        <button id="copyProfileReferral" style="background: linear-gradient(90deg,#00ff88,#a786ff); color: #181c2a; border: none; border-radius: 6px; padding: 8px 16px; font-size: 0.9em; cursor: pointer; font-weight: bold; white-space: nowrap; transition: all 0.2s;">Ú©Ù¾ÛŒ</button>
                    </div>
                </div>
            `;
            // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¹Ú©ÙˆØ³ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (Û±Û² Ø³Ø§Ø¹Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù¾ÙˆØ±Ø³Ø§Ù†Øª Ùˆ Û³Û° Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ú©Ø´â€ŒØ¨Ú©)
            (function setupCountdowns(){
              try {
                const claimBtnEl = document.getElementById('claim-btn');
                const cashbackBtnEl = document.getElementById('monthly-cashback-btn');
                const nowTs = Math.floor(Date.now() / 1000);
                const remainClaim = Math.max(0, Number(user.lastClaimTime || 0) + 12 * 3600 - nowTs);
                const remainMonthly = Math.max(0, Number(user.lastMonthlyClaim || 0) + 30 * 24 * 3600 - nowTs);
                
                // Ù‡Ù…ÛŒØ´Ù‡ ØªØ§ÛŒÙ…Ø± Ø±Ø§ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ù†ØŒ Ø­ØªÛŒ Ø§Ú¯Ù‡ Ø²Ù…Ø§Ù† Ø¨Ù‡ ØµÙØ± Ø±Ø³ÛŒØ¯Ù‡ Ø¨Ø§Ø´Ø¯
                if (claimBtnEl) startCountdownButton(claimBtnEl, remainClaim);
                if (cashbackBtnEl) startMonthCounterButton(cashbackBtnEl, user.lastMonthlyClaim);
              } catch (e) { /* ignore */ }
            })();

            setTimeout(function() {
              const cashbackBtn = document.getElementById('monthly-cashback-btn');
              const cashbackMsg = document.getElementById('monthly-cashback-msg');
              if (cashbackBtn && cashbackMsg) {
                const claimBtn = document.getElementById('claim-btn');
                if (claimBtn) {
                  claimBtn.addEventListener('click', async function(e) {
                    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø´Ø±Ø§ÛŒØ·
                    const modal = document.getElementById('eligibility-modal');
                    const modalBody = document.getElementById('eligibility-modal-body');
                    modalBody.innerHTML = '<b>Ø´Ø±Ø§ÛŒØ· Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù…ØªÛŒØ§Ø²:</b><br>â€¢ ÙÙ‚Ø· Ù‡Ø± Û±Û² Ø³Ø§Ø¹Øª ÛŒÚ©Ø¨Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.<br>â€¢ Ø¨Ø§ÛŒØ¯ Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.<br>â€¢ Ø§Ú¯Ø± Ø§Ù…ØªÛŒØ§Ø² Ù†Ø¯Ø§Ø±ÛŒØ¯ ÛŒØ§ Ù‡Ù†ÙˆØ² Û±Û² Ø³Ø§Ø¹Øª Ù†Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª.<br>';
                    modal.style.display = 'flex';
                    await new Promise((resolve) => {
                      document.getElementById('eligibility-modal-close').onclick = () => {
                        modal.style.display = 'none';
                        resolve();
                      };
                    });
                    // Ù¾Ø³ Ø§Ø² Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª
                    claimBtn.disabled = true;
                    claimBtn.style.opacity = '0.5';
                    claimBtn.style.cursor = 'not-allowed';
                    cashbackMsg.style.display = 'block';
                    cashbackMsg.style.opacity = '1';
                    cashbackMsg.style.background = 'rgba(167,134,255,0.08)';
                    cashbackMsg.style.border = '1.5px solid #a786ff';
                    cashbackMsg.style.borderRadius = '10px';
                    cashbackMsg.style.padding = '1em 1.2em';
                    cashbackMsg.style.marginBottom = '1.2rem';
                    cashbackMsg.style.textAlign = 'center';
                    cashbackMsg.style.fontSize = '1.07em';
                    cashbackMsg.style.boxShadow = '0 2px 8px #a786ff22';
                    cashbackMsg.style.whiteSpace = 'pre-line';
                    try {
                      const { contract, address } = await window.connectWallet();
                      const user = await contract.users(address);
                      if (!user.activated) throw new Error('Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª.');
                      if (user.binaryPoints == 0) throw new Error('Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù†Ø¯Ø§Ø±ÛŒØ¯.');
                      cashbackMsg.innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù…ØªÛŒØ§Ø²...';
                      cashbackMsg.style.color = '#a786ff';
                      const tx = await contract.claim();
                      await tx.wait();
                      cashbackMsg.innerHTML = 'âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!';
                      cashbackMsg.style.color = '#00ff88';
                      setTimeout(()=>{cashbackMsg.style.display='none';}, 3200);
                      await loadProfile();
                    } catch(err) {
                      cashbackMsg.innerHTML = 'âŒ ' + (err && err.message ? err.message : err);
                      cashbackMsg.style.color = '#ff4444';
                      setTimeout(()=>{cashbackMsg.style.display='none';}, 4200);
                    }
                    claimBtn.disabled = false;
                    claimBtn.style.opacity = '';
                    claimBtn.style.cursor = '';
                  });
                }
                if (cashbackBtn && cashbackMsg) {
                  cashbackBtn.addEventListener('click', async function(e) {
                    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø´Ø±Ø§ÛŒØ· Ú©Ø´â€ŒØ¨Ú©
                    const modal = document.getElementById('eligibility-modal');
                    const modalBody = document.getElementById('eligibility-modal-body');
                    modalBody.innerHTML = '<b>Ø´Ø±Ø§ÛŒØ· Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´â€ŒØ¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡:</b><br>â€¢ ÙÙ‚Ø· Ù‡Ø± Û³Û° Ø±ÙˆØ² ÛŒÚ©Ø¨Ø§Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø¯Ø§Ø´Øª Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.<br>â€¢ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ÙØ±Ø²Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.<br>â€¢ Ø³Ù‚Ù Ú©Ø´â€ŒØ¨Ú© Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ù…Ø¨Ù„Øº Ø³Ù¾Ø±Ø¯Ù‡ Ø´Ù…Ø§Ø³Øª.<br>â€¢ Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ù¾Ø± Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ù‡Ù†ÙˆØ² Û³Û° Ø±ÙˆØ² Ù†Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ø³Ù‚Ù Ú©Ø´â€ŒØ¨Ú© Ù¾Ø± Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª.<br>â€¢ <span style=\'color:#a786ff\'>Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù…Ú© ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ø± Ù…Ø§Ù‡ Ù…Ø¹Ø§Ø¯Ù„ <b>Ø³Ù‡ Ø¯Ø±ØµØ¯</b> Ø§Ø² Ù…Ø¨Ù„ØºÛŒ Ú©Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø´â€ŒØ¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ø´Ù…Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</span>';
                    modal.style.display = 'flex';
                    await new Promise((resolve) => {
                      document.getElementById('eligibility-modal-close').onclick = () => {
                        modal.style.display = 'none';
                        resolve();
                      };
                    });
                    cashbackBtn.disabled = true;
                    cashbackBtn.style.opacity = '0.5';
                    cashbackBtn.style.cursor = 'not-allowed';
                    cashbackMsg.style.display = 'block';
                    cashbackMsg.style.opacity = '1';
                    cashbackMsg.style.background = 'rgba(0,255,136,0.08)';
                    cashbackMsg.style.border = '1.5px solid #00ff88';
                    cashbackMsg.style.borderRadius = '10px';
                    cashbackMsg.style.padding = '1em 1.2em';
                    cashbackMsg.style.marginBottom = '1.2rem';
                    cashbackMsg.style.textAlign = 'center';
                    cashbackMsg.style.fontSize = '1.07em';
                    cashbackMsg.style.boxShadow = '0 2px 8px #00ff8822';
                    cashbackMsg.style.whiteSpace = 'pre-line';
                    try {
                      const { contract, address } = await window.connectWallet();
                      const user = await contract.users(address);
                      const now = Math.floor(Date.now() / 1000);
                      const leftAddr = await contract.getLeftAddress(user.index);
                      const rightAddr = await contract.getRightAddress(user.index);
                      if (!user.activated) throw new Error('Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª.');
                      if (leftAddr != '0x0000000000000000000000000000000000000000' && rightAddr != '0x0000000000000000000000000000000000000000')
                        throw new Error('Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´â€ŒØ¨Ú© Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ÙØ±Ø²Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.');
                      if (now < Number(user.lastMonthlyClaim) + 30 * 24 * 3600) {
                        const remain = Math.ceil((Number(user.lastMonthlyClaim) + 30 * 24 * 3600 - now) / (24*3600));
                        throw new Error(`Ù‡Ù†ÙˆØ² ${remain} Ø±ÙˆØ² ØªØ§ Ø¨Ø±Ø¯Ø§Ø´Øª Ø¨Ø¹Ø¯ÛŒ Ú©Ø´â€ŒØ¨Ú© Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª.`);
                      }
                      if (user.totalMonthlyRewarded >= user.depositedAmount)
                        throw new Error('Ø³Ù‚Ù Ú©Ø´â€ŒØ¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø´Ù…Ø§ Ù¾Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª.');
                      cashbackMsg.innerHTML = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´â€ŒØ¨Ú©...';
                      cashbackMsg.style.color = '#a786ff';
                      const tx = await contract.claimMonthlyReward(1);
                      await tx.wait();
                      cashbackMsg.innerHTML = 'âœ… Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø´Ø¨Ú© Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\nØ¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù…Ú© ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ø± Ù…Ø§Ù‡ Ù…Ø¹Ø§Ø¯Ù„ <b>Ø³Ù‡ Ø¯Ø±ØµØ¯</b> Ø§Ø² Ù…Ø¨Ù„ØºÛŒ Ú©Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø´â€ŒØ¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ø´Ù…Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.';
                      cashbackMsg.style.color = '#00ff88';
                      setTimeout(()=>{cashbackMsg.style.display='none';}, 3200);
                      await loadProfile();
                    } catch(err) {
                      cashbackMsg.innerHTML = 'âŒ ' + (err && err.message ? err.message : err) + '\nØ¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ú©Ù…Ú© ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù‡Ø± Ù…Ø§Ù‡ Ù…Ø¹Ø§Ø¯Ù„ <b>Ø³Ù‡ Ø¯Ø±ØµØ¯</b> Ø§Ø² Ù…Ø¨Ù„ØºÛŒ Ú©Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø´â€ŒØ¨Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ø´Ù…Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.';
                      cashbackMsg.style.color = '#ff4444';
                      setTimeout(()=>{cashbackMsg.style.display='none';}, 4200);
                    }
                    cashbackBtn.disabled = false;
                    cashbackBtn.style.opacity = '';
                    cashbackBtn.style.cursor = '';
                  });
                }
              }
            }, 100);
            setProfileProgress(100);
            hideProfileProgress();
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ø±ÙØ±Ø§Ù„
            if (typeof setupReferralCopy === 'function') {
                setupReferralCopy();
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ ÙˆÙ„Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ù…Øª Ø±Ø§Ø³Øª Ùˆ Ú†Ù¾
            if (typeof updateWalletCountsDisplay === 'function') {
                setTimeout(async () => {
                    await updateWalletCountsDisplay();
                }, 1000); // ØªØ§Ø®ÛŒØ± 1 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„
            }
        } catch (e) {
            content.innerHTML = `<div class="error-message">Ø®Ø·Ø§: ${e.message || e}</div>`;
            setProfileProgress(100);
            hideProfileProgress();
        }
    }
    window.addEventListener('DOMContentLoaded', async function() {
        try {
            await loadProfile();
        } catch (e) {
            // Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ØŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø¹Ø¯ Ø§Ø² Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
        }
    });
    </script>
    
    <!-- Floating Token Growth Card - Ú©Ø§Ø±Øª Ø´Ù†Ø§ÙˆØ± Ø±Ø´Ø¯ ØªÙˆÚ©Ù† -->
    <script src="js/floating-token-card.js?v=20250809"></script>
    <script>
      window.addEventListener('DOMContentLoaded', function() {
        try {
          if (window.showFloatingCardNow) {
            window.showFloatingCardNow();
          }
          setTimeout(function(){
            if (window.updateCardToOval) {
              window.updateCardToOval();
            }
          }, 100);
        } catch (e) {
          console.warn('Floating card init error:', e);
        }
      });
    </script>
</body>
</html> 
