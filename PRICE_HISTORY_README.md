# سیستم تاریخچه قیمت‌های CPA Terminal

## 📊 بررسی کلی

این سیستم برای ذخیره و نمایش تاریخچه قیمت‌های توکن CPA و پوینت‌ها طراحی شده است. سیستم شامل:

- **ذخیره خودکار قیمت‌ها** در localStorage
- **نمایش چارت قیمت** با قابلیت تغییر دوره زمانی
- **آمار قیمت‌ها** (حداقل، حداکثر)
- **به‌روزرسانی خودکار** هر 30 ثانیه

## 🏗️ ساختار فایل‌ها

### `js/price-history-manager.js`
کلاس اصلی مدیریت تاریخچه قیمت‌ها:

```javascript
class PriceHistoryManager {
    // مدیریت تاریخچه قیمت توکن و پوینت
    // ذخیره در localStorage
    // به‌روزرسانی خودکار
}
```

### `js/price-chart.js`
کلاس نمایش چارت قیمت:

```javascript
class PriceChart {
    // نمایش چارت با Chart.js
    // تغییر دوره زمانی
    // به‌روزرسانی چارت
}
```

## 🔧 قابلیت‌ها

### 1. ذخیره تاریخچه
- **توکن CPA**: قیمت توکن از قرارداد
- **پوینت**: ارزش پوینت از قرارداد
- **دوره‌های زمانی**: روزانه، هفتگی، ماهانه، سالانه

### 2. نمایش چارت
- **چارت خطی** با Chart.js
- **رنگ‌بندی**: سبز برای توکن، بنفش برای پوینت
- **نمایش علمی**: برای اعداد خیلی کوچک
- **فقط قیمت‌های واقعی**: تا زمان فعلی

### 3. آمار قیمت‌ها
- **حداقل قیمت**: کمترین قیمت در دوره
- **حداکثر قیمت**: بیشترین قیمت در دوره
- **به‌روزرسانی خودکار**: با تغییر دوره زمانی

### 4. کنترل‌ها
- **دکمه‌های دوره زمانی**: Day, Week, Month, Year
- **دکمه پاک کردن**: حذف کامل تاریخچه
- **تایمر خودکار**: به‌روزرسانی هر 30 ثانیه

## 📱 رابط کاربری

### نمایش قیمت‌های فعلی
```
Token Price: 0.000123 CPA
Point Value: 0.000045 CPA
```

### آمار قیمت‌ها
```
Token Min: 0.000100 | Token Max: 0.000150
Point Min: 0.000040 | Point Max: 0.000050
```

### دکمه‌های کنترل
- **Day (24h)**: نمایش 24 ساعت
- **Week (7d)**: نمایش 7 روز
- **Month (30d)**: نمایش 30 روز
- **Year (12m)**: نمایش 12 ماه
- **🗑️ Clear History**: پاک کردن تاریخچه

## 🔄 به‌روزرسانی خودکار

### تایمرها
- **قیمت توکن**: هر 30 ثانیه
- **قیمت پوینت**: هر 30 ثانیه
- **آمار**: با تغییر دوره زمانی

### ذخیره‌سازی
- **localStorage**: `cpa_price_history_complete`
- **فرمت**: JSON با ساختار کامل
- **بازیابی**: خودکار در بارگذاری صفحه

## 📊 ساختار داده

### تاریخچه قیمت توکن
```javascript
tokenPriceHistory: {
    day: Array(24),    // 24 ساعت
    week: Array(7),    // 7 روز
    month: Array(30),  // 30 روز
    year: Array(12)    // 12 ماه
}
```

### تاریخچه قیمت پوینت
```javascript
pointPriceHistory: {
    day: Array(24),    // 24 ساعت
    week: Array(7),    // 7 روز
    month: Array(30),  // 30 روز
    year: Array(12)    // 12 ماه
}
```

## 🚀 استفاده

### راه‌اندازی خودکار
```javascript
// در DOMContentLoaded
window.priceHistoryManager = new PriceHistoryManager();
window.priceHistoryManager.startAutoUpdate();
```

### به‌روزرسانی دستی
```javascript
// به‌روزرسانی قیمت توکن
const tokenPrice = await window.priceHistoryManager.updateTokenPrice();

// به‌روزرسانی قیمت پوینت
const pointPrice = await window.priceHistoryManager.updatePointPrice();
```

### دریافت آمار
```javascript
// آمار توکن برای دوره روزانه
const tokenStats = window.priceHistoryManager.getHistoryStats('token', 'day');

// آمار پوینت برای دوره هفتگی
const pointStats = window.priceHistoryManager.getHistoryStats('point', 'week');
```

## 🔧 تنظیمات

### تغییر فاصله به‌روزرسانی
```javascript
// تغییر به 60 ثانیه
window.priceHistoryManager.startAutoUpdate(60000);
```

### پاک کردن تاریخچه
```javascript
// پاک کردن کامل
window.priceHistoryManager.clearHistory();
```

### دریافت تاریخچه کامل
```javascript
// دریافت همه داده‌ها
const fullHistory = window.priceHistoryManager.getFullHistory();
```

## 📝 نکات مهم

1. **فقط قیمت‌های واقعی**: چارت فقط قیمت‌های ثبت شده را نمایش می‌دهد
2. **ذخیره خودکار**: همه تغییرات در localStorage ذخیره می‌شود
3. **بازیابی خودکار**: در بارگذاری مجدد صفحه، تاریخچه بازیابی می‌شود
4. **فرمت علمی**: اعداد کوچک‌تر از 0.000001 به صورت علمی نمایش داده می‌شوند
5. **خطایابی**: در صورت خطا در دریافت قیمت، پیام مناسب نمایش داده می‌شود

## 🐛 عیب‌یابی

### مشکل عدم نمایش قیمت
1. بررسی اتصال کیف پول
2. بررسی قرارداد
3. بررسی console برای خطاها

### مشکل عدم ذخیره
1. بررسی localStorage
2. بررسی فضای ذخیره
3. بررسی دسترسی‌های مرورگر

### مشکل عدم به‌روزرسانی
1. بررسی تایمرها
2. بررسی اتصال شبکه
3. بررسی خطاهای JavaScript

## 🔮 توسعه آینده

- [ ] ذخیره در فایل JSON
- [ ] API برای دریافت تاریخچه
- [ ] نمودار مقایسه‌ای توکن و پوینت
- [ ] تحلیل روند قیمت
- [ ] هشدار تغییرات قیمت
- [ ] صادرات داده‌ها 